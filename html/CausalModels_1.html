<div class="container">

<table style="width: 100%;"><tr>
<td>doubly_robust</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Doubly Robust Model</h2>

<h3>Description</h3>

<p><code>`doubly_robust`</code> trains both an outcome model and a propensity model to generate predictions
for the outcome and probability of treatment respectively. By default, the model uses
<code>standardization</code> and <code>propensity_scores</code> to form a
doubly-robust model between standardization and IP weighting. Alternatively, any outcome and treatment
models can be provided instead, but must be compatible with the <code>predict</code> generic function in R.
Since many propensity models may not predict probabilities without additional arguments into the
predict function, the predictions themselves can be given for both the outcome and propensity scores.
</p>


<h3>Usage</h3>

<pre><code class="language-R">doubly_robust(
  data,
  out.mod = NULL,
  p.mod = NULL,
  f = NA,
  family = gaussian(),
  simple = pkg.env$simple,
  scores = NA,
  p.f = NA,
  p.simple = pkg.env$simple,
  p.family = binomial(),
  p.scores = NA,
  n.boot = 50,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame containing the variables in the model.
This should be the same data used in <code>init_params</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out.mod</code></td>
<td>
<p>(optional) a regression model that predicts the outcome. NOTE: the model given
must be compatible with the <code>predict</code> generic function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.mod</code></td>
<td>
<p>(optional) a propensity model that predicts the probability of treatment. NOTE: the model given
must be compatible with the <code>predict</code> generic function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>(optional) an object of class "formula" that overrides the default parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>the family to be used in the general linear model.
By default, this is set to <code>gaussian</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simple</code></td>
<td>
<p>a boolean indicator to build default formula with interactions.
If true, interactions will be excluded. If false, interactions will be included. By
default, simple is set to false.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>(optional) use calculated outcome estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.f</code></td>
<td>
<p>(optional) an object of class "formula" that overrides the default formula for the denominator of the IP
weighting function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.simple</code></td>
<td>
<p>a boolean indicator to build default formula with interactions for the propensity models.
If true, interactions will be excluded. If false, interactions will be included. By
default, simple is set to false.
NOTE: if this is changed, the coefficient for treatment may not accurately represent the average causal effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.family</code></td>
<td>
<p>the family to be used in the underlying propensity model.
By default, this is set to <code>binomial</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.scores</code></td>
<td>
<p>(optional) use calculated propensity scores.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.boot</code></td>
<td>
<p>an integer value that indicates number of bootstrap iterations to calculate standard error.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments that may be passed to the underlying <code>glm</code> model.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>doubly_robust</code> returns an object of <code>class</code> "doubly_robust".
</p>
<p>The functions <code>print</code>, <code>summary</code>, and <code>predict</code> can be used to interact with
the underlying <code>glm</code> model.
</p>
<p>An object of class <code>"doubly_robust"</code> is a list containing the following:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>out.call</code></td>
<td>
<p>the matched call of the outcome model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.call</code></td>
<td>
<p>the matched call of the propensity model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out.model</code></td>
<td>
<p>the underlying outcome model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.model</code></td>
<td>
<p>the underlying propensity model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_hat</code></td>
<td>
<p>the estimated outcome values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.scores</code></td>
<td>
<p>the estimated propensity scores.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ATE</code></td>
<td>
<p>the estimated average treatment effect (risk difference).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ATE.summary</code></td>
<td>
<p>a data frame containing the ATE, SE, and 95% CI of the ATE. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the data frame used to train the model.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">library(causaldata)
data(nhefs)
nhefs.nmv &lt;- nhefs[which(!is.na(nhefs$wt82)), ]
nhefs.nmv$qsmk &lt;- as.factor(nhefs.nmv$qsmk)

confounders &lt;- c(
  "sex", "race", "age", "education", "smokeintensity",
  "smokeyrs", "exercise", "active", "wt71"
)

init_params(wt82_71, qsmk,
  covariates = confounders,
  data = nhefs.nmv
)

# model using all defaults
model &lt;- doubly_robust(data = nhefs.nmv)
summary(model)

# use alternative outcome model
out.mod &lt;- propensity_matching(data = nhefs.nmv)
db.model &lt;- doubly_robust(
  out.mod = out.mod,
  data = nhefs.nmv
)
db.model

# give calculated outcome predictions and give formula for propensity scores
db.model &lt;- doubly_robust(
  scores = predict(out.mod),
  p.f = qsmk ~ sex + race + age,
  data = nhefs.nmv
)
db.model

</code></pre>


</div>