<div class="container">

<table style="width: 100%;"><tr>
<td>ffs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Forward feature selection</h2>

<h3>Description</h3>

<p>A simple forward feature selection algorithm
</p>


<h3>Usage</h3>

<pre><code class="language-R">ffs(
  predictors,
  response,
  method = "rf",
  metric = ifelse(is.factor(response), "Accuracy", "RMSE"),
  maximize = ifelse(metric == "RMSE", FALSE, TRUE),
  globalval = FALSE,
  withinSE = FALSE,
  minVar = 2,
  trControl = caret::trainControl(),
  tuneLength = 3,
  tuneGrid = NULL,
  seed = sample(1:1000, 1),
  verbose = TRUE,
  cores = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>predictors</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maximize</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>globalval</code></td>
<td>
<p>Logical. Should models be evaluated based on 'global' performance? See <code>global_validation</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>withinSE</code></td>
<td>
<p>Logical Models are only selected if they are better than the
currently best models Standard error</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minVar</code></td>
<td>
<p>Numeric. Number of variables to combine for the first selection.
See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trControl</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuneLength</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuneGrid</code></td>
<td>
<p>see <code>train</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>A random number used for model training</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical. Should information about the progress be printed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Numeric. If &gt; 2, mclapply will be used. see <code>mclapply</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments passed to the classification or regression routine
(such as randomForest).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Models with two predictors are first trained using all possible
pairs of predictor variables. The best model of these initial models is kept.
On the basis of this best model the predictor variables are iteratively
increased and each of the remaining variables is tested for its improvement
of the currently best model. The process stops if none of the remaining
variables increases the model performance when added to the current best model.
</p>
<p>The forward feature selection can be run in parallel with forking on Linux systems (mclapply).
Each fork computes a model, which drastically speeds up the runtime -
especially of the initial predictor search.
The internal cross validation can be run in parallel on all systems. See information
on parallel processing of carets train functions for details.
</p>
<p>Using withinSE will favour models with less variables and
probably shorten the calculation time
</p>
<p>Per Default, the ffs starts with all possible 2-pair combinations.
minVar allows to start the selection with more than 2 variables, e.g.
minVar=3 starts the ffs testing all combinations of 3 (instead of 2) variables
first and then increasing the number. This is important for e.g. neural networks
that often cannot make sense of only two variables. It is also relevant if
it is assumed that the optimal variables can only be found if more than 2
are considered at the same time.
</p>


<h3>Value</h3>

<p>A list of class train. Beside of the usual train content
the object contains the vector "selectedvars" and "selectedvars_perf"
that give the order of the best variables selected as well as their corresponding
performance (starting from the first two variables). It also contains "perf_all"
that gives the performance of all model runs.
</p>


<h3>Note</h3>

<p>This variable selection is particularly suitable for spatial
cross validations where variable selection
MUST be based on the performance of the model for predicting new spatial units.
See Meyer et al. (2018) and Meyer et al. (2019) for further details.
</p>


<h3>Author(s)</h3>

<p>Hanna Meyer
</p>


<h3>References</h3>


<ul>
<li>
<p> Gasch, C.K., Hengl, T., Gräler, B., Meyer, H., Magney, T., Brown, D.J. (2015): Spatio-temporal interpolation of soil water, temperature, and electrical conductivity in 3D+T: the Cook Agronomy Farm data set. Spatial Statistics 14: 70-90.
</p>
</li>
<li>
<p> Meyer, H., Reudenbach, C., Hengl, T., Katurji, M., Nauß, T. (2018): Improving performance of spatio-temporal machine learning models using forward feature selection and target-oriented validation. Environmental Modelling &amp; Software 101: 1-9.  <a href="https://doi.org/10.1016/j.envsoft.2017.12.001">doi:10.1016/j.envsoft.2017.12.001</a>
</p>
</li>
<li>
<p> Meyer, H., Reudenbach, C., Wöllauer, S., Nauss, T. (2019): Importance of spatial predictor variable selection in machine learning applications - Moving from data reproduction to spatial prediction. Ecological Modelling. 411, 108815. <a href="https://doi.org/10.1016/j.ecolmodel.2019.108815">doi:10.1016/j.ecolmodel.2019.108815</a>.
</p>
</li>
<li>
<p> Ludwig, M., Moreno-Martinez, A., Hölzel, N., Pebesma, E., Meyer, H. (2023): Assessing and improving the transferability of current global spatial prediction models. Global Ecology and Biogeography. <a href="https://doi.org/10.1111/geb.13635">doi:10.1111/geb.13635</a>.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>train</code>,<code>bss</code>,
<code>trainControl</code>,<code>CreateSpacetimeFolds</code>,<code>nndm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
data(splotdata)
ffsmodel &lt;- ffs(splotdata[,6:12], splotdata$Species_richness, ntree = 20)

ffsmodel$selectedvars
ffsmodel$selectedvars_perf
plot(ffsmodel)
#or only selected variables:
plot(ffsmodel,plotType="selected")

## End(Not run)

# or perform model with target-oriented validation (LLO CV)
#the example is described in Gasch et al. (2015). The ffs approach for this dataset is described in
#Meyer et al. (2018). Due to high computation time needed, only a small and thus not robust example
#is shown here.

## Not run: 
# run the model on three cores (see vignette for details):
library(doParallel)
library(lubridate)
cl &lt;- makeCluster(3)
registerDoParallel(cl)

#load and prepare dataset:
data(cookfarm)
trainDat &lt;- cookfarm[cookfarm$altitude==-0.3&amp;
  year(cookfarm$Date)==2012&amp;week(cookfarm$Date)%in%c(13:14),]

#visualize dataset:
ggplot(data = trainDat, aes(x=Date, y=VW)) + geom_line(aes(colour=SOURCEID))

#create folds for Leave Location Out Cross Validation:
set.seed(10)
indices &lt;- CreateSpacetimeFolds(trainDat,spacevar = "SOURCEID",k=3)
ctrl &lt;- trainControl(method="cv",index = indices$index)

#define potential predictors:
predictors &lt;- c("DEM","TWI","BLD","Precip_cum","cday","MaxT_wrcc",
"Precip_wrcc","NDRE.M","Bt","MinT_wrcc","Northing","Easting")

#run ffs model with Leave Location out CV
set.seed(10)
ffsmodel &lt;- ffs(trainDat[,predictors],trainDat$VW,method="rf",
tuneLength=1,trControl=ctrl)
ffsmodel
plot(ffsmodel)
#or only selected variables:
plot(ffsmodel,plotType="selected")

#compare to model without ffs:
model &lt;- train(trainDat[,predictors],trainDat$VW,method="rf",
tuneLength=1, trControl=ctrl)
model
stopCluster(cl)

## End(Not run)

## Not run: 
## on linux machines, you can also run the ffs in parallel with forks:
data("splotdata")
spatial_cv = CreateSpacetimeFolds(splotdata, spacevar = "Biome", k = 5)
ctrl &lt;- trainControl(method="cv",index = spatial_cv$index)

ffsmodel &lt;- ffs(predictors = splotdata[,6:16],
               response = splotdata$Species_richness,
               tuneLength = 1,
               method = "rf",
               trControl = ctrl,
               ntree = 20,
               seed = 1,
               cores = 4)

## End(Not run)


</code></pre>


</div>