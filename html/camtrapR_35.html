<div class="container">

<table style="width: 100%;"><tr>
<td>recordTableIndividual</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate a single-species record table with individual identification from
camera trap images or videos</h2>

<h3>Description</h3>

<p>The function generates a single-species record table containing individual
IDs, e.g. for (spatial) capture-recapture analyses. It prepares input for
the function <code>spatialDetectionHistory</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">recordTableIndividual(
  inDir,
  hasStationFolders,
  IDfrom,
  cameraID,
  camerasIndependent,
  minDeltaTime = 0,
  deltaTimeComparedTo,
  timeZone,
  stationCol,
  writecsv = FALSE,
  outDir,
  metadataHierarchyDelimitor = "|",
  metadataIDTag,
  additionalMetadataTags,
  removeDuplicateRecords = TRUE,
  returnFileNamesMissingTags = FALSE,
  eventSummaryColumn,
  eventSummaryFunction,
  video
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>inDir</code></td>
<td>
<p>character. Directory containing images of individuals. Must end
with species name (e.g. ".../speciesImages/Clouded Leopard")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hasStationFolders</code></td>
<td>
<p>logical. Does <code>inDir</code> have station
subdirectories? If <code>TRUE</code>, station IDs will be taken from directory
names. If <code>FALSE</code>, they will be taken from image filenames (requires
images renamed with <code>imageRename</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>IDfrom</code></td>
<td>
<p>character. Read individual ID from image metadata ("metadata")
of from directory names ("directory")?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cameraID</code></td>
<td>
<p>character. Should the function look for camera IDs in the
image file names? If so, set to 'filename'. Requires images renamed with
<code>imageRename</code>. If missing, no camera ID will be assigned and it
will be assumed there was 1 camera only per station.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>camerasIndependent</code></td>
<td>
<p>logical. If <code>TRUE</code>, cameras at a station are
assumed to record individuals independently. If <code>FALSE</code>, cameras are
assumed to be non-independent (e.g. in pairs). Takes effect only if there
was more than 1 camera per station and cameraID = "filename".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minDeltaTime</code></td>
<td>
<p>numeric. time difference between observation of the same
individual at the same station/camera to be considered independent (in
minutes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deltaTimeComparedTo</code></td>
<td>
<p>character. For two records to be considered
independent, must the second one be at least <code>minDeltaTime</code> minutes
after the last independent record of the same individual
(<code>"lastIndependentRecord"</code>), or <code>minDeltaTime</code> minutes after the
last record (<code>"lastRecord"</code>)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeZone</code></td>
<td>
<p>character. Must be a value returned by
<code>OlsonNames</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stationCol</code></td>
<td>
<p>character. Name of the camera trap station column in the
output table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>writecsv</code></td>
<td>
<p>logical. Should the individual record table be saved as a
.csv file?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outDir</code></td>
<td>
<p>character. Directory to save csv file to. If NULL and
<code>writecsv = TRUE</code>, the output csv will be written to <code>inDir</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadataHierarchyDelimitor</code></td>
<td>
<p>character. The character delimiting
hierarchy levels in image metadata tags in field "HierarchicalSubject".
Either "|" or ":".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metadataIDTag</code></td>
<td>
<p>character. In custom image metadata, the individual ID
tag name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>additionalMetadataTags</code></td>
<td>
<p>character. additional camera model-specific
metadata tags to be extracted. (If possible specify tag groups as returned
by <code>exifTagNames</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>removeDuplicateRecords</code></td>
<td>
<p>logical. If there are several records of the
same individual at the same station (also same camera if cameraID is
defined) at exactly the same time, show only one?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnFileNamesMissingTags</code></td>
<td>
<p>logical. If species are assigned with
metadata and images are not tagged, return a few file names of these images
as a message?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eventSummaryColumn</code></td>
<td>
<p>character. A column in the record table (e.g. from
a metadata tag) by to summarise non-independent records (those within
<code>minDeltaTime</code> of a given record) with a user-defined function
(<code>eventSummaryFunction</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eventSummaryFunction</code></td>
<td>
<p>character. The function by which to summarise
<code>eventSummaryColumn</code> of non-independent records, e.g. "sum", "max"
(optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>video</code></td>
<td>
<p>list. Contains information on how to handle video data
(optional). See details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function can handle a number of different ways of storing images and
videos. In every case, images need to be stored in a species directory first
(e.g. using function <code>getSpeciesImages</code>). Station subdirectories
are optional. Camera subdirectories are not supported. This directory
structure can be created easily with function
<code>getSpeciesImages</code>.
</p>
<p>As with species identification, individuals can be identified in 2 different
ways: by moving images into individual directories
("Species/Station/Individual/XY.JPG" or "Species/Individual/XY.JPG") or by
metadata tagging (without the need for individual directories:
"Species/XY.JPG" or "Species/Station/XY.JPG").
</p>
<p><code>minDeltaTime</code> is a criterion for temporal independence of records of
an individual at the same station/location. Setting it to 0 will make the
function return all records. <code>camerasIndependent</code> defines if the
cameras at a station are to be considered independent (e.g. <code>FALSE</code> if
both cameras face each other and possibly <code>TRUE</code> if they face different
trails). <code>stationCol</code> is the station column name to be used in the
resulting table. Station IDs are read from the station directory names if
<code>hasStationFolders = TRUE</code>. Otherwise, the function will try to extract
station IDs from the image filenames (requires images renamed with
<code>imageRename</code>.
</p>
<p>If individual IDs were assigned with image metadata tags,
<code>metadataIDTag</code> must be set to the name of the metadata tag group used
for individual identification. <code>metadataHierarchyDelimitor</code> is "|" for
images tagged in DigiKam and images tagged in Adobe Bridge/ Lightroom with
the default settings. Manufacturer-specific Exif metadata tags such as
"AmbientTemperature" or "MoonPhase" can be extracted if specified in
<code>additionalMetadataTags</code>. Multiple names can be specified as a
character vector as: <code>c(Tag1, Tag2, ...)</code>. Because they are not
standardized, function <code>exifTagNames</code> provides a vector of all
available tag names. The metadata tags thus extracted may be used as
individual covariates in spatial capture-recapture models.
</p>
<p><code>eventSummaryColumn</code> and <code>eventSummaryFunction</code> can be used to
extract summary statistics for independent sampling events. For example, you
assigned a "count" tag to your images, indicating the number of individuals
in a picture. In a sequence of pictures taken within 1 minute, most pictures
show one individual, but one image shows two individuals. You tagged the
images accordingly (count = 1 or count = 2) and run <code>recordTable</code>. Set
<code>eventSummaryColumn = "count"</code> and <code>eventSummaryFunction = "max"</code>
to obtain the maximum number of <code>count</code> in all images within
<code>minDeltaTime</code> minutes of a given record. The results is in a new
column, in this example <code>count_max</code>. You can also calculate several
statistics at the same time, by supplying vectors of values, e.g.
<code>eventSummaryColumn = c("count", "count", "camera")</code> and
<code>eventSummaryFunction = c("min", "max", "unique")</code> to get minimum and
maximum count and all unique camera IDs for that event. Note that
<code>eventSummaryColumn</code> and <code>eventSummaryFunction</code> must be of same
length.
</p>
<p>Argument <code>video</code> is analogous to <code>recordTable</code>, a named
list with 2 or 4 items. 2 items (<code>file_formats</code>, <code>dateTimeTag</code>)
are always required, and are sufficent if <code>IDfrom = "directory"</code>. In
that case, no digiKam tags will be returned.  To return digiKam tags, two
additional items are required (<code>db_directory</code>, <code>db_filename</code>).
This is essential when using <code>IDfrom = "metadata"</code>. When using
<code>IDfrom = "directory"</code>, it is optional, but allows to extract metadata
tags assigned to videos in digiKam. This workaround is necessary because
digiKam tags are not written into video metadata, but are only saved in the
digiKam database. So in contrast to JPG images, they can not be extracted
with ExifTool. It also requires that <code>inDir</code> is in your digiKam
database.
</p>
<p>The items of argument <code>video</code> are:
</p>

<table>
<tr>
<td style="text-align: left;"> <code>file_formats</code> </td>
<td style="text-align: left;"> The video formats to extract (include
"jpg" if you want .JPG image metadata) </td>
</tr>
<tr>
<td style="text-align: left;"> <code>dateTimeTag</code> </td>
<td style="text-align: left;"> the
metadata tag to extract date/time from (use <code>exifTagNames</code> to
find out which tag is suitable) </td>
</tr>
<tr>
<td style="text-align: left;"> <code>db_directory</code> </td>
<td style="text-align: left;"> The directory
containing digiKam database (optional if <code>IDfrom = "directory"</code>) </td>
</tr>
<tr>
<td style="text-align: left;">
<code>db_filename</code> </td>
<td style="text-align: left;"> The digiKam database file in <code>db_directory</code>
(optional if <code>IDfrom = "directory"</code>) </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<p>See the example below for for how to specify the argument <code>video</code>.
</p>


<h3>Value</h3>

<p>A data frame containing species records with individual IDs and
additional information about stations, date, time and (optionally) further
metadata.
</p>


<h3>Warning </h3>

<p>Be sure to read the section on individual identification
in the package vignette
(<a href="https://CRAN.R-project.org/package=camtrapR/vignettes/camtrapr2.pdf">https://CRAN.R-project.org/package=camtrapR/vignettes/camtrapr2.pdf</a>).
</p>
<p>Af you use image metadata tags for identification, the tags must be written
to the image metadata. The function cannot read tags from .xmp sidecar
files. Make sure you set the preferences of your image management software
accordingly. In DigiKam, go to Settings/Configure digiKam/Metadata. There,
make sure "Write to sidecar files" is unchecked.
</p>
<p>Please note the section about defining argument <code>timeZone</code> in the
vignette on data extraction (accessible via
<code>vignette("DataExtraction")</code> or online
(<a href="https://cran.r-project.org/package=camtrapR/vignettes/camtrapr3.pdf">https://cran.r-project.org/package=camtrapR/vignettes/camtrapr3.pdf</a>)).
</p>


<h3>Author(s)</h3>

<p>Juergen Niedballa
</p>


<h3>References</h3>

<p>Phil Harvey's ExifTool <a href="https://exiftool.org/">https://exiftool.org/</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">

## Not run:    # the examples run too long to pass CRAN tests

 wd_images_ID_individual &lt;- system.file("pictures/sample_images_indiv_tag/LeopardCat", 
                                        package = "camtrapR")
 # missing space in species = "LeopardCat" is because of CRAN package policies
 # note argument additionalMetadataTags: contains tag names as returned by function exifTagNames

 if (Sys.which("exiftool") != ""){        # only run these examples if ExifTool is available

 rec_table_pbe &lt;- recordTableIndividual(inDir                  = wd_images_ID_individual,
                                        minDeltaTime           = 60,
                                        deltaTimeComparedTo    = "lastRecord",
                                        hasStationFolders      = FALSE,
                                        IDfrom                 = "metadata",
                                        camerasIndependent     = FALSE,
                                        writecsv               = FALSE,
                                        metadataIDTag          = "individual",
                                        additionalMetadataTags = c("EXIF:Model", "EXIF:Make"),
                                        timeZone               = "Asia/Kuala_Lumpur"
 )
 
 
 # extracting some example summary stats too 
 # a nonsensical example, get all unique cameras with which the event was photographed
 
  rec_table_pbe2 &lt;- recordTableIndividual(inDir                = wd_images_ID_individual,
                                        minDeltaTime           = 60,
                                        deltaTimeComparedTo    = "lastRecord",
                                        hasStationFolders      = FALSE,
                                        IDfrom                 = "metadata",
                                        camerasIndependent     = FALSE,
                                        writecsv               = FALSE,
                                        metadataIDTag          = "individual",
                                        additionalMetadataTags = c("EXIF:Model", "EXIF:Make"),
                                        timeZone               = "Asia/Kuala_Lumpur",
                                        eventSummaryColumn     = "EXIF:Make",
                                        eventSummaryFunction   = "unique"
 )
 
 ### Video example (the sample data don't contain a video, this is hypothetical)
 # with JPG, video mp4, avi, mov, ID = metadata
 
rec_table_ind_video &lt;- recordTableIndividual(inDir = wd_images_ID_individual,
                          hasStationFolder  = FALSE,
                          IDfrom            = "metadata", 
                          metadataIDTag     = "individual",
                          video = list(file_formats = c("jpg", "mp4", "avi", "mov"),
                                       dateTimeTag = "QuickTime:CreateDate",
                                       db_directory = "C:/Users/YourName/Pictures",
                                       db_filename = "digikam4.db")
)

  
} else {  
# show function output if ExifTool is not available
message("ExifTool is not available. Cannot test function. Loading recordTableSample instead")
data(recordTableSample)
}

## End(Not run)


</code></pre>


</div>