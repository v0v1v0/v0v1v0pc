<div class="container">

<table style="width: 100%;"><tr>
<td>CST_Calibration</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Forecast Calibration</h2>

<h3>Description</h3>

<p>Five types of member-by-member bias correction can be performed. 
The <code>"bias"</code> method corrects the bias only, the <code>"evmos"</code> method 
applies a variance inflation technique to ensure the correction of the bias 
and the correspondence of variance between forecast and observation (Van 
Schaeybroeck and Vannitsem, 2011). The ensemble calibration methods 
<code>"mse_min"</code> and <code>"crps_min"</code> correct the bias, the overall forecast 
variance and the ensemble spread as described in Doblas-Reyes et al. (2005) 
and Van Schaeybroeck and Vannitsem (2015), respectively. While the 
<code>"mse_min"</code> method minimizes a constrained mean-squared error using three 
parameters, the <code>"crps_min"</code> method features four parameters and 
minimizes the Continuous Ranked Probability Score (CRPS). The 
<code>"rpc-based"</code> method adjusts the forecast variance ensuring that the 
ratio of predictable components (RPC) is equal to one, as in Eade et al. 
(2014). It is equivalent to function <code>Calibration</code> but for objects 
of class <code>s2dv_cube</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CST_Calibration(
  exp,
  obs,
  exp_cor = NULL,
  cal.method = "mse_min",
  eval.method = "leave-one-out",
  multi.model = FALSE,
  na.fill = TRUE,
  na.rm = TRUE,
  apply_to = NULL,
  alpha = NULL,
  memb_dim = "member",
  sdate_dim = "sdate",
  dat_dim = NULL,
  ncores = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>exp</code></td>
<td>
<p>An object of class <code>s2dv_cube</code> as returned by <code>CST_Start</code> 
function with at least 'sdate' and 'member' dimensions, containing the  
seasonal hindcast experiment data in the element named <code>data</code>. The 
hindcast is used to calibrate the forecast in case the forecast is provided; 
if not, the same hindcast will be calibrated instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs</code></td>
<td>
<p>An object of class <code>s2dv_cube</code> as returned by <code>CST_Start</code> 
function with at least 'sdate' dimension, containing the observed data in 
the element named <code>$data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp_cor</code></td>
<td>
<p>An optional object of class <code>s2dv_cube</code> as returned by 
<code>CST_Start</code> function with at least 'sdate' and 'member' dimensions, 
containing the seasonal forecast experiment data in the element named 
<code>data</code>. If the forecast is provided, it will be calibrated using the 
hindcast and observations; if not, the hindcast will be calibrated instead. 
If there is only one corrected dataset, it should not have dataset dimension. 
If there is a corresponding corrected dataset for each 'exp' forecast, the 
dataset dimension must have the same length as in 'exp'. The default value 
is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cal.method</code></td>
<td>
<p>A character string indicating the calibration method used, 
can be either <code>bias</code>, <code>evmos</code>, <code>mse_min</code>, <code>crps_min</code> or 
<code>rpc-based</code>. Default value is <code>mse_min</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval.method</code></td>
<td>
<p>A character string indicating the sampling method used, it 
can be either <code>in-sample</code> or <code>leave-one-out</code>. Default value is the 
<code>leave-one-out</code> cross validation. In case the forecast is provided, any 
chosen eval.method is over-ruled and a third option is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>multi.model</code></td>
<td>
<p>A boolean that is used only for the <code>mse_min</code> 
method. If multi-model ensembles or ensembles of different sizes are used, 
it must be set to <code>TRUE</code>. By default it is <code>FALSE</code>. Differences 
between the two approaches are generally small but may become large when 
using small ensemble sizes. Using multi.model when the calibration method is 
<code>bias</code>, <code>evmos</code> or <code>crps_min</code> will not affect the result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.fill</code></td>
<td>
<p>A boolean that indicates what happens in case calibration is 
not possible or will yield unreliable results. This happens when three or 
less forecasts-observation pairs are available to perform the training phase 
of the calibration. By default <code>na.fill</code> is set to true such that NA 
values will be returned. If <code>na.fill</code> is set to false, the uncorrected 
data will be returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>A boolean that indicates whether to remove the NA values or not. 
The default value is <code>TRUE</code>. See Details section for further 
information about its use and compatibility with <code>na.fill</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apply_to</code></td>
<td>
<p>A character string that indicates whether to apply the 
calibration to all the forecast (<code>"all"</code>) or only to those where the 
correlation between the ensemble mean and the observations is statistically
significant (<code>"sign"</code>). Only useful if <code>cal.method == "rpc-based"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>A numeric value indicating the significance level for the 
correlation test. Only useful if <code>cal.method == "rpc-based" &amp; apply_to 
== "sign"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>memb_dim</code></td>
<td>
<p>A character string indicating the name of the member dimension.
By default, it is set to 'member'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdate_dim</code></td>
<td>
<p>A character string indicating the name of the start date 
dimension. By default, it is set to 'sdate'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat_dim</code></td>
<td>
<p>A character string indicating the name of dataset dimension. 
The length of this dimension can be different between 'exp' and 'obs'. 
The default value is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>An integer that indicates the number of cores for parallel 
computations using multiApply function. The default value is one.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Both the <code>na.fill</code> and <code>na.rm</code> parameters can be used to 
indicate how the function has to handle the NA values. The <code>na.fill</code> 
parameter checks whether there are more than three forecast-observations pairs 
to perform the computation. In case there are three or less pairs, the 
computation is not carried out, and the value returned by the function depends 
on the value of this parameter (either NA if <code>na.fill == TRUE</code> or the 
uncorrected value if <code>na.fill == TRUE</code>). On the other hand, <code>na.rm</code> 
is used to indicate the function whether to remove the missing values during 
the computation of the parameters needed to perform the calibration.
</p>


<h3>Value</h3>

<p>An object of class <code>s2dv_cube</code> containing the calibrated 
forecasts in the element <code>data</code> with the dimensions nexp, nobs and same 
dimensions as in the 'exp' object. nexp is the number of experiment 
(i.e., 'dat_dim' in exp), and nobs is the number of observation (i.e., 
'dat_dim' in obs). If dat_dim is NULL, nexp and nobs are omitted. If 'exp_cor' 
is provided the returned array will be with the same dimensions as 'exp_cor'.
</p>


<h3>Author(s)</h3>

<p>Ver√≥nica Torralba, <a href="mailto:veronica.torralba@bsc.es">veronica.torralba@bsc.es</a>
</p>
<p>Bert Van Schaeybroeck, <a href="mailto:bertvs@meteo.be">bertvs@meteo.be</a>
</p>


<h3>References</h3>

<p>Doblas-Reyes F.J, Hagedorn R, Palmer T.N. The rationale behind the 
success of multi-model ensembles in seasonal forecasting-II calibration and 
combination. Tellus A. 2005;57:234-252. doi: <a href="https://doi.org/10.1111/j.1600-0870.2005.00104.x">10.1111/j.1600-0870.2005.00104.x</a>
</p>
<p>Eade, R., Smith, D., Scaife, A., Wallace, E., Dunstone, N., 
Hermanson, L., &amp; Robinson, N. (2014). Do seasonal-to-decadal climate 
predictions underestimate the predictability of the read world? Geophysical 
Research Letters, 41(15), 5620-5628. doi: <a href="https://doi.org/10.1002/2014GL061146">10.1002/2014GL061146</a>
</p>
<p>Van Schaeybroeck, B., &amp; Vannitsem, S. (2011). Post-processing 
through linear regression. Nonlinear Processes in Geophysics, 18(2), 
147. doi: <a href="https://doi.org/10.5194/npg-18-147-2011">10.5194/npg-18-147-2011</a>
</p>
<p>Van Schaeybroeck, B., &amp; Vannitsem, S. (2015). Ensemble 
post-processing using member-by-member approaches: theoretical aspects. 
Quarterly Journal of the Royal Meteorological Society, 141(688), 807-818.  
doi: <a href="https://doi.org/10.1002/qj.2397">10.1002/qj.2397</a>
</p>


<h3>See Also</h3>

<p><code>CST_Start</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example 1:
mod1 &lt;- 1 : (1 * 3 * 4 * 5 * 6 * 7)
dim(mod1) &lt;- c(dataset = 1, member = 3, sdate = 4, ftime = 5, lat = 6, lon = 7)
obs1 &lt;- 1 : (1 * 1 * 4 * 5 * 6 * 7)
dim(obs1) &lt;- c(dataset = 1, member = 1, sdate = 4, ftime = 5, lat = 6, lon = 7)
lon &lt;- seq(0, 30, 5)
lat &lt;- seq(0, 25, 5)
coords &lt;- list(lat = lat, lon = lon)
exp &lt;- list(data = mod1, coords = coords)
obs &lt;- list(data = obs1, coords = coords)
attr(exp, 'class') &lt;- 's2dv_cube'
attr(obs, 'class') &lt;- 's2dv_cube'
a &lt;- CST_Calibration(exp = exp, obs = obs, cal.method = "mse_min", eval.method = "in-sample")

# Example 2:
mod1 &lt;- 1 : (1 * 3 * 4 * 5 * 6 * 7)
mod2 &lt;- 1 : (1 * 3 * 1 * 5 * 6 * 7)
dim(mod1) &lt;- c(dataset = 1, member = 3, sdate = 4, ftime = 5, lat = 6, lon = 7)
dim(mod2) &lt;- c(dataset = 1, member = 3, sdate = 1, ftime = 5, lat = 6, lon = 7)
obs1 &lt;- 1 : (1 * 1 * 4 * 5 * 6 * 7)
dim(obs1) &lt;- c(dataset = 1, member = 1, sdate = 4, ftime = 5, lat = 6, lon = 7)
lon &lt;- seq(0, 30, 5)
lat &lt;- seq(0, 25, 5)
coords &lt;- list(lat = lat, lon = lon)
exp &lt;- list(data = mod1, coords = coords)
obs &lt;- list(data = obs1, coords = coords)
exp_cor &lt;- list(data = mod2, lat = lat, lon = lon)
attr(exp, 'class') &lt;- 's2dv_cube'
attr(obs, 'class') &lt;- 's2dv_cube'
attr(exp_cor, 'class') &lt;- 's2dv_cube'
a &lt;- CST_Calibration(exp = exp, obs = obs, exp_cor = exp_cor, cal.method = "evmos")

</code></pre>


</div>