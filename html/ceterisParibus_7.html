<div class="container">

<table style="width: 100%;"><tr>
<td>ceteris_paribus_layer</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add Layer to the Ceteris Paribus Plot</h2>

<h3>Description</h3>

<p>Function 'ceteris_paribus_layer()' adds a layer to a plot created with 'plot.ceteris_paribus_explainer()' plots.
Various parameters help to decide what should be plotted, profiles, aggregated profiles, points or rugs.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ceteris_paribus_layer(
  x,
  ...,
  size = 1,
  alpha = 0.3,
  color = "black",
  size_points = 2,
  alpha_points = 1,
  color_points = color,
  size_rugs = 0.5,
  alpha_rugs = 1,
  color_rugs = color,
  size_residuals = 1,
  alpha_residuals = 1,
  color_residuals = color,
  only_numerical = TRUE,
  show_profiles = TRUE,
  show_observations = TRUE,
  show_rugs = FALSE,
  show_residuals = FALSE,
  aggregate_profiles = NULL,
  as.gg = FALSE,
  facet_ncol = NULL,
  selected_variables = NULL,
  init_plot = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a ceteris paribus explainer produced with function 'ceteris_paribus()'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other explainers that shall be plotted together</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>a numeric. Size of lines to be plotted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>a numeric between 0 and 1. Opacity of lines</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size_points</code></td>
<td>
<p>a numeric. Size of points to be plotted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_points</code></td>
<td>
<p>a numeric between 0 and 1. Opacity of points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_points</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size_rugs</code></td>
<td>
<p>a numeric. Size of rugs to be plotted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_rugs</code></td>
<td>
<p>a numeric between 0 and 1. Opacity of rugs</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_rugs</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size_residuals</code></td>
<td>
<p>a numeric. Size of line and points to be plotted for residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_residuals</code></td>
<td>
<p>a numeric between 0 and 1. Opacity of points and lines for residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_residuals</code></td>
<td>
<p>a character. Either name of a color or name of a variable that should be used for coloring for residuals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only_numerical</code></td>
<td>
<p>a logical. If TRUE then only numerical variables will be plotted. If FALSE then only categorical variables will be plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_profiles</code></td>
<td>
<p>a logical. If TRUE then profiles will be plotted. Either individual or aggregate (see 'aggregate_profiles')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_observations</code></td>
<td>
<p>a logical. If TRUE then individual observations will be marked as points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_rugs</code></td>
<td>
<p>a logical. If TRUE then individual observations will be marked as rugs</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_residuals</code></td>
<td>
<p>a logical. If TRUE then residuals will be plotted as a line ended with a point</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregate_profiles</code></td>
<td>
<p>function. If NULL (default) then individual profiles will be plotted. If a function (e.g. mean or median) then profiles will be aggregated and only the aggregate profile will be plotted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.gg</code></td>
<td>
<p>if TRUE then returning plot will have gg class</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet_ncol</code></td>
<td>
<p>number of columns for the 'facet_wrap()'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selected_variables</code></td>
<td>
<p>if not NULL then only 'selected_variables' will be presented</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init_plot</code></td>
<td>
<p>technical parameter, do not use.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a ggplot2 object
</p>


<h3>Examples</h3>

<pre><code class="language-R">library("DALEX")
 ## Not run: 
library("randomForest")
set.seed(59)

apartments_rf_model &lt;- randomForest(m2.price ~ construction.year + surface + floor +
      no.rooms + district, data = apartments)

explainer_rf &lt;- explain(apartments_rf_model,
      data = apartmentsTest[,2:6], y = apartmentsTest$m2.price)

apartments_small_1 &lt;- apartmentsTest[1,]
apartments_small_2 &lt;- select_sample(apartmentsTest, n = 20)
apartments_small_3 &lt;- select_neighbours(apartmentsTest, apartments_small_1, n = 20)

cp_rf_y1 &lt;- ceteris_paribus(explainer_rf, apartments_small_1, y = apartments_small_1$m2.price)
cp_rf_y2 &lt;- ceteris_paribus(explainer_rf, apartments_small_2, y = apartments_small_2$m2.price)
cp_rf_y3 &lt;- ceteris_paribus(explainer_rf, apartments_small_3, y = apartments_small_3$m2.price)

tmp &lt;- plot(cp_rf_y3, show_profiles = TRUE, show_observations = TRUE,
               show_residuals = TRUE, color = "black",
               alpha = 0.2, color_residuals = "darkred",
               selected_variables = c("construction.year", "surface"))

tmp &lt;- plot(cp_rf_y3, show_profiles = TRUE, show_observations = TRUE,
               show_residuals = TRUE, color = "black",
               alpha = 0.2, color_residuals = "darkred")

tmp

tmp +
 ceteris_paribus_layer(cp_rf_y2, show_profiles = TRUE, show_observations = TRUE,
               alpha = 0.2, color = "darkblue")

tmp +
  ceteris_paribus_layer(cp_rf_y2, show_profiles = TRUE, show_observations = TRUE,
               alpha = 0.2, color = "darkblue") +
  ceteris_paribus_layer(cp_rf_y2, show_profiles = TRUE, show_observations = FALSE,
               alpha = 1, size = 2, color = "blue", aggregate_profiles = mean) +
  ceteris_paribus_layer(cp_rf_y1, show_profiles = TRUE, show_observations = FALSE,
               alpha = 1, size = 2, color = "red", aggregate_profiles = mean)

## End(Not run)
</code></pre>


</div>