<div class="container">

<table style="width: 100%;"><tr>
<td>generate_map</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate map visualizations (choropleths) of CSPP data</h2>

<h3>Description</h3>

<p><code>generate_map</code> takes CSPP data from <code>get_cspp_data</code> and plots the
values of numeric variables on the map of the U.S. It can also plot
individual states or sets of states.
</p>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cspp_data</code></td>
<td>
<p>Dataframe generated by <code>get_cspp_data</code> which must
include the variable <code>state</code>. If there are multiple years of data per
state, by default the most recent year is used in creating the map unless
<code>average_years</code> is set to <code>TRUE</code>. Default is NULL and returns the
most recent year's <code>poptotal</code> data as an example map.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var_name</code></td>
<td>
<p>Specify the variable from the dataset passed to
<code>cspp_data</code> to plot on the map. If left blank, the first variable that
is not "year", "st", "state", "state_fips", or "state_icspr" is used.
Default is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average_years</code></td>
<td>
<p>Default is <code>FALSE</code>. If <code>TRUE</code>, averages over
all of the years per state in the dataframe to produce a value to plot on
the map. If the type of the variable in <code>var_name</code> is not numeric,
will reset this parameter to FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop_NA_states</code></td>
<td>
<p>Choose whether to drop states at the map generating
stage which have NA values. Default is <code>FALSE</code> and states with missing
data will be filled grey. If set to <code>TRUE</code>, states will have no fill
in the plot.
</p>
<p>If you're passing a dataframe subset to certain states, set this to TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poly_args</code></td>
<td>
<p>Default is <code>list(color = "#666666", size = .5)</code>.
Changes the aesthetics of how the states look when plotted. The <code>fill</code>
of each state can be manually changed through ggplot's <code>scale_fill_</code>
(see examples). See <code>geom_polygon</code> for other options
to pass to this argument.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note: due to complications with plotting Alaska and Hawaii, this package
currently does not support plotting these two states.
</p>
<p>This function is general in the sense that it will produce a ggplot-style map
for any dataframe passed to it with the proper formatting. Any dataframe that
has at least three columns, with the first two a numeric 'year' column and a
state name as a string, and the final column the value to be plotted, will
work with this function.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot</code> object. See examples for how to work with
this object.
</p>


<h3>See Also</h3>

<p><code>get_cspp_data</code>, <code>get_cites</code>, <code>get_var_info</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## default map with total population
generate_map()

## pass specific variables
# returns average over all non NA years in the data
generate_map(get_cspp_data(var_category = "demographics"),
             var_name = "pctpopover65")

## add additional ggplot options
generate_map(get_cspp_data(var_category = "demographics"),
             var_name = "pctpopover65",
             poly_args = list(color = "black"),
             drop_NA_states = FALSE) +
 ggplot2::scale_fill_gradient(low = "white", high = "red") +
 ggplot2::theme(legend.position = "none") +
 ggplot2::ggtitle("% Population Over 65")

## plot specific states
# drop_NA_states set to TRUE plots only those states
library(dplyr)
generate_map(get_cspp_data(var_category = "demographics") %&gt;%
               dplyr::filter(st %in% c("NC", "VA", "SC")),
             var_name = "pctpopover65",
             poly_args = list(color = "black"),
             drop_NA_states = TRUE) +
 ggplot2::scale_fill_gradient(low = "white", high = "red") +
 ggplot2::theme(legend.position = "none") +
 ggplot2::ggtitle("% Population Over 65")

## pass specific variables and years
# returns average over set of years provided
library(dplyr)
generate_map(get_cspp_data(var_category = "demographics") %&gt;%
 dplyr::filter(year %in% seq(2001, 2010)))

# returns average over set of years provided
library(dplyr)
generate_map(get_cspp_data(var_category = "demographics") %&gt;%
 dplyr::filter(year %in% seq(2001, 2010)))

</code></pre>


</div>