<div class="container">

<table style="width: 100%;"><tr>
<td>ARMM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Adaptive Randomization via Mahalanobis distance for Multi-arm design</h2>

<h3>Description</h3>

<p>Randomize patients into treatment groups
for multi-arm trials using ARMM proposed by Haoyu Yang, Yichen Qin,
Yang Li, Fan Wang, and Feifang Hu.(2022)
</p>


<h3>Usage</h3>

<pre><code class="language-R">ARMM(covariate, assignment, K, q = 0.75, method)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>covariate</code></td>
<td>
<p>a data frame. A row of the dataframe
corresponds to the covariate profile of a patient.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assignment</code></td>
<td>
<p>a vector. If partial patients had been allocated
, please input their allocation. IF
all the patients are not be allocated, please input
'assignment = NA' directly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>an integer; number of arms of the trial.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>q</code></td>
<td>
<p>the biased coin probability.
<code class="reqn">q</code> should be larger than 1/2 and less than 1, default = 0.75</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Methods for calculating Mahalanobis distance, input one of these texts:
'mean', 'max' or 'median'.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Suppose <code class="reqn">n</code> units (participants) are to be assigned to <code class="reqn">K</code>
treatment groups. For each unit <code class="reqn">i, i = 1, ..., n</code> and
treatment <code class="reqn">j, j = 1, ..., K</code>, define the assignment
matrix <code class="reqn">[T_{ij}]^{n*K}</code>, where
<code class="reqn">T_{ij}=1</code> indicates unit <code class="reqn">i</code> receives treatment <code class="reqn">j</code>.
Consider <code class="reqn">p</code> continuous covariates, let <code class="reqn">x_i =
(x_{i1},...,x_{in})^T</code>.
</p>
<p>The proposed method, namely the adaptive randomization
via Mahalanobis distance for multi-arm design (ARMM),
is outlined below. The implement of ARMM is similar to ARM.
</p>
<p>First assume that <code class="reqn">n</code> units are in a sequence
and then assign the first <code class="reqn">K</code> units to <code class="reqn">K</code> treatment
groups randomly
as the initialization. Then,
the following units are assigned in blocks of <code class="reqn">K</code>
sequentially and
adaptively until all the units
are assigned. For <code class="reqn">K</code> units are assigned to <code class="reqn">K</code>
groups, there are in total <code class="reqn">K!</code> possible allocations.
Calculate <code class="reqn">K!</code> potential overall
covariate imbalance measurement
according to pairwise Mahalanobis
distance under the <code class="reqn">K!</code> possible allocations.
Choose the allocation which corresponds to the smallest
Mahalanobis
distance with a probability of <code class="reqn">q</code> across all potential allocations.
Repeat the process until all units are assigned.
</p>
<p>For any pair of treatments <code class="reqn">s</code> and <code class="reqn">t</code> among the <code class="reqn">K</code>
treatment groups, calculate the Mahalanobis distance by:
</p>
<p style="text-align: center;"><code class="reqn">M_{s,t}(n) = 2n/K/K(\hat{x}_1 -\hat{x}_2)^Tcov(x)^{-1}(\hat{x}_1 -\hat{x}_2)</code>
</p>

<p>In total, there are <code class="reqn">C_K^2</code> pairs of Mahalanobis
distances among <code class="reqn">K</code> treatment groups.Finally, calculate
the mean, the median or the maximum to represent the total imbalance.
</p>
<p>See the reference for more details.
</p>


<h3>Value</h3>

<p>An object of class "ARMM" is a list containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>assignment</code></td>
<td>
<p>Allocation of patients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_size</code></td>
<td>
<p>The number of patients from treatment 1 to treatment <code class="reqn">K</code> respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mahalanobis_Distance</code></td>
<td>
<p>Mahalanobis distance among treatment groups .</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Yang H, Qin Y, Wang F, et al. Balancing covariates in multi-arm trials via adaptive randomization. Computational Statistics &amp; Data Analysis, 2023, 179: 107642. https://doi.org/10.1016/j.csda.2022.107642
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(MASS)
#simulate covariates of patients
p &lt;- 6; n &lt;- 30
sigma &lt;- diag(p); mean &lt;- c(rep(0,p))
data &lt;- mvrnorm(n, mean, sigma)
covariate &lt;- as.data.frame(data)
#IF all the patients are not be allocated
ARMM(covariate = covariate, assignment = NA, K = 3, q = 0.75, method = 'mean')
#IF you had allocated partial patients
ARMM(covariate = covariate, assignment = c(1,2), K=4, q=0.75, method = 'max')
</code></pre>


</div>