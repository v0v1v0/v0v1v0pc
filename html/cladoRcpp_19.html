<div class="container">

<table style="width: 100%;"><tr>
<td>rcpp_states_list_to_DEmat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>C++ conversion of a states list to a dispersal-extinction matrix (DEmat)</h2>

<h3>Description</h3>

<p>This function takes a list of states/ranges, a matrix describing relative dispersal probability (dmat) for each pair of areas, and
a list describing the local extirpation probability for each area (elist), and calculates a transition matrix Qmat accordingly.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rcpp_states_list_to_DEmat(areas_list, states_list, dmat, elist,
  amat = NULL, include_null_range = TRUE, normalize_TF = TRUE,
  makeCOO_TF = FALSE, min_precision = 1e-26)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>areas_list</code></td>
<td>
<p>a list of lists of areas (numbers, starting with 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>states_list</code></td>
<td>
<p>a list of lists of areas (numbers, starting with 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dmat</code></td>
<td>
<p>dispersal matrix from area to area</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>elist</code></td>
<td>
<p>a list of extinction probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>amat</code></td>
<td>
<p>A matrix specifying the probability of instantaneous transition from one area to another (as in standard character rate matrices).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include_null_range</code></td>
<td>
<p>include the null () range (NA) in the matrix (LAGRANGE default=TRUE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>normalize_TF</code></td>
<td>
<p>should the columns be -1 * rowsums?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>makeCOO_TF</code></td>
<td>
<p>should the returned matrix be COO or standard dense (the latter is default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_precision</code></td>
<td>
<p>what is the effective minimum size for 0</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The size of the matrix will expand dramatically with the number of areas.  See <code>numstates_from_numareas</code> for the calculation.
</p>
<p>Above 7 or so areas, making <code>Qmat</code> a COO-formatted matrix (COO=Coordinate list, see wikipedia, <a href="http://en.wikipedia.org/wiki/Sparse_matrix#Coordinate_list_.28COO.29">http://en.wikipedia.org/wiki/Sparse_matrix#Coordinate_list_.28COO.29</a> ) which can then be used in <code>rexpokit</code>'s sparse-matrix algorithms,
should be more efficient. (Sparse matrices are matrices made of mostly 0s.)
</p>


<h3>Value</h3>

<p>dmat (a standard Q matrix)
</p>


<h3>Author(s)</h3>

<p>Nicholas Matzke <a href="mailto:matzke@berkeley.edu">matzke@berkeley.edu</a>
</p>


<h3>References</h3>

<p><a href="http://en.wikipedia.org/wiki/Sparse_matrix#Coordinate_list_.28COO.29">http://en.wikipedia.org/wiki/Sparse_matrix#Coordinate_list_.28COO.29</a>
#bibliography /Dropbox/_njm/__packages/cladoRcpp_setup/cladoRcpp_refs.bib
@cite Matzke_2013
@cite Matzke_2014
@cite ReeSmith2008
</p>


<h3>See Also</h3>

<p><code>numstates_from_numareas</code>, <code>convolve</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Specify the areas
areas_list_txt = c("A", "B", "C")
areas_list_txt

# rcpp_states_list_to_DEmat function requires a 0-based list of areas
areas_list = seq(0, length(areas_list_txt)-1, 1)
areas_list

## Not run: 

# Calculate the list of 0-based indices for each possible 
#geographic range, i.e. each combination of areas
states_list = rcpp_areas_list_to_states_list(areas=areas_list, maxareas=3, 
include_null_range=FALSE)
states_list
states_list = rcpp_areas_list_to_states_list(areas=areas_list, maxareas=3, 
include_null_range=TRUE)
states_list
states_list = rcpp_areas_list_to_states_list(areas=areas_list, maxareas=2, 
include_null_range=TRUE)
states_list
states_list = rcpp_areas_list_to_states_list(areas=areas_list, maxareas=1, 
include_null_range=TRUE)
states_list

# Hard-code the along-branch dispersal and extinction rates
d = 0.2
e = 0.1

# Calculate the dispersal weights matrix and the extinction weights matrix
# Equal dispersal in all directions (unconstrained)
areas = areas_list
distances_mat = matrix(1, nrow=length(areas), ncol=length(areas))
dmat = matrix(d, nrow=length(areas), ncol=length(areas))
dmat

# Equal extinction probability for all areas
elist = rep(e, length(areas))
elist

# Set up the instantaneous rate matrix (Q matrix, Qmat)
# DON'T force a sparse-style (COO-formatted) matrix here
force_sparse = FALSE
Qmat = rcpp_states_list_to_DEmat(areas_list, states_list, dmat, elist, 
include_null_range=TRUE, normalize_TF=TRUE, makeCOO_TF=force_sparse)
Qmat

# DO force a sparse-style (COO-formatted) matrix here
force_sparse = TRUE
Qmat = rcpp_states_list_to_DEmat(areas_list, states_list, dmat, elist, 
include_null_range=TRUE, normalize_TF=TRUE, makeCOO_TF=force_sparse)
Qmat


# Repeat with an amat
amat = dmat
amat[is.numeric(amat)] = 0.33

# Set up the instantaneous rate matrix (Q matrix, Qmat)
# DON'T force a sparse-style (COO-formatted) matrix here
force_sparse = FALSE
Qmat = rcpp_states_list_to_DEmat(areas_list, states_list, dmat, elist, amat, 
include_null_range=TRUE, normalize_TF=TRUE, makeCOO_TF=force_sparse)
Qmat

# DO force a sparse-style (COO-formatted) matrix here
force_sparse = TRUE
Qmat = rcpp_states_list_to_DEmat(areas_list, states_list, dmat, elist, amat, 
include_null_range=TRUE, normalize_TF=TRUE, makeCOO_TF=force_sparse)
Qmat

## End(Not run)


</code></pre>


</div>