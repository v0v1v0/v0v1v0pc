<div class="container">

<table style="width: 100%;"><tr>
<td>aemet_forecast_tidy</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Helper functions for extracting forecasts</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Helpers for <code>aemet_forecast_daily()</code>
and <code>aemet_forecast_hourly()</code>:
</p>

<ul>
<li> <p><code>aemet_forecast_vars_available()</code> extracts the values available on
the dataset.
</p>
</li>
<li> <p><code>aemet_forecast_tidy()</code> produces a <code>tibble</code> with the
forecast for <code>var</code>.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">aemet_forecast_tidy(x, var)

aemet_forecast_vars_available(x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A database extracted with <code>aemet_forecast_daily()</code> or
<code>aemet_forecast_hourly()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>Name of the desired var to extract</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A vector of characters (<code>aemet_forecast_vars_available()</code>)
or a <code>tibble</code> (<code>aemet_forecast_tidy()</code>).
</p>


<h3>See Also</h3>

<p>Other forecasts: 
<code>aemet_forecast_beaches()</code>,
<code>aemet_forecast_daily()</code>,
<code>aemet_forecast_fires()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Hourly values
hourly &lt;- aemet_forecast_hourly(c("15030", "28080"))

# Vars available
aemet_forecast_vars_available(hourly)

# Get temperature
temp &lt;- aemet_forecast_tidy(hourly, "temperatura")

library(dplyr)
# Make hour - Need lubridate to adjust timezones
temp_end &lt;- temp %&gt;%
  mutate(
    forecast_time = lubridate::force_tz(
      as.POSIXct(fecha) + hora,
      tz = "Europe/Madrid"
    )
  )

# Add also sunset and sunrise
suns &lt;- temp_end %&gt;%
  select(nombre, fecha, orto, ocaso) %&gt;%
  distinct_all() %&gt;%
  group_by(nombre) %&gt;%
  mutate(
    ocaso_end = lubridate::force_tz(
      as.POSIXct(fecha) + ocaso,
      tz = "Europe/Madrid"
    ),
    orto_end = lubridate::force_tz(
      as.POSIXct(fecha) + orto,
      tz = "Europe/Madrid"
    ),
    orto_lead = lead(orto_end)
  ) %&gt;%
  tidyr::drop_na()



# Plot

library(ggplot2)

ggplot(temp_end) +
  geom_rect(data = suns, aes(
    xmin = ocaso_end, xmax = orto_lead,
    ymin = min(temp_end$temperatura),
    ymax = max(temp_end$temperatura)
  ), alpha = .4) +
  geom_line(aes(forecast_time, temperatura), color = "blue4") +
  facet_wrap(~nombre, nrow = 2) +
  scale_x_datetime(labels = scales::label_date_short()) +
  scale_y_continuous(labels = scales::label_number(suffix = "ยบ")) +
  labs(
    x = "", y = "",
    title = "Forecast: Temperature",
    subtitle = paste("Forecast produced on", format(temp_end$elaborado[1],
      usetz = TRUE
    ))
  )

</code></pre>


</div>