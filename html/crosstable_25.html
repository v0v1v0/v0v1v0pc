<div class="container">

<table style="width: 100%;"><tr>
<td>body_add_legend</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add a legend to a table or a figure</h2>

<h3>Description</h3>

<p>Add a legend to a table or a figure in an <code>officer</code> document. Legends can be referred to using the <code style="white-space: pre;">⁠@ref⁠</code> syntax in <code>body_add_normal()</code> (see examples for some use cases). Table legends should be inserted before the table while figure legends should be inserted after the figure.
</p>


<h3>Usage</h3>

<pre><code class="language-R">body_add_table_legend(
  doc,
  legend,
  ...,
  bookmark = NULL,
  legend_style = getOption("crosstable_style_legend", doc$default_styles$paragraph),
  style = deprecated(),
  legend_prefix = NULL,
  name_format = NULL,
  legend_name = "Table",
  seqfield = "SEQ Table \\* Arabic",
  par_before = FALSE,
  envir = parent.frame(),
  legacy = FALSE
)

body_add_figure_legend(
  doc,
  legend,
  ...,
  bookmark = NULL,
  legend_style = getOption("crosstable_style_legend", doc$default_styles$paragraph),
  style = deprecated(),
  legend_prefix = NULL,
  name_format = NULL,
  legend_name = "Figure",
  seqfield = "SEQ Figure \\* Arabic",
  par_after = FALSE,
  envir = parent.frame(),
  legacy = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>doc</code></td>
<td>
<p>a docx object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>the table legend. Supports <code>glue</code> syntax and markdown syntax (see Section below).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>unused</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bookmark</code></td>
<td>
<p>the id of the bookmark. This is the id that should then be called in <code>body_add_normal()</code> using the <code>"\\@ref(id)"</code> syntax. Forbidden characters will be removed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_style</code></td>
<td>
<p>style of of the whole legend. May depend on the docx template. However, if <code>name_format</code> is provided with a specific <code>font.size</code>, this size will apply to the whole legend for consistency.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>style</code></td>
<td>
<p>deprecated in favor of <code>name_format</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_prefix</code></td>
<td>
<p>a prefix that comes before the legend, after the numbering</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name_format</code></td>
<td>
<p>format of the legend's LHS (legend_name + numbering) using <code>officer::fp_text_lite()</code> or <code>officer::fp_text()</code>. Default to <code>fp_text_lite(bold=TRUE)</code> in addition to the format defined in <code>legend_style</code>. Note that the reference to the bookmark will have the same specific format in the text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend_name</code></td>
<td>
<p>name before the numbering. Default to either "Table" or "Figure".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seqfield</code></td>
<td>
<p>Keep default. Otherwise, you may figure it out doing this: in a docx file, insert a table legend, right click on the inserted number and select "Toggle Field Codes". This argument should be the value of the field, with extra escaping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par_before, par_after</code></td>
<td>
<p>should an empty paragraph be inserted before/after the legend?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>Environment to evaluate each expression in <code>glue()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legacy</code></td>
<td>
<p>use the old version of this function, if you cannot update <code>{officer}</code> to v0.4+</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The docx object <code>doc</code>
</p>


<h3>Warning</h3>

<p>Be aware that you unfortunately cannot reference a bookmark more than once using this method. Writing: <br><code>body_add_normal("Table \\@ref(iris_col1) is about flowers. I really like Table \\@ref(iris_col1).")</code><br>
will prevent the numbering from applying.
</p>


<h3>What to do if there is still no numbering?</h3>

<p>During the opening of the document, MS Word might ask you to "update the fields", to which you should answer "Yes".  <br>
If it is not asked or if you answer "No", the legends added with <code>body_add_table_legend()</code> or <code>body_add_figure_legend()</code> might have no actual numbers displayed. <br>
In this case, you have to manually update the references in MS Word: select all (<kbd>Ctrl</kbd>+<kbd>A</kbd>), then update (<kbd>F9</kbd>), sometimes twice. More info on <a href="https://ardata-fr.github.io/officeverse/faq.html#update-fields">https://ardata-fr.github.io/officeverse/faq.html#update-fields</a>.
</p>


<h3>Markdown support</h3>

<p>In all <code>crosstable</code> helpers for <code>officer</code>, you can use the following Markdown syntax to format your text:
</p>

<ul>
<li> <p><em>bold</em>: <code>"**text in bold**"</code>
</p>
</li>
<li>
<p> *italics: <code>"*text in italics*"</code>
</p>
</li>
<li> <p><em>subscript</em>: <code>"Text in ~subscript~"</code>
</p>
</li>
<li> <p><em>superscript</em>: <code>"Text in ^superscript^"</code>
</p>
</li>
<li> <p><em>newline</em>: <code style="white-space: pre;">⁠Before &lt;br&gt; After⁠</code>
</p>
</li>
<li> <p><em>color</em>: <code>"&lt;color:red&gt;red text&lt;/color&gt;"</code>
</p>
</li>
<li> <p><em>shade</em>: <code>"&lt;shade:yellow&gt;yellow text&lt;/shade&gt;"</code> (background color)
</p>
</li>
<li> <p><em>font family</em>: <code>"&lt;ff:symbol&gt;symbol&lt;/ff&gt;"</code> (
</p>
</li>
</ul>
<p>Note that the font name depends on your system language. For instant, in French, it would be <code>Symbol</code> with an uppercase first letter.
</p>
<p>See the last example of <code>body_add_normal()</code> for a practical case.
</p>


<h3>Author(s)</h3>

<p>Dan Chaltiel
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(officer)
library(ggplot2)
p = ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width, color=Species)) + geom_point()
fp_italic = fp_text_lite(italic=TRUE, font.size=10)
x = read_docx() %&gt;%
    body_add_normal("There is Table \\@ref(iris_col1) and Table \\@ref(iris_col2). ",
                    "The `iris` dataset is about flowers.") %&gt;%
    body_add_normal() %&gt;%
    body_add_table_legend("Iris dataset, column 1 (mean={round(mean(iris[[1]]), 2)})",
                           bookmark="iris_col1") %&gt;%
    body_add_crosstable(crosstable(iris[1])) %&gt;%
    body_add_normal() %&gt;%
    body_add_table_legend("Iris dataset, column 2 (mean={round(mean(iris[[2]]), 2)})",
                          bookmark="iris_col2",
                          name_format=fp_italic, legend_style="Balloon Text") %&gt;%
    body_add_crosstable(crosstable(iris[2])) %&gt;%
    body_add_normal() %&gt;%
    body_add_normal("There is also the figure \\@ref(iris_fig)") %&gt;%
    body_add_gg(p) %&gt;%
    body_add_figure_legend("Iris plot", bookmark="iris_fig")
write_and_open(x)
#If asked to update fields, press "Yes". Otherwise press Ctrl+A then F9 twice for the references
#to appear.
</code></pre>


</div>