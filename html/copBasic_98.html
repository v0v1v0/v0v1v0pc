<div class="container">

<table style="width: 100%;"><tr>
<td>med.regressCOP</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perform Median Regression using a Copula by Numerical Derivative Method for V with respect to U</h2>

<h3>Description</h3>

<p>Perform <em>median regression</em> (Nelsen, 2006, pp. 217–218) of a copula by inversion of numerical derivatives of the copula (<code>derCOPinv</code>). The documentation for <code>qua.regressCOP</code> provides mathematical details. The <code>qua.regressCOP.draw</code> supports so-called <em>quantile regression</em> along various probability levels (see <b>Examples</b>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">med.regressCOP(u=seq(0.01,0.99, by=0.01), cop=NULL, para=NULL, level=NA, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>Nonexceedance probability <code class="reqn">u</code> in the <code class="reqn">X</code> direction;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cop</code></td>
<td>
<p>A copula function;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>para</code></td>
<td>
<p>Vector of parameters or other data structure, if needed, to pass to the copula;</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The level of the prediction interval to compute. For example, <code>level=0.95</code> will compute the 95-percent prediction interval as will <code>level=0.05</code> because internally a reflection check is made; and</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to pass such <code>qua.regressCOP</code> and <code>derCOPinv</code> that are called in succession.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> <code>data.frame</code> of the median regressed probabilities of <code class="reqn">V</code> and provided <code class="reqn">U</code> values is returned. Note: if <code>level</code> is used, then the column ordering of the returned <code>data.frame</code> changes—please access the columns by the named idiom. The lower- and upper-prediction interval is contained in the columns repectively titled <code>Vlwr</code> and <code>Vupr</code> to mimic nomenclature somewhat of function <code>predict.lm()</code> in <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>.
</p>


<h3>Note</h3>

<p>An extended demonstration is needed concerning prediction intervals by median regression and a comparison to well-known linear regression. This also affords and opportunity to have <span class="pkg">copBasic</span> interact with the <span class="pkg">copula</span> package to gain access to the <em>Gaussian copula</em> and a <em>maximum pseudo-likelihood</em> estimation of the parameter.
</p>
<p>First, a function <code>NORMcop()</code> is defined to form the interconnect between the two packages. It is critically important that the user recognize that the so-called <code>copula</code> object as built by the <span class="pkg">copula</span> package is treated as the canonical <code>para</code> argument in <span class="pkg">copBasic</span> calls herein.
</p>
<pre>
  "NORMcop" &lt;-  # pCoupla() from package copula is analogous to COP()
  function(u,v, para=NULL, ...) {
    if(length(u) == 1) u &lt;- rep(u, length(v)) # see asCOP() for reasoning of
    if(length(v) == 1) v &lt;- rep(v, length(u)) # this "vectorization" hack
    return(copula::pCopula(matrix(c(u,v), ncol=2), para))
  }
</pre>
<p>The parameter <code class="reqn">\Theta \in [-1, 1]</code> (<em>Pearson R</em>) and <code class="reqn">\rho_\mathbf{C}(\Theta)</code> (<em>Spearman Rho</em>, <code>rhoCOP</code>) and <code class="reqn">\tau_\mathbf{C}(\Theta)</code> (<em>Kendall Tau</em>, <code>tauCOP</code>) are according to Salvadori <em>et al.</em> (2007, p. 255) the values
</p>
<p style="text-align: center;"><code class="reqn">\rho_\mathbf{C}(\Theta) = \frac{2}{\pi}\,\mathrm{arcsin}(\Theta)</code>
</p>

<p>and
</p>
<p style="text-align: center;"><code class="reqn">\tau_\mathbf{C}(\Theta) = \frac{6}{\pi}\,\mathrm{arcsin}(\Theta/2)\mbox{.}</code>
</p>

<p>Second, a bivariate <em>Gaussian copula</em> is defined with a parameter <code class="reqn">\Theta = 0.7</code> (thus <code class="reqn">\rho_\mathbf{C} = 0.6829105</code>, <code>rhoCOP(NORMcop, norm.cop)</code>) and then <code class="reqn">n=255</code> samples simulated from it. These are then cast into standard normal variates to mimic the idea of bivariate data in nonprobability units and facilitation regression comparison.
</p>
<pre>
  norm.cop &lt;- copula::normalCopula(c(0.7), dim = 2) # define a Gaussian copula
  UVs      &lt;- copula::rCopula(255, norm.cop) # draw 255 samples
  UVs      &lt;- as.data.frame(UVs); X &lt;- qnorm(UVs[,1]); Y &lt;- qnorm(UVs[,2])
</pre>
<p>Third, the <em>Weibull plotting positions</em> from the <code>pp()</code> function of package <span class="pkg">lmomco</span> are used to estimate the empirical probababilities of the data in <code>UV</code> that are casted into an <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> <code>matrix</code> because the <span class="pkg">copula</span> package expects the data as a <code>matrix</code> for the default parameter estimation. The code is completed by the specification of the fitted <em>Gaussian copula</em> in <code>fnorm.cop</code>.
</p>
<pre>
  UV &lt;- as.matrix(data.frame(U=lmomco::pp(X, sort=FALSE),
                             V=lmomco::pp(Y, sort=FALSE)))
  para &lt;- copula::fitCopula(copula::normalCopula(dim=2), UV)
  para &lt;- summary(para)$coefficients[1] # maximum pseudo-likelihood est.
  fnorm.cop &lt;- copula::normalCopula(para, dim=2)
</pre>
<p>Fourth, ordinary-least-squares (OLS) linear regression for <code class="reqn">Y\mid X</code> and <code class="reqn">X\mid Y</code> is computed, and the results plotted on top of the data points. The 2/3rd-prediction limits are computed by <code>predict.lm()</code> and also shown.
</p>
<pre>
  # Classical linear regressions from two perspectives.
  LMyx &lt;- lm(Y~X);       LMxy &lt;- lm(X~Y)
  YonX &lt;- summary(LMyx); XonY &lt;- summary(LMyx)

  QUorV &lt;- seq(-3,3, by=0.05) # vector for graphical operations
  plot(X, Y, col=8, pch=21)
  lines(QUorV, YonX$coefficients[1]+YonX$coefficients[2]*QUorV, col=2, lwd=4)
  tmp &lt;- predict.lm(LMyx, list(X=X), level=2/3, interval="prediction")
  lines(X, tmp[,2], col=2); lines(X, tmp[,3], col="red"  )

  lines(XonY$coefficients[1]+XonY$coefficients[2]*QUorV, QUorV, col=3, lwd=4)
  tmp &lt;- predict.lm(LMxy, list(Y=Y), level=2/3, interval="prediction")
  lines(tmp[,2], Y, col="green"); lines(tmp[,3], Y, col="green")
</pre>
<p>Finally, the demonstration ends with plotting of the median regression for the Gaussian copula and drawing the regression lines. The two median regression lines are nearly coincident with the OLS regression lines as anticipated with a reasonably large sample size albeit maximum pseudo-likelihood was used to estimate the copula parameter. The mean of a uniform distributed variable given say <code class="reqn">U = u</code> (horizontal axis) is 1/2, which coincides with the median. The median regression lines thus are coincident with the OLS lines even though OLS and real-space (native units of <code class="reqn">X</code> and <code class="reqn">Y</code>) were not used for their computation. The 2/3-prediction intervals also are plotted for comparison.
</p>
<pre>
  UorV    &lt;- c(0.001, seq(.02,0.98, by=.02), 0.999)
  MEDreg  &lt;- med.regressCOP( u=UorV, level=2/3, cop=NORMcop, para=fnorm.cop)
  MEDreg2 &lt;- med.regressCOP2(v=UorV, level=2/3, cop=NORMcop, para=fnorm.cop)
  lines(qnorm(UorV),         qnorm(MEDreg$V),    col="blue",    lty=2)
  lines(qnorm(UorV),         qnorm(MEDreg$Vlwr), col="blue",    lty=2)
  lines(qnorm(UorV),         qnorm(MEDreg$Vupr), col="blue",    lty=2)
  lines(qnorm(MEDreg2$U),    qnorm(UorV),        col="magenta", lty=2)
  lines(qnorm(MEDreg2$Ulwr), qnorm(UorV),        col="magenta", lty=2)
  lines(qnorm(MEDreg2$Uupr), qnorm(UorV),        col="magenta", lty=2)
</pre>
<p>A curious aside (Joe, 2014, p. 164) about the <em>Gaussian copula</em> is that <em>Blomqvist Beta</em> (<code>blomCOP</code>) is equal to <em>Kendall Tau</em> (<code>tauCOP</code>), which can be checked by
</p>
<pre>
  blomCOP(cop=NORMcop, para=norm.cop) # 0.4936334
  tauCOP( cop=NORMcop, para=norm.cop) # 0.493633
</pre>
<p>and obviously the <code class="reqn">\beta_\mathbf{C} = \tau_\mathbf{C}</code> are numerically the same.
</p>


<h3>Author(s)</h3>

<p>W.H. Asquith</p>


<h3>References</h3>

<p>Nelsen, R.B., 2006, An introduction to copulas: New York, Springer, 269 p.
</p>
<p>Salvadori, G., De Michele, C., Kottegoda, N.T., and Rosso, R., 2007, Extremes in Nature—An approach using copulas: Springer, 289 p.
</p>


<h3>See Also</h3>

<p><code>med.regressCOP2</code>, <code>qua.regressCOP</code>, <code>qua.regressCOP.draw</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# INDEPENDENCE YIELDS STRAIGHT LINES, RED IS THE MEDIAN REGRESSION
FF &lt;- seq(0.1, 0.9, by=0.1)
plot(c(0,1),c(0,1), type="n", lwd=3,
     xlab="U, NONEXCEEDANCE PROBABILITY", ylab="V, NONEXCEEDANCE PROBABILITY")
# Draw the regression of V on U and then U on V (wrtV=TRUE)
qua.regressCOP.draw(f=FF, cop=P, para=NA, ploton=FALSE)
qua.regressCOP.draw(f=FF, cop=P, para=NA, ploton=FALSE, wrtV=TRUE, lty=2)#
## End(Not run)

## Not run: 
# NEGATIVE PLACKETT THETA YIELDS CURVES DOWN TO RIGHT, RED IS THE MEDIAN REGRESSION
theta &lt;- 0.5; FF &lt;- seq(0.1, 0.9, by=0.1)
plot(c(0,1),c(0,1), type="n", lwd=3,
     xlab="U, NONEXCEEDANCE PROBABILITY", ylab="V, NONEXCEEDANCE PROBABILITY")
# Draw the regression of V on U and then U on V (wrtV=TRUE)
qua.regressCOP.draw(f=FF, cop=PLACKETTcop, ploton=FALSE, para=theta)
qua.regressCOP.draw(f=FF, cop=PLACKETTcop, ploton=FALSE, para=theta, wrtV=TRUE, lty=2)#
## End(Not run)
</code></pre>


</div>