<div class="container">

<table style="width: 100%;"><tr>
<td>physeq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Process 'phyloseq-class' objects to calculate chemical metrics</h2>

<h3>Description</h3>

<p>Calculate chemical metrics of community reference proteomes from taxonomic abundances in <code>phyloseq-class</code> objects and make plots of individual metrics or two metrics against each other.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  ps_taxacounts(physeq, split = TRUE)
  ps_metrics(physeq, split = TRUE, refdb = "GTDB_214", quiet = FALSE, ...)
  plot_ps_metrics(physeq, metrics = c("Zc", "nO2", "nH2O"), x = "samples",
    color = NULL, shape = NULL, title = NULL,
    scales = "free_y", nrow = 1, sortby = NULL, ...)
  plot_ps_metrics2(physeq, metrics = c("Zc", "nH2O"), color = NULL,
    shape = NULL, title = NULL, refdb = "GTDB_214", quiet = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>physeq</code></td>
<td>
<p>'phyloseq-class', a <span class="pkg">phyloseq</span> object containing an 'otu_table' and 'tax_table'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split</code></td>
<td>
<p>logical, calculate metrics for each sample (TRUE) or the entire set (FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refdb</code></td>
<td>
<p>character, name of reference database (passed to <code>get_metrics</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>logical, suppress printed messages? (passed to <code>map_taxa</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed to <code>ps_metrics</code> and thence to <code>get_metrics</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metrics</code></td>
<td>
<p>character, chemical metrics to calculate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>map this variable to the horizontal axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color</code></td>
<td>
<p>map this variable to colors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape</code></td>
<td>
<p>map this variable to shapes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>main title for the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scales</code></td>
<td>
<p>‘<span class="samp">⁠free_y⁠</span>’ or ‘<span class="samp">⁠fixed⁠</span>’ for different vertical scales or same scale in each panel</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrow</code></td>
<td>
<p>number of rows of panels (passed to <code>facet_wrap</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sortby</code></td>
<td>
<p>subset of <code>metrics</code> argument, sort x-index by the mean values of these metrics</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ps_taxacounts</code> returns a data frame with lowest-level classifications (from genus to phylum) and abundances for each OTU in the <code>physeq</code> object.
</p>
<p><code>ps_metrics</code> calculates chemical metrics of community reference proteomes from the lowest-level classifications after taxonomic mapping with <code>map_taxa</code>.
</p>
<p><code>plot_ps_metrics</code> plots individual chemical metrics or multiple chemical metrics, each in their own panel.
This function is modified from <code>plot_richness</code>; see that help page for further details about graphics-related arguments.
</p>
<p><code>plot_ps_metrics2</code> plot two chemical metrics against each other.
</p>
<p>The <code>metrics</code> argument is passed to <code>get_metrics</code> and selects the metrics to calculate.
<code>split</code>, <code>refdb</code>, and <code>quiet</code> can also be used as additional arguments in <code>plot_ps_metrics</code> and <code>plot_ps_metrics2</code>.
</p>


<h3>Value</h3>

<p>For <code>ps_taxacounts</code>, a data frame with samples in rows, and columns <code>taxid</code> (sample name taken from the OTU table obtained from <code>otu_table(physeq)</code>), <code>lineage</code> (all taxonomic names from the taxonomy table obtained from <code>tax_table(physeq)</code>, separated by semicolons), <code>name</code> (lowest-level taxonomic name), <code>rank</code> (rank of lowest-level taxon), followed by the abundances from the OTU table.
</p>
<p>For <code>ps_metrics</code>, a data frame with samples in rows, and columns corresponding to each of the <code>metrics</code>.
</p>
<p>For <code>plot_ps_metrics</code> and <code>plot_ps_metrics2</code>, ggplot objects.
</p>


<h3>Author(s)</h3>

<p>The author of this Rd file and the <code>ps_taxacounts</code> and <code>ps_metrics</code> functions is Jeffrey Dick.
<code>plot_ps_metrics</code> is based on the <code>plot_richness</code> function by Paul J. McMurdie and was modified from that function by Jeffrey Dick.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example 1: Humboldt Sulfuretum (Fonseca et al., 2022)
file &lt;- system.file("extdata/DADA2-GTDB_214/FEN+22/ps_FEN+22.rds", package = "chem16S")
physeq &lt;- readRDS(file)
# Get lowest-level (to genus) classification for each OTU
taxacounts &lt;- ps_taxacounts(physeq)
# Show numbers of assignments at each taxonomic level
table(taxacounts$rank)
# Map taxonomic names
map &lt;- map_taxa(taxacounts, refdb = "GTDB_214")
# Taxonomy and reference proteomes are both from GTDB,
# so there are no unmapped classifications
sum(attr(map, "unmapped_percent")) # == 0
# Calculate chemical metrics
ps_metrics(physeq, refdb = "GTDB_214")

# Example 2: GlobalPatterns dataset from phyloseq
data(GlobalPatterns, package = "phyloseq")
# Plot metrics grouped by sample type and sorted by mean Zc;
# refdb = "RefSeq" uses manual mappings from the RDP to NCBI taxonomy
p &lt;- plot_ps_metrics(GlobalPatterns, x = "SampleType",
                     sortby = "Zc", refdb = "RefSeq_206")
# Change orientation of x-axis labels
p + ggplot2::theme(axis.text.x = ggplot2::element_text(
  angle = 45, vjust = 1, hjust = 1))
</code></pre>


</div>