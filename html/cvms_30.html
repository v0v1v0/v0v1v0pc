<div class="container">

<table style="width: 100%;"><tr>
<td>plot_probabilities</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot predicted probabilities</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
</p>
<p>Creates a <code>ggplot2</code> line plot object with the probabilities
of either the target classes or the predicted classes.
</p>
<p>The observations are ordered by the highest probability.
</p>
<p>TODO line geom: average probability per observation
</p>
<p>TODO points geom: actual probabilities per observation
</p>
<p>The meaning of the <strong>horizontal lines</strong> depend on the settings.
These are either <em>recall</em> scores, <em>precision</em> scores,
or <em>accuracy</em> scores, depending on the <code>`probability_of`</code>
and <code>`apply_facet`</code> arguments.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_probabilities(
  data,
  target_col,
  probability_cols,
  predicted_class_col = NULL,
  obs_id_col = NULL,
  group_col = NULL,
  probability_of = "target",
  positive = 2,
  order = "centered",
  theme_fn = ggplot2::theme_minimal,
  color_scale = ggplot2::scale_colour_brewer(palette = "Dark2"),
  apply_facet = length(probability_cols) &gt; 1,
  smoothe = FALSE,
  add_points = !is.null(obs_id_col),
  add_hlines = TRUE,
  add_caption = TRUE,
  show_x_scale = FALSE,
  line_settings = list(),
  smoothe_settings = list(),
  point_settings = list(),
  hline_settings = list(),
  facet_settings = list(),
  ylim = c(0, 1)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p><code>data.frame</code> with probabilities, target classes and (optional) predicted classes.
Can also include observation identifiers and a grouping variable.
</p>
<p>Example for binary classification:
</p>

<table>
<tr>
<td style="text-align: right;">
  <strong>Classifier</strong> </td>
<td style="text-align: right;"> <strong>Observation</strong> </td>
<td style="text-align: right;"> <strong>Probability</strong> </td>
<td style="text-align: right;"> <strong>Target</strong> </td>
<td style="text-align: right;"> <strong>Prediction</strong>  </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.3 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_1 </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.7 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.2 </td>
<td style="text-align: right;"> cl_2 </td>
<td style="text-align: right;"> cl_1 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.8 </td>
<td style="text-align: right;"> cl_2 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>Example for multiclass classification:
</p>

<table>
<tr>
<td style="text-align: right;">
  <strong>Classifier</strong> </td>
<td style="text-align: right;"> <strong>Observation</strong> </td>
<td style="text-align: right;"> <strong>cl_1</strong> </td>
<td style="text-align: right;"> <strong>cl_2</strong> </td>
<td style="text-align: right;"> <strong>cl_3</strong> </td>
<td style="text-align: right;"> <strong>Target</strong> </td>
<td style="text-align: right;"> <strong>Prediction</strong>  </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.2 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> 0.7 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_3 </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.3 </td>
<td style="text-align: right;"> 0.5 </td>
<td style="text-align: right;"> 0.2 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.8 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> cl_2 </td>
<td style="text-align: right;"> cl_1 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> 0.6 </td>
<td style="text-align: right;"> 0.3 </td>
<td style="text-align: right;"> cl_3 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>You can have multiple rows per observation ID per group. If, for instance, we
have run repeated cross-validation of 3 classifiers, we would have one predicted probability
per fold column per classifier.
</p>
<p>As created with the various validation functions in <code>cvms</code>, like
<code>cross_validate_fn()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_col</code></td>
<td>
<p>Name of column with target levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probability_cols</code></td>
<td>
<p>Name of columns with predicted probabilities.
</p>
<p>For <strong>binary</strong> classification, this should be <strong>one column</strong> with the probability of the
<strong>second class</strong> (alphabetically).
</p>
<p>For <strong>multiclass</strong> classification, this should be <strong>one column per class</strong>.
These probabilities must sum to <code>1</code> row-wise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predicted_class_col</code></td>
<td>
<p>Name of column with predicted classes.
</p>
<p>This is required when <code>probability_of = "prediction"</code> and/or <code>add_hlines = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_id_col</code></td>
<td>
<p>Name of column with observation identifiers for grouping the <strong>x-axis</strong>.
When <code>NULL</code>, each row is an observation.
</p>
<p>Use case: when you have multiple predicted probabilities per observation by a classifier
(e.g. from repeated cross-validation).
</p>
<p>Can also be a grouping variable that you wish to aggregate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group_col</code></td>
<td>
<p>Name of column with groups. The plot elements
are split by these groups and can be identified by their color.
</p>
<p>E.g. the <em>classifier</em> responsible for the prediction.
</p>
<p><strong>N.B.</strong> With more than <strong><code>8</code></strong> groups,
the default <code>`color_scale`</code> might run out of colors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probability_of</code></td>
<td>
<p>Whether to plot the probabilities of the
target classes (<code>"target"</code>) or the predicted classes (<code>"prediction"</code>).
</p>
<p>For each row, we extract the probability of either the
<em>target class</em> or the <em>predicted class</em>. Both are useful
to plot, as they show the behavior of the classifier in a way a confusion matrix doesn't.
One classifier might be very certain in its predictions (whether wrong or right), whereas
another might be less certain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>positive</code></td>
<td>
<p>TODO</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>How to order of the the probabilities. (Character)
</p>
<p>One of: <code>"descending"</code>, <code>"ascending"</code>, and <code>"centered"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theme_fn</code></td>
<td>
<p>The <code>ggplot2</code> theme function to apply.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_scale</code></td>
<td>
<p><code>ggplot2</code> color scale object for adding discrete colors to the plot.
</p>
<p>E.g. the output of
<code>ggplot2::scale_colour_brewer()</code> or
<code>ggplot2::scale_colour_viridis_d()</code>.
</p>
<p><strong>N.B.</strong> The number of colors in the object's palette should be at least the same as
the number of groups in the <code>`group_col`</code> column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apply_facet</code></td>
<td>
<p>Whether to use
<code>ggplot2::facet_wrap()</code>. (Logical)
</p>
<p>By default, faceting is applied when there are more than one probability column (multiclass).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoothe</code></td>
<td>
<p>Whether to use <code>ggplot2::geom_smooth()</code> instead of
<code>ggplot2::geom_line()</code>.
This also adds a <code>95%</code> confidence interval by default.
</p>
<p>Settings can be passed via the <code>`smoothe_settings`</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_points</code></td>
<td>
<p>Add a point for each predicted probability.
These are grouped on the x-axis by the <code>`obs_id_col`</code> column. (Logical)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_hlines</code></td>
<td>
<p>Add horizontal lines. (Logical)
</p>
<p>The meaning of these lines depends on the <code>`probability_of`</code>
and <code>`apply_facet`</code> arguments:
</p>

<table>
<tr>
<td style="text-align: right;">
  <strong><code>apply_facet</code></strong> </td>
<td style="text-align: right;"> <strong><code>probability_of</code></strong> </td>
<td style="text-align: right;"> <strong>Metric</strong> </td>
</tr>
<tr>
<td style="text-align: right;">
  <code>FALSE</code> </td>
<td style="text-align: right;"> <code>"target"</code> </td>
<td style="text-align: right;"> <strong>Accuracy</strong> </td>
</tr>
<tr>
<td style="text-align: right;">
  <code>FALSE</code> </td>
<td style="text-align: right;"> <code>"prediction"</code> </td>
<td style="text-align: right;"> <strong>Accuracy</strong> </td>
</tr>
<tr>
<td style="text-align: right;">
  <code>TRUE</code> </td>
<td style="text-align: right;"> <code>"target"</code> </td>
<td style="text-align: right;"> <strong>Recall / Sensitivity</strong> </td>
</tr>
<tr>
<td style="text-align: right;">
  <code>TRUE</code> </td>
<td style="text-align: right;"> <code>"prediction"</code> </td>
<td style="text-align: right;"> <strong>Precision / PPV</strong> </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_caption</code></td>
<td>
<p>Whether to add a caption explaining the plot. This is dynamically generated
and intended as a starting point. (Logical)
</p>
<p>You can overwrite the text with <code>ggplot2::labs(caption = "...")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_x_scale</code></td>
<td>
<p>TODO</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line_settings</code></td>
<td>
<p>Named list of arguments for <code>ggplot2::geom_line()</code>.
</p>
<p>The <code>mapping</code> argument is set separately.
</p>
<p>Any argument not in the list will use its default value.
</p>
<p>Default: <code>list(size = 0.5)</code>
</p>
<p><strong>N.B.</strong> Ignored when <code>smoothe = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoothe_settings</code></td>
<td>
<p>Named list of arguments for <code>ggplot2::geom_smooth()</code>.
</p>
<p>The <code>mapping</code> argument is set separately.
</p>
<p>Any argument not in the list will use its default value.
</p>
<p>Default: <code>list(size = 0.5, alpha = 0.18, level = 0.95, se = TRUE)</code>
</p>
<p><strong>N.B.</strong> Only used when <code>smoothe = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>point_settings</code></td>
<td>
<p>Named list of arguments for <code>ggplot2::geom_point()</code>.
</p>
<p>The <code>mapping</code> argument is set separately.
</p>
<p>Any argument not in the list will use its default value.
</p>
<p>Default: <code>list(size = 0.1, alpha = 0.4)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hline_settings</code></td>
<td>
<p>Named list of arguments for <code>ggplot2::geom_hline()</code>.
</p>
<p>The <code>mapping</code> argument is set separately.
</p>
<p>Any argument not in the list will use its default value.
</p>
<p>Default: <code>list(size = 0.35, alpha = 0.5)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet_settings</code></td>
<td>
<p>Named list of arguments for <code>ggplot2::facet_wrap()</code>.
</p>
<p>The <code>facets</code> argument is set separately.
</p>
<p>Any argument not in the list will use its default value.
</p>
<p>Commonly set arguments are <code>nrow</code> and <code>ncol</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>Limits for the y-scale.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>TODO
</p>


<h3>Value</h3>

<p>A <code>ggplot2</code> object with a faceted line plot. TODO
</p>


<h3>Author(s)</h3>

<p>Ludvig Renbo Olsen, <a href="mailto:r-pkgs@ludvigolsen.dk">r-pkgs@ludvigolsen.dk</a>
</p>


<h3>See Also</h3>

<p>Other plotting functions: 
<code>font()</code>,
<code>plot_confusion_matrix()</code>,
<code>plot_metric_density()</code>,
<code>plot_probabilities_ecdf()</code>,
<code>sum_tile_settings()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Attach cvms
library(cvms)
library(ggplot2)
library(dplyr)

#
# Multiclass
#

# Plot probabilities of target classes
# From repeated cross-validation of three classifiers

# plot_probabilities(
#   data = predicted.musicians,
#   target_col = "Target",
#   probability_cols = c("A", "B", "C", "D"),
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   obs_id_col = "ID",
#   probability_of = "target"
# )

# Plot probabilities of predicted classes
# From repeated cross-validation of three classifiers

# plot_probabilities(
#   data = predicted.musicians,
#   target_col = "Target",
#   probability_cols = c("A", "B", "C", "D"),
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   obs_id_col = "ID",
#   probability_of = "prediction"
# )

# Center probabilities

# plot_probabilities(
#   data = predicted.musicians,
#   target_col = "Target",
#   probability_cols = c("A", "B", "C", "D"),
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   obs_id_col = "ID",
#   probability_of = "prediction",
#   order = "centered"
# )

#
# Binary
#

# Filter the predicted.musicians dataset
# binom_data &lt;- predicted.musicians %&gt;%
#   dplyr::filter(
#     Target %in% c("A", "B")
#   ) %&gt;%
#   # "B" is the second class alphabetically
#   dplyr::rename(Probability = B) %&gt;%
#   dplyr::mutate(`Predicted Class` = ifelse(
#     Probability &gt; 0.5, "B", "A")) %&gt;%
#   dplyr::select(-dplyr::all_of(c("A","C","D")))

# Plot probabilities of predicted classes
# From repeated cross-validation of three classifiers

# plot_probabilities(
#   data = binom_data,
#   target_col = "Target",
#   probability_cols = "Probability",
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   obs_id_col = "ID",
#   probability_of = "target"
# )

# plot_probabilities(
#   data = binom_data,
#   target_col = "Target",
#   probability_cols = "Probability",
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   obs_id_col = "ID",
#   probability_of = "prediction",
#   ylim = c(0.5, 1)
# )


</code></pre>


</div>