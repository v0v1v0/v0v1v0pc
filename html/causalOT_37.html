<div class="container">

<table style="width: 100%;"><tr>
<td>OTProblem</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Object Oriented OT Problem</h2>

<h3>Description</h3>

<p>Object Oriented OT Problem
</p>


<h3>Usage</h3>

<pre><code class="language-R">OTProblem(measure_1, measure_2, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>measure_1</code></td>
<td>
<p>An object of class Measure</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>measure_2</code></td>
<td>
<p>An object of class Measure</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Not used at this time</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An R6 object of class "OTProblem"
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>device</code></dt>
<dd>
<p>the <code>torch::torch_device()</code> of the data.</p>
</dd>
<dt><code>dtype</code></dt>
<dd>
<p>the torch::torch_dtype of the data.</p>
</dd>
<dt><code>selected_delta</code></dt>
<dd>
<p>the delta value selected after <code>choose_hyperparameters</code></p>
</dd>
<dt><code>selected_lambda</code></dt>
<dd>
<p>the lambda value selected after <code>choose_hyperparameters</code></p>
</dd>
</dl>
</div>


<h3>Active bindings</h3>

<div class="r6-active-bindings">

<dl>
<dt><code>loss</code></dt>
<dd>
<p>prints the current value of the objective. Only availble after the <a href="#method-OTProblem-solve"><code>OTProblem$solve()</code></a> method has been run</p>
</dd>
<dt><code>penalty</code></dt>
<dd>
<p>Returns a list of the lambda and delta penalities that will be iterated through. To set these values, use the <a href="#method-OTProblem-setup_arguments"><code>OTProblem$setup_arguments()</code></a> function.</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-OTProblem-add"><code>OTProblem$add()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-subtract"><code>OTProblem$subtract()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-multiply"><code>OTProblem$multiply()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-divide"><code>OTProblem$divide()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-setup_arguments"><code>OTProblem$setup_arguments()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-solve"><code>OTProblem$solve()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-choose_hyperparameters"><code>OTProblem$choose_hyperparameters()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-info"><code>OTProblem$info()</code></a>
</p>
</li>
<li> <p><a href="#method-OTProblem-clone"><code>OTProblem$clone()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-OTProblem-add"></a>



<h4>Method <code>add()</code>
</h4>

<p>adds <code>o2</code> to the OTProblem
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$add(o2)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>o2</code></dt>
<dd>
<p>A number or object of class OTProblem</p>
</dd>
</dl>
</div>


<hr>
<a id="method-OTProblem-subtract"></a>



<h4>Method <code>subtract()</code>
</h4>

<p>subtracts <code>o2</code> from OTProblem
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$subtract(o2)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>o2</code></dt>
<dd>
<p>A number or object of class OTProblem</p>
</dd>
</dl>
</div>


<hr>
<a id="method-OTProblem-multiply"></a>



<h4>Method <code>multiply()</code>
</h4>

<p>multiplies OTProblem by <code>o2</code>
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$multiply(o2)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>o2</code></dt>
<dd>
<p>A number or an object of class OTProblem</p>
</dd>
</dl>
</div>


<hr>
<a id="method-OTProblem-divide"></a>



<h4>Method <code>divide()</code>
</h4>

<p>divides OTProblem by <code>o2</code>
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$divide(o2)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>o2</code></dt>
<dd>
<p>A number or object of class OTProblem</p>
</dd>
</dl>
</div>


<hr>
<a id="method-OTProblem-setup_arguments"></a>



<h4>Method <code>setup_arguments()</code>
</h4>



<h5>Usage</h5>

<div class="r"><pre>OTProblem$setup_arguments(
      lambda,
      delta,
      grid.length = 7L,
      cost.function = NULL,
      p = 2,
      cost.online = "auto",
      debias = TRUE,
      diameter = NULL,
      ot_niter = 1000L,
      ot_tol = 0.001
    )</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>lambda</code></dt>
<dd>
<p>The penalty parameters to try for the OT problems. If not provided, function will select some</p>
</dd>
<dt><code>delta</code></dt>
<dd>
<p>The constraint paramters to try for the balance function problems, if any</p>
</dd>
<dt><code>grid.length</code></dt>
<dd>
<p>The number of hyperparameters to try if not provided</p>
</dd>
<dt><code>cost.function</code></dt>
<dd>
<p>The cost function for the data. Can be any function that takes arguments <code>x1</code>, <code>x2</code>, <code>p</code>. Defaults to the Euclidean distance</p>
</dd>
<dt><code>p</code></dt>
<dd>
<p>The power to raise the cost matrix by. Default is 2</p>
</dd>
<dt><code>cost.online</code></dt>
<dd>
<p>Should online costs be used? Default is "auto" but "tensorized" stores the cost matrix in memory while "online" will calculate it on the fly.</p>
</dd>
<dt><code>debias</code></dt>
<dd>
<p>Should debiased OT problems be used? Defaults to TRUE</p>
</dd>
<dt><code>diameter</code></dt>
<dd>
<p>Diameter of the cost function.</p>
</dd>
<dt><code>ot_niter</code></dt>
<dd>
<p>Number of iterations to run the OT problems</p>
</dd>
<dt><code>ot_tol</code></dt>
<dd>
<p>The tolerance for convergence of the OT problems</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>NULL
</p>



<h5>Examples</h5>

<div class="r example copy">
<pre> ot$setup_arguments(lambda = c(1000,10))
    </pre>
</div>


<hr>
<a id="method-OTProblem-solve"></a>



<h4>Method <code>solve()</code>
</h4>

<p>Solve the OTProblem at each parameter value. Must run setup_arguments first.
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$solve(
      niter = 1000L,
      tol = 1e-05,
      optimizer = c("torch", "frank-wolfe"),
      torch_optim = torch::optim_lbfgs,
      torch_scheduler = torch::lr_reduce_on_plateau,
      torch_args = NULL,
      osqp_args = NULL,
      quick.balance.function = TRUE
    )</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>niter</code></dt>
<dd>
<p>The nubmer of iterations to run solver at each combination of hyperparameter values</p>
</dd>
<dt><code>tol</code></dt>
<dd>
<p>The tolerance for convergence</p>
</dd>
<dt><code>optimizer</code></dt>
<dd>
<p>The optimizer to use. One of "torch" or "frank-wolfe"</p>
</dd>
<dt><code>torch_optim</code></dt>
<dd>
<p>The <code>torch_optimizer</code> to use. Default is torch::optim_lbfgs</p>
</dd>
<dt><code>torch_scheduler</code></dt>
<dd>
<p>The torch::lr_scheduler to use. Default is torch::lr_reduce_on_plateau</p>
</dd>
<dt><code>torch_args</code></dt>
<dd>
<p>Arguments passed to the torch optimizer and scheduler</p>
</dd>
<dt><code>osqp_args</code></dt>
<dd>
<p>Arguments passed to <code>osqp::osqpSettings()</code> if appropriate</p>
</dd>
<dt><code>quick.balance.function</code></dt>
<dd>
<p>Should <code>osqp::osqp()</code> be used to select balance function constraints (delta) or not. Default true.</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre> ot$solve(niter = 1, torch_optim = torch::optim_rmsprop)
    </pre>
</div>


<hr>
<a id="method-OTProblem-choose_hyperparameters"></a>



<h4>Method <code>choose_hyperparameters()</code>
</h4>

<p>Selects the hyperparameter values through a bootstrap algorithm
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$choose_hyperparameters(
      n_boot_lambda = 100L,
      n_boot_delta = 1000L,
      lambda_bootstrap = Inf
    )</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>n_boot_lambda</code></dt>
<dd>
<p>The number of bootstrap iterations to run when selecting lambda</p>
</dd>
<dt><code>n_boot_delta</code></dt>
<dd>
<p>The number of bootstrap iterations to run when selecting delta</p>
</dd>
<dt><code>lambda_bootstrap</code></dt>
<dd>
<p>The penalty parameter to use when selecting lambda. Higher numbers run faster.</p>
</dd>
</dl>
</div>



<h5>Examples</h5>

<div class="r example copy">
<pre> ot$choose_hyperparameters(n_boot_lambda = 10, 
                                             n_boot_delta = 10, 
                                             lambda_bootstrap = Inf)
    </pre>
</div>


<hr>
<a id="method-OTProblem-info"></a>



<h4>Method <code>info()</code>
</h4>

<p>Provides diagnostics after solve and choose_hyperparameter methods have been run.
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$info()</pre></div>



<h5>Returns</h5>

<p>a list with slots
</p>

<ul>
<li> <p><code>loss</code> the final loss values
</p>
</li>
<li> <p><code>iterations</code> The number of iterations run for each combination of parameters
</p>
</li>
<li> <p><code>balance.function.differences</code> The final differences in the balance functions
</p>
</li>
<li> <p><code>hyperparam.metrics</code> A list of the bootstrap evalustion for delta and lambda values</p>
</li>
</ul>
<h5>Examples</h5>

<div class="r example copy">
<pre> ot$info()
    </pre>
</div>


<hr>
<a id="method-OTProblem-clone"></a>



<h4>Method <code>clone()</code>
</h4>

<p>The objects of this class are cloneable with this method.
</p>


<h5>Usage</h5>

<div class="r"><pre>OTProblem$clone(deep = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>deep</code></dt>
<dd>
<p>Whether to make a deep clone.</p>
</dd>
</dl>
</div>




<h3>Examples</h3>

<pre><code class="language-R">## ------------------------------------------------
## Method `OTProblem(measure_1, measure_2)`
## ------------------------------------------------

if (torch::torch_is_installed()) {
  # setup measures
  x &lt;- matrix(1, 100, 10)
  m1 &lt;- Measure(x = x)
  
  y &lt;- matrix(2, 100, 10)
  m2 &lt;- Measure(x = y, adapt = "weights")
  
  z &lt;- matrix(3,102, 10)
  m3 &lt;- Measure(x = z)
  
  # setup OT problems
  ot1 &lt;- OTProblem(m1, m2)
  ot2 &lt;- OTProblem(m3, m2)
  ot &lt;- 0.5 * ot1 + 0.5 * ot2
  print(ot)

## ------------------------------------------------
## Method `OTProblem$setup_arguments`
## ------------------------------------------------

  ot$setup_arguments(lambda = 1000)

## ------------------------------------------------
## Method `OTProblem$solve`
## ------------------------------------------------

  ot$solve(niter = 1, torch_optim = torch::optim_rmsprop)

## ------------------------------------------------
## Method `OTProblem$choose_hyperparameters`
## ------------------------------------------------

  ot$choose_hyperparameters(n_boot_lambda = 1,
                            n_boot_delta = 1, 
                            lambda_bootstrap = Inf)

## ------------------------------------------------
## Method `OTProblem$info`
## ------------------------------------------------

ot$info()
}
</code></pre>


</div>