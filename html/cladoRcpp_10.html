<div class="container">

<table style="width: 100%;"><tr>
<td>rcpp_calc_anclikes_sp_COOweights_faster</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Even faster version of rcpp_calc_anclikes_sp</h2>

<h3>Description</h3>

<p>This function improves on <code>rcpp_calc_anclikes_sp</code> and
<code>rcpp_calc_anclikes_sp_COOprobs</code>.  In addition to the compressed
COO-like storage format, the internal C++ code here explicitly
enumerates the allowed transitions, rather than searching through
every possibility and testing whether or not it is allowed.  This 
appears to scale well to very large state spaces.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rcpp_calc_anclikes_sp_COOweights_faster(Rcpp_leftprobs, Rcpp_rightprobs, l,
  s = 1, v = 1, j = 0, y = 1, dmat = NULL, maxent01s = NULL,
  maxent01v = NULL, maxent01j = NULL, maxent01y = NULL,
  max_minsize_as_function_of_ancsize = NULL, printmat = TRUE,
  m = NULL, m_null_range = TRUE, jts_matrix = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Rcpp_leftprobs</code></td>
<td>
<p>Probabilities of the states at the base of the left descendant branch</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rcpp_rightprobs</code></td>
<td>
<p>Probabilities of the states at the base of the right descendant branch</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>l</code></td>
<td>
<p>List of state indices (0-based)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>Relative weight of sympatric "subset" speciation. Default <code>s=1</code> mimics LAGRANGE model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>v</code></td>
<td>
<p>Relative weight of vicariant speciation. Default <code>v=1</code> mimics LAGRANGE model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>j</code></td>
<td>
<p>Relative weight of "founder event speciation"/jump speciation. Default <code>j=0</code> mimics LAGRANGE model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Relative weight of fully sympatric speciation (range-copying). Default <code>y=1</code> mimics LAGRANGE model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dmat</code></td>
<td>
<p>If given, a matrix of rank numareas giving multipliers for the probability
of each dispersal event between areas. Default NULL, which sets every cell of the 
<code>dmat</code> matrix to value 1.  Users may construct their own parameterized <code>dmat</code>
(for example, making <code>dmat</code> a function of distance) for inclusion in ML or
Bayesian analyses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxent01s</code></td>
<td>
<p>Matrix giving the relative weight of each possible descendant rangesize for 
the smaller range, for a given ancestral rangesize, for a subset-sympatric speciation event. 
Default is <code>NULL</code>, which means the script will set up the LAGRANGE model (one descendent
always has range size 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxent01v</code></td>
<td>
<p>Matrix giving the relative weight of each possible descendant rangesize for 
the smaller range, for a given ancestral rangesize, for a vicariance speciation event. 
Default is <code>NULL</code>, which means the script will set up the LAGRANGE model (one descendent 
always has range size 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxent01j</code></td>
<td>
<p>Matrix giving the relative weight of each possible descendant rangesize for 
the smaller range, for a given ancestral rangesize, for a founder-event speciation event. 
Default is <code>NULL</code>, which means the script will set up the LAGRANGE model (one descendent 
always has range size 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxent01y</code></td>
<td>
<p>Matrix giving the relative weight of each possible descendant rangesize for 
the smaller range, for a given ancestral rangesize, for a full-sympatric (range-copying) 
speciation event. 
Default is <code>NULL</code>, which means the script will set up the LAGRANGE model (one descendent 
always has range size 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_minsize_as_function_of_ancsize</code></td>
<td>
<p>If given, any state with a range larger that this value will 
be given a probability of zero (for the branch with the smaller rangesize).  This means that not every
possible combination of ranges has to be checked, which can get very slow for large state spaces.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printmat</code></td>
<td>
<p>Should the probability matrix output be printed to screen? (useful for debugging, but 
can be dramatically slow in R.app for some reason for even moderate numbers of states; perhaps 
overrunning the line length...)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>This is a vector of rate/weight multipliers for dispersal, conditional on the values of some
(non-biogeographical) trait. For example, one might hypothesize that flight/flightlessness effects
dispersal probability, and manually put a multiplier of 0.001 on the flightlessness state. Or, 
one might attempt to estimate this. The strategy used in cladoRcpp is to expand the default cladogenetic
rate matrix by length(m) times. I.e., if <em>m</em> is not <code>NULL</code>, then loop through the values of <em>m</em> and apply the 
multipliers to <em>d</em> (and <em>j</em>, and <em>a</em>) events. Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m_null_range</code></td>
<td>
<p>Is the null range included in the state space in the general 
analysis? (The function needs to know this, when there are traits, to index
the state space correctly.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>jts_matrix</code></td>
<td>
<p>A numtraits x numtraits matrix containing the proportions for 
trait transitions during j events. E.g., for a sudden switch from 
trait 1 (flight) to trait 2 (flightlessness) during a jump event.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This should be faster, i.e. by look for each type of event individually.
</p>
<p>Returns results as 4 columns: ancestral index, left index, right index, conditional
probability given ancestral states (assuming likelihood of descendants is 1). Indexes
are 0-based.
</p>
<p>Keep in mind that cladogenesis matrices exclude the null state
(a range of 0 areas), so if your states list starts with the 
null range (as is typical/default in DEC-style models)
then to get the R 1-based state indices requires e.g. 
COO_weights_columnar[[1]] + 2.
</p>
<p>When the calculation is run at each node in the tree, all that is required is one
pass through the COO-like array, with the downpassed probabilities of the
states on the left and right branches multiplied by the probability column.
</p>


<h3>Value</h3>

<p><code>COO_weights_columnar</code> Transition weights matrix in COO-like format as 4 columns: 
ancestral index, left index, right index, and weight of the specified transition. Indexes are
0-based. 
Keep in mind that cladogenesis matrices exclude the null state
(a range of 0 areas), so if your states list starts with the 
null range (as is typical/default in DEC-style models)
then to get the R 1-based state indices requires e.g. 
COO_weights_columnar[[1]] + 2.
</p>
<p>Dividing the
weights by the sum of the weights for a particular ancestral state yields the conditional
probabilities of each transition at the speciation event.
(assuming likelihood of descendants is 1).
</p>


<h3>Author(s)</h3>

<p>Nicholas Matzke <a href="mailto:matzke@berkeley.edu">matzke@berkeley.edu</a>
</p>


<h3>See Also</h3>

<p><code>rcpp_calc_anclikes_sp</code>, <code>rcpp_calc_anclikes_sp_COOprobs</code>, 
<code>rcpp_calc_anclikes_sp_COOweights_faster</code>
</p>
<p><code>rcpp_calc_anclikes_sp</code>
#bibliography /Dropbox/_njm/__packages/cladoRcpp_setup/cladoRcpp_refs.bib
@cite Matzke_2013
@cite Matzke_2014
@cite ReeSmith2008
</p>


<h3>Examples</h3>

<pre><code class="language-R"># For the basic logic of a probablistic cladogenesis model, see
?rcpp_calc_anclikes_sp

# For examples of running the functions, see the comparison of all functions at:
# ?cladoRcpp

</code></pre>


</div>