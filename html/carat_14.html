<div class="container">

<table style="width: 100%;"><tr>
<td>evalRand</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Evaluation of Randomization Procedures</h2>

<h3>Description</h3>

<p>Evaluates a specific randomization procedure based on several different quantities of imbalances. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">evalRand(data, method = "HuHuCAR", N = 500, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>the iteration number. The default is 500.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the randomization procedure to be evaluated. This package provides assessment for <code>"HuHuCAR"</code>, <code>"PocSimMIN"</code>, <code>"StrBCD"</code>, <code>"StrPBR"</code>, <code>"AdjBCD"</code>, and <code>"DoptBCD"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to be passed to <code>method</code>. These arguments depend on the randomization method assessed and the following arguments are accepted:
</p>

<dl>
<dt>omega</dt>
<dd>
<p>a vector of weights at the overall, within-stratum, and within-covariate-margin levels. It is required that at least one element is larger than 0. Note that <code>omega</code> is only needed when <code>HuHuCAR</code> is to be assessed.</p>
</dd>
<dt>weight</dt>
<dd>
<p>a vector of weights for within-covariate-margin imbalances. It is required that at least one element is larger than 0. Note that <code>weight</code> is only needed when <code>PocSimMIN</code> is to be assessed.</p>
</dd>
<dt>p</dt>
<dd>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. Note that <code>p</code> is only needed when <code>"HuHuCAR"</code>,  <code>"PocSimMIN"</code> and <code>"StrBCD"</code> are to be assessed.</p>
</dd>
<dt>a</dt>
<dd>
<p>a design parameter governing the degree of randomness. Note that <code>a</code> is only needed when <code>"AdjBCD"</code> is to be assessed.</p>
</dd>
<dt>bsize</dt>
<dd>
<p>the block size for stratified permuted block randomization. It is required to be a multiple of <code>2</code>. Note that <code>bsize</code> is only needed when <code>"StrPBR"</code> is to be assessed.</p>
</dd>
</dl>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>data</code> is designed for <code>N</code> times using <code>method</code>.
</p>


<h3>Value</h3>

<p>It returns an object of <code>class</code> <code>"careval"</code>. 
</p>
<p>An object of class <code>"careval"</code> is a list containing the following components: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>a vector giving the weights imposed on each covariate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bsize</code></td>
<td>
<p>the block size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Assig</code></td>
<td>
<p>a <code>n*N</code> matrix containing assignments for each patient for N iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Imb</code></td>
<td>
<p>a matrix containing maximum, 95%-quantile, median, and mean of absolute imbalances at overall, within-stratum and within-covariate-margin levels. Note that, we refer users to the <code class="reqn">i</code>th column of <code>`All strata`</code> for details of <code>level</code> <code class="reqn">i, i=1,\ldots,</code><code>strt_num</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SNUM</code></td>
<td>
<p>a matrix with <code>N</code> colunms containing the number of patients in each stratum for each iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the randomization method to be evaluated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iteration</code></td>
<td>
<p>the number of iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Data Type</code></td>
<td>
<p>the data type. <code>Real</code> or <code>Simulated</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DIF</code></td>
<td>
<p>a matrix containing the final differences at the overall, within-stratum, and within-covariate-margin levels for each iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the data frame.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Atkinson A C. <em>Optimum biased coin designs for sequential clinical trials with prognostic factors</em>[J]. Biometrika, 1982, 69(1): 61-67.
</p>
<p>Baldi Antognini A, Zagoraiou M. <em>The covariate-adaptive biased coin design for balancing clinical trials in the presence of prognostic factors</em>[J]. Biometrika, 2011, 98(3): 519-535.
</p>
<p>Hu Y, Hu F. <em>Asymptotic properties of covariate-adaptive randomization</em>[J]. The Annals of Statistics, 2012, 40(3): 1794-1815.
</p>
<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Pocock S J, Simon R. <em>Sequential treatment assignment with balancing for prognostic factors in the controlled clinical trial</em>[J]. Biometrics, 1975: 103-115.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. 
</p>
<p>Zelen M. <em>The randomization and stratification of patients to clinical trials</em>[J]. Journal of chronic diseases, 1974, 27(7): 365-375.
</p>


<h3>See Also</h3>

<p>See <code>evalRand.sim</code> to evaluate a randomization procedure with covariate data generating mechanism.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># a simple use
## Access by real data
## create a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 1000, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 1000, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 1000, TRUE), 
                 stringsAsFactors = TRUE)
Res &lt;- evalRand(data = df, method = "HuHuCAR", N = 500, 
                omega = c(1, 2, rep(1, ncol(df))), p = 0.85)
## view the output
Res

  ## view all patients' assignments
  Res$Assig

## Assess by simulated data
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5)
pr &lt;- c(0.35, 0.65, 0.25, 0.35, 0.4, 0.25, 0.15, 0.2, 0.15, 0.25)
n &lt;- 1000
N &lt;- 50
omega = c(1, 2, 1, 1, 2)
# assess Hu and Hu's procedure with the same group of patients
Res.sim &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                        level_num = level_num, pr = pr, method = "HuHuCAR", 
                        omega, p = 0.85)
 
  ## Compare four procedures
  cov_num &lt;- 3
  level_num &lt;- c(2, 10, 2)
  pr &lt;- c(rep(0.5, times = 2), rep(0.1, times = 10), rep(0.5, times = 2))
  n &lt;- 100
  N &lt;- 200 # &lt;&lt;adjust according to CPU
  bsize &lt;- 4
  ## set weights for HuHuCAR
  omega &lt;- c(1, 2, rep(1, cov_num)); 
  ## set weights for PocSimMIN
  weight = rep(1, cov_num); 
  ## set biased probability
  p = 0.80
  # assess Hu and Hu's procedure
  RH &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                     level_num = level_num, pr = pr, method = "HuHuCAR", 
                     omega = omega, p = p)
  # assess Pocock and Simon's method
  RPS &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                      level_num = level_num, pr = pr, method = "PocSimMIN", 
                      weight, p = p)
  # assess Shao's procedure
  RS &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                     level_num = level_num, pr = pr, method = "StrBCD", 
                     p = p)
  # assess stratified randomization
  RSR &lt;- evalRand.sim(n = n, N = N, Replace = FALSE, cov_num = cov_num, 
                      level_num = level_num, pr = pr, method = "StrPBR", 
                      bsize)
  
  # create containers
  C_M = C_O = C_WS = matrix(NA, nrow = 4, ncol = 4)
  colnames(C_M) = colnames(C_O) = colnames(C_WS) = 
    c("max", "95%quan", "med", "mean")
  rownames(C_M) = rownames(C_O) = rownames(C_WS) = 
    c("HH", "PocSim", "Shao", "StraRand")
  
  # assess the overall imbalance
  C_O[1, ] = RH$Imb[1, ]
  C_O[2, ] = RPS$Imb[1, ]
  C_O[3, ] = RS$Imb[1, ]
  C_O[4, ] = RSR$Imb[1, ]
  # view the result
  C_O
  
  # assess the marginal imbalances
  C_M[1, ] = apply(RH$Imb[(1 + RH$strt_num) : (1 + RH$strt_num + sum(level_num)), ], 2, mean)
  C_M[2, ] = apply(RPS$Imb[(1 + RPS$strt_num) : (1 + RPS$strt_num + sum(level_num)), ], 2, mean)
  C_M[3, ] = apply(RS$Imb[(1 + RS$strt_num) : (1 + RS$strt_num + sum(level_num)), ], 2, mean)
  C_M[4, ] = apply(RSR$Imb[(1 + RSR$strt_num) : (1 + RSR$strt_num + sum(level_num)), ], 2, mean)
  # view the result
  C_M
  
  # assess the within-stratum imbalances
  C_WS[1, ] = apply(RH$Imb[2 : (1 + RH$strt_num), ], 2, mean)
  C_WS[2, ] = apply(RPS$Imb[2 : (1 + RPS$strt_num), ], 2, mean)
  C_WS[3, ] = apply(RS$Imb[2 : (1 + RS$strt_num), ], 2, mean)
  C_WS[4, ] = apply(RSR$Imb[2 : (1 + RSR$strt_num), ], 2, mean)
  # view the result
  C_WS
  
  # Compare the four procedures through plots
  meth = rep(c("Hu", "PS", "Shao", "STR"), times = 3)
  shape &lt;- rep(1 : 4, times = 3)
  crt &lt;- rep(1 : 3, each = 4)
  crt_c &lt;- rep(c("O", "M", "WS"), each = 4)
  mean &lt;- c(C_O[, 4], C_M[, 4], C_WS[, 4])
  df_1 &lt;- data.frame(meth, shape, crt, crt_c, mean, 
                     stringsAsFactors = TRUE)
  
  require(ggplot2)
  p1 &lt;- ggplot(df_1, aes(x = meth, y = mean, color = crt_c, group = crt,
                         linetype = crt_c, shape = crt_c)) +
    geom_line(size = 1) +
    geom_point(size = 2) +
    xlab("method") +
    ylab("absolute mean") +
    theme(plot.title = element_text(hjust = 0.5))
  p1

</code></pre>


</div>