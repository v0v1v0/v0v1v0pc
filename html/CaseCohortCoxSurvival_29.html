<div class="container">

<table style="width: 100%;"><tr>
<td>variance.missingdata</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>variance.missingdata</h2>

<h3>Description</h3>

<p>Computes the variance estimate that follows the complete variance decomposition,
for a parameter such as log-relative hazard, cumulative baseline hazard or
covariate specific pure-risk, when covariate information is missing for
individuals in the phase-two sample.
</p>


<h3>Usage</h3>

<pre><code class="language-R">variance.missingdata(n, casecohort, casecohort.phase2, weights,
weights.phase2, weights.p2.phase2, infl2, infl3, stratified.p2 = NULL,
estimated.weights = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>number of individuals in the whole cohort.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>casecohort</code></td>
<td>
<p>If <code>stratified = TRUE</code>, data frame with <code>W</code>
(the <code class="reqn">J</code> phase-two strata), <code>strata.m</code> (vector of length <code class="reqn">J</code> with the numbers of
sampled individuals in the strata in the second phase of sampling) and
<code>strata.n</code> (vector of length <code class="reqn">J</code> with the strata sizes in the cohort), for
each individual in the stratified case cohort data. If <code>stratified = FALSE</code>,
data frame with <code>m</code> (number of sampled individuals in the second phase of
sampling) and <code>n</code> (cohort size), for each individual in the unstratified
case cohort data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>casecohort.phase2</code></td>
<td>
<p>If <code>stratified = TRUE</code>, data frame with <code>W</code>
(the <code class="reqn">J</code> phase-two strata), <code>strata.m</code> (vector of length <code class="reqn">J</code> with the
numbers of sampled individuals in the strata in the second phase of sampling),
<code>strata.n</code> (vector of length <code class="reqn">J</code> with the strata sizes in the cohort) and
<code>phase3</code> (phase-three sampling indicator), for each individual in the
phase-two sample. If <code>stratified = FALSE</code>, data frame with  <code>m</code> (number
of sampled individuals in the second phase of sampling), <code>n</code> (cohort size)
and unstrat.phase3 (phase-three sampling indicator), for each individual in the
phase-two sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>vector with design weights for the individuals
in the case cohort data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights.phase2</code></td>
<td>
<p>vector with design weights for the individuals in the
phase-two sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights.p2.phase2</code></td>
<td>
<p>vector with phase-two design weights for the individuals
in the phase-two sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>infl2</code></td>
<td>
<p>matrix with the phase-two influences on the parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>infl3</code></td>
<td>
<p>matrix with the phase-three influences on the parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratified.p2</code></td>
<td>
<p>was the second phase of sampling stratified on <code>W</code>?
Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimated.weights</code></td>
<td>
<p>were the phase-three weights estimated? Default is <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>variance.missingdata</code> works for estimation from a case cohort with design
weights and when covariate information was missing for certain individuals in the
phase-two data (i.e., case cohort obtained from three phases of sampling and
consisting of individuals in the phase-two data without missing covariate
information).
</p>
<p>If there are no missing covariates in the phase- two sample, use <code>variance</code>
with either design weights or calibrated weights.
</p>
<p><code>variance.missingdata</code> uses the variance formulas provided in Etievant and
Gail (2024).
</p>


<h3>Value</h3>

<p><code>variance</code>: variance estimate.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code>influences.missingdata</code>, <code>influences.RH.missingdata</code>, <code>influences.CumBH.missingdata</code>,
</p>
<p><code>influences.PR.missingdata</code>, <code>robustvariance</code> and <code>variance</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2)  &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3)  &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)
  n &lt;- nrow(cohort)

  # Quantities needed for estimation of the cumulative baseline hazard when
  # covariate data is missing
  mod.cohort &lt;- coxph(Surv(event.time, status) ~ X2, data = cohort,
                      robust = TRUE) # X2 is available on all cohort members
  mod.cohort.detail &lt;- coxph.detail(mod.cohort, riskmat = TRUE)

  riskmat.phase2 &lt;- with(cohort, mod.cohort.detail$riskmat[phase2 == 1,])
  rownames(riskmat.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  observed.times.phase2 &lt;- apply(riskmat.phase2, 1,
                                 function(v) {which.max(cumsum(v))})
  dNt.phase2 &lt;- matrix(0, nrow(riskmat.phase2), ncol(riskmat.phase2))
  dNt.phase2[cbind(1:nrow(riskmat.phase2), observed.times.phase2)] &lt;- 1
  dNt.phase2 &lt;- sweep(dNt.phase2, 1, phase2$status, "*")
  colnames(dNt.phase2) &lt;- colnames(riskmat.phase2)
  rownames(dNt.phase2) &lt;- rownames(riskmat.phase2)

  Tau1 &lt;- 0 # given time interval for the pure risk
  Tau2 &lt;- 8
  x &lt;- c(-1, 1, -0.6) # given covariate profile for the pure risk

  # Estimation using the stratified case cohort with true known design weights

  mod.true &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3, data = casecohort,
                    weight = weight.true, id = id, robust = TRUE)

  est.true &lt;- influences.missingdata(mod = mod.true,
                                     riskmat.phase2 = riskmat.phase2,
                                     dNt.phase2 = dNt.phase2, Tau1 = Tau1,
                                     Tau2 = Tau2, x = x)
  infl.beta.true &lt;- est.true$infl.beta
  infl.Lambda0.true &lt;- est.true$infl.Lambda0.Tau1Tau2
  infl.Pi.x.true &lt;- est.true$infl.Pi.x.Tau1Tau2
  infl2.beta.true &lt;- est.true$infl2.beta
  infl2.Lambda0.true &lt;- est.true$infl2.Lambda0.Tau1Tau2
  infl2.Pi.x.true &lt;- est.true$infl2.Pi.x.Tau1Tau2
  infl3.beta.true &lt;- est.true$infl3.beta
  infl3.Lambda0.true &lt;- est.true$infl3.Lambda0.Tau1Tau2
  infl3.Pi.x.true &lt;- est.true$infl3.Pi.x.Tau1Tau2

  # variance estimate for the log-relative hazard estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.true,
                       weights.phase2 = phase2$weight.true,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.beta.true, infl3 = infl3.beta.true,
                       stratified.p2 = TRUE)

  # variance estimate for the cumulative baseline hazard estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.true,
                       weights.phase2 = phase2$weight.true,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Lambda0.true, infl3 = infl3.Lambda0.true,
                       stratified.p2 = TRUE)

  # variance estimate for the pure risk estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.true,
                       weights.phase2 = phase2$weight.true,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Pi.x.true, infl3 = infl3.Pi.x.true,
                       stratified.p2 = TRUE)


  # Estimation using the stratified case cohort with estimated weights, and
  # accounting for the estimation through the influences

  mod.estimated &lt;- coxph(Surv(event.time, status) ~ X1 + X2 + X3,
                         data = casecohort, weight = weight.est, id = id,
                         robust = TRUE)

  est.estimated  &lt;- influences.missingdata(mod.estimated,
                                           riskmat.phase2 = riskmat.phase2,
                                           dNt.phase2 = dNt.phase2,
                                           estimated.weights = TRUE,
                                           B.phase2 = B.phase2, Tau1 = Tau1,
                                           Tau2 = Tau2, x = x)

  infl.beta.estimated &lt;- est.estimated$infl.beta
  infl.Lambda0.estimated &lt;- est.estimated$infl.Lambda0.Tau1Tau2
  infl.Pi.x.estimated &lt;- est.estimated$infl.Pi.x.Tau1Tau2
  infl2.beta.estimated &lt;- est.estimated$infl2.beta
  infl2.Lambda0.estimated &lt;- est.estimated$infl2.Lambda0.Tau1Tau2
  infl2.Pi.x.estimated &lt;- est.estimated$infl2.Pi.x.Tau1Tau2
  infl3.beta.estimated &lt;- est.estimated$infl3.beta
  infl3.Lambda0.estimated &lt;- est.estimated$infl3.Lambda0.Tau1Tau2
  infl3.Pi.x.estimated &lt;- est.estimated$infl3.Pi.x.Tau1Tau2

  # variance estimate for the log-relative hazard
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.est,
                       weights.phase2 = phase2$weight.est,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.beta.estimated,
                       infl3 = infl3.beta.estimated,
                       stratified.p2 = TRUE, estimated.weights = TRUE)

  # variance estimate for the cumulative baseline hazard estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.est,
                       weights.phase2 = phase2$weight.est,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Lambda0.estimated,
                       infl3 = infl3.Lambda0.estimated,
                       stratified.p2 = TRUE, estimated.weights = TRUE)

  # variance estimate for the pure risk estimate
  variance.missingdata(n = n, casecohort = casecohort,
                       casecohort.phase2 = phase2,
                       weights = casecohort$weight.est,
                       weights.phase2 = phase2$weight.est,
                       weights.p2.phase2 = phase2$weight.p2.true,
                       infl2 = infl2.Pi.x.estimated,
                       infl3 = infl3.Pi.x.estimated,
                       stratified.p2 = TRUE, estimated.weights = TRUE)

</code></pre>


</div>