<div class="container">

<table style="width: 100%;"><tr>
<td>reconstruct_ancestral_states</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Determine maximum parsimony ancestral state reconstruction(s)</h2>

<h3>Description</h3>

<p>Given a tree, or set of trees, and a cladistic matrix returns all most parsimonious reconstruction(s) for every character.
</p>


<h3>Usage</h3>

<pre><code class="language-R">reconstruct_ancestral_states(
  trees,
  cladistic_matrix,
  estimate_all_nodes = FALSE,
  estimate_tip_values = FALSE,
  inapplicables_as_missing = FALSE,
  polymorphism_behaviour = "uncertainty",
  uncertainty_behaviour = "uncertainty",
  polymorphism_geometry,
  polymorphism_distance,
  state_ages,
  dollo_penalty
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>trees</code></td>
<td>
<p>A tree (phylo object) or set of trees (multiPhylo object).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cladistic_matrix</code></td>
<td>
<p>A character-taxon matrix in the format imported by read_nexus_matrix. These should be discrete with labels matching the tip labels of <code>tree</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate_all_nodes</code></td>
<td>
<p>Logical that allows the user to make estimates for all ancestral values. The default (<code>FALSE</code>) will only make estimates for nodes that link coded terminals (recommended).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate_tip_values</code></td>
<td>
<p>Logical that allows the user to make estimates for tip values. The default (<code>FALSE</code>) will only makes estimates for internal nodes (recommended).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inapplicables_as_missing</code></td>
<td>
<p>Argument passed to calculate_tree_length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>polymorphism_behaviour</code></td>
<td>
<p>Argument passed to calculate_tree_length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uncertainty_behaviour</code></td>
<td>
<p>Argument passed to calculate_tree_length.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>polymorphism_geometry</code></td>
<td>
<p>Argument passed to make_costmatrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>polymorphism_distance</code></td>
<td>
<p>Argument passed to make_costmatrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state_ages</code></td>
<td>
<p>Argument passed to make_costmatrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dollo_penalty</code></td>
<td>
<p>Argument passed to make_costmatrix.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Although most phylogenetic inference considers character evolution on a tree, they rarely explicitly assign states to internal nodes in the process, and hence this is normally done <em>a posteriori</em> using some form of ancestral state estimation algorithm. This function uses the parsimony optimality criterion (i.e., maximum parsimony, or the process that involves the fewest possible transitions, or, more accurately, the lowest total transition cost).
</p>
<p><b>Algorithm</b>
</p>
<p>Like calculate_tree_length, this function is built around the generalised Swofford and Maddison (1992) algorithm, but adds the second pass as this is the one that explicitly generates <em>all</em> most parsimonious reconstructions. As it is a generalised approach it can work with the broadest range of character types and (rooted) trees of any degree of resolution - treating polytomies as hard.
</p>


<h3>Value</h3>

<p>A list with multiple components, including:
</p>
<table><tr style="vertical-align: top;">
<td><code>ITEM</code></td>
<td>
<p>ITEM EXPLANATION.</p>
</td>
</tr></table>
<h3>Author(s)</h3>

<p>Graeme T. Lloyd <a href="mailto:graemetlloyd@gmail.com">graemetlloyd@gmail.com</a>
</p>


<h3>References</h3>

<p>Lloyd, G. T., 2018. Journeys through discrete-character morphospace: synthesizing phylogeny, tempo, and disparity. <em>Palaeontology</em>, <b>61</b>, 637-645.
</p>
<p>Swofford, D. L. and Maddison, W. P., 1992. Parsimony, character-state reconstructions, and evolutionary inferences. <em>In</em> R. L. Mayden (ed.) Systematics, Historical Ecology, and North American Freshwater Fishes. Stanford University Press, Stanford, p187-223.
</p>


<h3>See Also</h3>

<p>calculate_tree_length, estimate_ancestral_states
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Generate two trees:
trees &lt;- ape::read.tree(text = c("(A,(B,(C,(D,E))));", "(A,((B,C),(D,E)));"))

# Build a simple 5-by-10 binary character matrix:
cladistic_matrix &lt;- build_cladistic_matrix(
  character_taxon_matrix = matrix(
    data = sample(
      x = c("0", "1"), # ADD MISSING, POLYMORPHISM, INAPPLICABLE ETC. HERE LATER TO TEST
      size = 50,
      replace = TRUE
    ),
    nrow = 5,
    ncol = 10,
    dimnames = list(
      LETTERS[1:5],
      c()
    )
  )
)

# Reconstruct ancestral states (limiting output to all most parsimonious
# ancestral state reconstruction for every tree and character combination):
reconstruct_ancestral_states(
  trees = trees,
  cladistic_matrix = cladistic_matrix,
  estimate_all_nodes = FALSE,
  estimate_tip_values = FALSE,
  inapplicables_as_missing = FALSE,
  polymorphism_behaviour = "uncertainty",
  uncertainty_behaviour = "uncertainty",
  polymorphism_geometry = "simplex",
  polymorphism_distance = "euclidean",
  dollo_penalty = 999,
  state_ages = c(2, 1)
)$node_estimates

</code></pre>


</div>