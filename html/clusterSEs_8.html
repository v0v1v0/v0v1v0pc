<div class="container">

<table style="width: 100%;"><tr>
<td>cluster.wild.glm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Wild Cluster Bootstrapped p-Values For Linear Family GLM</h2>

<h3>Description</h3>

<p>This software estimates p-values using wild cluster bootstrapped t-statistics for linear family GLM models (Cameron, Gelbach, and Miller 2008). Residuals are repeatedly re-sampled by cluster to form a pseudo-dependent variable, a model is estimated for each re-sampled data set, and inference is based on the sampling distribution of the pivotal (t) statistic. Users may choose whether to impose the null hypothesis for independent variables; the null is never imposed for the intercept or any model that includes factor variables, interactions, or polynomials (although manually specified versions of these can circumvent the restriction). Confidence intervals are only reported when the null hypothesis is <em>not</em> imposed.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cluster.wild.glm(
  mod,
  dat,
  cluster,
  ci.level = 0.95,
  impose.null = TRUE,
  boot.reps = 1000,
  report = TRUE,
  prog.bar = TRUE,
  output.replicates = FALSE,
  seed = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mod</code></td>
<td>
<p>A linear (identity link) model estimated using <code>glm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p>The data set used to estimate <code>mod</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>A formula of the clustering variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.level</code></td>
<td>
<p>What confidence level should CIs reflect? (Note: only reported when <code>impose.null == FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>impose.null</code></td>
<td>
<p>Should we impose the null Ho?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot.reps</code></td>
<td>
<p>The number of bootstrap samples to draw.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report</code></td>
<td>
<p>Should a table of results be printed to the console?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prog.bar</code></td>
<td>
<p>Show a progress bar of the bootstrap (= TRUE) or not (= FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output.replicates</code></td>
<td>
<p>Should the cluster bootstrap coefficient replicates be output (= TRUE) or not (= FALSE)? Only available when impose.null = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Random number seed for replicability (default is NULL).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>p.values</code></td>
<td>
<p>A matrix of the estimated p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>A matrix of confidence intervals (if null not imposed).</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>Code to estimate GLM clustered standard errors by Mahmood Arai: http://thetarzan.wordpress.com/2011/06/11/clustered-standard-errors-in-r/. Cluster SE degrees of freedom correction = (M/(M-1)) with M = the number of clusters.
</p>


<h3>Author(s)</h3>

<p>Justin Esarey
</p>


<h3>References</h3>

<p>Esarey, Justin, and Andrew Menger. 2017. "Practical and Effective Approaches to Dealing with Clustered Data." <em>Political Science Research and Methods</em> forthcoming: 1-35. &lt;URL:http://jee3.web.rice.edu/cluster-paper.pdf&gt;.
</p>
<p>Cameron, A. Colin, Jonah B. Gelbach, and Douglas L. Miller. 2008. "Bootstrap-Based Improvements for Inference with Clustered Errors." <em>The Review of Economics and Statistics</em> 90(3): 414-427. &lt;DOI:10.1162/rest.90.3.414&gt;.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

#########################################
# example one: predict chicken weight
#########################################

# predict chick weight using diet, do not impose the null hypothesis
# because of factor variable "Diet"
data(ChickWeight)
weight.mod &lt;- glm(formula = weight~Diet,data=ChickWeight)
cluster.wd.w.1 &lt;-cluster.wild.glm(weight.mod, dat = ChickWeight,cluster = ~Chick, boot.reps = 1000)

# impose null
dum &lt;- model.matrix(~ ChickWeight$Diet)
ChickWeight$Diet2 &lt;- as.numeric(dum[,2])
ChickWeight$Diet3 &lt;- as.numeric(dum[,3])
ChickWeight$Diet4 &lt;- as.numeric(dum[,4])

weight.mod2 &lt;- glm(formula = weight~Diet2+Diet3+Diet4,data=ChickWeight)
cluster.wd.w.2 &lt;-cluster.wild.glm(weight.mod2, dat = ChickWeight,cluster = ~Chick, boot.reps = 1000)

############################################################################
# example two: linear model of whether respondent has a university degree
#              with interaction between gender and age + country FEs
############################################################################

require(effects)
data(WVS)

WVS$degree.n &lt;- as.numeric(WVS$degree)
WVS$gender.n &lt;- as.numeric(WVS$gender)
WVS$genderXage &lt;- WVS$gender.n * WVS$age
lin.model &lt;- glm(degree.n ~ gender.n + age + genderXage + religion, data=WVS)

# compute marginal effect of male gender on probability of obtaining a university degree
# using conventional standard errors
age.vec &lt;- seq(from=18, to=90, by=1)
me.age &lt;- coefficients(lin.model)[2] + coefficients(lin.model)[4]*age.vec
plot(me.age ~ age.vec, type="l", ylim=c(-0.1, 0.1), xlab="age", 
     ylab="ME of male gender on Pr(university degree)")
se.age &lt;- sqrt( vcov(lin.model)[2,2] + vcov(lin.model)[4,4]*(age.vec)^2 +
                2*vcov(lin.model)[2,4]*age.vec)
ci.h &lt;- me.age + qt(0.975, lower.tail=T, df=lin.model$df.residual) * se.age
ci.l &lt;- me.age - qt(0.975, lower.tail=T, df=lin.model$df.residual) * se.age
lines(ci.h ~ age.vec, lty=2)
lines(ci.l ~ age.vec, lty=2)


# cluster on country, compute CIs for marginal effect of gender on degree attainment
clust.wild.result &lt;- cluster.wild.glm(lin.model, WVS, ~ country, 
                                      impose.null = F, report = T, 
                                      output.replicates=T)
replicates &lt;- clust.wild.result$replicates
me.boot &lt;- matrix(data=NA, nrow=dim(replicates)[1], ncol=length(age.vec))
for(i in 1:dim(replicates)[1]){
  me.boot[i,] &lt;- replicates[i,"gender.n"] + replicates[i,"genderXage"]*age.vec
}
ci.wild &lt;- apply(FUN=quantile, X=me.boot, MARGIN=2, probs=c(0.025, 0.975))

# a little lowess smoothing applied to compensate for discontinuities 
# arising from shifting between replicates
lines(lowess(ci.wild[1,] ~ age.vec), lty=3)
lines(lowess(ci.wild[2,] ~ age.vec), lty=3)

# finishing touches to plot
legend(lty=c(1,2,3), "topleft",
       legend=c("Model Marginal Effect", "Conventional 95% CI",
                "Wild BS 95% CI"))
                

## End(Not run)
</code></pre>


</div>