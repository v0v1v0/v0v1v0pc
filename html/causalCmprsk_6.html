<div class="container">

<table style="width: 100%;"><tr>
<td>get.weights</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fitting a logistic regression model for propensity scores and estimating weights</h2>

<h3>Description</h3>

<p>Fits a propensity scores model by logistic regression and returns both estimated propensity scores
and requested weights. The estimated propensity scores can be used
for further diagnostics, e.g. for testing a positivity assumption and covariate balance.
</p>


<h3>Usage</h3>

<pre><code class="language-R">get.weights(formula, data, A, C = NULL, wtype = "unadj", case.w = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula expression, of the form <code>response ~ predictors</code>.
The <code>response</code> is a binary treatment/exposure variable,
for which a logistic regression model (a  Propensity Scores model) will be fit using <code>glm</code>.
See the documentation of <code>glm</code> and <code>formula</code> for details. As an alternative to specifying <code>formula</code>,
arguments <code>A</code> and <code>C</code>, defined below, can be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame that includes a treatment indicator <code>A</code> and covariates <code>C</code> appearing in <code>formula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>a character specifying the name of the treatment/exposure variable.
It is assumed that <code>A</code> is a numeric binary indicator with 0/1 values, where <code>A</code>=1
is assumed a treatment group, and <code>A</code>=0 a control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>a vector of character strings with variable names (potential confounders)
in the logistic regression model for Propensity Scores, i.e. P(A=1|C=c).
The default value of <code>C</code> is NULL corresponding to <code>wtype</code>="unadj"
that will estimate treatment effects in the raw (observed) data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wtype</code></td>
<td>
<p>a character string variable indicating the type of weights that will define the target
population for which the ATE will be estimated.
The default is "unadj" - this will not adjust for possible
treatment selection bias and will not use propensity scores weighting. It can be used, for example,
in data from a randomized controlled trial (RCT) where there is no need for emulation of baseline randomization.
Other possible values are "stab.ATE", "ATE", "ATT", "ATC" and "overlap".
See Table 1 from Li, Morgan, and Zaslavsky (2018).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>case.w</code></td>
<td>
<p>a vector of case weights.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with the following fields:
</p>

<ul>
<li>
<p><code>wtype</code> a character string indicating the type of the estimated weights
</p>
</li>
<li>
<p><code>ps</code> a vector of estimated propensity scores P(A=a|C=c)
</p>
</li>
<li>
<p><code>w</code> a vector of estimated weights
</p>
</li>
<li>
<p><code>summary.glm</code> a summary of the logistic regression fit which is done
using <code>stats::glm</code></p>
</li>
</ul>
<p> function
</p>


<h3>References</h3>

<p>F. Li, K.L. Morgan, and A.M. Zaslavsky. 2018. Balancing Covariates via Propensity Score Weighting. Journal of the American Statistical Association 113 (521): 390–400.
</p>
<p>M.A. Hernán, B. Brumback, and J.M. Robins. 2000. Marginal structural models and to estimate the causal effect of zidovudine on the survival of HIV-positive men. Epidemiology, 11 (5): 561-570.
</p>


<h3>See Also</h3>

<p><code>fit.nonpar</code>, <code>fit.cox</code>, <code>causalCmprsk</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;- runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)
form.txt &lt;- paste0("TRT", " ~ ", paste0(c("c1", "c2"), collapse = "+"))
trt.formula &lt;- as.formula(form.txt)
wei &lt;- get.weights(formula=trt.formula, data=data, wtype = "overlap")
hist(wei$ps[data$TRT==1], col="red", breaks = seq(0,1,0.05))
par(new=TRUE)
hist(wei$ps[data$TRT==0], col="blue", breaks = seq(0,1,0.05))

# please see our package vignette for practical examples

</code></pre>


</div>