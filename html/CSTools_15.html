<div class="container">

<table style="width: 100%;"><tr>
<td>CST_Analogs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Downscaling using Analogs based on large scale fields.</h2>

<h3>Description</h3>

<p>This function perform a downscaling using Analogs. To compute 
the analogs, the function search for days with similar large scale conditions
to downscaled fields to a local scale. The large scale and the local scale 
regions are defined by the user. The large scale is usually given by 
atmospheric circulation as sea level pressure or geopotential height 
(Yiou et al, 2013) but the function gives the possibility to use another 
field. The local scale will be usually given by precipitation or temperature 
fields, but might be another variable.The analogs function will find the best
analogs based in Minimum Euclidean distance in the large scale pattern
(i.e.SLP).
</p>
<p>The search of analogs must be done in the longest dataset posible. This is 
important since it is necessary to have a good representation of the 
possible states of the field in the past, and therefore, to get better 
analogs. 
This function has not constrains of specific regions, variables to downscale,
or data to be used (seasonal forecast data, climate projections data, 
reanalyses data). The regrid into a finner scale is done interpolating with 
CST_Start. Then, this interpolation is corrected selecting the analogs in the 
large and local scale in based of the observations. The function is an 
adapted version of the method of Yiou et al 2013. For an advanced search of 
Analogs (multiple Analogs, different criterias, further information from the
metrics and date of the selected Analogs) use the'Analog'
function within 'CSTools' package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CST_Analogs(
  expL,
  obsL,
  expVar = NULL,
  obsVar = NULL,
  sdate_dim = "sdate",
  region = NULL,
  criteria = "Large_dist",
  excludeTime = NULL,
  time_expL = NULL,
  time_obsL = NULL,
  nAnalogs = NULL,
  AnalogsInfo = FALSE,
  ncores = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>expL</code></td>
<td>
<p>An 's2dv_cube' object containing the experimental field on the 
large scale for which the analog is aimed. This field is used to in all the
criterias. If parameter 'expVar' is not provided, the function will return 
the expL analog. The element 'data' in the 's2dv_cube' object must have, at
least, latitudinal and longitudinal dimensions. The object is expect to be 
already subset for the desired large scale region. Latitudinal dimension 
accepted names: 'lat', 'lats', 'latitude', 'y', 'j', 'nav_lat'. Longitudinal 
dimension accepted names: 'lon', 'lons','longitude', 'x', 'i', 'nav_lon'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsL</code></td>
<td>
<p>An 's2dv_cube' object containing the observational field on the
large scale. The element 'data' in the 's2dv_cube' object must have the same 
latitudinal and longitudinal dimensions as parameter 'expL' and a temporal 
dimension with the maximum number of available observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expVar</code></td>
<td>
<p>An 's2dv_cube' object containing the experimental field on the
local scale, usually a different variable to the parameter 'expL'. If it is 
not NULL (by default, NULL), the returned field by this function will be the 
analog of parameter 'expVar'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsVar</code></td>
<td>
<p>An 's2dv_cube' containing the field of the same variable as the 
passed in parameter 'expVar' for the same region.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdate_dim</code></td>
<td>
<p>A character string indicating the name of the start date 
dimension. By default, it is set to 'sdate'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>region</code></td>
<td>
<p>A vector of length four indicating the minimum longitude, 
the maximum longitude, the minimum latitude and the maximum latitude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criteria</code></td>
<td>
<p>A character string indicating the criteria to be used for the
selection of analogs:
</p>

<ul>
<li>
<p>Large_dist minimum Euclidean distance in the large scale pattern; 
</p>
</li>
<li>
<p>Local_dist minimum Euclidean distance in the large scale pattern 
and minimum Euclidean distance in the local scale pattern; and
</p>
</li>
<li>
<p>Local_cor minimum Euclidean distance in the large scale pattern, 
minimum Euclidean distance in the local scale pattern and highest 
correlation in the local variable to downscale.</p>
</li>
</ul>
<p>Criteria 'Large_dist' is recommended for CST_Analogs, for an advanced use of 
the criterias 'Local_dist' and 'Local_cor' use 'Analogs' function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excludeTime</code></td>
<td>
<p>An array of N named dimensions (coinciding with time 
dimensions in expL)of character string(s) indicating the date(s) of the 
observations in the format "dd/mm/yyyy" to be excluded during the search of 
analogs. It can be NULL but if expL is not a forecast (time_expL contained in
time_obsL), by default time_expL will be removed during the search of analogs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_expL</code></td>
<td>
<p>A character string indicating the date of the experiment 
in the same format than time_obsL (i.e. "yyyy-mm-dd"). By default it is NULL 
and dates are taken from element <code>$attrs$Dates</code> from expL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_obsL</code></td>
<td>
<p>A character string indicating the date of the observations 
in the date format (i.e. "yyyy-mm-dd"). By default it is NULL and dates are 
taken from element <code>$attrs$Dates</code> from obsL. It must have time 
dimensions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nAnalogs</code></td>
<td>
<p>Number of Analogs to be selected to apply the criterias 
'Local_dist' or 'Local_cor'. This is not the necessary the number of analogs 
that the user can get, but the number of events with minimum distance in 
which perform the search of the best Analog. The default value for the 
'Large_dist' criteria is 1, for 'Local_dist' and 'Local_cor' criterias must
be greater than 1 in order to match with the first criteria, if nAnalogs is
NULL for 'Local_dist' and 'Local_cor' the default value will be set at the 
length of 'time_obsL'. If AnalogsInfo is FALSE the function returns just 
the best analog.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AnalogsInfo</code></td>
<td>
<p>A logical value. TRUE to get a list with two elements: 
1) the downscaled field and 2) the AnalogsInfo which contains: 
a) the number of the best analogs, b) the corresponding value of the metric 
used in the selected criteria (distance values for Large_dist and Local_dist, 
correlation values for Local_cor), c)dates of the analogs). The analogs are 
listed in decreasing order, the first one is the best analog (i.e if the 
selected criteria is Local_cor the best analog will be the one with highest 
correlation, while for Large_dist criteria the best analog will be the day 
with minimum Euclidean distance). Set to FALSE to get a single analog, the 
best analog, for instance for downscaling.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>The number of cores to use in parallel computation</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An 's2dv_cube' object containing an array with the dowscaled values of 
the best analogs in element 'data'. If 'AnalogsInfo' is TRUE, 'data' is a list 
with an array of the downscaled fields and the analogs information in 
elements 'analogs', 'metric' and 'dates'.
</p>


<h3>Author(s)</h3>

<p>M. Carmen Alvarez-Castro, <a href="mailto:carmen.alvarez-castro@cmcc.it">carmen.alvarez-castro@cmcc.it</a>
</p>
<p>Maria M. Chaves-Montero, <a href="mailto:mariadm.chaves@cmcc.it">mariadm.chaves@cmcc.it</a>
</p>
<p>Veronica Torralba, <a href="mailto:veronica.torralba@cmcc.it">veronica.torralba@cmcc.it</a>
</p>
<p>Nuria Perez-Zanon <a href="mailto:nuria.perez@bsc.es">nuria.perez@bsc.es</a>
</p>


<h3>References</h3>

<p>Yiou, P., T. Salameh, P. Drobinski, L. Menut, R. Vautard,
and M. Vrac, 2013 : Ensemble reconstruction of the atmospheric column 
from surface pressure using analogues.  Clim. Dyn., 41, 1419-1437. 
<a href="mailto:pascal.yiou@lsce.ipsl.fr">pascal.yiou@lsce.ipsl.fr</a>
</p>


<h3>See Also</h3>

<p><code>CST_Start</code>, <code>Start</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">expL &lt;- rnorm(1:200)
dim(expL) &lt;- c(member = 10, lat = 4, lon = 5)
obsL &lt;- c(rnorm(1:180), expL[1, , ]*1.2)
dim(obsL) &lt;- c(time = 10, lat = 4, lon = 5)
time_obsL &lt;- as.POSIXct(paste(rep("01", 10), rep("01", 10), 1994:2003, sep = "-"), 
                       format = "%d-%m-%y")
dim(time_obsL) &lt;- c(time = 10)
time_expL &lt;- time_obsL[1]
dim(time_expL) &lt;- c(time = 1)
lon &lt;-  seq(-1, 5, 1.5)
lat &lt;- seq(30, 35, 1.5)
coords &lt;- list(lon = seq(-1, 5, 1.5), lat = seq(30, 35, 1.5))
attrs_expL &lt;- list(Dates = time_expL)
attrs_obsL &lt;- list(Dates = time_obsL)
expL &lt;- list(data = expL, coords = coords, attrs = attrs_expL)
obsL &lt;- list(data = obsL, coords = coords, attrs = attrs_obsL)
class(expL) &lt;- 's2dv_cube'
class(obsL) &lt;- 's2dv_cube'
region &lt;- c(min(lon), max(lon), min(lat), max(lat))
downscaled_field &lt;- CST_Analogs(expL = expL, obsL = obsL, region = region)

</code></pre>


</div>