<div class="container">

<table style="width: 100%;"><tr>
<td>treemapClinData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Treemap interactive plot.</h2>

<h3>Description</h3>

<p>Note: the table and plot are not (yet) linked.
</p>


<h3>Usage</h3>

<pre><code class="language-R">treemapClinData(...)
</code></pre>


<h3>Arguments</h3>

<table><tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Arguments passed on to <code>plotCountClinData</code>
</p>

<dl>
<dt><code>colorVar</code></dt>
<dd>
<p>(optional) String with coloring variable
(NULL by default).
By default, the treemap is colored based by section.</p>
</dd>
<dt><code>colorRange</code></dt>
<dd>
<p>(optional) Numeric vector of length 2 with range 
for the color variable, in case it is a numeric variable.</p>
</dd>
<dt><code>vars</code></dt>
<dd>
<p>Character vector with variables of <code>data</code>
containing the groups. If multiple, they should be specified in 
hierarchical order (from parent to child node).</p>
</dd>
<dt><code>varsLab</code></dt>
<dd>
<p>Named character vector with labels for <code>vars</code>.</p>
</dd>
<dt><code>valueVar</code></dt>
<dd>
<p>String with numeric variable of <code>data</code> 
containing the value to display.</p>
</dd>
<dt><code>valueLab</code></dt>
<dd>
<p>String with label for the <code>valueVar</code> variable.</p>
</dd>
<dt><code>valueType</code></dt>
<dd>
<p>String with type of values in <code>valueVar</code>
(<code>branchvalues</code> of the <code>plot_ly</code>) function),
among others: 'total' (default, only if sum(child) &lt;= to parent)
or 'relative'.</p>
</dd>
<dt><code>pathVar</code></dt>
<dd>
<p>String with variable of <code>data</code> containing hyperlinks 
with path to the subject-specific report, formatted as: <br></p>
<pre>&lt;a href="./path-to-report"&gt;label&lt;/a&gt;</pre>
<p>.<br> 
If multiple, they should be separated by: ', '.<br>
The report(s) will be:
</p>

<ul>
<li>
<p> compressed to a zip file and downloaded 
if the user clicks on the 'p' (a.k.a 'profile') key
when hovering on a point of the plot
</p>
</li>
<li>
<p> included in a collapsible row, and clickable with hyperlinks
in the table
</p>
</li>
</ul>
</dd>
<dt><code>pathLab</code></dt>
<dd>
<p>String with label for <code>pathVar</code>,
included in the collapsible row in the table.</p>
</dd>
<dt><code>table</code></dt>
<dd>
<p>Logical, if TRUE (FALSE by default)
returns also a <code>datatable</code> containing the plot data.
(The plot and the table are not linked.)</p>
</dd>
<dt><code>data</code></dt>
<dd>
<p>Data.frame with data.</p>
</dd>
<dt><code>verbose</code></dt>
<dd>
<p>Logical, if TRUE (FALSE by default) progress messages are printed
in the current console.
For the visualizations, progress messages during download
of subject-specific report are displayed in the browser console.</p>
</dd>
<dt><code>width</code></dt>
<dd>
<p>Numeric, width of the plot in pixels,
800 by default.</p>
</dd>
<dt><code>height</code></dt>
<dd>
<p>Numeric, height of the plot in pixels,
500 by default.</p>
</dd>
<dt><code>hoverVars</code></dt>
<dd>
<p>Character vector with variable(s) to be displayed in the hover,
by default any position (and axis) and aesthetic variables displayed in the plot.</p>
</dd>
<dt><code>hoverLab</code></dt>
<dd>
<p>Named character vector with labels for <code>hoverVars</code>.</p>
</dd>
<dt><code>labelVars</code></dt>
<dd>
<p>Named character vector containing variable labels.</p>
</dd>
<dt><code>id</code></dt>
<dd>
<p>String with general id for the plot:
</p>

<ul>
<li>
<p> 'id' is used as <code>group</code> for the <code>SharedData</code>
</p>
</li>
<li>
<p> 'button:[id]' is used as button ID if <code>table</code> is TRUE
</p>
</li>
</ul>
<p>If not specified, a random id, as 'plotClinData[X]' is used.</p>
</dd>
<dt><code>title</code></dt>
<dd>
<p>String with title for the plot.</p>
</dd>
<dt><code>titleExtra</code></dt>
<dd>
<p>String with extra title for the plot (appended after <code>title</code>).</p>
</dd>
<dt><code>caption</code></dt>
<dd>
<p>String with caption. <br>
The caption is included at the bottom right of the plot.
Please note that this might overlap with 
vertical or rotated x-axis labels.</p>
</dd>
<dt><code>subtitle</code></dt>
<dd>
<p>String with subtitle.<br>
The subtitle is included at the top left of the plot,
below the title.</p>
</dd>
<dt><code>colorLab</code></dt>
<dd>
<p>String with label for <code>colorVar</code>.</p>
</dd>
<dt><code>colorPalette</code></dt>
<dd>
<p>(optional) Named character vector with color palette.
If not specified, the viridis color palette is used.<br>
See <code>clinColors</code>.</p>
</dd>
<dt><code>watermark</code></dt>
<dd>
<p>(optional) String with path to a file containing a watermark.</p>
</dd>
<dt><code>tableButton</code></dt>
<dd>
<p>Logical, if TRUE (by default)
the table is included within an HTML button.</p>
</dd>
<dt><code>tableVars</code></dt>
<dd>
<p>Character vector with variables to be included 
in the table.</p>
</dd>
<dt><code>tableLab</code></dt>
<dd>
<p>Named character vector with labels
for each <code>tableVars</code>.</p>
</dd>
<dt><code>tablePars</code></dt>
<dd>
<p>List with parameters passed to the
<code>getClinDT</code> function.</p>
</dd>
</dl>
</td>
</tr></table>
<h3>Value</h3>

<p>Either:
</p>

<ul>
<li>
<p> if a <code>table</code> is requested: a <code>clinDataReview</code> object, 
a.k.a a list with the 'plot' (<code>plotly</code> object) and 'table'
(<code>datatable</code> object)
</p>
</li>
<li>
<p> otherwise: a <code>plotly</code> object
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Laure Cougnaud
</p>


<h3>See Also</h3>

<p>Other visualizations of summary statistics for clinical data: 
<code>barplotClinData()</code>,
<code>boxplotClinData()</code>,
<code>errorbarClinData()</code>,
<code>plotCountClinData()</code>,
<code>sunburstClinData()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(clinUtils)

data(dataADaMCDISCP01)
labelVars &lt;- attr(dataADaMCDISCP01, "labelVars")

dataDM &lt;- dataADaMCDISCP01$ADSL
dataAE &lt;- dataADaMCDISCP01$ADAE

library(plyr)

## basic treemap:

# treemap takes as input table with counts
if (requireNamespace("inTextSummaryTable", quietly = TRUE)) {

# total counts: Safety Analysis Set (patients with start date for the first treatment)
dataTotal &lt;- subset(dataDM, RFSTDTC != "")

# compute adverse event table
tableAE &lt;- inTextSummaryTable::getSummaryStatisticsTable(
		
	data = dataAE,
	rowVar = c("AESOC", "AEDECOD"),
	dataTotal = dataTotal,
	rowOrder = "total",
	labelVars = labelVars,
	stats = inTextSummaryTable::getStats("count"),
	
	# plotly treemap requires records (rows) for each group
	rowVarTotalInclude = "AEDECOD",
	outputType = "data.frame-base"

)

dataPlot &lt;- tableAE

dataPlot$n &lt;- as.numeric(dataPlot$n)

# create plot
treemapClinData(
	data = dataPlot,
	vars = c("AESOC", "AEDECOD"),
	valueVar = "n",
    valueLab = "Number of patients with adverse events"
)

## treemap with coloring

# extract worst-case scenario
dataAE$AESEVN &lt;- as.numeric(factor(dataAE$AESEV, levels = c("MILD", "MODERATE", "SEVERE")))
if(any(is.na(dataAE$AESEVN)))
	stop("Severity should be filled for all subjects.")

dataAEWC &lt;- ddply(dataAE, c("AESOC", "AEDECOD", "USUBJID"), function(x){
	x[which.max(x$AESEVN), ]
})
dataTotalRow &lt;- list(AEDECOD = 
	ddply(dataAEWC, c("AESOC", "USUBJID"), function(x){
		x[which.max(x$AESEVN), ]
	})
)


# compute adverse event table
tableAE &lt;- inTextSummaryTable::getSummaryStatisticsTable(
		
	data = dataAEWC,
	rowVar = c("AESOC", "AEDECOD"),
	var = "AESEVN",
	dataTotal = dataTotal,
	rowOrder = "total",
	labelVars = labelVars,
		
	# plotly treemap requires records (rows) for each group
	rowVarTotalInclude = "AEDECOD",
	dataTotalRow = dataTotalRow,
	outputType = "data.frame-base"

)

dataPlot &lt;- tableAE

dataPlot$statN &lt;- as.numeric(dataPlot$statN)
dataPlot$statMean &lt;- as.numeric(dataPlot$statMean)

# create plot
treemapClinData(
	data = dataPlot,
	vars = c("AESOC", "AEDECOD"),
	valueVar = "statN", valueLab = "Number of patients with adverse events",
	colorVar = "statMean", colorLab = "Mean severity"
)

}
</code></pre>


</div>