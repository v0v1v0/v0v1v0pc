<div class="container">

<table style="width: 100%;"><tr>
<td>s_attribute_encode</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Read, process and write data on structural attributes.</h2>

<h3>Description</h3>

<p>Read, process and write data on structural attributes.
</p>


<h3>Usage</h3>

<pre><code class="language-R">s_attribute_encode(
  values,
  data_dir,
  s_attribute,
  corpus,
  region_matrix,
  method = c("R", "CWB"),
  registry_dir = Sys.getenv("CORPUS_REGISTRY"),
  encoding,
  delete = FALSE,
  verbose = TRUE
)

s_attribute_recode(
  data_dir,
  s_attribute,
  from = c("UTF-8", "latin1"),
  to = c("UTF-8", "latin1")
)

s_attribute_files(s_attribute, data_dir)

s_attribute_get_values(s_attribute, data_dir)

s_attribute_get_regions(s_attribute, data_dir)

s_attribute_merge(x, y)

s_attribute_delete(corpus, s_attribute)

s_attribute_rename(corpus, old, new, registry_dir, verbose = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>values</code></td>
<td>
<p>A <code>character</code> vector with the values of the structural
attribute.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_dir</code></td>
<td>
<p>The data directory where to write the files.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s_attribute</code></td>
<td>
<p>Name of the structural attribute, an atomic <code>character</code>
vector containing only lowercase ASCII characters (a-z), digits (0-9), -,
and _: No non-ASCII or uppercase letters allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corpus</code></td>
<td>
<p>A CWB corpus.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>region_matrix</code></td>
<td>
<p>A two-column <code>matrix</code> with corpus positions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Either 'R' or 'CWB'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>registry_dir</code></td>
<td>
<p>Path name of the registry directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>encoding</code></td>
<td>
<p>Encoding of the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delete</code></td>
<td>
<p>Logical, whether to call <code>RcppCWB::cl_delete_corpus()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>Character string describing the current encoding of the attribute.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>Character string describing the target encoding of the attribute.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Data defining a first s-attribute, a <code>data.table</code> (or an object
coercible to a <code>data.table</code>) with three columns ("cpos_left",
"cpos_right", "value").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Data defining a second s-attribute, a <code>data.table</code> (or an
object coercible to a <code>data.table</code>) with three columns ("cpos_left",
"cpos_right", "value").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>old</code></td>
<td>
<p>A <code>character</code> vector with s-attributes to be renamed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new</code></td>
<td>
<p>A <code>character</code> vector with new names of s-attributes. The vector
needs to have the same length as vector <code>old</code>. The 1st, 2nd, 3rd ... nth
attribute stated in vector <code>old</code> will get the new names at the 1st, 2nd,
3rd, ... nth position of vector <code>new</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>s_attribute_encode()</code> implements a 'pure R' implementation to add
or modify structural attributes of an existing CWB corpus.
</p>
<p>If the corpus has been loaded/used before, a new s-attribute may not be
available unless <code>RcppCWB::cl_delete_corpus()</code> has been called. Use the
argument <code>delete</code> for calling this function.
</p>
<p><code>s_attribute_recode</code> will recode the values in the avs-file and change
the attribute value index in the avx file. The rng-file remains unchanged. The registry
file remains unchanged, and it is highly recommended to consider <code>s_attribute_recode</code>
as a helper for <code>corpus_recode</code> that will recode all s-attributes, all p-attributes,
and will reset the encoding in the registry file.
</p>
<p><code>s_attribute_files()</code> will return a named character vector with
the data files (extensions: "avs", "avx", "rng") in the directory indicated
by <code>data_dir</code> for the structural attribute <code>s_attribute</code>.
</p>
<p><code>s_attribute_get_values()</code> is equivalent to performing the CL
function cl_struc2id for all strucs of a structural attribute. It is a
"pure R" operation that is faster than using CL, as it processes entire
files for the s-attribute directly. The return value is a <code>character</code>
vector with all string values for the s-attribute.
</p>
<p><code>s_attribute_get_regions</code> will return a two-column integer
matrix with regions for the strucs of a given s-attribute. Left corpus
positions are in the first column, right corpus positions in the second
column. The result is equivalent to calling RcppCWB::get_region_matrix for
all strucs of a s-attribute, but may be somewhat faster. It is a "pure R"
function which is fast as it processes files entirely and directly.
</p>
<p><code>s_attribute_merge()</code> combines two tables with regions for
s-attributes checking for intersections that may cause problems. The
heuristic is to keep all non-intersecting annotations and those annotations
that define the same region in object <code>x</code> and object <code>y</code>.
Annotations of <code>x</code> and <code>y</code> which overlap uncleanly, i.e. without
an identity of the left and the right corpus position ("cpos_left" /
"cpos_right") are dropped. The scenario for using the function is to decode
a s-attribute (using <code>s_attribute_decode()</code>), mix in an additional
annotation, and to re-encode the enhanced s-attribute (using
<code>s_attribute_encode()</code>).
</p>
<p>Function <code>s_attribute_delete()</code> is not yet implemented.
</p>
<p>Function <code>s_attribute_rename()</code> can be used to rename a structural
attribute.
</p>


<h3>See Also</h3>

<p>To decode a structural attribute, see
<code>s_attribute_decode</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">require("RcppCWB")
registry_tmp &lt;- fs::path(tempdir(), "cwb", "registry")
data_dir_tmp &lt;- fs::path(tempdir(), "cwb", "indexed_corpora", "reuters")

cwb_dir_rcppcwb &lt;- system.file(package = "RcppCWB", "extdata", "cwb")
registry_dir_rcppcwb &lt;- fs::path(cwb_dir_rcppcwb, "registry")
data_dir_rcppcwb &lt;- fs::path(cwb_dir_rcppcwb,"indexed_corpora", "reuters")

corpus_copy(
  corpus = "REUTERS",
  registry_dir = registry_dir_rcppcwb,
  data_dir = data_dir_rcppcwb,
  registry_dir_new = registry_tmp,
  data_dir_new = data_dir_tmp
)

no_strucs &lt;- cl_attribute_size(
  corpus = "REUTERS",
  attribute = "id",
  attribute_type = "s",
  registry = registry_tmp
)

cpos_matrix &lt;- get_region_matrix(
      corpus = "REUTERS",
      struc = 0L:(no_strucs - 1L),
      s_attribute = "id",
      registry = registry_tmp
)

s_attribute_encode(
  values = 1L:nrow(cpos_matrix),
  data_dir = data_dir_tmp,
  s_attribute = "article_id",
  corpus = "REUTERS",
  region_matrix = cpos_matrix,
  method = "R",
  registry_dir = registry_tmp,
  encoding = "latin1",
  verbose = TRUE,
  delete = TRUE
)

cl_struc2str(
  "REUTERS",
  struc = 0L:(nrow(cpos_matrix) - 1L),
  s_attribute = "article_id",
  registry = registry_tmp
)

unlink(registry_tmp, recursive = TRUE)
unlink(data_dir_tmp, recursive = TRUE)
data_dir &lt;- system.file(
  package = "RcppCWB",
  "extdata",
  "cwb",
  "indexed_corpora",
  "reuters"
)
avs &lt;- s_attribute_get_values(s_attribute = "id", data_dir = data_dir)
rng &lt;- s_attribute_get_regions(
  s_attribute = "id",
  data_dir = system.file(package = "RcppCWB", "extdata", "cwb", "indexed_corpora", "reuters")
)
x &lt;- data.frame(
  cpos_left =  c(1L, 5L, 10L, 20L, 25L),
  cpos_right = c(2L, 5L, 12L, 21L, 27L),
  value = c("ORG", "LOC", "ORG", "PERS", "ORG"),
  stringsAsFactors = FALSE
)
y &lt;- data.frame(
  cpos_left =  c(5, 11, 20, 25L, 30L),
  cpos_right = c(5, 12, 22, 27L, 33L),
  value = c("LOC", "ORG", "ORG", "ORG", "ORG"),
  stringsAsFactors = FALSE
)
s_attribute_merge(x,y)
</code></pre>


</div>