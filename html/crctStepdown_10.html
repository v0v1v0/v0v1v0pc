<div class="container">

<table style="width: 100%;"><tr>
<td>stepdown</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Conduct the randomisation-based stepdown procedure</h2>

<h3>Description</h3>

<p>For a set of models fit with lme4, base R, or glmmrBase, the function will conduct the randomisation tests
and generate p-values for the null hypotheses of no treatment effect that controls the
family-wise error rate, and generates a 100(1-alpha)% confidence set for the
treatment effect model parameters.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stepdown(
  fitlist,
  tr_var = "treat",
  cl_var = "cl",
  data,
  alpha = 0.05,
  plots = TRUE,
  n_permute = 1000,
  nsteps = 1000,
  type = "rw",
  rand_func = NULL,
  confint = TRUE,
  sigma = NULL,
  ci_start_values = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fitlist</code></td>
<td>
<p>A list of models fitted with lme4, base R (lm or glm), or glmmrBase. All models should be fit using the
same data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tr_var</code></td>
<td>
<p>String indicating the name of the column in data that is a binary indicator
for whether the observation was under the treatment (1=treatment, 0=control)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl_var</code></td>
<td>
<p>String specifying the name of the column identifying the clusters/cluster-time</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing the data used to fit the models in fitlist</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Numeric. 100(1-alpha)% confidence intervals are calculated. Default it 0.05</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plots</code></td>
<td>
<p>Logical indicating whether to plot permutational distributions and confidence
interval search during running of function. Default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_permute</code></td>
<td>
<p>Number of permutations of the randomisation test to run</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsteps</code></td>
<td>
<p>Number of steps of the confidence interval search process</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Method of correction: options are "rw" = Romano-Wolf randomisation test based stepdown, "h"
= Holm standard stepdown, "h" = Holm stepdown using randomisation test, "b" = standard Bonferroni, "br" =
Bonerroni using randomisation test, or "none" = randomisation test with no correction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rand_func</code></td>
<td>
<p>String of the name of a function that re-randomises the clusters. The function
must take the arguments <code>nJ</code> for the number of clusters and <code>nT</code> for the number of time periods.
The function should produce a data frame that identifies the clusters in the treatment group under the new
randomisation scheme. The data frame can either have a single column with name cl_var or
two columns of cl_var and t identifying the cluster ID and time period a cluster joins
the treatment group. If NULL then clusters are randomised in a 1:1 ratio to treatment and control</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confint</code></td>
<td>
<p>Logical indicating whether to run the confidence interval search process</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>optional, list of estimated covariance matrices of the observations from the models in fitlist.
If provided then the weighted q-score statistic is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_start_values</code></td>
<td>
<p>Optional list. The list should contain named vectors "upper" and/or "lower" that provide
a set of starting values for the upper and/or lower confidence interval searches, respectively. Alternatively,
a named scalar <code>scale</code> can be provided such that the starting values of the confidence interval search procedure
are est +/- <code>scale</code>*SE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical indicating whether to provide detailed output</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data frame with the point estimates, p-values, and confidence intervals
</p>


<h3>Examples</h3>

<pre><code class="language-R">
out &lt;- twoarm_sim()
data &lt;- out[[1]]
  fit1 &lt;- lme4::glmer(y1 ~ treat + (1|cl) ,
data=data,
family="poisson")

fit2 &lt;- lme4::glmer(y2 ~ treat + (1|cl),
                    data=data,
                    family="poisson")
 stepdown(fitlist=list(fit1,fit2),
          data=data,
          n_permute = 100,
          nsteps=100,
          plots=FALSE,
          verbose=TRUE)
</code></pre>


</div>