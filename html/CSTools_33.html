<div class="container">

<table style="width: 100%;"><tr>
<td>CST_RainFARM</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>RainFARM stochastic precipitation downscaling of a CSTools object</h2>

<h3>Description</h3>

<p>This function implements the RainFARM stochastic precipitation
downscaling method and accepts a CSTools object (an object of the class 
's2dv_cube' as provided by 'CST_Load') as input.
Adapted for climate downscaling and including orographic correction
as described in Terzago et al. 2018.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CST_RainFARM(
  data,
  weights = 1,
  slope = 0,
  nf,
  kmin = 1,
  nens = 1,
  fglob = FALSE,
  fsmooth = TRUE,
  nprocs = 1,
  time_dim = NULL,
  verbose = FALSE,
  drop_realization_dim = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An object of the class 's2dv_cube' as returned by 'CST_Load', 
containing the spatial precipitation fields to downscale.
The data object is expected to have an element named <code>$data</code> with at 
least two spatial dimensions named "lon" and "lat" and one or more 
dimensions over which to compute average spectral slopes (unless specified 
with parameter <code>slope</code>), which can be specified by parameter 
<code>time_dim</code>. The number of longitudes and latitudes in the input data is 
expected to be even and the same. If not the function will perform a 
subsetting to ensure this condition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Matrix with climatological weights which can be obtained using
the <code>CST_RFWeights</code> function. If <code>weights = 1.</code> (default) no  
weights are used. The names of these dimensions must be at least 'lon' and 
'lat'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slope</code></td>
<td>
<p>Prescribed spectral slope. The default is <code>slope = 0.</code>
meaning that the slope is determined automatically over the dimensions 
specified by <code>time_dim</code>. A 1D array with named dimension can be 
provided (see details and examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nf</code></td>
<td>
<p>Refinement factor for downscaling (the output resolution is 
increased by this factor).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kmin</code></td>
<td>
<p>First wavenumber for spectral slope (default: <code>kmin = 1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nens</code></td>
<td>
<p>Number of ensemble members to produce (default: <code>nens = 1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fglob</code></td>
<td>
<p>Logical to conserve global precipitation over the domain 
(default: FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fsmooth</code></td>
<td>
<p>Logical to conserve precipitation with a smoothing kernel 
(default: TRUE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nprocs</code></td>
<td>
<p>The number of parallel processes to spawn for the use for 
parallel computation in multiple cores. (default: 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_dim</code></td>
<td>
<p>String or character array with name(s) of dimension(s)
(e.g. "ftime", "sdate", "member" ...) over which to compute spectral slopes.
If a character array of dimension names is provided, the spectral slopes
will be computed as an average over all elements belonging to those 
dimensions. If omitted one of c("ftime", "sdate", "time") is searched and 
the first one with more than one element is chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical for verbose output (default: FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drop_realization_dim</code></td>
<td>
<p>Logical to remove the "realization" stochastic 
ensemble dimension, needed for saving data through function CST_SaveData 
(default: FALSE) with the following behaviour if set to TRUE:
</p>

<ol>
<li>
<p>if <code>nens == 1</code>: the dimension is dropped;
</p>
</li>
<li>
<p>if <code>nens &gt; 1</code> and a "member" dimension exists: the "realization" 
and "member" dimensions are compacted (multiplied) and the resulting 
dimension is named "member";
</p>
</li>
<li>
<p>if <code>nens &gt; 1</code> and a "member" dimension does not exist: the 
"realization" dimension is renamed to "member".
</p>
</li>
</ol>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Wether parameter 'slope' and 'weights' presents seasonality 
dependency, a dimension name should match between these parameters and the 
input data in parameter 'data'. See example 2 below where weights and slope 
vary with 'sdate' dimension.
</p>


<h3>Value</h3>

<p>CST_RainFARM() returns a downscaled CSTools object (i.e., of the 
class 's2dv_cube'). If <code>nens &gt; 1</code> an additional dimension named 
"realization" is added to the <code>$data</code> array after the "member" dimension 
(unless <code>drop_realization_dim = TRUE</code> is specified). The ordering of the 
remaining dimensions in the <code>$data</code> element of the input object is 
maintained.
</p>


<h3>Author(s)</h3>

<p>Jost von Hardenberg - ISAC-CNR, <a href="mailto:j.vonhardenberg@isac.cnr.it">j.vonhardenberg@isac.cnr.it</a>
</p>


<h3>References</h3>

<p>Terzago, S. et al. (2018). NHESS 18(11), 2825-2840.
doi: <a href="https://doi.org/10.5194/nhess-18-2825-2018">10.5194/nhess-18-2825-2018</a>;
D'Onofrio et al. (2014), J of Hydrometeorology 15, 830-843; Rebora et. al. 
(2006), JHM 7, 724.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example 1: using CST_RainFARM for a CSTools object
nf &lt;- 8   # Choose a downscaling by factor 8
exp &lt;- 1 : (2 * 3 * 4 * 8 * 8)
dim(exp) &lt;- c(dataset = 1, member = 2, sdate = 3, ftime = 4, lat = 8, lon = 8)
lon &lt;- seq(10, 13.5, 0.5)
lat &lt;- seq(40, 43.5, 0.5)
coords &lt;- list(lon = lon, lat = lat)
data &lt;- list(data = exp, coords = coords)
class(data) &lt;- 's2dv_cube'
# Create a test array of weights
ww &lt;- array(1., dim = c(lon = 8 * nf, lat = 8 * nf))
res &lt;- CST_RainFARM(data, nf = nf, weights = ww, nens = 3, time_dim = 'ftime')
</code></pre>


</div>