<div class="container">

<table style="width: 100%;"><tr>
<td>bgnbd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>BG/NBD models</h2>

<h3>Description</h3>

<p>Fits BG/NBD models on transactional data without and with static covariates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S4 method for signature 'clv.data'
bgnbd(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  ...
)

## S4 method for signature 'clv.data.static.covariates'
bgnbd(
  clv.data,
  start.params.model = c(),
  optimx.args = list(),
  verbose = TRUE,
  names.cov.life = c(),
  names.cov.trans = c(),
  start.params.life = c(),
  start.params.trans = c(),
  names.cov.constr = c(),
  start.params.constr = c(),
  reg.lambdas = c(),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>clv.data</code></td>
<td>
<p>The data object on which the model is fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.params.model</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the model without covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optimx.args</code></td>
<td>
<p>Additional arguments to control the optimization which are forwarded to <code>optimx::optimx</code>.
If multiple optimization methods are specified, only the result of the last method is further processed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Show details about the running of the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.cov.life</code></td>
<td>
<p>Which of the set Lifetime covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.cov.trans</code></td>
<td>
<p>Which of the set Transaction covariates should be used. Missing parameter indicates all covariates shall be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.params.life</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all lifetime covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.params.trans</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for all transaction covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>names.cov.constr</code></td>
<td>
<p>Which covariates should be forced to use the same parameters for the lifetime and transaction process. The covariates need to be present as both, lifetime and transaction covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.params.constr</code></td>
<td>
<p>Named start parameters containing the optimization start parameters for the constraint covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reg.lambdas</code></td>
<td>
<p>Named lambda parameters used for the L2 regularization of the lifetime and the transaction covariate parameters. Lambdas have to be &gt;= 0.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Model parameters for the BG/NBD model are <code>r, alpha, a, and b</code>. <br><code>r</code>: shape parameter of the Gamma distribution of the purchase process. <br><code>alpha</code>: scale parameter of the Gamma distribution of the purchase process. <br><code>a</code>: shape parameter of the Beta distribution of the dropout process.<br><code>b</code>: shape parameter of the Beta distribution of the dropout process.
</p>
<p>If no start parameters are given, r = 1, alpha = 3, a = 1, b = 3 is used.
All model start parameters are required to be &gt; 0. If no start values are given for the
covariate parameters, 0.1 is used.
</p>
<p>Note that the DERT expression has not been derived (yet) and it consequently is not possible to calculated
values for DERT and CLV.
</p>


<h4>The BG/NBD model</h4>

<p>The BG/NBD is an "easy" alternative to the Pareto/NBD model that is easier to implement. The BG/NBD model slight adapts
the behavioral "story" associated with the Pareto/NBD model in order to simplify the implementation. The BG/NBD model uses a beta-geometric and
exponential gamma mixture distributions to model customer behavior. The key difference to the Pareto/NBD model is that a customer can only
churn right after a transaction. This simplifies computations significantly, however has the drawback that a customer cannot churn until he/she
makes a transaction. The Pareto/NBD model assumes that a customer can churn at any time.
</p>



<h4>BG/NBD model with static covariates</h4>

<p>The standard BG/NBD model captures heterogeneity was solely using Gamma distributions.
However, often exogenous knowledge, such as for example customer demographics, is available.
The supplementary knowledge may explain part of the heterogeneity among the customers and
therefore increase the predictive accuracy of the model. In addition, we can rely on these
parameter estimates for inference, i.e. identify and quantify effects of contextual factors
on the two underlying purchase and attrition processes. For technical details we refer to
the technical note by Fader and Hardie (2007).
</p>
<p>The likelihood function is the likelihood function associated with the basic model where
alpha, a, and b are replaced with alpha = alpha0*exp(-g1z1), a = a_0*exp(g2z2), and b = b0*exp(g3z2)
while r remains unchanged. Note that in the current implementation, we constrain the covariate parameters
and data for the lifetime process to be equal (g2=g3 and z2=z3).
</p>



<h3>Value</h3>

<p>Depending on the data object on which the model was fit, <code>bgnbd</code> returns either an object of
class clv.bgnbd or clv.bgnbd.static.cov.
</p>
<p>The function <code>summary</code> can be used to obtain and print a summary of the results.
The generic accessor functions <code>coefficients</code>, <code>vcov</code>, <code>fitted</code>,
<code>logLik</code>, <code>AIC</code>, <code>BIC</code>, and <code>nobs</code> are available.
</p>


<h3>References</h3>

<p>Fader PS, Hardie BGS, Lee KL (2005). ““Counting Your Customers” the Easy Way:
An Alternative to the Pareto/NBD Model” Marketing Science, 24(2), 275-284.
</p>
<p>Fader PS, Hardie BGS (2013). “Overcoming the BG/NBD Model's #NUM! Error Problem”
URL <a href="http://brucehardie.com/notes/027/bgnbd_num_error.pdf">http://brucehardie.com/notes/027/bgnbd_num_error.pdf</a>.
</p>
<p>Fader PS, Hardie BGS (2007). “Incorporating time-invariant covariates into the
Pareto/NBD and BG/NBD models.”
URL <a href="http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf">http://www.brucehardie.com/notes/019/time_invariant_covariates.pdf</a>.
</p>
<p>Fader PS, Hardie BGS, Lee KL (2007). “Creating a Fit Histogram for the BG/NBD Model”
URL <a href="https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf">https://www.brucehardie.com/notes/014/bgnbd_fit_histogram.pdf</a>
</p>


<h3>See Also</h3>

<p><code>clvdata</code> to create a clv data object, <code>SetStaticCovariates</code>
to add static covariates to an existing clv data object.
</p>
<p>gg to fit customer's average spending per transaction with the <code>Gamma-Gamma</code> model
</p>
<p><code>predict</code> to predict expected transactions, probability of being alive, and customer lifetime value for every customer
</p>
<p><code>plot</code> to plot the unconditional expectation as predicted by the fitted model
</p>
<p><code>pmf</code> for the probability to make exactly x transactions in the estimation period, given by the probability mass function (PMF).
</p>
<p><code>newcustomer</code> to predict the expected number of transactions for an average new customer.
</p>
<p>The generic functions <code>vcov</code>, <code>summary</code>, <code>fitted</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data("apparelTrans")
clv.data.apparel &lt;- clvdata(apparelTrans, date.format = "ymd",
                            time.unit = "w", estimation.split = 52)

# Fit standard bgnbd model
bgnbd(clv.data.apparel)

# Give initial guesses for the model parameters
bgnbd(clv.data.apparel,
     start.params.model = c(r=0.5, alpha=15, a = 2, b=5))


# pass additional parameters to the optimizer (optimx)
#    Use Nelder-Mead as optimization method and print
#    detailed information about the optimization process
apparel.bgnbd &lt;- bgnbd(clv.data.apparel,
                     optimx.args = list(method="Nelder-Mead",
                                        control=list(trace=6)))

# estimated coefs
coef(apparel.bgnbd)

# summary of the fitted model
summary(apparel.bgnbd)

# predict CLV etc for holdout period
predict(apparel.bgnbd)

# predict CLV etc for the next 15 periods
predict(apparel.bgnbd, prediction.end = 15)


# To estimate the bgnbd model with static covariates,
#   add static covariates to the data
data("apparelStaticCov")
clv.data.static.cov &lt;-
 SetStaticCovariates(clv.data.apparel,
                     data.cov.life = apparelStaticCov,
                     names.cov.life = c("Gender", "Channel"),
                     data.cov.trans = apparelStaticCov,
                     names.cov.trans = c("Gender", "Channel"))

# Fit bgnbd with static covariates
bgnbd(clv.data.static.cov)

# Give initial guesses for both covariate parameters
bgnbd(clv.data.static.cov, start.params.trans = c(Gender=0.75, Channel=0.7),
                   start.params.life  = c(Gender=0.5, Channel=0.5))

# Use regularization
bgnbd(clv.data.static.cov, reg.lambdas = c(trans = 5, life=5))

# Force the same coefficient to be used for both covariates
bgnbd(clv.data.static.cov, names.cov.constr = "Gender",
                   start.params.constr = c(Gender=0.5))

# Fit model only with the Channel covariate for life but
# keep all trans covariates as is
bgnbd(clv.data.static.cov, names.cov.life = c("Channel"))

</code></pre>


</div>