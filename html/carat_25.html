<div class="container">

<table style="width: 100%;"><tr>
<td>StrBCD</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Shao's Method in the Two-Arms Case</h2>

<h3>Description</h3>

<p>Allocates patients to one of the two treatments using Shao's method proposed by Shao J, Yu X, Zhong B (2010) &lt;doi:10.1093/biomet/asq014&gt;. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">StrBCD(data, p = 0.85)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame. A row of the dataframe corresponds to the covariate profile of a patient.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>the biased coin probability. <code>p</code> should be larger than <code>1/2</code> and less than <code>1</code>. The default is <code>0.85</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Consider <code class="reqn">I</code> covariates and <code class="reqn">m_i</code> levels for the <code class="reqn">i</code>th covariate, <code class="reqn">i=1,\ldots,I</code>. <code class="reqn">T_j</code> is the assignment of the <code class="reqn">j</code>th patient and <code class="reqn">Z_j = (k_1,\dots,k_I)</code> indicates the covariate profile of this patient, <code class="reqn">j=1,\ldots,n</code>. For convenience, <code class="reqn">(k_1,\dots,k_I)</code> and <code class="reqn">(i;k_i)</code> denote the stratum and margin, respectively. <code class="reqn">D_j(.)</code> is the difference between the numbers of patients assigned to treatment <code class="reqn">1</code> and treatment <code class="reqn">2</code> at the corresponding levels after <code class="reqn">j</code> patients have been assigned. The stratified biased coin design is as follows:
</p>
<p>(1) The first patient is assigned to treatment <code class="reqn">1</code> with probability <code class="reqn">1/2</code>;
</p>
<p>(2) Suppose <code class="reqn">j-1</code> patients have been assigned (<code class="reqn">1&lt;j\le n</code>) and the <code class="reqn">j</code>th patient falls within <code class="reqn">(k_1^*,\dots,k_I^*)</code>;
</p>
<p>(3) If the <code class="reqn">j</code>th patient were assigned to treatment <code class="reqn">1</code>, then the potential within-stratum difference between the two treatments would be
</p>
<p style="text-align: center;"><code class="reqn">D_j^{(1)}(k_1^*,\dots,k_I^*)=D_j(k_1^*,\dots,k_I^*)+1</code>
</p>

<p>for stratum <code class="reqn">(k_1^*,\ldots,k_I^*)</code>. Similarly, the potential difference would be obtained in the same way if the <code class="reqn">j</code>th patient were assigned to treatment <code class="reqn">2</code>;
</p>
<p>(4) An imbalance measure is defined by
</p>
<p style="text-align: center;"><code class="reqn">Imb_j^{(l)}=[D_j^{(l)}(k_1^*,\dots,k_I^*)]^2,l=1,2;</code>
</p>

<p>(5) Conditional on the assignments of the first (<code class="reqn">j-1</code>) patients as well as the covariates'profiles of the first <code class="reqn">j</code> patients, assign the <code class="reqn">j</code>th patient to treatment <code class="reqn">1</code> with probability
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=q</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&gt;Imb_j^{(2)},</code>
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=p</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}&lt;Imb_j^{(2)}</code>, and
</p>
<p style="text-align: center;"><code class="reqn">P(T_j=1|Z_j,T_1,\dots,T_{j-1})=0.5</code>
</p>
<p> for <code class="reqn">Imb_j^{(1)}=Imb_j^{(2)}.</code>
</p>
<p>Details of the procedure can be found in Shao J, Yu X, Zhong B (2010).
</p>


<h3>Value</h3>

<p>It returns an object of <code>class</code> <code>"carandom"</code>. 
</p>
<p>An object of class <code>"carandom"</code> is a list containing the following components: 
</p>
<table>
<tr style="vertical-align: top;">
<td><code>datanumeric</code></td>
<td>
<p>a bool indicating whether the data is a numeric data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>
<p>a character string giving the name(s) of the included covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strt_num</code></td>
<td>
<p>the number of strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov_num</code></td>
<td>
<p>the number of covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level_num</code></td>
<td>
<p>a vector of level numbers for each covariate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>the number of patients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cov_Assig</code></td>
<td>
<p>a <code>(cov_num + 1) * n</code> matrix containing covariate profiles for all patients and the corresponding assignments. The <code class="reqn">i</code>th column represents the <code class="reqn">i</code>th patient. The first <code>cov_num</code> rows include patients' covariate profiles, and the last row contains the assignments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assignments</code></td>
<td>
<p>the randomization sequence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>All strata</code></td>
<td>
<p>a matrix containing all strata involved.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Diff</code></td>
<td>
<p>a matrix with only one column. There are final differences at the overall, within-stratum, and within-covariate-margin levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string describing the randomization procedure to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Data Type</code></td>
<td>
<p>a character string giving the data type, <code>Real</code> or <code>Simulated</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>framework</code></td>
<td>
<p>the framework of the used randomization procedure: stratified randomization, or model-based method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the data frame.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Ma W, Ye X, Tu F, Hu F. <em>carat: Covariate-Adaptive Randomization for Clinical Trials</em>[J]. Journal of Statistical Software, 2023, 107(2): 1-47.
</p>
<p>Shao J, Yu X, Zhong B. <em>A theory for testing hypotheses under covariate-adaptive randomization</em>[J]. Biometrika, 2010, 97(2): 347-360. 
</p>


<h3>See Also</h3>

<p>See <code>StrBCD.sim</code> for allocating patients with covariate data generating mechanism. 
See <code>StrBCD.ui</code> for command-line user interface.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># a simple use
## Real Data
## creat a dataframe
df &lt;- data.frame("gender" = sample(c("female", "male"), 1000, TRUE, c(1 / 3, 2 / 3)), 
                 "age" = sample(c("0-30", "30-50", "&gt;50"), 1000, TRUE), 
                 "jobs" = sample(c("stu.", "teac.", "others"), 1000, TRUE), 
                 stringsAsFactors = TRUE)
Res &lt;- StrBCD(data = df)
## view the output
Res

## view all patients' profile and assignments
Res$Cov_Assig

## Simulated Data
cov_num = 3
level_num = c(2, 3, 3)
pr = c(0.4, 0.6, 0.3, 0.4, 0.3, 0.4, 0.3, 0.3)
Res.sim &lt;- StrBCD.sim(n = 1000, cov_num, level_num, pr)
## view the output
Res.sim

## view the detials of difference
Res.sim$Diff


N &lt;- 5
n &lt;- 1000
cov_num &lt;- 3
level_num &lt;- c(2, 3, 5) 
# Set pr to follow two tips:
# (1) length of pr should be sum(level_num);
# (2)sum of probabilities for each margin should be 1
pr &lt;- c(0.4, 0.6, 0.3, 0.4, 0.3, rep(0.2, times = 5))
omega &lt;- c(0.2, 0.2, rep(0.6 / cov_num, times = cov_num))

## generate a container to contain Diff
DH &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
DS &lt;- matrix(NA, ncol = N, nrow = 1 + prod(level_num) + sum(level_num))
for(i in 1 : N){
  result &lt;- HuHuCAR.sim(n, cov_num, level_num, pr, omega)
  resultS &lt;- StrBCD.sim(n, cov_num, level_num, pr)
  DH[ , i] &lt;- result$Diff; DS[ , i] &lt;- resultS$Diff
}

## do some analysis
require(dplyr)

## analyze the overall imbalance
Ana_O &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_O) &lt;- c("NEW", "Shao")
colnames(Ana_O) &lt;- c("mean", "median", "95%quantile")
temp &lt;- DH[1, ] %&gt;% abs
tempS &lt;- DS[1, ] %&gt;% abs
Ana_O[1, ] &lt;- c((temp %&gt;% mean), (temp %&gt;% median),
                (temp %&gt;% quantile(0.95)))
Ana_O[2, ] &lt;- c((tempS %&gt;% mean), (tempS %&gt;% median),
                (tempS %&gt;% quantile(0.95)))

## analyze the within-stratum imbalances
tempW &lt;- DH[2 : (1 + prod(level_num)), ] %&gt;% abs
tempWS &lt;- DS[2 : 1 + prod(level_num), ] %&gt;% abs
Ana_W &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_W) &lt;- c("NEW", "Shao")
colnames(Ana_W) &lt;- c("mean", "median", "95%quantile")
Ana_W[1, ] = c((tempW %&gt;% apply(1, mean) %&gt;% mean),
               (tempW %&gt;% apply(1, median) %&gt;% mean),
               (tempW %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_W[2, ] = c((tempWS %&gt;% apply(1, mean) %&gt;% mean),
               (tempWS %&gt;% apply(1, median) %&gt;% mean),
               (tempWS %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

## analyze the marginal imbalance
tempM &lt;- DH[(1 + prod(level_num) + 1) :
              (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
tempMS &lt;- DS[(1 + prod(level_num) + 1) :
               (1 + prod(level_num) + sum(level_num)), ] %&gt;% abs
Ana_M &lt;- matrix(NA, nrow = 2, ncol = 3)
rownames(Ana_M) &lt;- c("NEW", "Shao")
colnames(Ana_M) &lt;- c("mean", "median", "95%quantile")
Ana_M[1, ] = c((tempM %&gt;% apply(1, mean) %&gt;% mean),
               (tempM %&gt;% apply(1, median) %&gt;% mean),
               (tempM %&gt;% apply(1, mean) %&gt;% quantile(0.95)))
Ana_M[2, ] = c((tempMS %&gt;% apply(1, mean) %&gt;% mean),
               (tempMS %&gt;% apply(1, median) %&gt;% mean),
               (tempMS %&gt;% apply(1, mean) %&gt;% quantile(0.95)))

AnaHP &lt;- list(Ana_O, Ana_M, Ana_W)
names(AnaHP) &lt;- c("Overall", "Marginal", "Within-stratum")

AnaHP

</code></pre>


</div>