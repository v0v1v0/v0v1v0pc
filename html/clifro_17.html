<div class="container">

<table style="width: 100%;"><tr>
<td>cf_query</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Retrieve Data from the National Climate Database</h2>

<h3>Description</h3>

<p>Query the National Climate Database via CliFlo based on the <span class="pkg">clifro</span> user
and selected datatypes, stations and dates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cf_query(
  user,
  datatype,
  station,
  start_date,
  end_date = now(tz),
  date_format = "ymd_h",
  tz = "Pacific/Auckland",
  output_tz = c("local", "NZST", "UTC"),
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>user</code></td>
<td>
<p>a <code>cfUser</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datatype</code></td>
<td>
<p>a <code>cfDatatype</code> object containing the datatypes to
be retrieved.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>station</code></td>
<td>
<p>a <code>cfStation</code> object containing the stations where
the datatypes will be retrieved from.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start_date</code></td>
<td>
<p>a character, Date or POSIXt object indicating the start
date. If a character string is supplied the date format
should be in the form <code>yyyy-mm-dd-hh</code> unless
<code>date_format</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end_date</code></td>
<td>
<p>same as <code>start_date</code>. Defaults to
<code>now</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date_format</code></td>
<td>
<p>a character string matching one of <code>"ymd_h"</code>,
<code>"mdy_h"</code>, <code>"ydm_h"</code> or <code>"dmy_h"</code>
representing the <code>lubridate-package</code>
date parsing function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tz</code></td>
<td>
<p>the timezone for which the start and end dates refer to. Conversion
to Pacific/Auckland time is done automatically through the
<code>with_tz</code> function. Defaults to
"Pacific/Auckland".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_tz</code></td>
<td>
<p>the timezone of the output. This can be one of either "local",
"UTC", or "NZST".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>logical. When <code>TRUE</code> the function evaluates without
displaying customary messages. Messages from CliFlo are still
displayed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code>cf_query</code> function is used to combine the <span class="pkg">clifro</span> user
(<code>cfUser</code>), along with the desired datatypes
(<code>cfDatatype</code>) and stations (<code>cfStation</code>). The query
is 'built up' using these objects, along with the necessary dates. The
function then uses all these data to query the National Climate Database via
the CliFlo web portal and returns one of the many <code>cfData</code>
objects if one dataframe is returned, or a <code>cfDataList</code> object if
there is more than one dataframe returned from CliFlo. If a <code>cfDataList</code>
is returned, each element in the list is a subclass of the <code>cfData</code>
class, see the 'cfData Subclasses' section.
</p>


<h3>Value</h3>

<p>a <code>cfData</code> or <code>cfDataList</code> object.
</p>


<h3>CfData Subclasses</h3>

<p>There are 8 <code>cfData</code> subclasses that are returned from <code>cf_query</code>
depending on the datatype requested. Each of these subclasses have default
<code>plot</code> methods for usability and efficiency in exploring and plotting
<span class="pkg">clifro</span> data.
</p>
<p>The following table summarises these subclasses and how they are created, see
also the examples on how to automatically create some of these subclasses.
</p>

<table>
<tr>
<td style="text-align: left;">
<strong>Subclass</strong> </td>
<td style="text-align: left;"> <strong>CliFlo Datatype</strong>
</td>
</tr>
<tr>
<td style="text-align: left;">
cfWind </td>
<td style="text-align: left;"> Any 'Wind' data </td>
</tr>
<tr>
<td style="text-align: left;">
cfRain </td>
<td style="text-align: left;"> Any 'Precipitation' data </td>
</tr>
<tr>
<td style="text-align: left;">
cfScreen Obs </td>
<td style="text-align: left;"> 'Temperature and Humidity' data measured in a standard screen </td>
</tr>
<tr>
<td style="text-align: left;">
cfTemp </td>
<td style="text-align: left;"> Maximum and minimum 'Temperature and Humidity' data </td>
</tr>
<tr>
<td style="text-align: left;">
cfEarthTemp </td>
<td style="text-align: left;"> 'Temperature and Humidity' data at a given depth </td>
</tr>
<tr>
<td style="text-align: left;">
cfSunshine </td>
<td style="text-align: left;"> Any 'Sunshine &amp; Radiation' data </td>
</tr>
<tr>
<td style="text-align: left;">
cfPressure </td>
<td style="text-align: left;"> Any 'Pressure' data </td>
</tr>
<tr>
<td style="text-align: left;">
cfOther </td>
<td style="text-align: left;"> Any other CliFlo 'Daily and Hourly Observations' </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>cf_user</code>, <code>cf_datatype</code> and
<code>cf_station</code> for creating the objects needed for a query. See
<code>plot,cfDataList,missing-method</code> for general information on
default plotting of <code>cfData</code> and <code>cfDataList</code> objects, and the
links within.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Retrieve daily rain data from Reefton Ews
daily.rain = cf_query(cf_user("public"), cf_datatype(3, 1, 1),
                      cf_station(), "2012-01-01 00")
daily.rain

# returns a cfData object as there is only one datatype
class(daily.rain) # 'cfRain' object - inherits 'cfData'

# Look up the help page for cfRain plot methods
?plot.cfRain

# Retrieve daily rain and wind data from Reefton Ews

daily.dts = cf_query(cf_user("public"),
                     cf_datatype(c(2, 3), c(1, 1), list(4, 1), c(1, NA)),
                     cf_station(), "2012-01-01 00", "2013-01-01 00")
daily.dts

# returns a cfDataList object as there is more than one datatype. Each
# element of the cfDataList is an object inheriting from the cfData class.
class(daily.dts)     # cfDataList
class(daily.dts[1])  # cfRain
class(daily.dts[2])  # cfWind

# Create a cfSunshine object (inherits cfData)
# Retrieve daily global radiation data at Reefton Ews
rad.data = cf_query(cf_user(), cf_datatype(5,2,1), cf_station(),
                    "2012-01-01 00")
rad.data

# The cf_query function automatically creates the appropriate cfData subclass
class(rad.data)

# The advantage of having these subclasses is that it makes plotting very easy
plot(rad.data)
plot(daily.rain)
plot(daily.rain, include_runoff = FALSE)
plot(daily.dts)
plot(daily.dts, 2)

## End(Not run)
</code></pre>


</div>