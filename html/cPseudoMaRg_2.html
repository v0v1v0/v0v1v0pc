<div class="container">

<table style="width: 100%;"><tr>
<td>makeCPMSampler</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>correlated pseudo-marginal: generates functions that output a big vector</h2>

<h3>Description</h3>

<p>correlated pseudo-marginal: generates functions that output a big vector
</p>


<h3>Usage</h3>

<pre><code class="language-R">makeCPMSampler(
  paramKernSamp,
  logParamKernEval,
  logPriorEval,
  logLikeApproxEval,
  yData,
  numU,
  numIters,
  rho = 0.99,
  storeEvery = 1,
  nansInLLFatal = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>paramKernSamp</code></td>
<td>
<p>function(theta) -&gt; theta proposal</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logParamKernEval</code></td>
<td>
<p>function(oldTheta, newTheta) -&gt; logDensity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logPriorEval</code></td>
<td>
<p>function(theta) -&gt; logDensity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLikeApproxEval</code></td>
<td>
<p>function(y, thetaProposal, uProposal) -&gt; logApproxDensity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yData</code></td>
<td>
<p>the observed data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numU</code></td>
<td>
<p>integer number of u samples</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numIters</code></td>
<td>
<p>integer number of MCMC iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>correlation tuning parameter (-1,1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>storeEvery</code></td>
<td>
<p>increase this integer if you want to use thinning</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nansInLLFatal</code></td>
<td>
<p>terminate the entire chain on NaNs, or simply disregard sample</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>vector of theta samples
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# sim data
realTheta1 &lt;- .2 + .3
realTheta2 &lt;- .2
realParams &lt;- c(realTheta1, realTheta2)
numObs &lt;- 10
realX &lt;- rnorm(numObs, mean = 0, sd = sqrt(realTheta2))
realY &lt;- rnorm(numObs, mean = realX, sd = sqrt(realTheta1 - realTheta2))
# tuning params
numImportanceSamps &lt;- 1000
numMCMCIters &lt;- 1000
randomWalkScale &lt;- 1.5
recordEveryTh &lt;- 1
sampler &lt;- makeCPMSampler(
 paramKernSamp = function(params){
   return(params + rnorm(2)*randomWalkScale)
 },
 logParamKernEval = function(oldTheta, newTheta){
   dnorm(newTheta[1], oldTheta[1], sd = randomWalkScale, log = TRUE)
   + dnorm(newTheta[2], oldTheta[2], sd = randomWalkScale, log = TRUE)
 },
 logPriorEval = function(theta){
   if( (theta[1] &gt; theta[2]) &amp; all(theta &gt; 0)){
     0
   }else{
     -Inf
   }
 },
 logLikeApproxEval = function(y, thetaProposal, uProposal){
   if( (thetaProposal[1] &gt; thetaProposal[2]) &amp; (all(thetaProposal &gt; 0))){
     xSamps &lt;- uProposal*sqrt(thetaProposal[2])
     logCondLikes &lt;- sapply(xSamps,
                           function(xsamp) {
                             sum(dnorm(y,
                                       xsamp,
                                       sqrt(thetaProposal[1] - thetaProposal[2]),
                                       log = TRUE)) })
     m &lt;- max(logCondLikes)
     log(sum(exp(logCondLikes - m))) + m - log(length(y))
   }else{
     -Inf
   }
 },
 realY, numImportanceSamps, numMCMCIters, .99, recordEveryTh
)
res &lt;- sampler(realParams)
</code></pre>


</div>