<div class="container">

<table style="width: 100%;"><tr>
<td>levbox_mergetime</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function to combine NetCDF files and simultaneously cut a region and level.</h2>

<h3>Description</h3>

<p>This function selects a region and a level from a bunch of CM SAF NetCDF files
that match the same pattern of the filename, and writes the output to a new
file. If no longitude and latitude values are given, files are only merged.
All input files have to have the same rectangular grid and the same variable.
The reference time of the output file is determined by the first input file.
</p>


<h3>Usage</h3>

<pre><code class="language-R">levbox_mergetime(
  var,
  level = 1,
  path,
  pattern,
  outfile,
  lon1 = -180,
  lon2 = 180,
  lat1 = -90,
  lat2 = 90,
  nc34 = 4,
  overwrite = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>Name of NetCDF variable (character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>Number of level that should be extracted (integer).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>The directory of input NetCDF files without / at the end
(character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pattern</code></td>
<td>
<p>A part of the filename, which is the same for all desired input
files (character). The pattern has to be a character string containing a
regular expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outfile</code></td>
<td>
<p>Filename of output NetCDF file. This may include the directory
(character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon1</code></td>
<td>
<p>Longitude of lower left corner (numeric).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon2</code></td>
<td>
<p>Longitude of upper right left corner (numeric).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat1</code></td>
<td>
<p>Latitude of lower left corner (numeric).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat2</code></td>
<td>
<p>Latitude of upper right corner (numeric).  Longitude of upper
right corner (numeric).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nc34</code></td>
<td>
<p>NetCDF version of output file. If <code>nc34 = 3</code> the output file will be
in NetCDFv3 format (numeric). Default output is NetCDFv4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overwrite</code></td>
<td>
<p>logical; should existing output file be overwritten?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical; if TRUE, progress messages are shown</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A NetCDF file including the merged time series of the selected region
is written. The output NetCDF file contains only the selected level.
</p>


<h3>See Also</h3>

<p>Other data manipulation functions: 
<code>acsaf_box_mergetime()</code>,
<code>add_grid_info()</code>,
<code>box_mergetime()</code>,
<code>cmsaf.transform.coordinate.system()</code>,
<code>map_regular()</code>,
<code>remap()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Create an example NetCDF file with a similar structure as used by CM
## SAF. The file is created with the ncdf4 package.  Alternatively
## example data can be freely downloaded here: &lt;https://wui.cmsaf.eu/&gt;

library(ncdf4)

## create some (non-realistic) example data

lon &lt;- seq(5, 15, 0.5)
lat &lt;- seq(45, 55, 0.5)
time &lt;- c(as.Date("2000-01-01"), as.Date("2001-02-01"))
origin &lt;- as.Date("1983-01-01 00:00:00")
time &lt;- as.numeric(difftime(time, origin, units = "hour"))
level &lt;- c(1:5)
data1 &lt;- array(250:350, dim = c(21, 21, 5, 1))
data2 &lt;- array(230:320, dim = c(21, 21, 5, 1))

## create two example NetCDF files

x &lt;- ncdim_def(name = "lon", units = "degrees_east", vals = lon)
y &lt;- ncdim_def(name = "lat", units = "degrees_north", vals = lat)
l &lt;- ncdim_def(name = "level", units = "1", vals = level)
t &lt;- ncdim_def(name = "time", units = "hours since 1983-01-01 00:00:00",
 vals = time[1], unlim = TRUE)
var1 &lt;- ncvar_def("SIS", "W m-2", list(x, y, l, t), -1, prec = "short")
vars &lt;- list(var1)
ncnew &lt;- nc_create(file.path(tempdir(),"CMSAF_example_file_n1.nc"), vars)
ncvar_put(ncnew, var1, data1)
ncatt_put(ncnew, "lon", "standard_name", "longitude", prec = "text")
ncatt_put(ncnew, "lat", "standard_name", "latitude", prec = "text")
ncatt_put(ncnew, "level", "standard_name", "level", prec = "text")
nc_close(ncnew)

t &lt;- ncdim_def(name = "time", units = "hours since 1983-01-01 00:00:00",
 vals = time[2], unlim = TRUE)
ncnew &lt;- nc_create(file.path(tempdir(),"CMSAF_example_file_n2.nc"), vars)
ncvar_put(ncnew, var1, data2)
ncatt_put(ncnew, "lon", "standard_name", "longitude", prec = "text")
ncatt_put(ncnew, "lat", "standard_name", "latitude", prec = "text")
ncatt_put(ncnew, "level", "standard_name", "level", prec = "text")
nc_close(ncnew)

## Cut a region and levl, and merge both example CM SAF NetCDF files
## into one output file. First get path information of working
## directory.
levbox_mergetime(var = "SIS", level = 1, path = tempdir(), 
 pattern = "CMSAF_example_file_n", outfile = file.path(tempdir(),
 "CMSAF_example_file_levbox_mergetime.nc"), lon1 = 8, lon2 = 12, 
 lat1 = 48, lat2 =52)

unlink(c(file.path(tempdir(),"CMSAF_example_file_n1.nc"), 
 file.path(tempdir(),"CMSAF_example_file_n2.nc"),
 file.path(tempdir(),"CMSAF_example_file_levbox_mergetime.nc")))
</code></pre>


</div>