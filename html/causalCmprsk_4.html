<div class="container">

<table style="width: 100%;"><tr>
<td>get.numAtRisk</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Number-at-risk in raw and weighted data</h2>

<h3>Description</h3>

<p>Obtaining time-varying number-at-risk statistic in both raw and weighted data
</p>


<h3>Usage</h3>

<pre><code class="language-R">get.numAtRisk(df, X, E, A, C = NULL, wtype = "unadj", cens = 0)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>a data frame that includes time-to-event <code>X</code>, type of event <code>E</code>,
a treatment indicator <code>A</code>  and covariates <code>C</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a character string specifying the name of the time-to-event variable in <code>df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>a character string specifying the name of the "event type" variable in <code>df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>a character specifying the name of the treatment/exposure variable.
It is assumed that <code>A</code> is a numeric binary indicator with 0/1 values, where <code>A</code>=1
is assumed a treatment group, and <code>A</code>=0 a control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>a vector of character strings with variable names (potential confounders)
in the logistic regression model for Propensity Scores, i.e. P(A=1|C=c).
The default value of <code>C</code> is NULL corresponding to <code>wtype</code>="unadj"
that will estimate treatment effects in the raw (observed) data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wtype</code></td>
<td>
<p>a character string variable indicating the type of weights that will define the target
population for which the ATE will be estimated.
The default is "unadj" - this will not adjust for possible
treatment selection bias and will not use propensity scores weighting. It can be used, for example,
in data from a randized controlled trial (RCT) where there is no need for emulation of baseline randomization.
Other possible values are "stab.ATE", "ATE", "ATT", "ATC" and "overlap".
See Table 1 from Li, Morgan, and Zaslavsky (2018).
"stab.ATE" is defined as P(A=a)/P(A=a|C=c) - see Hern√°n et al. (2000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens</code></td>
<td>
<p>an integer value in <code>E</code> that corresponds to censoring times recorded in <code>X</code>.
By default <code>fit.nonpar</code> assumes <code>cens</code>=0</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with two fields:
</p>

<ul>
<li>
<p><code>trt.0</code> a matrix with three columns, <code>time</code>, <code>num</code> and <code>sample</code>
corresponding to the treatment arm with <code>A</code>=0.
The results for both weighted and unadjusted number-at-risk are returnd in  a long-format matrix.
The column <code>time</code> is a vector of time points at which we calculate the number-at-risk.
The column <code>num</code> is the number-at-risk.
The column <code>sample</code> is a factor variable that gets one of two values, "Weighted" or "Unadjusted".
The estimated number-at-risk in the weighted sample corresponds to the rows with <code>sample="Weighted"</code>.
</p>
</li>
<li>
<p><code>trt.1</code> a matrix with three columns, <code>time</code>, <code>num</code> and <code>sample</code>
corresponding to the treatment arm with <code>A</code>=1.
The results for both weighted and unadjusted number-at-risk are returnd in  a long-format matrix.
The column <code>time</code> is a vector of time points at which we calculate the number-at-risk.
The column <code>num</code> is the number-at-risk.
The column <code>sample</code> is a factor variable that gets one of two values, "Weighted" or "Unadjusted".
The estimated number-at-risk in the weighted sample corresponds to the rows with <code>sample="Weighted"</code>.</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>get.weights</code>, <code>get.pointEst</code>, <code>causalCmprsk</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;- runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)

num.atrisk &lt;- get.numAtRisk(data, "X", "E", "TRT", C=covs.names, wtype="overlap", cens=0)
plot(num.atrisk$trt.1$time[num.atrisk$trt.1$sample=="Weighted"],
     num.atrisk$trt.1$num[num.atrisk$trt.1$sample=="Weighted"], col="red", type="s",
     xlab="time", ylab="number at risk",
     main="Number at risk in TRT=1", ylim=c(0, max(num.atrisk$trt.1$num)))
lines(num.atrisk$trt.1$time[num.atrisk$trt.1$sample=="Unadjusted"],
      num.atrisk$trt.1$num[num.atrisk$trt.1$sample=="Unadjusted"], col="blue", type="s")
legend("topright", legend=c("Weighted", "Unadjusted"), lty=1:1,  col=c("red", "blue"))
plot(num.atrisk$trt.0$time[num.atrisk$trt.0$sample=="Weighted"],
     num.atrisk$trt.0$num[num.atrisk$trt.0$sample=="Weighted"], col="red", type="s",
     xlab="time", ylab="number at risk",
     main="Number at risk in TRT=0", ylim=c(0, max(num.atrisk$trt.0$num)))
lines(num.atrisk$trt.0$time[num.atrisk$trt.0$sample=="Unadjusted"],
      num.atrisk$trt.0$num[num.atrisk$trt.0$sample=="Unadjusted"], col="blue", type="s")
legend("topright", legend=c("Weighted", "Unadjusted"), lty=1:1,  col=c("red", "blue"))

</code></pre>


</div>