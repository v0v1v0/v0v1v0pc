<div class="container">

<table style="width: 100%;"><tr>
<td>ard_stack_hierarchical</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Stacked Hierarchical ARD Statistics</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a><br>
Use these functions to calculate multiple summaries of nested or hierarchical data
in a single call.
</p>

<ul>
<li> <p><code>ard_stack_hierarchical()</code>: Calculates <em>rates</em> of events (e.g. adverse events)
utilizing the <code>denominator</code> and <code>id</code> arguments to identify the rows in <code>data</code>
to include in each rate calculation.
</p>
</li>
<li> <p><code>ard_stack_hierarchical_count()</code>: Calculates <em>counts</em> of events utilizing
all rows for each tabulation.
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">ard_stack_hierarchical(
  data,
  variables,
  by = dplyr::group_vars(data),
  id,
  denominator,
  include = everything(),
  statistic = everything() ~ c("n", "N", "p"),
  overall = FALSE,
  over_variables = FALSE,
  attributes = FALSE,
  total_n = FALSE,
  shuffle = FALSE
)

ard_stack_hierarchical_count(
  data,
  variables,
  by = dplyr::group_vars(data),
  denominator = NULL,
  include = everything(),
  overall = FALSE,
  over_variables = FALSE,
  attributes = FALSE,
  total_n = FALSE,
  shuffle = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>(<code>data.frame</code>)<br>
a data frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>(<code>tidy-select</code>)<br>
Specifies the nested/hierarchical structure of the data.
The variables that are specified here and in the <code>include</code> argument
will have summary statistics calculated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>(<code>tidy-select</code>)<br>
variables to perform tabulations by. All combinations of the variables
specified here appear in results. Default is <code>dplyr::group_vars(data)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>(<code>tidy-select</code>)<br>
argument used to subset <code>data</code> to identify rows in <code>data</code> to calculate
event rates in <code>ard_stack_hierarchical()</code>. See details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>denominator</code></td>
<td>
<p>(<code>data.frame</code>, <code>integer</code>)<br>
used to define the denominator and enhance the output.
The argument is required for <code>ard_stack_hierarchical()</code> and optional
for <code>ard_stack_hierarchical_count()</code>.
</p>

<ul>
<li>
<p> the univariate tabulations of the <code>by</code> variables are calculated with <code>denominator</code>,
when a data frame is passed, e.g. tabulation of the treatment assignment
counts that may appear in the header of a table.
</p>
</li>
<li>
<p> the <code>denominator</code> argument must be specified when <code>id</code> is used to
calculate the event rates.
</p>
</li>
<li>
<p> if <code>total_n=TRUE</code>, the <code>denominator</code> argument is used to return the total N
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include</code></td>
<td>
<p>(<code>tidy-select</code>)<br>
Specify the subset a columns indicated in the <code>variables</code> argument for which
summary statistics will be returned. Default is <code>everything()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>(<code>formula-list-selector</code>)<br>
a named list, a list of formulas,
or a single formula where the list element one or more of  <code>c("n", "N", "p")</code>
(or the RHS of a formula).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall</code></td>
<td>
<p>(scalar <code>logical</code>)<br> logical indicating whether overall statistics
should be calculated (i.e. repeat the operations with <code>by=NULL</code> in <em>most cases</em>, see below for details).
Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>over_variables</code></td>
<td>
<p>(scalar <code>logical</code>)<br>
logical indicating whether summary statistics
should be calculated over or across the columns listed in the <code>variables</code> argument.
Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>attributes</code></td>
<td>
<p>(scalar <code>logical</code>)<br>
logical indicating whether to include the results of <code>ard_attributes()</code> for all
variables represented in the ARD. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>total_n</code></td>
<td>
<p>(scalar <code>logical</code>)<br>
logical indicating whether to include of <code>ard_total_n(denominator)</code> in the returned ARD.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shuffle</code></td>
<td>
<p>(scalar <code>logical</code>)<br>
logical indicating whether to perform <code>shuffle_ard()</code> on the final result.
Default is <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>an ARD data frame of class 'card'
</p>


<h3>Subsetting Data for Rate Calculations</h3>

<p>To calculate event rates, the <code>ard_stack_hierarchical()</code> function identifies
rows to include in the calculation.
First, the primary data frame is sorted by the columns identified in
the <code>id</code>, <code>by</code>, and <code>variables</code> arguments.
</p>
<p>As the function cycles over the variables specified in the <code>variables</code> argument,
the data frame is grouped by <code>id</code>, <code>intersect(by, names(denominator))</code>, and <code>variables</code>
utilizing the last row within each of the groups.
</p>
<p>For example, if the call is
<code>ard_stack_hierarchical(data = ADAE, variables = c(AESOC, AEDECOD), id = USUBJID)</code>,
then we'd first subset ADAE to be one row within the grouping <code>c(USUBJID, AESOC, AEDECOD)</code>
to calculate the event rates in <code>'AEDECOD'</code>. We'd then repeat and
subset ADAE to be one row within the grouping <code>c(USUBJID, AESOC)</code>
to calculate the event rates in <code>'AESOC'</code>.
</p>


<h3>Overall Argument</h3>

<p>When we set <code>overall=TRUE</code>, we wish to re-run our calculations removing the
stratifying columns. For example, if we ran the code below, we results would
include results with the code chunk being re-run with <code>by=NULL</code>.
</p>
<div class="sourceCode r"><pre>ard_stack_hierarchical(
  data = ADAE,
  variables = c(AESOC, AEDECOD),
  by = TRTA,
  denominator = ADSL |&gt; dplyr::rename(TRTA = ARM),
  overall = TRUE
)
</pre></div>
<p>But there is another case to be aware of: when the <code>by</code> argument includes
columns that are not present in the <code>denominator</code>, for example when tabulating
results by AE grade or severity in addition to treatment assignment.
In the example below, we're tabulating results by treatment assignment and
AE severity. By specifying <code>overall=TRUE</code>, we will re-run the to get
results with <code>by = AESEV</code> and again with <code>by = NULL</code>.
</p>
<div class="sourceCode r"><pre>ard_stack_hierarchical(
  data = ADAE,
  variables = c(AESOC, AEDECOD),
  by = c(TRTA, AESEV),
  denominator = ADSL |&gt; dplyr::rename(TRTA = ARM),
  overall = TRUE
)
</pre></div>


<h3>Examples</h3>

<pre><code class="language-R">ard_stack_hierarchical(
  ADAE,
  variables = c(AESOC, AEDECOD),
  by = TRTA,
  denominator = ADSL |&gt; dplyr::rename(TRTA = ARM),
  id = USUBJID
)

ard_stack_hierarchical_count(
  ADAE,
  variables = c(AESOC, AEDECOD),
  by = TRTA,
  denominator = ADSL |&gt; dplyr::rename(TRTA = ARM)
)
</code></pre>


</div>