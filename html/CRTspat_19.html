<div class="container">

<table style="width: 100%;"><tr>
<td>simulateCRT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulation of cluster randomized trial with spillover</h2>

<h3>Description</h3>

<p><code>simulateCRT</code> generates simulated data for a cluster randomized trial (CRT) with geographic spillover between arms.
</p>


<h3>Usage</h3>

<pre><code class="language-R">simulateCRT(
  trial = NULL,
  effect = 0,
  outcome0 = NULL,
  generateBaseline = TRUE,
  matchedPair = TRUE,
  scale = "proportion",
  baselineNumerator = "base_num",
  baselineDenominator = "base_denom",
  denominator = NULL,
  ICC_inp = NULL,
  kernels = 200,
  sigma_m = NULL,
  spillover_interval = NULL,
  tol = 0.005
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>trial</code></td>
<td>
<p>an object of class <code>"CRTsp"</code> or a data frame containing locations in (x,y) coordinates, cluster
assignments (factor <code>cluster</code>), and arm assignments (factor <code>arm</code>). Each location may also be
assigned a <code>propensity</code> (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>effect</code></td>
<td>
<p>numeric. The simulated effect size (defaults to 0)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome0</code></td>
<td>
<p>numeric. The anticipated value of the outcome in the absence of intervention</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>generateBaseline</code></td>
<td>
<p>logical. If <code>TRUE</code> then baseline data and the <code>propensity</code> will be simulated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>matchedPair</code></td>
<td>
<p>logical. If <code>TRUE</code> then the function tries to carry out randomization
using pair-matching on the baseline data (see details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>measurement scale of the outcome. Options are: 'proportion' (the default); 'count'; 'continuous'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baselineNumerator</code></td>
<td>
<p>optional name of numerator variable for pre-existing baseline data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baselineDenominator</code></td>
<td>
<p>optional name of denominator variable for pre-existing baseline data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>denominator</code></td>
<td>
<p>optional name of denominator variable for the outcome</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ICC_inp</code></td>
<td>
<p>numeric. Target intra cluster correlation, provided as input when baseline data are to be simulated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernels</code></td>
<td>
<p>number of kernels used to generate a de novo <code>propensity</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_m</code></td>
<td>
<p>numeric. standard deviation of the normal kernel measuring spatial smoothing leading to spillover</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spillover_interval</code></td>
<td>
<p>numeric. input spillover interval</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>numeric. tolerance of output ICC</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Synthetic data are generated by sampling around the values of
variable <code>propensity</code>, which is a numerical vector
(taking positive values) of length equal to the number of locations.
There are three ways in which <code>propensity</code> can arise:
</p>

<ol>
<li> <p><code>propensity</code> can be provided as part of the input <code>trial</code> object.
</p>
</li>
<li>
<p> Baseline numerators and denominators (values of <code>baselineNumerator</code>
and <code>baselineDenominator</code> may be provided.
<code>propensity</code> is then generated as the numerator:denominator ratio
for each location in the input object
</p>
</li>
<li>
<p> Otherwise <code>propensity</code> is generated using a 2D Normal
kernel density. The <a href="https://rdrr.io/cran/OOR/man/StoSOO.html"><code>OOR::StoSOO</code></a>
is used to achieve an intra-cluster correlation coefficient (ICC) that approximates
the value of <code>'ICC_inp'</code> by searching for an appropriate value of the kernel bandwidth.
</p>
</li>
</ol>
<p><code>num[i]</code>, the synthetic outcome for location <code>i</code>
is simulated with expectation: <br></p>
<p style="text-align: center;"><code class="reqn">E(num[i]) = outcome0[i] * propensity[i] * denom[i] * (1 - effect*I[i])/mean(outcome0[] * propensity[])</code>
</p>
 <p><br>
The sampling distribution of <code>num[i]</code> depends on the value of <code>scale</code> as follows: <br></p>

<ul>
<li> <p><code>scale</code>=’continuous’: Values of <code>num</code> are sampled from a
Normal distributions with means <code>E(num[i])</code>
and variance determined by the fitting to <code>ICC_inp</code>.<br></p>
</li>
<li> <p><code>scale</code>=’count’: Simulated events are allocated to locations via multivariate hypergeometric distributions
parameterised with <code>E(num[i])</code>.<br></p>
</li>
<li> <p><code>scale</code>=’proportion’: Simulated events are allocated to locations via multinomial distributions
parameterised with <code>E(num[i])</code>.<br></p>
</li>
</ul>
<p><code>denominator</code> may specify a vector of numeric (non-zero) values
in the input <code>"CRTsp"</code> or <code>data.frame</code> which is returned
as variable <code>denom</code>. It acts as a scale-factor for continuous outcomes, rate-multiplier
for counts, or denominator for proportions. For discrete data all values of <code>denom</code>
must be &gt; 0.5 and are rounded to the nearest integer in calculations of <code>num</code>.<br><br>
By default, <code>denom</code> is generated as a vector of ones, leading to simulation of
dichotomous outcomes if <code>scale</code>=’proportion’.<br></p>
<p>If baseline numerators and denominators are provided then the output vectors
<code>base_denom</code> and  <code>base_num</code> are set to the input values. If baseline numerators and denominators
are not provided then the synthetic baseline data are generated by sampling around <code>propensity</code> in the same
way as the outcome data, but with the effect size set to zero.
</p>
<p>If <code>matchedPair</code> is <code>TRUE</code> then pair-matching on the baseline data will be used in randomization providing
there are an even number of clusters. If there are an odd number of clusters then matched pairs are not generated and
an unmatched randomization is output.
</p>
<p>Either <code>sigma_m</code> or <code>spillover_interval</code> must be provided. If both are provided then
the value of <code>sigma_m</code> is overwritten
by the standard deviation implicit in the value of <code>spillover_interval</code>.
Spillover is simulated as arising from a diffusion-like process.
</p>
<p>For further details see <a href="https://edoc.unibas.ch/85228/">Multerer (2021)</a>
</p>


<h3>Value</h3>

<p>A list of class <code>"CRTsp"</code> containing the following components:
</p>

<table>
<tr>
<td style="text-align: left;">
<code>geom_full</code>
</td>
<td style="text-align: left;"> list: </td>
<td style="text-align: left;"> summary statistics describing the site
cluster assignments, and randomization </td>
</tr>
<tr>
<td style="text-align: left;">
<code>design</code>
</td>
<td style="text-align: left;"> list: </td>
<td style="text-align: left;"> values of input parameters to the design </td>
</tr>
<tr>
<td style="text-align: left;">
<code>trial</code> </td>
<td style="text-align: left;"> data frame: </td>
<td style="text-align: left;"> rows correspond to geolocated points, as follows:</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> <code>x</code> </td>
<td style="text-align: left;"> numeric vector:  x-coordinates of locations </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"> <code>y</code> </td>
<td style="text-align: left;"> numeric vector:  y-coordinates of locations </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>cluster</code> </td>
<td style="text-align: left;"> factor:  assignments to cluster of each location  </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>arm</code> </td>
<td style="text-align: left;"> factor:  assignments to <code>control</code> or <code>intervention</code> for each location </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>nearestDiscord</code> </td>
<td style="text-align: left;"> numeric vector:  signed Euclidean distance to nearest discordant location (km) </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>propensity</code> </td>
<td style="text-align: left;"> numeric vector:  propensity for each location </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>base_denom</code> </td>
<td style="text-align: left;"> numeric vector:  denominator for baseline </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>base_num</code> </td>
<td style="text-align: left;"> numeric vector:  numerator for baseline </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>denom</code> </td>
<td style="text-align: left;"> numeric vector:  denominator for the outcome </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>num</code> </td>
<td style="text-align: left;"> numeric vector:  numerator for the outcome </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;">
<code>...</code> </td>
<td style="text-align: left;"> other objects included in the input <code>"CRTsp"</code> object
or <code>data.frame</code>
</td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">{smalltrial &lt;- readdata('smalltrial.csv')
 simulation &lt;- simulateCRT(smalltrial,
  effect = 0.25,
  ICC_inp = 0.05,
  outcome0 = 0.5,
  matchedPair = FALSE,
  scale = 'proportion',
  sigma_m = 0.6,
  tol = 0.05)
 summary(simulation)
 }
</code></pre>


</div>