<div class="container">

<table style="width: 100%;"><tr>
<td>pairsRosenblatt</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plots for Graphical GOF Test via Pairwise Rosenblatt Transforms</h2>

<h3>Description</h3>

<p><code>pairsColList()</code> creates a <code>list</code> containing
information about colors for a given matrix of (approximate aka
“pseudo”) p-values.  These colors are used in
<code>pairsRosenblatt()</code> for visualizing a graphical
goodness-of-fit test based on pairwise Rosenblatt transformed data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pairsRosenblatt(cu.u, pvalueMat=pviTest(pairwiseIndepTest(cu.u)),
                method = c("scatter", "QQchisq", "QQgamma",
                           "PPchisq", "PPgamma", "none"),
                g1, g2, col = "B&amp;W.contrast",
                colList = pairsColList(pvalueMat, col=col),
                main=NULL,
                sub = gpviString(pvalueMat, name = "pp-values"),
		panel = NULL, do.qqline = TRUE,
                keyOpt = list(title="pp-value", rug.at=pvalueMat), ...)

pairsColList(P, pdiv = c(1e-04, 0.001, 0.01, 0.05, 0.1, 0.5),
             signif.P = 0.05, pmin0 = 1e-05, bucketCols = NULL,
             fgColMat = NULL, bgColMat = NULL, col = "B&amp;W.contrast",
             BWcutoff = 170,
             bg.col = c("ETHCL", "zurich", "zurich.by.fog", "baby",
                        "heat", "greenish"),
             bg.ncol.gap = floor(length(pdiv)/3),
             bg.col.bottom = NULL, bg.col.top = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cu.u</code></td>
<td>
<p><code class="reqn">(n,d,d)</code>-<code>array</code> of pairwise
Rosenblatt-transformed observations as returned by
<code>pairwiseCcop()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvalueMat</code></td>
<td>
<p><code class="reqn">(d,d)</code>-<code>matrix</code> of p-values (or pp-values).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p><code>character</code> indicating the plot method
to be used. Currently possible are:
</p>

<dl>
<dt><code>"scatter"</code></dt>
<dd>
<p>a simple scatter plot.</p>
</dd>
<dt><code>"QQchisq"</code></dt>
<dd>
<p>a Q-Q plot after a map to the
<code class="reqn">\chi^2</code> distribution.</p>
</dd>
<dt><code>"QQgamma"</code></dt>
<dd>
<p>a Q-Q plot after a map to the
gamma distribution.</p>
</dd>
<dt><code>"PPchisq"</code></dt>
<dd>
<p>a P-P plot after a map to the
<code class="reqn">\chi^2</code> distribution.</p>
</dd>
<dt><code>"PPgamma"</code></dt>
<dd>
<p>a P-P plot after a map to the
gamma distribution.</p>
</dd>
<dt><code>"none"</code></dt>
<dd>
<p>no points are plotted.</p>
</dd>
</dl>
<p>Note: These methods merely just set <code>g1</code> and <code>g2</code>
correctly; see the code for more details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g1</code></td>
<td>
<p><code>function</code> from
<code class="reqn">[0,1]^n\to[0,1]^n</code>
applied to "x" for plotting in one panel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g2</code></td>
<td>
<p><code>function</code> from
<code class="reqn">[0,1]^{n\times 2}\to[0,1]^n</code>
applied to "y" for plotting in one panel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colList</code></td>
<td>
<p><code>list</code> of colors and information as
returned by <code>pairsColList()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>title.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sub</code></td>
<td>
<p>sub-title with a smart default containing a global (p)p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>panel</code></td>
<td>
<p>a <code>panel</code> function as for <code>pairs</code>, or,
by default, <code>NULL</code>, where the panel is set as <code>points</code>
or “<code>points</code> <code class="reqn">+</code> <code>qqline</code>” if the method is
"QQ...." and <code>do.qqline</code> is true.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.qqline</code></td>
<td>
<p>if <code>method = "QQ...."</code>, specify if the plot
panels should also draw a <code>qqline()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keyOpt</code></td>
<td>
<p>argument passed to <code>.pairsCond()</code> for
options for the key.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed to <code>.pairsCond()</code>
(for <code>pairsRosenblatt()</code>)
and to <code>heat_hcl()</code> (for <code>pairsColList</code>;
used to generate the color palette), see Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>P</code></td>
<td>
<p><code class="reqn">d \times d</code> <code>matrix</code> of p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pdiv</code></td>
<td>
<p>numeric vector of strictly increasing p-values in
(0,1) that determine the “buckets” for the background
colors of <code>.pairsCond()</code> which creates the
pairs-like goodness-of-fit plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>signif.P</code></td>
<td>
<p>significance level (must be an element of <code>pdiv</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pmin0</code></td>
<td>
<p>a <code>numeric</code> indicating the lower endpoint of
the p-value buckets if <code>pmin</code> is zero.  If set to 0, the lowest
value of the p-value buckets will also be 0.
</p>
<p>Note that <code>pmin0</code> should be in (0, <code>min(pdiv)</code>) when using
<code>pairsColList()</code> for <code>.pairsCond()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bucketCols</code></td>
<td>
<p><code>vector</code> of length as <code>pdiv</code> containing the
colors for the buckets.  If not specified, either
<code>bg.col.bottom</code> and <code>bg.col.top</code> are used (if provided) or
<code>bg.col</code> (if provided).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fgColMat</code></td>
<td>
<p><code class="reqn">(d,d)</code>-<code>matrix</code> with foreground colors (the
default will be black if the background color is bright
and white if it is dark; see also <code>BWcutoff</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bgColMat</code></td>
<td>
<p><code class="reqn">(d,d)</code>-<code>matrix</code> of background colors;
do not change this unless you know what you are doing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>foreground color (defaults to "B&amp;W.contrast" which switches
black/white according to <code>BWcutoff</code>), passed to
<code>.pairsCond()</code>.  If <code>colList</code> is not specified,
this color is used to construct the points' color.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BWcutoff</code></td>
<td>
<p>number in (0, 255) for switching
foreground color if <code>col="B&amp;W.contrast"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bg.col</code></td>
<td>
<p>color scheme for the background colors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bg.ncol.gap</code></td>
<td>
<p>number of colors left out as "gap" for
color buckets below/above <code>signif.P</code> (to make
significance/non-significance more visible).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bg.col.bottom</code></td>
<td>
<p><code>vector</code> of length 3 containing a HCL
color specification. If <code>bg.col.bottom</code> is provided and
<code>bucketCols</code> is not, <code>bg.col.bottom</code> is used as the color
for the bucket of smallest p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bg.col.top</code></td>
<td>
<p><code>vector</code> of length 3 containing a HCL
color specification. If <code>bg.col.top</code> is provided and
<code>bucketCols</code> is not, <code>bg.col.top</code> is used as the color for
the bucket of largest p-values.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Extra arguments of <code>pairsRosenblatt()</code> are passed to
<code>.pairsCond()</code>, these notably may include <code>key</code>, true
by default, which draws a color key for the colors used as panel
background encoding (pseudo) p-values.
</p>
<p><code>pairsColList()</code> is basically an auxiliary function to specify
the colors used in the graphical goodness-of-fit test as
conducted by <code>pairsRosenblatt()</code>. The latter is described in
detail in Hofert and Mächler (2013).
See also <code>demo(gof_graph)</code>.
</p>


<h3>Value</h3>


<dl>
<dt>
<code>pairsRosenblatt</code>: </dt>
<dd>
<p>invisibly, the result of <code>.pairsCond()</code>.</p>
</dd>
<dt>
<code>pairsColList</code>: </dt>
<dd>
<p>a named <code>list</code> with components
</p>

<dl>
<dt><code>fgColMat</code></dt>
<dd>
<p><code>matrix</code> of foreground colors.</p>
</dd>
<dt><code>bgColMat</code></dt>
<dd>
<p><code>matrix</code> of background colors
(corresponding to <code>P</code>).</p>
</dd>
<dt><code>bucketCols</code></dt>
<dd>
<p><code>vector</code> containing the colors
corresponding to <code>pvalueBuckets</code> as described above.</p>
</dd>
<dt><code>pvalueBuckets</code></dt>
<dd>
<p><code>vector</code> containing the
endpoints of the p-value buckets.</p>
</dd>
</dl>
</dd>
</dl>
<h3>References</h3>

<p>Hofert, M. and Mächler, M. (2014)
A graphical goodness-of-fit test for dependence models in higher dimensions;
<em>Journal of Computational and Graphical Statistics</em>,
<b>23</b>(3), 700–716.  <a href="https://doi.org/10.1080/10618600.2013.812518">doi:10.1080/10618600.2013.812518</a>
</p>


<h3>See Also</h3>

<p><code>pairwiseCcop()</code> for the tools behind the scenes.
<code>demo(gof_graph)</code> for examples.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## 2-dim example {d = 2} ===============
##
## "t" Copula with 22. degrees of freedom; and (pairwise) tau = 0.5
nu &lt;- 2.2 # degrees of freedom
## Define the multivariate distribution
tCop &lt;- ellipCopula("t", param=iTau(ellipCopula("t", df=nu), tau = 0.5),
                    dim=2, df=nu)
set.seed(19)
X &lt;- qexp(rCopula(n = 400, tCop))

## H0 (wrongly): a Normal copula, with correct tau
copH0 &lt;- ellipCopula("normal", param=iTau(ellipCopula("normal"), tau = 0.5))

## create array of pairwise copH0-transformed data columns
cu.u &lt;- pairwiseCcop(pobs(X), copula = copH0)

## compute pairwise matrix of p-values and corresponding colors
pwIT &lt;- pairwiseIndepTest(cu.u, N=200) # (d,d)-matrix of test results

round(pmat &lt;- pviTest(pwIT), 3) # pick out p-values
## .286 and .077
pairsRosenblatt(cu.u, pvalueMat= pmat)



### A shortened version of   demo(gof_graph) -------------------------------

N &lt;- 32 ## too small, for "testing"; realistically, use a larger one:
if(FALSE)
N &lt;- 100

## 5d Gumbel copula ##########

n &lt;- 250 # sample size
d &lt;- 5 # dimension
family &lt;- "Gumbel" # copula family
tau &lt;- 0.5
set.seed(17)
## define and sample the copula (= H0 copula), build pseudo-observations
cop &lt;- getAcop(family)
th &lt;- cop@iTau(tau) # correct parameter value
copH0 &lt;- onacopulaL(family, list(th, 1:d)) # define H0 copula
U. &lt;- pobs(rCopula(n, cop=copH0))

## create array of pairwise copH0-transformed data columns
cu.u &lt;- pairwiseCcop(U., copula = copH0)

## compute pairwise matrix of p-values and corresponding colors
pwIT &lt;- pairwiseIndepTest(cu.u, N=N, verbose=interactive()) # (d,d)-matrix of test results
round(pmat &lt;- pviTest(pwIT), 3) # pick out p-values
## Here (with seed=1):  no significant ones, smallest = 0.0603

## Plots ---------------------

## plain (too large plot symbols here)
pairsRosenblatt(cu.u, pvalueMat=pmat, pch=".")

## with title, no subtitle
pwRoto &lt;- "Pairwise Rosenblatt transformed observations"
pairsRosenblatt(cu.u, pvalueMat=pmat, pch=".", main=pwRoto, sub=NULL)

## two-line title including expressions, and centered
title &lt;- list(paste(pwRoto, "to test"),
              substitute(italic(H[0]:C~~bold("is Gumbel with"~~tau==tau.)),
                         list(tau.=tau)))
line.main &lt;- c(4, 1.4)
pairsRosenblatt(cu.u, pvalueMat=pmat, pch=".",
                main=title, line.main=line.main, main.centered=TRUE)

## Q-Q plots -- can, in general, better detect outliers
pairsRosenblatt(cu.u, pvalueMat=pmat, method="QQchisq", cex=0.2)
</code></pre>


</div>