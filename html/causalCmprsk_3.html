<div class="container">

<table style="width: 100%;"><tr>
<td>fit.nonpar</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nonparametric estimation of ATE corresponding to the target population</h2>

<h3>Description</h3>

<p>Implements nonparametric estimation (based on the weighted Aalen-Johansen estimator) of ATE meaning that
it does not assume any model for potential outcomes.
It provides three measures of treatment effects on time-to-event outcomes:
(1) cause-specific hazard ratios which are time-dependent measures under a nonparametric model,
(2) risk-based measures such as cause-specific risk differences and cause-specific risk ratios, and
(3) restricted-mean-time differences which quantify how much time on average was lost (or gained)
due to treatment by some specified time point.
Please see our package vignette for more details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit.nonpar(
  df,
  X,
  E,
  trt.formula,
  A,
  C = NULL,
  wtype = "unadj",
  cens = 0,
  conf.level = 0.95,
  bs = FALSE,
  nbs.rep = 400,
  seed = 17,
  parallel = FALSE,
  verbose = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>a data frame that includes time-to-event <code>X</code>, type of event <code>E</code>,
a treatment indicator <code>A</code>  and covariates <code>C</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a character string specifying the name of the time-to-event variable in <code>df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>a character string specifying the name of the "event type" variable in <code>df</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trt.formula</code></td>
<td>
<p>a formula expression, of the form <code>response ~ predictors</code>.
The <code>response</code> is a binary treatment/exposure variable,
for which a logistic regression model (a  Propensity Scores model) will be fit using <code>glm</code>.
See the documentation of <code>glm</code> and <code>formula</code> for details. As an alternative to specifying <code>formula</code>,
arguments <code>A</code> and <code>C</code>, defined below, can be specified.
Either <code>formula</code> or a pair of <code>A</code> and <code>C</code> must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>a character specifying the name of the treatment/exposure variable.
It is assumed that <code>A</code> is a numeric binary indicator with 0/1 values, where <code>A</code>=1
is assumed a treatment group, and <code>A</code>=0 a control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>a vector of character strings with variable names (potential confounders)
in the logistic regression model for Propensity Scores, i.e. P(A=1|C=c).
The default value of <code>C</code> is NULL corresponding to <code>wtype</code>="unadj"
that will estimate treatment effects in the raw (observed) data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wtype</code></td>
<td>
<p>a character string variable indicating the type of weights that will define the target
population for which the ATE will be estimated.
The default is "unadj" - this will not adjust for possible
treatment selection bias and will not use propensity scores weighting. It can be used, for example,
in data from a randomized controlled trial (RCT) where there is no need for emulation of baseline randomization.
Other possible values are "stab.ATE", "ATE", "ATT", "ATC" and "overlap".
See Table 1 from Li, Morgan, and Zaslavsky (2018).
"stab.ATE" is defined as P(A=a)/P(A=a|C=c) - see Hernán et al. (2000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens</code></td>
<td>
<p>an integer value in <code>E</code> that corresponds to censoring times recorded in <code>X</code>.
By default <code>fit.nonpar</code> assumes <code>cens</code>=0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p>the confidence level that will be used in the bootstrap confidence intervals.
The default is 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bs</code></td>
<td>
<p>a logical flag indicating whether to perform bootstrap in order to obtain confidence intervals. There are no
analytical confidence intervals in <code>fit.nonpar</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbs.rep</code></td>
<td>
<p>number of bootstrap replications</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>the random seed for the bootstrap, in order to make the results reproducible</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>a logical flag indicating whether to perform bootstrap sequentially or in parallel,
using several cores simultaneously. The default value is FALSE. In parallel execution, the number
of available cores is detected, and the parallel jobs are assigned to the number of
detected available cores minus one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical flag indicating whether to show a progress of bootstrap.
The progress bar is shown only for sequential bootstrap computation.
The default value is FALSE.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of class <code>cmprsk</code> with the following fields:
</p>

<table>
<tr>
<td style="text-align: left;">
<code>time</code>  </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;"> a vector of time points for which all the parameters are estimated </td>
</tr>
<tr>
<td style="text-align: left;">
<code>trt.0</code> </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;"> a list of estimates of the absolute counterfactual parameters
corresponding to <code>A</code>=0 and the type of event <code>E</code>. <code>trt.0</code> has the number of
 fields as the number of different types of events in the data set.
For each type of event there is a list of estimates:  </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<ul>
<li>
<p><code>CumHaz</code> a vector of cumulative hazard estimates
</p>
</li>
<li>
<p><code>CIF</code> a vector of cumulative incidence functions (CIF)
</p>
</li>
<li>
<p><code>RMT</code> a vector of restricted mean time (RMT) estimates
</p>
</li>
<li>
<p><code>CumHaz.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for cumulative hazard estimates
</p>
</li>
<li>
<p><code>CumHaz.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for cumulative hazard estimates
</p>
</li>
<li>
<p><code>CumHaz.SE</code> a vector of the bootstrap-based estimated standard errors
of cumulative hazard estimates
</p>
</li>
<li>
<p><code>CIF.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for CIF estimates
</p>
</li>
<li>
<p><code>CIF.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for CIF estimates
</p>
</li>
<li>
<p><code>CIF.SE</code> a vector of bootstrap-based estimated standard error
of CIF estimates
</p>
</li>
<li>
<p><code>RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for RMT estimates
</p>
</li>
<li>
<p><code>RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for RMT estimates
</p>
</li>
<li>
<p><code>RMT.SE</code> a vector of the bootstrap-based estimated standard errors
of RMT estimates
</p>
</li>
<li>
<p><code>bs.CumHaz</code> a matrix of dimension <code>nbs.rep</code> by the length of <code>time</code> vector,
with cumulative hazard estimates for <code>nbs.rep</code> bootstrap samples
</p>
</li>
</ul>
<table>
<tr>
<td style="text-align: left;">
<code>trt.1</code> </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;"> a list of estimates of the absolute counterfactual parameters
corresponding to <code>A</code>=1 and the type of event <code>E</code>. <code>trt.1</code> has the number of
 fields as the number of different types of events  in the data set.
For each type of event there is a list of estimates:  </td>
</tr>
<tr>
<td style="text-align: left;"> </td>
</tr>
</table>
<ul>
<li>
<p><code>CumHaz</code> a vector of cumulative hazard estimates
</p>
</li>
<li>
<p><code>CIF</code> a vector of cumulative incidence functions
</p>
</li>
<li>
<p><code>RMT</code> a vector of restricted mean time estimates
</p>
</li>
<li>
<p><code>CumHaz.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for cumulative hazard estimates
</p>
</li>
<li>
<p><code>CumHaz.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for cumulative hazard estimates
</p>
</li>
<li>
<p><code>CumHaz.SE</code> a vector of the bootstrap-based estimated standard errors
of cumulative hazard estimates
</p>
</li>
<li>
<p><code>CIF.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for CIF estimates
</p>
</li>
<li>
<p><code>CIF.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for CIF estimates
</p>
</li>
<li>
<p><code>CIF.SE</code> a vector of bootstrap-based estimated standard error
for CIF estimates
</p>
</li>
<li>
<p><code>RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for RMT estimates
</p>
</li>
<li>
<p><code>RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for RMT estimates
</p>
</li>
<li>
<p><code>RMT.SE</code> a vector of the bootstrap-based estimated standard errors
of the RMT estimates
</p>
</li>
<li>
<p><code>bs.CumHaz</code> a matrix of dimension <code>nbs.rep</code> by the length of <code>time</code> vector,
with cumulative hazard estimates for <code>nbs.rep</code> bootstrap samples
</p>
</li>
</ul>
<table>
<tr>
<td style="text-align: left;">
<code>trt.eff</code> </td>
<td style="text-align: left;"> </td>
</tr>
<tr>
<td style="text-align: left;"> a list of estimates of the treatment effect measures
corresponding to the type of event <code>E</code>. <code>trt.eff</code> has the number of
 fields as the number of different types of events  in the data set.
For each type of event there is a list of estimates: </td>
</tr>
</table>
<ul>
<li>
<p><code>log.CumHazR</code> a vector of the log of the time-varying ratio of hazards in two treatment arms
</p>
</li>
<li>
<p><code>RD</code> a vector of time-varying Risk Difference between two treatment arms
</p>
</li>
<li>
<p><code>RR</code> a vector of time-varying Risk Ratio between two treatment arms
</p>
</li>
<li>
<p><code>ATE.RMT</code> a vector of the time-varying Restricted Mean Time Difference
between two treatment arms
</p>
</li>
<li>
<p><code>log.CumHazR.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of <code>log.CumHazR</code>
</p>
</li>
<li>
<p><code>log.CumHazR.CI.U</code> a vector of bootstrap-based quantile estimates of the
upper confidence limits of <code>log.CumHazR</code>
</p>
</li>
<li>
<p><code>log.CumHazR.SE</code> a vector of bootstrap-based estimated standard errors
of <code>log.CumHazR</code>
</p>
</li>
<li>
<p><code>RD.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of the Risk Difference estimates
</p>
</li>
<li>
<p><code>RD.CI.U</code> a vector of bootstrap-based quantile estimate of the
upper confidence limits of the Risk Difference estimates
</p>
</li>
<li>
<p><code>RD.SE</code> a vector of the bootstrap-based estimated standard errors
of the Risk Difference
</p>
</li>
<li>
<p><code>RR.CI.L</code> a vector of bootstrap-based quantile estimates of the
lower confidence limits of the Risk Ratio estimates
</p>
</li>
<li>
<p><code>RR.CI.U</code> a vector of bootstrap-based quantile estimate of the
upper confidence limits of the Risk Ratio estimates
</p>
</li>
<li>
<p><code>RR.SE</code> a vector of the bootstrap-based estimated standard errors
of the Risk Ratio
</p>
</li>
<li>
<p><code>ATE.RMT.CI.L</code> a vector of bootstrap-based quantile estimate of
lower confidence limits for the RMT difference estimates
</p>
</li>
<li>
<p><code>ATE.RMT.CI.U</code> a vector of bootstrap-based quantile estimate of
upper confidence limits for the RMT difference estimates
</p>
</li>
<li>
<p><code>ATE.RMT.SE</code> a vector of bootstrap-based estimated standard errors
of the RMT difference estimates
</p>
</li>
</ul>
<h3>References</h3>

<p>F. Li, K.L. Morgan, and A.M. Zaslavsky. 2018. Balancing Covariates via Propensity Score Weighting. Journal of the American Statistical Association 113 (521): 390–400.
</p>
<p>M.A. Hernán, B. Brumback, and J.M. Robins. 2000. Marginal structural models and to estimate the causal effect of zidovudine on the survival of HIV-positive men. Epidemiology, 11 (5): 561-570.
</p>


<h3>See Also</h3>

<p><code>fit.cox</code>, <code>get.pointEst</code>, <code>causalCmprsk</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># create a data set
n &lt;- 1000
set.seed(7)
c1 &lt;-  runif(n)
c2 &lt;- as.numeric(runif(n)&lt; 0.2)
set.seed(77)
cf.m.T1 &lt;- rweibull(n, shape=1, scale=exp(-(-1 + 2*c1)))
cf.m.T2 &lt;-  rweibull(n, shape=1, scale=exp(-(1 + 1*c2)))
cf.m.T &lt;- pmin( cf.m.T1, cf.m.T2)
cf.m.E &lt;- rep(0, n)
cf.m.E[cf.m.T1&lt;=cf.m.T2] &lt;- 1
cf.m.E[cf.m.T2&lt;cf.m.T1] &lt;- 2
set.seed(77)
cf.s.T1 &lt;- rweibull(n, shape=1, scale=exp(-1*c1 ))
cf.s.T2 &lt;-  rweibull(n, shape=1, scale=exp(-2*c2))
cf.s.T &lt;- pmin( cf.s.T1, cf.s.T2)
cf.s.E &lt;- rep(0, n)
cf.s.E[cf.s.T1&lt;=cf.s.T2] &lt;- 1
cf.s.E[cf.s.T2&lt;cf.s.T1] &lt;- 2
exp.z &lt;- exp(0.5 + 1*c1 - 1*c2)
pr &lt;- exp.z/(1+exp.z)
TRT &lt;- ifelse(runif(n)&lt; pr, 1, 0)
X &lt;- ifelse(TRT==1, cf.m.T, cf.s.T)
E &lt;- ifelse(TRT==1, cf.m.E, cf.s.E)
covs.names &lt;- c("c1", "c2")
data &lt;- data.frame(X=X, E=E, TRT=TRT, c1=c1, c2=c2)
form.txt &lt;- paste0("TRT", " ~ ", paste0(covs.names, collapse = "+"))
trt.formula &lt;- as.formula(form.txt)
wei &lt;- get.weights(formula=trt.formula, data=data, wtype = "overlap")
hist(wei$ps[data$TRT==1], col="red", breaks = seq(0,1,0.05))
hist(wei$ps[data$TRT==0], col="blue", breaks = seq(0,1,0.05))
# Nonparametric estimation:
res.ATE &lt;- fit.nonpar(df=data, X="X", E="E", trt.formula=trt.formula, wtype="stab.ATE")
nonpar.pe &lt;- get.pointEst(res.ATE, 0.5)
nonpar.pe$trt.eff[[1]]$RD

# please see our package vignette for practical examples

</code></pre>


</div>