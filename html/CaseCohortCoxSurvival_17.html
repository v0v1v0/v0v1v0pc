<div class="container">

<table style="width: 100%;"><tr>
<td>estimation.weights.phase3</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>estimation.weights.phase3</h2>

<h3>Description</h3>

<p>Estimates the weights for the third phase of sampling (due to missingness in phase two).
</p>


<h3>Usage</h3>

<pre><code class="language-R">estimation.weights.phase3(B.phase3, total.phase2, gamma0 = NULL, niter.max = NULL,
epsilon.stop = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>B.phase3</code></td>
<td>
<p>matrix for the case-cohort (phase-three data), with phase-three
sampling strata indicators. It should have as many columns as phase-three strata
(<code class="reqn">J^{(3)}</code>), with one 1 per row, to indicate the phase-three stratum position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>total.phase2</code></td>
<td>
<p>vector of length <code class="reqn">J^{(3)}</code> with un-weighted column totals
for <code>B</code> in the phase-two data (i.e.,
using all the individuals, even the ones with missing covariate data).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma0</code></td>
<td>
<p>vector of length <code class="reqn">J^{(3)}</code> with initial values for <code class="reqn">\gamma</code>
(Lagrangian multipliers), to be used as seed in the iterative procedure. Default
is (0,...,0).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter.max</code></td>
<td>
<p>maximum number of iterations for the iterative optimization
algorithm. Default is <code>10^4</code> iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon.stop</code></td>
<td>
<p>threshold for the difference between the estimated weighted
total and the total in the whole cohort. If this difference is less than the
value of <code>epsilon.stop</code>, no more iterations will be performed. Default is <code>10^(-10)</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>estimation.weights.phase3</code> estimates the phase-three sampling weights by solving in
<code class="reqn">\gamma</code>
</p>
<p style="text-align: center;"><code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \lbrace \xi_{i,j} V_{i,j}
      \text{exp}( \gamma' B_{i,j}) B_{i,j} - \xi_{i,j} B_{i,j} \rbrace = 0,</code>
</p>

<p>with <code class="reqn">\xi_{i,j}</code> the phase-two sampling indicator and <code class="reqn">V_{i,j}</code> the phase-three
sampling indicator of individual <code class="reqn">i</code> in stratum <code class="reqn">j</code>, and with
<code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \xi_{i,j} B_{i,j}</code> the total in the
phase-two data. See Etievant and Gail (2024).
The Newton Raphson method is used to solve the optimization problem.
</p>
<p>In the end, the estimated weights are given by <code class="reqn">\text{exp}(\hat \gamma' B_{i,j})</code>,
and <code class="reqn">\sum_{j=1}^J \sum_{i=1}^{n^{(j)}} \xi_{i,j} V_{i,j} \text{exp}(\hat \gamma' B_{i,j}) B_{i,j}</code>
gives the estimated total.
</p>


<h3>Value</h3>

<p><code>gamma.hat</code>: vector of length <code class="reqn">J^{(3)}</code> with final gamma values.
</p>
<p><code>estimated.weights</code>: vector with the estimated phase-three weights for the
individuals in the case-cohort (phase-three data), computed from <code>B.phase3</code>
and <code>gamma.hat</code>.
</p>
<p><code>estimated.total</code>: vector with the estimated totals, computed from the
<code>estimated.weights</code> and <code>B.phase3</code>.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code>influences.missingdata</code>, <code>influences.RH.missingdata</code>,<code>influences.CumBH.missingdata</code> and <code>influences.PR.missingdata</code>.</p>


<h3>Examples</h3>

<pre><code class="language-R">
  data(dataexample.missingdata.stratified, package="CaseCohortCoxSurvival")

  cohort &lt;- dataexample.missingdata.stratified$cohort
  phase2 &lt;- cohort[which(cohort$phase2 == 1),] # the phase-two sample
  casecohort &lt;- cohort[which(cohort$phase3 == 1),] # the stratified case-cohort

  B.phase2 &lt;- cbind(1 * (phase2$W3 == 0), 1 * (phase2$W3 == 1))
  rownames(B.phase2) &lt;- cohort[cohort$phase2 == 1, "id"]
  B.phase3 &lt;- cbind(1 * (casecohort$W3 == 0), 1 * (casecohort$W3 == 1))
  rownames(B.phase3) &lt;- cohort[cohort$phase3 == 1, "id"]
  total.B.phase2 &lt;- colSums(B.phase2)
  J3 &lt;- ncol(B.phase3)

  estimation.weights.p3 &lt;- estimation.weights.phase3(B.phase3 = B.phase3,
                                                  total.phase2 = total.B.phase2,
                                                  gamma0 = rep(0, J3),
                                                  niter.max = 10^(4),
                                                  epsilon.stop = 10^(-10))
</code></pre>


</div>