<div class="container">

<table style="width: 100%;"><tr>
<td>filterData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Filter a dataset based on specified filters.</h2>

<h3>Description</h3>

<p>A dataset can be filtered:
</p>

<ul>
<li>
<p> on a specific <code>value</code> of interest
</p>
</li>
<li>
<p> on a function of a variable (<code>valueFct</code> parameter), 
e.g. maximum of the variable)
</p>
</li>
<li>
<p> to retain only non missing values of a variable (<code>keepNA</code> 
set to <code>FALSE</code>)
</p>
</li>
<li>
<p> by groups (<code>varsBy</code> parameter)
</p>
</li>
</ul>
<p><strong>Note that by default, missing values in the filtering variable are retained
(which differs from the default behaviour in R).</strong>
To filter missing records, please set the <code>keepNA</code> parameter to <code>FALSE</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">filterData(
  data,
  filters,
  keepNA = TRUE,
  returnAll = FALSE,
  verbose = FALSE,
  labelVars = NULL,
  labelData = "data"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data.frame with data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filters</code></td>
<td>
<p>Unique filter or list of filters.<br>
Each filter is a list containing:
</p>

<ul>
<li>
<p> 'var': String with variable from <code>data</code> to filter on.
</p>
</li>
<li>
<p> 'value': (optional) Character vector with values from <code>var</code> 
<strong>to consider/keep</strong>.
</p>
</li>
<li>
<p> 'valueFct': (optional) Function (or string with this function)
to be applied on <code>var</code> to extract value to consider.<br>
For example, <code>valueFct = max</code> will extract the records
with the maximum value of the variable.
</p>
</li>
<li>
<p> 'op': (optional) String with operator used to retain records 
from <code>value</code>.
If not specified, the inclusion operator: '%in%' is considered, so
records with <code>var</code> in <code>value</code> are retained.
</p>
</li>
<li>
<p> 'rev': (optional) Logical, if TRUE (FALSE by default), 
filtering condition based on <code>value</code>/<code>valueFct</code> is reversed.
</p>
</li>
<li>
<p> 'keepNA': (optional) Logical, if TRUE (by default), 
missing values in <code>var</code> are retained.<br>
If not specified, <code>keepNA</code> general parameter is used.
</p>
</li>
<li>
<p> 'varsBy': (optional) Character vector with variables in 
<code>data</code> containing groups to filter by
</p>
</li>
<li>
<p> 'postFct': (optional) Function (or string with this function) with
post-processing applied on the results of the filtering criteria 
(TRUE/FALSE for each record). This function should return TRUE/FALSE
(for each record or for all considered records).<br>
For example, '<code>postFct = any, varsBy = "group"</code>' retains all groups
which contain at least one record that fulfills the criteria.
</p>
</li>
<li>
<p> 'varNew': (optional) String with name of a new variable containing
the results of the filtering criteria (as TRUE/FALSE).
</p>
</li>
<li>
<p> 'labelNew': (optional) String with label for the <code>varNew</code> variable.
</p>
</li>
</ul>
<p>If a list of filters is specified, the different filters are <strong>independently
executed on the entire dataset to identify the records to retain for
each filtering condition.</strong><br>
The resulting selections are combined 
with a <code>Logic</code> operator ('&amp;' by default, i.e. 'AND' condition).
A custom logic operator can be specified between the lists describing the filter, 
for example:<br><code>list(list(var = "SEX", value = "F"), "&amp;", 
list(var = "COUNTRY", value = "DEU"))</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keepNA</code></td>
<td>
<p>Logical, if TRUE (by default) missing values in <code>var</code> are retained.
If set to FALSE, missing values are ignored for all filters.
The specification within <code>filters</code> prevails on this parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnAll</code></td>
<td>
<p>Logical:
</p>

<ul>
<li>
<p> if FALSE (by default): the <code>data</code> for only the filtered records
is returned.
</p>
</li>
<li>
<p> if TRUE: the full <code>data</code> is returned. 
Records are flagged based on the <code>filters</code> condition, in a new column:
<code>varNew</code> (if specified), or 'keep' otherwise; containing TRUE
if the record fulfill all conditions, FALSE otherwise
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical, if TRUE (FALSE by default) progress messages are printed
in the current console.
For the visualizations, progress messages during download
of subject-specific report are displayed in the browser console.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelVars</code></td>
<td>
<p>Named character vector containing variable labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labelData</code></td>
<td>
<p>(optional) String with label for input <code>data</code>,
that will be included in progress messages.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>If <code>returnAll</code>
</p>

<ul>
<li>
<p> is <code>FALSE</code>: <code>data</code> filtered with the specified filters
</p>
</li>
<li>
<p> is <code>TRUE</code>: <code>data</code> with the additional column: <code>keep</code> 
or <code>varNew</code> (if specified), containing <code>TRUE</code> for records 
which fulfill the specified condition(s) and <code>FALSE</code> otherwise.
</p>
</li>
</ul>
<p>The output contains the additional attribute: <code>msg</code> which contains a message
describing the filtered records.
</p>


<h3>Author(s)</h3>

<p>Laure Cougnaud
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(clinUtils)

data(dataADaMCDISCP01)
labelVars &lt;- attr(dataADaMCDISCP01, "labelVars")

dataDM &lt;- dataADaMCDISCP01$ADSL

## single filter

# filter with inclusion criteria:
filterData(
	data = dataDM, 
	filters = list(var = "SEX", value = "M"),
	# optional
	labelVars = labelVars, verbose = TRUE
)

# filter with non-inclusion criteria
filterData(
	data = dataDM, 
	filters = list(var = "SEX", value = "M", rev = TRUE), 
	# optional
	labelVars = labelVars, verbose = TRUE
)

# filter based on inequality operator
filterData(
	data = dataDM, 
	filters = list(var = "AGE", value = 75, op = "&lt;="), 
	# optional
	labelVars = labelVars, verbose = TRUE
)

# missing values are retained by default!
dataDMNA &lt;- dataDM
dataDMNA[1 : 2, "AGE"] &lt;- NA
filterData(
	data = dataDMNA, 
	filters = list(var = "AGE", value = 75, op = "&lt;="), 
	# optional
	labelVars = labelVars, verbose = TRUE
)

# filter missing values on variable
filterData(
	data = dataDMNA, 
	filters = list(var = "AGE", value = 75, op = "&lt;=", keepNA = FALSE), 
	# optional
	labelVars = labelVars, verbose = TRUE
)

# retain only missing values
filterData(
	data = dataDMNA, 
	filters = list(var = "AGE", value = NA, keepNA = TRUE), 
	# optional
	labelVars = labelVars, verbose = TRUE
)

# filter missing values
filterData(
	data = dataDMNA, 
	filters = list(var = "AGE", keepNA = FALSE), 
	# optional
	labelVars = labelVars, verbose = TRUE
)


## multiple filters

# by default the records fulfilling all conditions are retained ('AND')
filterData(
	data = dataDM, 
	filters = list(
		list(var = "AGE", value = 75, op = "&lt;="),
		list(var = "SEX", value = "M")
	), 
	# optional
	labelVars = labelVars, verbose = TRUE
)

# custom operator:
filterData(
	data = dataDM, 
	filters = list(
		list(var = "AGE", value = 75, op = "&lt;="),
		"|",
		list(var = "SEX", value = "M")
	), 
	# optional
	labelVars = labelVars, verbose = TRUE
)

# filter by group

# only retain adverse event records with worst-case severity
dataAE &lt;- dataADaMCDISCP01$ADAE
dataAE$AESEV &lt;- factor(dataAE$AESEV, levels = c("MILD", "MODERATE", "SEVERE"))
dataAE$AESEVN &lt;- as.numeric(dataAE$AESEV)
nrow(dataAE)
dataAEWorst &lt;- filterData(
	data = dataAE,
	filters = list(
		var = "AESEVN",		
		valueFct = max,
		varsBy = c("USUBJID", "AEDECOD"),
		keepNA = FALSE
	),
	# optional
	labelVars = labelVars, verbose = TRUE
)
nrow(dataAEWorst)

# post-processing function
# keep subjects with at least one severe AE:
dataSubjectWithSevereAE &lt;- filterData(
  data = dataAE,
  filters = list(
    var = "AESEV",		
    value = "SEVERE",
    varsBy = "USUBJID",
    postFct = any
  ),
  # optional
  labelVars = labelVars, verbose = TRUE
)

# for each laboratory parameter: keep only subjects which have at least one
# measurement classified as low or high
dataLB &lt;- subset(dataADaMCDISCP01$ADLBC, !grepl("change", PARAM))
dataLBFiltered &lt;- filterData(
  data = dataLB,
  filters = list(
    var = "LBNRIND",		
    value = c("LOW", "HIGH"),
    varsBy = c("PARAMCD", "USUBJID"),
    postFct = any
  ),
  # optional
  labelVars = labelVars, verbose = TRUE
)
</code></pre>


</div>