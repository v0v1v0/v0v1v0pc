<div class="container">

<table style="width: 100%;"><tr>
<td>cj</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simple Conjoint Analyses and Visualization</h2>

<h3>Description</h3>

<p>Simple analyses of conjoint (factorial) experiments and visualization of results.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cj(
  data,
  formula,
  id = ~0,
  weights = NULL,
  estimate = c("amce", "frequencies", "mm", "amce_differences", "mm_differences"),
  feature_order = NULL,
  feature_labels = NULL,
  level_order = c("ascending", "descending"),
  by = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame containing variables specified in <code>formula</code>. All RHS variables should be factors; the base level for each will be used in estimation and for AMCEs the base level's AMCE will be zero. Optionally, this can instead be an object of class “survey.design” returned by <code>svydesign</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula specifying a model to be estimated. ; all levels across features should be unique. For <code>estimate = "amce"</code> in a constrained conjoint design, two-way interactions can be specified to handle constraints between factors in the design. These are detected automatically. Higher-order constraints are not allowed and interactions are ignored for all other values of <code>estimate</code> as constraints are irrelevant to those statistics.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>An RHS formula specifying a variable holding respondent identifiers, to be used for clustering standard errors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>An (optional) RHS formula specifying a variable holding survey weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimate</code></td>
<td>
<p>A character string specifying an estimate type. Current options are average marginal component effects (or AMCEs, “amce”, estimated via <code>amce</code>), display frequencies (“frequncies”, estimated via <code>cj_freqs</code>), marginal means (or AMMs, “mm”, estimated via <code>mm</code>), differences in MMs (“mm_differences”, via <code>mm_diffs</code>), or differences in AMCEs (“amce_differences”, via <code>amce_diffs</code>). Additional options may be made available in the future. Non-ambiguous abbreviations are allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_order</code></td>
<td>
<p>An (optional) character vector specifying the names of feature (RHS) variables in the order they should be encoded in the resulting data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature_labels</code></td>
<td>
<p>A named list of “fancy” feature labels to be used in output. By default, the function looks for a “label” attribute on each variable in <code>formula</code> and uses that for pretty printing. This argument overrides those attributes or otherwise provides fancy labels for this purpose. This should be a list with names equal to variables on the righthand side of <code>formula</code> and character string values; arguments passed here override variable attributes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level_order</code></td>
<td>
<p>A character string specifying levels (within each feature) should be ordered increasing or decreasing in the final output. This is mostly only consequential for plotting via <code>plot.cj_mm</code>, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>A formula containing only RHS variables, specifying grouping factors over which to perform estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to <code>amce</code>, <code>cj_freqs</code>, <code>mm</code>, <code>mm_diffs</code>, or <code>amce_diffs</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The main function <code>cj</code> is a convenience function wrapper around the underlying estimation functions that provide for average marginal component effects (AMCEs), by default, via the <code>amce</code> function, marginal means (MMs) via the <code>mm</code> function, and display frequencies via <code>cj_freqs</code> and <code>cj_props</code>. Additional estimands may be supported in the future through their own functions and through the <code>cj</code> interface. Plotting is provided via ggplot2 for all types of estimates.
</p>
<p>The only additional functionality provided by <code>cj</code> over the underlying functions is the <code>by</code> argument, which will perform operations on subsets of <code>data</code>, returning a single data frame. This can be useful, for example, for evaluating profile spillover effects and subgroup results, or in any situation where one might be inclined to use a <code>for</code> loop or <code>lapply</code>, calling <code>cj</code> repeatedly on subgroups.
</p>
<p>Note: Some features of cregg (namely, the <code>amce_diffs</code>) function, or <code>estimate = "amce_diff"</code> here) only work with full factorial conjoint experiments. Designs involving two-way constraints between features are supported simply by expressing interactions between constrained terms in <code>formula</code> (again, except for <code>amce_diffs</code>). Higher-order constraints may be supported in the future.
</p>


<h3>Value</h3>

<p>A data frame with special class to facilitate plotting (e.g., “cj_amce”, “cj_mm”, etc.)
</p>


<h3>Author(s)</h3>

<p>Thomas J. Leeper &lt;thosjleeper@gmail.com&gt;
</p>


<h3>See Also</h3>

<p>Functions: <code>amce</code>, <code>mm</code>, <code>cj_freqs</code>, <code>mm_diffs</code>, <code>plot.cj_amce</code>, <code>cj_tidy</code>
Data: <code>immigration</code>, <code>taxes</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# load data
requireNamespace("ggplot2")
data("immigration")
immigration$contest_no &lt;- factor(immigration$contest_no)
data("taxes")

# calculate MMs
f1 &lt;- ChosenImmigrant ~ Gender + Education + 
         LanguageSkills + CountryOfOrigin + Job + JobExperience + 
         JobPlans + ReasonForApplication + PriorEntry
d1 &lt;- cj(immigration, f1, id = ~ CaseID, estimate = "mm", h0 = 0.5)
# plot MMs
plot(d1, vline = 0.5)

# calculate MMs for survey-weighted data
d1 &lt;- cj(taxes, chose_plan ~ taxrate1 + taxrate2 + taxrate3 +
         taxrate4 + taxrate5 + taxrate6 + taxrev, id = ~ ID,
         weights = ~ weight, estimate = "mm", h0 = 0.5)
# plot MMs
plot(d1, vline = 0.5)

# MMs split by profile number
stacked &lt;- cj(immigration, f1, id = ~ CaseID,
              estimate = "mm", by = ~ contest_no)

## plot with grouping
plot(stacked, group = "contest_no", vline = 0.5, feature_headers = FALSE)

## plot with facetting
plot(stacked) + ggplot2::facet_wrap(~ contest_no, nrow = 1L)

# estimate AMCEs
d2 &lt;- cj(immigration, f1, id = ~ CaseID)

# plot AMCEs
plot(d2)

## subgroup analysis
immigration$ethnosplit &lt;- cut(immigration$ethnocentrism, 2)
x &lt;- cj(na.omit(immigration), ChosenImmigrant ~ Gender + Education + LanguageSkills,
        id = ~ CaseID, estimate = "mm", h0 = 0.5, by = ~ ethnosplit)
plot(x, group = "ethnosplit", vline = 0.5)

# combinations of/interactions between features
immigration$language_entry &lt;- 
  interaction(immigration$LanguageSkills, immigration$PriorEntry, sep = "_")

## higher-order MMs for feature combinations
cj(immigration, ChosenImmigrant ~ language_entry,
   id = ~CaseID, estimate = "mm", h0 = 0.5)

## constrained designs
## in a constrained design, some cells are unobserved:
subset(cj_props(immigration, ~ Job + Education), Proportion == 0)
## MMs and AMCEs only use data from observed cells
## In `immigraation`, this means while the MM for `Job == "Janitor"` is an average 
## across all levels of Education:
mm(subset(immigration, Job == "Janitor"), ChosenImmigrant ~ Education)
## the MM for `Job == "Doctor"` is an average across only 3 levels of education:
mm(subset(immigration, Job == "Doctor"), ChosenImmigrant ~ Education)
## Use `cj_props()` to see constraints:
subset(cj_props(immigration, ~ Job + Education), Job == "Doctor" &amp; Proportion != 0)

## Substantively, the MM of "Doctor" might be higher than other levels of `Job`
## this could be due to the feature itself or due to the fact that it is constrained
## with a different subset of other feature levels than alternative levels of `Job`
## this may mean analysts want to report MMs (or AMCEs) only for the unconstrained levels:
elev &lt;- c("Two-Year College", "College Degree", "Graduate Degree")
jlev &lt;- c("Financial Analyst", "Computer Programmer", "Research Scientist", "Doctor")
mm(subset(immigration, Education %in% elev), ChosenImmigrant ~ Job)
mm(subset(immigration, Job %in% jlev), ChosenImmigrant ~ Education)
## or, present estimates excluding constrained levels:
mm(subset(immigration, !Education %in% elev), ChosenImmigrant ~ Job)
mm(subset(immigration, !Job %in% jlev), ChosenImmigrant ~ Education)

</code></pre>


</div>