<div class="container">

<table style="width: 100%;"><tr>
<td>product.covar.weight</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>product.covar.weight</h2>

<h3>Description</h3>

<p>Computes the product of joint design weights and joint sampling indicators
covariances, needed for the phase-two component of the variance (with design or
calibrated weights).
</p>


<h3>Usage</h3>

<pre><code class="language-R">product.covar.weight(casecohort, stratified = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>casecohort</code></td>
<td>
<p>if <code>stratified = TRUE</code>, data frame with <code>status</code> (case
status), <code>W</code> (the <code class="reqn">J</code> strata), <code>strata.m</code> (vector of length <code class="reqn">J</code> with the
numbers of sampled individuals in the strata) and <code>strata.n</code> (vector of length
<code class="reqn">J</code> with the strata sizes), for each individual in the stratified case-cohort
data. If <code>stratified = FALSE</code>, data frame with <code>status</code> (case status),
<code>m</code> (number of sampled individuals) and <code>n</code> (cohort size), for each
individual in the un-stratified case-cohort data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratified</code></td>
<td>
<p>was the sampling of the case-cohort stratified on <code>W</code>?
Default is <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>product.covar.weight</code> creates the matrix with the products of joint design
weights and joint sampling indicator covariances, for the non-cases in the case
cohort. In other words, it has as many rows and columns as non-cases in the case
cohort, and contains the <code class="reqn">w_{i,k,j} \sigma_{i,k,j}</code>, with
</p>
<p><code class="reqn">w_{i,k,j} = \frac{n^{(j)}(n^{(j)} -1)}{m^{(j)}(m^{(j)} -1)}</code> if individuals
<code class="reqn">i</code> and <code class="reqn">k</code> in stratum <code class="reqn">j</code> are both non-cases, and
<code class="reqn">w_{i,k,j} = \left( \frac{n^{(j)}}{m^{(j)}} \right)^2</code> otherwise,
<code class="reqn">i \neq k \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p><code class="reqn">w_{i,i,j} = \frac{n^{(j)}}{m^{(j)}}</code> if individuals <code class="reqn">i</code> in stratum <code class="reqn">j</code>
is a non-case, <code class="reqn">i \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p><code class="reqn">\sigma_{i,k,j} = \frac{m^{(j)}(m^{(j)} -1)}{n^{(j)}(n^{(j)} -1)} -
    \left( \frac{m^{(j)}}{n^{(j)}} \right)^2</code> if individuals <code class="reqn">i</code> and
<code class="reqn">k</code> in stratum <code class="reqn">j</code> are both non-cases,
<code class="reqn">i \neq k \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p><code class="reqn">\sigma_{i,i,j} = \frac{m^{(j)}}{n^{(j)}} - \left(1 - \frac{m^{(j)}}{n^{(j)}} \right)</code>
if individuals <code class="reqn">i</code> in stratum <code class="reqn">j</code> is a non-case,
<code class="reqn">i \in \lbrace 1, \dots, n^{(j)} \rbrace</code>,
<code class="reqn">j \in \lbrace 1, \dots, J \rbrace</code>.
</p>
<p>See Etievant and Gail (2024).
</p>


<h3>Value</h3>

<p><code>product.covar.weight</code>: matrix with the products of joint design weights and
joint sampling indicator covariances, for the non-cases in the case-cohort.
</p>


<h3>References</h3>

<p>Etievant, L., Gail, M. H. (2024). Cox model inference for relative hazard and pure risk from stratified weight-calibrated case-cohort data. Lifetime Data Analysis, 30, 572-599.
</p>


<h3>See Also</h3>

<p><code>variance</code>, that uses <code>product.covar.weight</code> to compute the variance
estimate that follows the complete variance decomposition (superpopulation and
phase-two variance components).
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  data(dataexample.stratified, package="CaseCohortCoxSurvival")
  cohort &lt;- dataexample.stratified$cohort
  casecohort &lt;- cohort[which(cohort$status == 1 |
                       cohort$subcohort == 1),] # the stratified case-cohort

  prod.covar.weight &lt;- product.covar.weight(casecohort, stratified = TRUE)

  sum(casecohort$status == 0) # number of non-cases in the case-cohort

</code></pre>


</div>