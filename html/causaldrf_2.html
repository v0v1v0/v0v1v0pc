<div class="container">

<table style="width: 100%;"><tr>
<td>aipwee_est</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Prediction with a residual bias correction estimator</h2>

<h3>Description</h3>

<p>This method combines the regression estimator with a residual bias correction
for estimating a parametric ADRF.
</p>


<h3>Usage</h3>

<pre><code class="language-R">aipwee_est(Y,
           treat,
           covar_formula = ~ 1,
           covar_lin_formula = ~ 1,
           covar_sq_formula = ~ 1,
           data,
           e_treat_1 = NULL,
           e_treat_2 = NULL,
           e_treat_3 = NULL,
           e_treat_4 = NULL,
           degree = 1,
           wt = NULL,
           method = "same",
           spline_df = NULL,
           spline_const = 1,
           spline_linear = 1,
           spline_quad = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>is the the name of the outcome variable contained in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>treat</code></td>
<td>
<p>is the name of the treatment variable contained in
<code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar_formula</code></td>
<td>
<p>is the formula to describe the covariates needed
to estimate the constant term:
<code>~ X.1 + ....</code>. Can include higher order terms or interactions.  i.e.
<code>~ X.1 + I(X.1^2) + X.1 * X.2 + ....</code>.  Don't forget the tilde before
listing the covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar_lin_formula</code></td>
<td>
<p>is the formula to describe the covariates needed
to estimate the linear term, t:
<code>~ X.1 + ....</code>. Can include higher order terms or interactions.  i.e.
<code>~ X.1 + I(X.1^2) + X.1 * X.2 + ....</code>.  Don't forget the tilde before
listing the covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar_sq_formula</code></td>
<td>
<p>is the formula to describe the covariates needed
to estimate the quadratic term, t^2:
<code>~ X.1 + ....</code>. Can include higher order terms or interactions.  i.e.
<code>~ X.1 + I(X.1^2) + X.1 * X.2 + ....</code>.  Don't forget the tilde before
listing the covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>is a dataframe containing <code>Y</code>, <code>treat</code>, and
<code>X</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e_treat_1</code></td>
<td>
<p>a vector, representing the conditional expectation of
<code>treat</code> from <code>T_mod</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e_treat_2</code></td>
<td>
<p>a vector, representing the conditional expectation of
<code>treat^2</code> from <code>T_mod</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e_treat_3</code></td>
<td>
<p>a vector, representing the conditional expectation of
<code>treat^3</code> from <code>T_mod</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>e_treat_4</code></td>
<td>
<p>a vector, representing the conditional expectation of
<code>treat^4</code> from <code>T_mod</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>is 1 for linear and 2 for quadratic outcome model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wt</code></td>
<td>
<p>is weight used in lsfit for outcome regression.
Default is wt = NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>is "same" if the same set of covariates are used to estimate
the constant, linear, and/or quadratic term.  If method = "different", then
different sets of covariates can be used to estimate the constant, linear,
and/or quadratic term.  covar_lin_formula and covar_sq_formula must be specified
if method = "different".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spline_df</code></td>
<td>
<p>degrees of freedom. The default, spline_df = NULL, corresponds to no knots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spline_const</code></td>
<td>
<p>is the number of spline terms needed to estimate the constant term.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spline_linear</code></td>
<td>
<p>is the number of spline terms needed to estimate the linear term.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spline_quad</code></td>
<td>
<p>is the number of spline terms needed to estimate the quadratic term.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This estimator bears a strong
resemblance to general regression estimators in the survey
literature, part of a more general class of calibration
estimators (Deville and Sarndal, 1992). It is
doubly robust, which means that it is consistent if
either of the models is true (Scharfstein, Rotnitzky and Robins
1999).  If the Y-model is correct, then the first term in
the previous equation is unbiased for <code class="reqn">\xi</code> and the second term has mean
zero even if the T-model is wrong. If the Y-model is incorrect, the
first term is biased, but the second term gives a consistent estimate
of (minus one times) the bias from the Y-model if the T-model is
correct.
</p>
<p>This function is a doubly-robust estimator that fits an outcome regression
model with a bias correction term.  For details see Schafer and Galagate (2015).
</p>


<h3>Value</h3>

<p><code>aipwee_est</code>  returns an object of class "causaldrf_lsfit",
a list that contains the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>param</code></td>
<td>
<p>parameter estimates for a add_spl fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t_mod</code></td>
<td>
<p>the result of the treatment model fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>out_mod</code></td>
<td>
<p>the result of the outcome model fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Schafer, J.L., Galagate, D.L. (2015).  Causal inference with a
continuous treatment and outcome: alternative estimators for parametric
dose-response models. <em>Manuscript in preparation</em>.
</p>
<p>Schafer, Joseph L, Kang, Joseph (2008).  Average causal effects from
nonrandomized studies: a practical guide and simulated example.
<em>Psychological methods</em>, <b>13.4</b>, 279.
</p>
<p>Robins, James M and Rotnitzky, Andrea (1995).
Semiparametric efficiency in multivariate regression models with missing data
<em>Journal of the American Statistical Association</em>, <b>90.429</b>, 122–129.
</p>
<p>Scharfstein, Daniel O and Rotnitzky, Andrea and Robins, James M (1999).
Adjusting for nonignorable drop-out using semiparametric nonresponse models
<em>Journal of the American Statistical Association</em>, <b>94.448</b>, 1096–1120.
</p>
<p>Deville, Jean-Claude and Sarndal, Carl-Erik (1992).
Calibration estimators in survey sampling
<em>Journal of the American Statistical Association</em>, <b>87.418</b>, 376–380.
</p>


<h3>See Also</h3>

<p><code>iptw_est</code>, <code>ismw_est</code>,
<code>reg_est</code>, <code>wtrg_est</code>,
##'    etc. for other estimates.
</p>
<p><code>t_mod</code>, <code>overlap_fun</code> to prepare the <code>data</code>
for use in the different estimates.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Example from Schafer (2015).

example_data &lt;- sim_data


t_mod_list &lt;- t_mod(treat = T,
              treat_formula = T ~ B.1 + B.2 + B.3 + B.4 + B.5 + B.6 + B.7 + B.8,
              data = example_data,
              treat_mod = "Normal")

cond_exp_data &lt;- t_mod_list$T_data
full_data &lt;- cbind(example_data, cond_exp_data)

aipwee_list &lt;- aipwee_est(Y = Y,
                         treat = T,
                         covar_formula = ~ B.1 + B.2 + B.3 + B.4 + B.5 + B.6 + B.7 + B.8,
                         covar_lin_formula = ~ 1,
                         covar_sq_formula = ~ 1,
                         data = example_data,
                         e_treat_1 = full_data$est_treat,
                         e_treat_2 = full_data$est_treat_sq,
                         e_treat_3 = full_data$est_treat_cube,
                         e_treat_4 = full_data$est_treat_quartic,
                         degree = 1,
                         wt = NULL,
                         method = "same",
                         spline_df = NULL,
                         spline_const = 1,
                         spline_linear = 1,
                         spline_quad = 1)

sample_index &lt;- sample(1:1000, 100)

plot(example_data$T[sample_index],
      example_data$Y[sample_index],
      xlab = "T",
      ylab = "Y",
      main = "aipwee estimate")

abline(aipwee_list$param[1],
        aipwee_list$param[2],
        lty = 2,
        lwd = 2,
        col = "blue")

legend('bottomright',
        "aipwee estimate",
        lty = 2,
        lwd = 2,
        col = "blue",
        bty='Y',
        cex=1)

rm(example_data, t_mod_list, cond_exp_data, full_data, aipwee_list, sample_index)
</code></pre>


</div>