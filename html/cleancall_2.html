<div class="container">

<table style="width: 100%;"><tr>
<td>call_with_cleanup</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Call a native routine within an exit context</h2>

<h3>Description</h3>

<p>C functions called this way can call the <code>r_call_on_exit()</code> and/or
<code>r_call_on_early_exit()</code> functions to establish exit handlers.
</p>


<h3>Usage</h3>

<pre><code class="language-R">call_with_cleanup(ptr, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ptr</code></td>
<td>
<p>A native pointer object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments for the native routine.
</p>
<p>Handlers installed via <code>r_call_on_exit()</code> are always executed on exit.
Handlers installed via <code>r_call_on_early_exit()</code> are only executed
on early exit, i.e. <em>not</em> on normal termination.</p>
</td>
</tr>
</table>
<h3>C API</h3>


<ul>
<li> <p><code style="white-space: pre;">⁠void r_call_on_exit(void (*fn)(void* data), void *data)⁠</code>
</p>
<p>Push an exit handler to the stack. This exit handler is always
executed, i.e. both on normal and early exits.
</p>
<p>Exit handlers are executed right after the function called from
<code>call_with_cleanup()</code> exits. (Or the function used in
<code>r_with_cleanup_context()</code>, if the cleanup context was established
from C.)
</p>
<p>Exit handlers are executed in reverse order (last in is first out,
LIFO). Exit handlers pushed with <code>r_call_on_exit()</code> and
<code>r_call_on_early_exit()</code> share the same stack.
</p>
<p>Best practice is to use this function immediately after acquiring a
resource, with the appropriate cleanup function for that resource.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠void r_call_on_early_exit(void (*fn)(void* data), void *data)⁠</code>
</p>
<p>Push an exit handler to the stack. This exit handler is only
executed on early exists, <em>not</em> on normal termination.
</p>
<p>Exit handlers are executed right after the function called from
<code>call_with_cleanup()</code> exits. (Or the function used in
<code>r_with_cleanup_context()</code>, if the cleanup context was established
from C.)
</p>
<p>Exit handlers are executed in reverse order (last in is first out,
LIFO). Exit handlers pushed with <code>r_call_on_exit()</code> and
<code>r_call_on_early_exit()</code> share the same stack.
</p>
<p>Best practice is to use this function immediately after acquiring a
resource, with the appropriate cleanup function for that resource.
</p>
</li>
<li> <p><code style="white-space: pre;">⁠SEXP r_with_cleanup_context(SEXP (*fn)(void* data), void* data)⁠</code>
</p>
<p>Establish a cleanup stack and call <code>fn</code> with <code>data</code>. This function
can be used to establish a cleanup stack from C code.
</p>
</li>
</ul>
<h3>See Also</h3>

<p>The package README file.
</p>


</div>