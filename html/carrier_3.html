<div class="container">

<table style="width: 100%;"><tr>
<td>crate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Crate a function to share with another process</h2>

<h3>Description</h3>

<p><code>crate()</code> creates functions in a self-contained environment
(technically, a child of the base environment). This has two
advantages:
</p>

<ul>
<li>
<p> They can easily be executed in another process.
</p>
</li>
<li>
<p> Their effects are reproducible. You can run them locally with the
same results as on a different process.
</p>
</li>
</ul>
<p>Creating self-contained functions requires some care, see section
below.
</p>


<h3>Usage</h3>

<pre><code class="language-R">crate(.fn, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.fn</code></td>
<td>
<p>A fresh formula or function. "Fresh" here means that
they should be declared in the call to <code>crate()</code>. See examples if
you need to crate a function that is already defined. Formulas
are converted to purrr-like lambda functions using
<code>rlang::as_function()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments to declare in the environment of <code>.fn</code>. If a
name is supplied, the object is assigned to that name. Otherwise
the argument is automatically named after itself.</p>
</td>
</tr>
</table>
<h3>Creating self-contained functions</h3>


<ul>
<li>
<p> They should call package functions with an explicit <code>::</code>
namespace. This includes packages in the default search path with
the exception of the base package. For instance <code>var()</code> from the
stats package must be called with its namespace prefix:
<code>stats::var(x)</code>.
</p>
</li>
<li>
<p> They should declare any data they depend on. You can declare data
by supplying additional arguments or by unquoting objects with <code style="white-space: pre;">⁠!!⁠</code>.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R"># You can create functions using the ordinary notation:
crate(function(x) stats::var(x))

# Or the formula notation:
crate(~ stats::var(.x))

# Declare data by supplying named arguments. You can test you have
# declared all necessary data by calling your crated function:
na_rm &lt;- TRUE
fn &lt;- crate(~ stats::var(.x, na.rm = na_rm))
try(fn(1:10))

# For small data it is handy to unquote instead. Unquoting inlines
# objects inside the function. This is less verbose if your
# function depends on many small objects:
fn &lt;- crate(~ stats::var(.x, na.rm = !!na_rm))
fn(1:10)

# One downside is that the individual sizes of unquoted objects
# won't be shown in the crate printout:
fn


# The function or formula you pass to crate() should defined inside
# the crate() call, i.e. you can't pass an already defined
# function:
fn &lt;- function(x) toupper(x)
try(crate(fn))

# If you really need to crate an existing function, you can
# explicitly set its environment to the crate environment with the
# set_env() function from rlang:
crate(rlang::set_env(fn))
</code></pre>


</div>