<div class="container">

<table style="width: 100%;"><tr>
<td>sql_hive_text_parse</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Automatic production of hive SQL</h2>

<h3>Description</h3>

<p>Returns text parse of hive SQL
</p>


<h3>Usage</h3>

<pre><code class="language-R">sql_hive_text_parse(
  sql_dt,
  key_sql = NULL,
  key_table = NULL,
  key_id = NULL,
  key_where = c("dt = date_add(current_date(),-1)"),
  only_key = FALSE,
  left_id = NULL,
  left_where = c("dt = date_add(current_date(),-1)"),
  new_name = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sql_dt</code></td>
<td>
<p>The data dictionary has three columns: table, map and feature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key_sql</code></td>
<td>
<p>You can write your own SQL for the main table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key_table</code></td>
<td>
<p>Key table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key_id</code></td>
<td>
<p>Primary key id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>key_where</code></td>
<td>
<p>Key table conditions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only_key</code></td>
<td>
<p>Only key table.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>left_id</code></td>
<td>
<p>Right table's key id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>left_where</code></td>
<td>
<p>Right table conditions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new_name</code></td>
<td>
<p>A string, Rename all variables except primary key with suffix 'new_name'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other params.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Text parse of hive SQL
</p>


<h3>Examples</h3>

<pre><code class="language-R">#sql_dt:table, map and feature
sql_dt = data.frame(table = c("table_1", "table_1",  "table_1", "table_1","table_1",
                               "table_2", "table_2","table_2",
                              "table_2","table_2","table_2","table_2",
                               "table_2","table_2","table_2","table_2",
                              "table_2","table_2","table_2","table_3","table_3",
                               "table_3","table_3","table_3"), 
                   map =  c("all","all", "all","all","all","all","all","all","all","all",
                            "all", "all","all","id_card_info",
                            "id_card_info","id_card_info", "mobile_info","mobile_info",
                            "mobile_info","all", "all","all", "all","all"), 
                   feature =c( "user_id","real_name","id_card_encode","mobile_encode","dt",
                              "user_id","type_code","first_channel",
                               "second_channel","user_name","user_sex","user_birthday",
                                 "user_age","card_province","card_zone",
                               "card_city","city","province","carrier","user_id",
                              "biz_id","biz_code","apply_time","dt"))
#sample 1
sql_hive_text_parse(sql_dt = sql_dt,
          key_sql = NULL,
               key_table = "table_2",
               key_where =  c("user_sex = 'male",
                              "user_age &gt; 20"),
               only_key = FALSE,
               key_id = "user_id",
               left_id = "user_id",
               left_where = c("dt = date_add(current_date(),-1)",
                              "apply_time &gt;= '2020-05-01' "
               ), new_name ="basic"
          )

#sample 2
sql_hive_text_parse(sql_dt = subset(sql_dt),
               key_sql = "SELECT 
       user_id,
       max(apply_time) as max_apply_time
       FROM table_3
       WHERE dt = date_add(current_date(),-1)
               GROUP BY user_id",
               key_id = "user_id",
               left_id = "user_id",
               left_where = c("dt = date_add(current_date(),-1)"
                              ),
               new_name =  NULL)
</code></pre>


</div>