<div class="container">

<table style="width: 100%;"><tr>
<td>vcovCR</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cluster-robust variance-covariance matrix</h2>

<h3>Description</h3>

<p>This is a generic function, with specific methods defined for 
<code>lm</code>, <code>plm</code>, <code>glm</code>, 
<code>gls</code>, <code>lme</code>,
<code>robu</code>, <code>rma.uni</code>, and
<code>rma.mv</code> objects.
</p>
<p><code>vcovCR</code> returns a sandwich estimate of the variance-covariance matrix 
of a set of regression coefficient estimates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">vcovCR(obj, cluster, type, target, inverse_var, form, ...)

## Default S3 method:
vcovCR(
  obj,
  cluster,
  type,
  target = NULL,
  inverse_var = FALSE,
  form = "sandwich",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>Fitted model for which to calculate the variance-covariance matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>Expression or vector indicating which observations belong to 
the same cluster. For some classes, the cluster will be detected 
automatically if not specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Character string specifying which small-sample adjustment should 
be used, with available options <code>"CR0"</code>, <code>"CR1"</code>, <code>"CR1p"</code>,
<code>"CR1S"</code>, <code>"CR2"</code>, or <code>"CR3"</code>. See "Details" section of 
<code>vcovCR</code> for further information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target</code></td>
<td>
<p>Optional matrix or vector describing the working 
variance-covariance model used to calculate the <code>CR2</code> and <code>CR4</code> 
adjustment matrices. If a vector, the target matrix is assumed to be 
diagonal. If not specified, <code>vcovCR</code> will attempt to infer a value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inverse_var</code></td>
<td>
<p>Optional logical indicating whether the weights used in 
fitting the model are inverse-variance. If not specified, <code>vcovCR</code> 
will attempt to infer a value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>form</code></td>
<td>
<p>Controls the form of the returned matrix. The default 
<code>"sandwich"</code> will return the sandwich variance-covariance matrix. 
Alternately, setting <code>form = "meat"</code> will return only the meat of the 
sandwich and setting <code>form = B</code>, where <code>B</code> is a matrix of 
appropriate dimension, will return the sandwich variance-covariance matrix 
calculated using <code>B</code> as the bread. <code>form = "estfun"</code> will return the 
(appropriately scaled) estimating function, the transposed crossproduct of 
which is equal to the sandwich variance-covariance matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments available for some classes of objects.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>vcovCR</code> returns a sandwich estimate of the variance-covariance matrix 
of a set of regression coefficient estimates.
</p>
<p>Several different small sample corrections are available, which run 
parallel with the "HC" corrections for heteroskedasticity-consistent 
variance estimators, as implemented in <code>vcovHC</code>. The
"CR2" adjustment is recommended (Pustejovsky &amp; Tipton, 2017; Imbens &amp;
Kolesar, 2016). See Pustejovsky and Tipton (2017) and Cameron and Miller
(2015) for further technical details. Available options include: </p>

<dl>
<dt>"CR0"</dt>
<dd>
<p>is the original form of the sandwich estimator (Liang &amp; Zeger,
1986), which does not make any small-sample correction.</p>
</dd> 
<dt>"CR1"</dt>
<dd>
<p>multiplies CR0 by <code>m / (m - 1)</code>, where <code>m</code> is the 
number of clusters.</p>
</dd> 
<dt>"CR1p"</dt>
<dd>
<p>multiplies CR0 by <code>m / (m - p)</code>, where <code>m</code> is the 
number of clusters and <code>p</code> is the number of covariates.</p>
</dd> 
<dt>"CR1S"</dt>
<dd>
<p>multiplies CR0 by <code>(m (N-1)) / [(m - 
  1)(N - p)]</code>, where <code>m</code> is the number of clusters, <code>N</code> is the 
total number of observations, and <code>p</code> is the number of covariates. 
Some Stata commands use this correction by default.</p>
</dd> 
<dt>"CR2"</dt>
<dd>
<p>is the
"bias-reduced linearization" adjustment proposed by Bell and McCaffrey
(2002) and further developed in Pustejovsky and Tipton (2017). The
adjustment is chosen so that the variance-covariance estimator is exactly
unbiased under a user-specified working model.</p>
</dd> 
<dt>"CR3"</dt>
<dd>
<p>approximates the leave-one-cluster-out jackknife variance estimator (Bell &amp; McCaffrey,
2002).</p>
</dd> </dl>
<h3>Value</h3>

<p>An object of class <code>c("vcovCR","clubSandwich")</code>, which consists 
of a matrix of the estimated variance of and covariances between the 
regression coefficient estimates. The matrix has several attributes: 
</p>
 <dl>
<dt>type</dt>
<dd>
<p>indicates which small-sample adjustment was used</p>
</dd> 
<dt>cluster</dt>
<dd>
<p>contains the factor vector that defines independent 
clusters</p>
</dd> <dt>bread</dt>
<dd>
<p>contains the bread matrix</p>
</dd> <dt>v_scale</dt>
<dd>
<p>constant 
used in scaling the sandwich estimator</p>
</dd> <dt>est_mats</dt>
<dd>
<p>contains a list of 
estimating matrices used to calculate the sandwich estimator</p>
</dd> 
<dt>adjustments</dt>
<dd>
<p>contains a list of adjustment matrices used to calculate
the sandwich estimator</p>
</dd> <dt>target</dt>
<dd>
<p>contains the working 
variance-covariance model used to calculate the adjustment matrices. This 
is needed for calculating small-sample corrections for Wald tests.</p>
</dd> </dl>
<h3>References</h3>

<p>Bell, R. M., &amp; McCaffrey, D. F. (2002). Bias reduction in
standard errors for linear regression with multi-stage samples. Survey
Methodology, 28(2), 169-181.
</p>
<p>Cameron, A. C., &amp; Miller, D. L. (2015). A Practitioner's Guide to
Cluster-Robust Inference. <em>Journal of Human Resources, 50</em>(2), 317-372.
<a href="https://doi.org/10.3368/jhr.50.2.317">doi:10.3368/jhr.50.2.317</a>
</p>
<p>Imbens, G. W., &amp; Kolesar, M. (2016). Robust standard errors in small samples:
Some practical advice. <em>Review of Economics and Statistics, 98</em>(4),
701-712. <a href="https://doi.org/10.1162/rest_a_00552">doi:10.1162/rest_a_00552</a>
</p>
<p>Liang, K.-Y., &amp; Zeger, S. L. (1986). Longitudinal data analysis using
generalized linear models. <em>Biometrika, 73</em>(1), 13-22.
<a href="https://doi.org/10.1093/biomet/73.1.13">doi:10.1093/biomet/73.1.13</a>
</p>
<p>Pustejovsky, J. E. &amp; Tipton, E. (2018). Small sample methods for
cluster-robust variance estimation and hypothesis testing in fixed effects
models. <em>Journal of Business and Economic Statistics, 36</em>(4), 672-683.
<a href="https://doi.org/10.1080/07350015.2016.1247004">doi:10.1080/07350015.2016.1247004</a>
</p>


<h3>See Also</h3>

<p><code>vcovCR.lm</code>, <code>vcovCR.plm</code>, 
<code>vcovCR.glm</code>, <code>vcovCR.gls</code>,
<code>vcovCR.lme</code>, <code>vcovCR.lmerMod</code>, <code>vcovCR.robu</code>,
<code>vcovCR.rma.uni</code>, <code>vcovCR.rma.mv</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# simulate design with cluster-dependence
m &lt;- 8
cluster &lt;- factor(rep(LETTERS[1:m], 3 + rpois(m, 5)))
n &lt;- length(cluster)
X &lt;- matrix(rnorm(3 * n), n, 3)
nu &lt;- rnorm(m)[cluster]
e &lt;- rnorm(n)
y &lt;- X %*% c(.4, .3, -.3) + nu + e
dat &lt;- data.frame(y, X, cluster, row = 1:n)

# fit linear model
lm_fit &lt;- lm(y ~ X1 + X2 + X3, data = dat)
vcov(lm_fit)

# cluster-robust variance estimator with CR2 small-sample correction
vcovCR(lm_fit, cluster = dat$cluster, type = "CR2")

# compare small-sample adjustments
CR_types &lt;- paste0("CR",c("0","1","1S","2","3"))
sapply(CR_types, function(type) 
       sqrt(diag(vcovCR(lm_fit, cluster = dat$cluster, type = type))))

</code></pre>


</div>