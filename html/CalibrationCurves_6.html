<div class="container">

<table style="width: 100%;"><tr>
<td>genCalCurve</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calibration performance using the generalized calibration framework</h2>

<h3>Description</h3>

<p>Function to assess the calibration performance of a prediction model where the outcome's distribution is a member of the exponential family (De Cock Campo, 2023).
The function plots the generalized calibration curve and computes the generalized calibration slope and intercept.
</p>


<h3>Usage</h3>

<pre><code class="language-R">genCalCurve(
  y,
  yHat,
  family,
  plot = TRUE,
  Smooth = FALSE,
  GLMCal = TRUE,
  lwdIdeal = 2,
  colIdeal = "gray",
  ltyIdeal = 1,
  lwdSmooth = 1,
  colSmooth = "blue",
  ltySmooth = 1,
  argzSmooth = alist(degree = 2),
  lwdGLMCal = 1,
  colGLMCal = "red",
  ltyGLMCal = 1,
  AddStats = T,
  Digits = 3,
  cexStats = 1,
  lwdLeg = 1.5,
  Legend = TRUE,
  legendPos = "bottomright",
  xLim = NULL,
  yLim = NULL,
  posStats = NULL,
  confLimitsSmooth = c("none", "bootstrap", "pointwise"),
  confLevel = 0.95,
  Title = "Calibration plot",
  xlab = "Predicted value",
  ylab = "Empirical average",
  EmpiricalDistribution = TRUE,
  length.seg = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector with the values for the response variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yHat</code></td>
<td>
<p>a vector with the predicted values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a description of the type of distribution and link function in the model. This can be a character string naming a family function, a family function or the result of a call to a family function.
(See family for details of family functions.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>logical, indicating if a plot should be made or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Smooth</code></td>
<td>
<p>logical, indicating if the flexible calibration curve should be estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>GLMCal</code></td>
<td>
<p>logical, indicating if the GLM calibration curve has to be estimated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwdIdeal</code></td>
<td>
<p>the line width of the ideal line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colIdeal</code></td>
<td>
<p>the color of the ideal line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ltyIdeal</code></td>
<td>
<p>the line type of the ideal line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwdSmooth</code></td>
<td>
<p>the line width of the flexible calibration curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colSmooth</code></td>
<td>
<p>the color of the flexible calibration curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ltySmooth</code></td>
<td>
<p>the line type of the flexible calibration curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>argzSmooth</code></td>
<td>
<p>arguments passed to <code>loess</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwdGLMCal</code></td>
<td>
<p>the line width of the GLM calibration curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colGLMCal</code></td>
<td>
<p>the color of the GLM calibration curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ltyGLMCal</code></td>
<td>
<p>the line type of the GLM calibration curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AddStats</code></td>
<td>
<p>logical, indicating whether to add the values of the generalized calibration slope and intercept to the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Digits</code></td>
<td>
<p>the number of digits of the generalized calibration slope and intercept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cexStats</code></td>
<td>
<p>the font size of the statistics shown on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwdLeg</code></td>
<td>
<p>the line width in the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Legend</code></td>
<td>
<p>logical, indicating whether the legend has to be added.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendPos</code></td>
<td>
<p>the position of the legend on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xLim, yLim</code></td>
<td>
<p>numeric vectors of length 2, giving the x and y coordinates ranges (see <code>plot.window</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>posStats</code></td>
<td>
<p>numeric vector of length 2, specifying the x and y coordinates of the statistics (generalized calibration curve and intercept) printed on the plot. Default is <code>NULL</code>
which places the statistics in the top left corner of the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confLimitsSmooth</code></td>
<td>
<p>character vector to indicate if and how the confidence limits for the flexible calibration curve have to be computed. <code>"none"</code> omits the confidence limits,
<code>"bootstrap"</code> uses 2000 bootstrap samples to calculate the 95% confidence limits and <code>"pointwise"</code> uses the pointwise confidence limits.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confLevel</code></td>
<td>
<p>the confidence level for the calculation of the pointwise confidence limits of the flexible calibration curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Title</code></td>
<td>
<p>the title of the plot</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>x-axis label, default is <code>"Predicted value"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>y-axis label, default is <code>"Empirical average"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EmpiricalDistribution</code></td>
<td>
<p>logical, indicating if the empirical distribution of the predicted values has to be added to the bottom of the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>length.seg</code></td>
<td>
<p>controls the length of the histogram lines. Default is <code>1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to be passed to <code>plot</code>, see <code>par</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of type <code>GeneralizedCalibrationCurve</code> with the following slots:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ggPlot</code></td>
<td>
<p>the ggplot object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stats</code></td>
<td>
<p>a vector containing performance measures of calibration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl.level</code></td>
<td>
<p>the confidence level used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Calibration</code></td>
<td>
<p>contains the calibration intercept and slope, together with their confidence intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cindex</code></td>
<td>
<p>the value of the c-statistic, together with its confidence interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warningMessages</code></td>
<td>
<p>if any, the warning messages that were printed while running the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CalibrationCurves</code></td>
<td>
<p>The coordinates for plotting the calibration curves. </p>
</td>
</tr>
</table>
<h3>References</h3>

<p>De Cock Campo, B. (2023). Towards reliable predictive analytics: a generalized calibration framework. arXiv:2309.08559, available at <a href="https://arxiv.org/abs/2309.08559">https://arxiv.org/abs/2309.08559</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(CalibrationCurves)
library(mgcv)
data("poissontraindata")
data("poissontestdata")

glmFit = glm(Y ~ ., data = poissontraindata, family = poisson)

# Example of a well calibrated poisson prediction model
yOOS = poissontestdata$Y
yHat = predict(glmFit, newdata = poissontestdata, type = "response")
genCalCurve(yOOS, yHat, family = "poisson", plot = TRUE)

# Example of an overfit poisson prediction model
gamFit = gam(Y ~ x1 + x3 + x1:x3 + s(x5), data = poissontraindata, family = poisson)
yHat = as.vector(predict(gamFit, newdata = poissontestdata, type = "response"))
genCalCurve(yOOS, yHat, family = "poisson", plot = TRUE)

# Example of an underfit poisson prediction model
glmFit = glm(Y ~ x2, data = poissontraindata, family = poisson)
yOOS = poissontestdata$Y
yHat = predict(glmFit, newdata = poissontestdata, type = "response")
genCalCurve(yOOS, yHat, family = "poisson", plot = TRUE)
</code></pre>


</div>