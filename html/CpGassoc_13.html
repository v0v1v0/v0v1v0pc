<div class="container">

<table style="width: 100%;"><tr>
<td>cpg.perm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Perform a Permutation Test of the Association Between Methylation and a Phenotype of Interest
</h2>

<h3>Description</h3>

<p>Calls <code>cpg.assoc</code> to get the observed P-values from the study and then performs a user-specified number of permutations to calculate an emperical p-value.
In addition to the same test statistics computed by <code>cpg.assoc</code>, <code>cpg.perm</code> will compute the permutation p-values for the observed p-value, the number of Holm significant sites, and the number of FDR significant sites.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cpg.perm(beta.values, indep, covariates = NULL, nperm, data = NULL, seed = NULL,
logit.transform = FALSE, chip.id = NULL, subset = NULL, random = FALSE,
fdr.cutoff = 0.05, fdr.method = "BH",large.data=FALSE,return.data=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>beta.values</code></td>
<td>

<p>A vector, matrix, or data frame containing the beta values of interest (1 row per CpG site, 1 column per individual).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indep</code></td>
<td>

<p>A vector containing the main variable of interest.  <code>cpg.assoc</code> will evaluate the association between indep and the beta values. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariates</code></td>
<td>

<p>A data frame consisting of the covariates of interest. covariates can also be a matrix if it is a model matrix minus the intercept column. 
It can also be a vector if there is only one covariate of interest.  Can also be a formula(e.g. <code>~cov1+cov2</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nperm</code></td>
<td>

<p>The number of permutations to be performed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>an optional data frame, list or environment (or object coercible by <code>as.data.frame</code> to a data frame) containing the variables in the model. If not found in data, the variables are taken from the environment from which <code>cpg.perm</code> is called.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>

<p>The required seed for random number generation. If not input, will use R's internal seed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logit.transform</code></td>
<td>

<p>logical. If <code>TRUE</code>, the logit transform of the beta values log(beta.val/(1-beta.val)) will be used. Any values equal to zero or one will be set to the 
next smallest or  next largest value respectively; values &lt;0 or &gt;1 will be set to NA.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chip.id</code></td>
<td>

<p>An optional vector containing chip, batch identities, or other categorical factor of interest to the researcher. If specified, chip id will be included as a factor in the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>

<p>An optional logical vector specifying a subset of observations to be used in the fitting process.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>

<p>logical. If <code>TRUE</code>, the <span class="option">chip.id</span> will be processed as a random effect, and a random intercept model will be fitted.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fdr.cutoff</code></td>
<td>

<p>The threshold at which to compare the FDR values. The default setting is .05. Any FDR values less than .05 will be considered significant.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fdr.method</code></td>
<td>

<p>Character. Method used to calculate False Discovery Rate. Can be any of the methods listed in <code>p.adjust</code>. The default method is "BH" for the Benjamini &amp; Hochberg method.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>large.data</code></td>
<td>

<p>Logical.  Enables analyses of large datasets.  When <code>large.data=TRUE</code>, <code>cpg.assoc</code> avoids memory problems by performing the analysis in chunks. Note: this option no longer works within windows systems. Based on reading max memory allowable by the system. Defaults to False. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.data</code></td>
<td>

<p>Logical. cpg.assoc can return dataframes containing the the variable of interest, covariates, and the chip id (if present). Defaults to FALSE. Set to TRUE if plan on using the downstream scatterplot functions).
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The item returned will be of class <code>"cpg.perm"</code>. It will contain all of the values of class cpg (<code>cpg.assoc</code>) and a few more:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>permutation.matrix</code></td>
<td>

<p>A matrix consisting of the minimum observed P-value, the number of Holm significant CpG sites, and the number of FDR significant sites for each permutation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gc.permutation.matrix</code></td>
<td>

<p>Similar to the permutation.matrix only in relation to the genomic control adjusted p-values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perm.p.values</code></td>
<td>

<p>A data frame consisting of the permutation P-values, and the number of permutations performed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perm.tstat</code></td>
<td>

<p>If one hundred or more permutations were performed and indep is a continuous variable, consists of the quantile .025 and .975 of observed t-statistics for each permutation, ordered from smallest to largest.
perm.tstat is used by <code>plot.cpg.perm</code> to compute the confidence intervals for the QQ plot of t-statistics. Otherwise <code>NULL</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perm.pval</code></td>
<td>

<p>If one hundred or more permutations were performed, consists of the observed p-values for each permutation, ordered from smallest to largest. perm.pval is usd by <code>plot.cpg.perm</code> to compute
the confidence intervals for the QQ plot of the p-values. Otherwise NULL.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Barfield, R.; Conneely, K.; Kilaru,V.<br>
Maintainer: R. Barfield: &lt;barfieldrichard8@gmail.com&gt;
</p>


<h3>See Also</h3>

<p><code>cpg.assoc</code>
<code>cpg.work</code>
<code>plot.cpg</code>
<code>scatterplot</code>
<code>cpg.combine</code>
<code>manhattan</code>
<code>plot.cpg.perm</code>
<code>sort.cpg.perm</code>
<code>sort.cpg</code>
<code>cpg.qc</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">##Loading the data
data(samplecpg,samplepheno,package="CpGassoc")

#Performing a permutation 10 times
Testperm&lt;-cpg.perm(samplecpg[1:200,],samplepheno$weight,seed=2314,nperm=10,large.data=FALSE)
Testperm
#All the contents of CpGassoc are included in the output from Testperm

#summary function works on objects of class cpg.perm
summary(Testperm)

</code></pre>


</div>