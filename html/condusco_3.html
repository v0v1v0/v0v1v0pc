<div class="container">

<table style="width: 100%;"><tr>
<td>run_pipeline_gbq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>A wrapper for running pipelines with a BigQuery invocation query</h2>

<h3>Description</h3>

<p>A wrapper for running pipelines with a BigQuery invocation query
</p>


<h3>Usage</h3>

<pre><code class="language-R">run_pipeline_gbq(pipeline, query, project, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pipeline</code></td>
<td>
<p>User-provided function with one argument, one row of query results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>query</code></td>
<td>
<p>A query to execute in Google BigQuery</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>project</code></td>
<td>
<p>The Google BigQuery project to bill</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to query_exec()</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
library(whisker)

#Set GBQ project
project &lt;- ''

#Set the following options for GBQ authentication on a cloud instance
options("httr_oauth_cache" = "~/.httr-oauth")
options(httr_oob_default=TRUE)

#Run the below query to authenticate and write credentials to .httr-oauth file
query_exec("SELECT 'foo' as bar",project=project);

pipeline &lt;- function(params){

  query &lt;- "
    SELECT
      {{#list}}
        SUM(CASE WHEN author.name ='{{name}}' THEN 1 ELSE 0 END) as n_{{name_clean}},
      {{/list}}
      repo_name
    FROM `bigquery-public-data.github_repos.sample_commits`
    GROUP BY repo_name
  ;"

  res &lt;- query_exec(
    whisker.render(query,params),
    project=project,
    use_legacy_sql = FALSE
  );

  print(res)
}

run_pipeline_gbq(pipeline, "
  SELECT CONCAT('[',
  STRING_AGG(
    CONCAT('{\"name\":\"',name,'\",'
      ,'\"name_clean\":\"', REGEXP_REPLACE(name, r'[^[:alpha:]]', ''),'\"}'
    )
  ),
  ']') as list
  FROM (
    SELECT author.name,
      COUNT(commit) n_commits
    FROM `bigquery-public-data.github_repos.sample_commits`
    GROUP BY 1
    ORDER BY 2 DESC
    LIMIT 10
  )
",
project,
use_legacy_sql = FALSE
)

## End(Not run)
</code></pre>


</div>