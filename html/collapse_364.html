<div class="container">

<table style="width: 100%;"><tr>
<td>collapse-options</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
<em>collapse</em> Package Options</h2>

<h3>Description</h3>

<p><em>collapse</em> is globally configurable to an extent few packages are: the default value of key function arguments governing the behavior of its algorithms, and the exported namespace, can be adjusted interactively through the <code>set_collapse()</code> function.
</p>
<p>These options are saved in an internal environment called <code>.op</code> (for safety and performance reasons) visible in the documentation of some functions such as <code>fmean</code>. The contents of this environment can be accessed using <code>get_collapse()</code>.
</p>
<p>There are also a few options that can be set using <code>options</code> (retrievable using <code>getOption</code>). These options mainly affect package startup behavior.
</p>



<h3>Usage</h3>

<pre><code class="language-R">set_collapse(...)
get_collapse(opts = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>either comma separated options, or a single list of options. The available options are:
</p>

<table>
<tr>
<td style="text-align: left;">
    <code>na.rm</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> logical, default <code>TRUE</code>. Sets the default for statistical algorithms such as the Fast Statistical Functions to skip missing values. If your data does not have missing values, or only in rare cases, it is recommended to change this to <code>FALSE</code> for performance gains. <em>Note</em> that this does not affect other (non-statistical) uses of <code>na.rm</code> arguments, such as in <code>pivot</code>. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    <code>sort</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> logical, default <code>TRUE</code>. Sets the default for grouping operations to be sorted. This also applies to factor generation using <code>qF</code> and tabulation with <code>qtab</code>, but excludes other uses of <code>sort</code> arguments where grouping is not the objective (such as in <code>funique</code> or <code>pivot</code>). In general, sorted grouping (internally using <code>radixorder</code>) is slower than hash-based direct grouping (internally using <code>group</code>). However, if data is pre-sorted, sorted grouping is slightly faster. In general, if records don't need to be sorted or you want to maintain their first-appearance order, changing this to <code>FALSE</code> is recommended and often brings substantial performance gains. <em>Note</em> that this also affects internal grouping applied when atomic vectors (except for factors) or lists are passed to <code>g</code> arguments in Fast Statistical Functions. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    <code>nthreads</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> integer, default 1. Sets the default for OpenMP multithreading, available in certain statistical and data manipulation functions. Setting values greater than 1 is strongly recommended with larger datasets. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    <code>stable.algo</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> logical, default <code>TRUE</code>. Option passed to <code>fvar()/fsd()</code> and <code>qsu()</code>. <code>FALSE</code> enables one-pass standard deviation calculation, which is very fast, but might incur catastrophic cancellation if numbers are large and the variance is small. see <code>fvar</code> for details. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    <code>stub</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> logical, default <code>TRUE</code>. Controls whether transformation operators (<code>.OPERATOR_FUN</code>) such as <code>W</code>, <code>L</code>, <code>STD</code> etc. add prefixes to transformed columns of matrix and data.frame-like objects. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    <code>verbose</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> integer, default <code>1</code>. Print additional (diagnostic) information or messages when executing code. Currently only used in <code>join</code> and <code>roworder</code>. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    <code>digits</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> integer, default <code>2</code>. Number of digits to print, e.g. in <code>descr</code> or <code>pwcor</code>. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    <code>mask</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> character, default <code>NULL</code>. Allows masking existing base R/dplyr functions with faster <em>collapse</em> versions, by creating additional functions in the namespace and instantly exporting them: </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

    </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> For example <code>set_collapse(mask = "unique")</code> (or, equivalently, <code>set_collapse(mask = "funique")</code>) will create <code>unique &lt;- funique</code> in the <em>collapse</em> namespace, export <code>unique()</code>, and silently detach and attach the namespace again so R can find it - all in millisecond. Thus calling <code>unique()</code> afterwards uses the <em>collapse</em> version - which is many times faster. <code>funique</code> remains available and you can still call <code>base::unique</code> explicitly. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

  </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> All <em>collapse</em> functions starting with 'f' can be passed to the option (with or without the 'f') e.g. <code>set_collapse(mask = c("subset", "transform", "droplevels"))</code> creates <code>subset &lt;- fsubset</code>, <code>transform &lt;- ftransform</code> etc. Special functions are <code>"n"</code> and <code>"table"/"qtab"</code>, and <code>"%in%"</code>, which create <code>n &lt;- GRPN</code> (for use in <code>(f)summarise</code>/<code>(f)mutate</code>), <code>table &lt;- qtab</code>, and replace <code>%in%</code> with a fast version using <code>fmatch</code>, respectively. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

  </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> There are also a couple of convenience keywords that you can use to mask groups of functions: </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"manip"</code> adds data manipulation functions: <code>fsubset, ftransform, ftransform&lt;-, ftransformv, fcompute, fcomputev, fselect, fselect&lt;-, fgroup_by, fgroup_vars, fungroup, fsummarise, fsummarize, fmutate, frename, findex_by, findex</code>. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"helper"</code> adds the functions: <code>fdroplevels</code>, <code>finteraction</code>, <code>fmatch</code>, <code>funique</code>, <code>fnunique</code>, <code>fduplicated</code>, <code>fcount</code>, <code>fcountv</code>, <code>fquantile</code>, <code>frange</code>, <code>fdist</code>, <code>fnlevels</code>, <code>fnrow</code> and <code>fncol</code>. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"> 
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"special"</code> exports <code>n()</code>, <code>table()</code> and <code>%in%</code>. See above. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"fast-fun"</code> adds the functions contained in the macro: <code>.FAST_FUN</code>. See also Note. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"fast-stat-fun"</code> adds the functions contained in the macro: <code>.FAST_STAT_FUN</code>. See also Note. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"fast-trfm-fun"</code> adds the functions contained in: <code>setdiff(.FAST_FUN, .FAST_STAT_FUN)</code>. See also Note. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"all"</code> turns on all of the above.</td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">


</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> The re-attaching of the namespace places <em>collapse</em> at the top of the search path (after the global environment), implying that all its exported functions will take priority over other libraries. Users can use <code>fastverse::fastverse_conflicts()</code> to check which functions are masked following <code>set_collapse(mask = ...)</code>. The option can be changed at any time with immediate effect. Using <code>set_collapse(mask = NULL)</code> removes all masked functions from the namespace, and can also be called simply to place <em>collapse</em> at the top of the search path. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

 <code>remove</code> </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> character, default <code>NULL</code>. Similar to 'mask': allows removing functions from the exported namespace (they are still in the namespace, just no longer exported). All <em>collapse</em> functions can be passed here. This argument is always evaluated after 'mask', thus you can also remove masked functions again i.e. after setting a keyword which masks a bunch of functions. There are also a couple of convenience keywords you can specify to bulk-remove certain functions:
</td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">

</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"shorthand"</code> removes function shorthands: <code>gv, gv&lt;-, av, av&lt;-, nv, nv&lt;-, gvr, gvr&lt;-, itn, ix, slt, slt&lt;-, sbt, gby, iby, mtt, smr, tfm, tfmv, tfm&lt;-, settfm, settfmv, rnm</code>. </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"infix"</code> removes infix functions: <code>%!=%, %[!]in%, %[!]iin%, %*=%, %+=%, %-=%, %/=%, %=%, %==%, %c*%, %c+%, %c-%, %c/%, %cr%, %r*%, %r+%, %r-%, %r/%, %rr%</code>.</td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"operator"</code> removes functions contained in the macro: <code>.OPERATOR_FUN</code>.</td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> - <code>"old"</code> removes depreciated functions contained in the macro: <code>.COLLAPSE_OLD</code>.</td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">


</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> Like 'mask', the option is alterable and reversible. Specifying <code>set_collapse(remove = NULL)</code> restores the exported namespace. Also like 'mask', this option silently detaches and attaches <em>collapse</em> again, ensuring that it is at the top of the search path.

 </td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">
  </td>
</tr>
</table>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>opts</code></td>
<td>
<p>character. A vector of options to receive from <code>.op</code>, or <code>NULL</code> for a list of all options.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>set_collapse()</code> returns the old content of <code>.op</code> invisibly as a list. <code>get_collapse()</code>, if called with only one option, returns the value of the option, and otherwise a list.
</p>


<h3>Options Set Using <code>options()</code>
</h3>


<ul>
<li> <p><code>"collapse_unused_arg_action"</code> regulates how generic functions (such as the Fast Statistical Functions) in the package react when an unknown argument is passed to a method. The default action is <code>"warning"</code> which issues a warning. Other options are <code>"error"</code>, <code>"message"</code> or <code>"none"</code>, whereby the latter enables silent swallowing of such arguments.
</p>






</li>
<li> <p><code>"collapse_export_F"</code>, if set to <code>TRUE</code>, exports the lead operator <code>F</code> in the package namespace when loading the package. The operator was exported by default until v1.9.0, but is now hidden inside the package due to too many problems with <code>base::F</code>. Alternatively, the operator can be accessed using <code>collapse:::F</code>.
</p>

</li>
<li> <p><code>"collapse_nthreads"</code>, <code>"collapse_na_rm"</code>, <code>"collapse_sort"</code>, <code>"collapse_stable_algo"</code>, <code>"collapse_verbose"</code>, <code>"collapse_digits"</code>, <code>"collapse_mask"</code> and <code>"collapse_remove"</code> can be set before loading the package to initialize <code>.op</code> with different defaults (e.g. using an <code>.Rprofile</code> file). Once loaded, these options have no effect, and users need to use <code>set_collapse()</code> to change them. See also the Note.
</p>
</li>
</ul>
<h3>Note</h3>

<p>Setting keywords "fast-fun", "fast-stat-fun", "fast-trfm-fun" or "all" with <code>set_collapse(mask = ...)</code> will also adjust internal optimization flags, e.g. in <code>(f)summarise</code> and <code>(f)mutate</code>, so that these functions - and all expressions containing them - receive vectorized execution (see examples of <code>(f)summarise</code> and <code>(f)mutate</code>). Users should be aware of expressions like <code>fmutate(mu = sum(var) / lenth(var))</code>: this usually gets executed by groups, but with these keywords set,this will be vectorized (like <code>fmutate(mu = fsum(var) / lenth(var))</code>) implying grouped sum divided by overall length. In this case <code>fmutate(mu = base::sum(var) / lenth(var))</code> needs to be specified to retain the original result.
</p>
<p><em>Note</em> that passing individual functions like <code>set_collapse(mask = "(f)sum")</code> will <b>not</b> change internal optimization flags for these functions. This is to ensure consistency i.e. you can be either all in (by setting appropriate keywords) or all out when it comes to vectorized stats with basic R names.
</p>
<p><em>Note</em> also that masking does not change documentation links, so you need to look up the f- version of a function to get the right documentation.
</p>
<p>A safe way to set options affecting startup behavior is by using a <code>.Rprofile</code> file in your user or project directory (see also <a href="https://www.statmethods.net/interface/customizing.html">here</a>, the user-level file is located at <code>file.path(Sys.getenv("HOME"), ".Rprofile")</code> and can be edited using <code>file.edit(Sys.getenv("HOME"), ".Rprofile")</code>), or by using a <a href="https://fastverse.github.io/fastverse/articles/fastverse_intro.html#custom-fastverse-configurations-for-projects"><code>.fastverse</code></a> configuration file in the project directory.
</p>
<p><code>options("collapse_remove")</code> does in fact remove functions from the namespace and cannot be reversed by <code>set_collapse(remove = NULL)</code> once the package is loaded. It is only reversed by re-loading <em>collapse</em>.
</p>


<h3>See Also</h3>

<p>Collapse Overview, collapse-package
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Setting new values
oldopts &lt;- set_collapse(nthreads = 2, na.rm = FALSE)

# Getting the values
get_collapse()
get_collapse("nthreads")

# Resetting
set_collapse(oldopts)
rm(oldopts)

## Not run: 
## This is a typical working setup I use:
library(fastverse)
# Loading other stats packages with fastverse_extend():
# displays versions, checks conflicts, and installs if unavailable
fastverse_extend(qs, fixest, grf, glmnet, install = TRUE)
# Now setting collapse options with some namespace modification
set_collapse(
  nthreads = 4,
  sort = FALSE,
  mask = c("manip", "helper", "special", "mean", "scale"),
  remove = "old"
)
# Final conflicts check (optional)
fastverse_conflicts()

# For some simpler scripts I also use
set_collapse(
  nthreads = 4,
  sort = FALSE,
  mask = "all",
  remove = c("old", "between") # I use data.table::between &gt; fbetween
)

# This is now collapse code
mtcars |&gt;
  subset(mpg &gt; 12) |&gt;
  group_by(cyl) |&gt;
  sum()

## End(Not run)

## Changing what happens with unused arguments
oldopts &lt;- options(collapse_unused_arg_action = "message") # default: "warning"
fmean(mtcars$mpg, bla = 1)

# Now nothing happens, same as base R
options(collapse_unused_arg_action = "none")
fmean(mtcars$mpg, bla = 1)
mean(mtcars$mpg, bla = 1)

options(oldopts)
rm(oldopts)
</code></pre>


</div>