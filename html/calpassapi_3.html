<div class="container">

<table style="width: 100%;"><tr>
<td>calpass_query</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Query data from CalPASS API endpoints</h2>

<h3>Description</h3>

<p>Query data from CalPASS API endpoints for a single interSegmentKey
</p>


<h3>Usage</h3>

<pre><code class="language-R">calpass_query(
  interSegmentKey,
  token,
  api_url = "https://mmap.calpassplus.org/api",
  endpoint = c("transcript", "placement"),
  verbose = FALSE
)

calpass_query_many(
  interSegmentKey,
  token,
  api_url = "https://mmap.calpassplus.org/api",
  endpoint = c("transcript", "placement"),
  verbose = FALSE,
  api_call_limit = 3200,
  limit_per_n_sec = 3600,
  wait = FALSE,
  token_username,
  token_password,
  token_client_id,
  token_scope
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>interSegmentKey</code></td>
<td>
<p>for <code>calpass_query</code>, a single interSegmentKey; for <code>calpass_query_many</code>, a vector of interSgementKey's.  The interSegmentKey's can be created from calpass_create_isk.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token</code></td>
<td>
<p>(optional) a token object created from calpass_get_token.  If this is not specified, then <code>token_username</code>, <code>token_password</code>, <code>token_client_id</code>, and <code>token_scope</code> should be specified.  The credentials approach is preferred for long runs to obtain refreshed tokens (tokens currently are valid for 1 hour).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>api_url</code></td>
<td>
<p>defaults to <code>'https://mmap.calpassplus.org/api'</code>, but can be overrode if CalPASS changes the url.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>endpoint</code></td>
<td>
<p>the api endpoint to use; defaults to <code>'transcript'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If <code>TRUE</code>, then print http exchanges (to assist with debugging).  Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>api_call_limit</code></td>
<td>
<p>the number of api calls allowed per <code>limit_per_n_sec</code>; defaults to 150 calls per 60 seconds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>limit_per_n_sec</code></td>
<td>
<p>time frame where <code>api_call_limit</code> is applicable to; defaults to 60 seconds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wait</code></td>
<td>
<p>indicates whether the user is willing to wait <code>limit_per_n_sec</code> seconds per batch if the number of unique values in <code>interSegmentKey</code> is greater than <code>api_call_limit</code>; defaults to <code>FALSE</code>.  The user should set to <code>TRUE</code> if there are more than <code>api_call_limit</code> number of calls to be executed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token_username</code></td>
<td>
<p>(optional, required if <code>token</code> is not specified) username passed to calpass_get_token.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token_password</code></td>
<td>
<p>(optional, required if <code>token</code> is not specified) password passed to calpass_get_token.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token_client_id</code></td>
<td>
<p>(optional, required if <code>token</code> is not specified) client_id passed to calpass_get_token.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token_scope</code></td>
<td>
<p>(optional, required if <code>token</code> is not specified) scope passed to calpass_get_token.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a data frame with columns <code>interSegmentKey</code>, <code>status_code</code> (the http response code: 200 means student was found, 204 means student was not found, 429 means the api limit was reached and student was not processed, and anything else in the 400's correspond to http errors.)
</p>


<h3>Functions</h3>


<ul><li> <p><code>calpass_query_many</code>: Query data from CalPASS API endpoints with a vector of interSegmentKey's.  The number of rows returned corresponds to the number of unique interSegmentKey's.
</p>
</li></ul>
<h3>Author(s)</h3>

<p>Vinh Nguyen
</p>


<h3>References</h3>

<p><a href="https://mmap.calpassplus.org/docs/index.html">MMAP API V1</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
## get access token
cp_token &lt;- calpass_get_token(username='my_cp_api_uid', password='my_cp_api_pwd')

## single run
isk &lt;- calpass_create_isk(first_name='Jane', last_name='Doe'
  , gender='F', birthdate=20001231)
calpass_query(interSegmentKey=isk
  , token=cp_token, endpoint='transcript')
calpass_query(interSegmentKey=isk
  , token=cp_token, endpoint='placement')

## multiple
firstname &lt;- c('Tom', 'Jane', 'Jo')
lastname &lt;- c('Ng', 'Doe', 'Smith')
gender &lt;- c('Male', 'Female', 'X')
birthdate &lt;- c(20001231, 19990101, 19981111)
df &lt;- data.frame(firstname, lastname
  , gender, birthdate, stringsAsFactors=FALSE)
library(dplyr)
df %&gt;%
  mutate(isk=calpass_create_isk(first_name=firstname
    , last_name=lastname
    , gender=gender
    , birthdate
  )) 
dfResults &lt;- calpass_query_many(interSegmentKey=df$isk
  , token=cp_token
  , endpoint='transcript'
)

## End(Not run)
</code></pre>


</div>