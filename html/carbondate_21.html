<div class="container">

<table style="width: 100%;"><tr>
<td>PlotCalendarAgeDensityIndividualSample</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot Posterior Calendar Age Estimate for an Individual Determination after Joint Calibration</h2>

<h3>Description</h3>

<p>Once a joint calibration function (any of PolyaUrnBivarDirichlet, WalkerBivarDirichlet
or PPcalibrate) has been run to calibrate a set of related radiocarbon
determinations, this function plots the posterior calendar age estimate for a given single
determination. Shown are a (direct) histogram of the posterior calendar ages generated by the MCMC
chain and also a (smoothed) kernel density estimate obtained using a Gaussian kernel. The highest
posterior density (HPD) interval is also shown for the interval width specified (default 2<code class="reqn">\sigma</code>).
</p>
<p>For more information read the vignettes: <br><code>vignette("Non-parametric-summed-density", package = "carbondate")</code> <br><code>vignette("Poisson-process-modelling", package = "carbondate")</code>
</p>
<p><strong>Note:</strong> The output of this function will provide different results from independent calibration
of the determination. By jointly, and simultaneously, calibrating all the related <code class="reqn">{}^{14}</code>C determinations
using the library functions we are able to share the available calendar information between the samples. This should result in improved
individual calibration.
</p>


<h3>Usage</h3>

<pre><code class="language-R">PlotCalendarAgeDensityIndividualSample(
  ident,
  output_data,
  calibration_curve = NULL,
  plot_14C_age = TRUE,
  plot_cal_age_scale = "BP",
  hist_resolution = 5,
  density_resolution = 1,
  interval_width = "2sigma",
  bespoke_probability = NA,
  n_burn = NA,
  n_end = NA,
  show_hpd_ranges = FALSE,
  show_unmodelled_density = FALSE,
  plot_pretty = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ident</code></td>
<td>
<p>The individual determination for which you want to plot the posterior
density estimate of the calendar age.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_data</code></td>
<td>
<p>The return value either from one of the Bayesian non-parametric DPMM
functions (PolyaUrnBivarDirichlet or WalkerBivarDirichlet); or
from the Poisson process modelling function (PPcalibrate).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calibration_curve</code></td>
<td>
<p>This is usually not required since the name of the
calibration curve variable is saved in the output data. However, if the
variable with this name is no longer in your environment then you should pass
the calibration curve here. If provided, this should be a dataframe which
should contain at least 3 columns entitled <code>calendar_age</code>, <code>c14_age</code> and <code>c14_sig</code>.
This format matches intcal20.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_14C_age</code></td>
<td>
<p>Whether to use the radiocarbon age (<code class="reqn">{}^{14}</code>C yr BP) as
the units of the y-axis in the plot. Defaults to <code>TRUE</code>. If <code>FALSE</code> uses
F<code class="reqn">{}^{14}</code>C concentration instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_cal_age_scale</code></td>
<td>
<p>The calendar scale to use for the x-axis. Allowed values are
"BP", "AD" and "BC". The default is "BP" corresponding to plotting in cal yr BP.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hist_resolution</code></td>
<td>
<p>The distance between histogram breaks when plotting the individual
posterior calendar age density. Default is 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>density_resolution</code></td>
<td>
<p>The distance between calendar ages for the returned smoothed calendar age
probability. Default is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interval_width</code></td>
<td>
<p>The confidence intervals to show for the calibration curve and
for the highest posterior density ranges.
Choose from one of "1sigma" (68.3%), "2sigma" (95.4%) and "bespoke". Default is "2sigma".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bespoke_probability</code></td>
<td>
<p>The probability to use for the confidence interval
if <code>"bespoke"</code> is chosen above. E.g., if 0.95 is chosen, then the 95% confidence
interval is calculated. Ignored if <code>"bespoke"</code> is not chosen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_burn</code></td>
<td>
<p>The number of MCMC iterations that should be discarded as burn-in (i.e.,
considered to be occurring before the MCMC has converged). This relates to the number
of iterations (<code>n_iter</code>) when running the original update functions (not the thinned <code>output_data</code>).
Any MCMC iterations before this are not used in the calculations. If not given, the first half of
the MCMC chain is discarded. Note: The maximum value that the function will allow is
<code>n_iter - 100 * n_thin</code> (where <code>n_iter</code> and <code>n_thin</code> are the arguments given to
PolyaUrnBivarDirichlet or WalkerBivarDirichlet)
which would leave only 100 of the (thinned) values in <code>output_data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_end</code></td>
<td>
<p>The iteration number of the last sample in <code>output_data</code> to use in the calculations.
Assumed to be the total number of (thinned) realisations stored if not given.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_hpd_ranges</code></td>
<td>
<p>Set to <code>TRUE</code> to also show the highest posterior density (HPD) range
on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_unmodelled_density</code></td>
<td>
<p>Set to <code>TRUE</code> to also show the unmodelled density (i.e., the
result of independent calibration using CalibrateSingleDetermination) on the plot.
Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot_pretty</code></td>
<td>
<p>logical, defaulting to <code>TRUE</code>. If set <code>TRUE</code> then will select pretty plotting
margins (that create sufficient space for axis titles and rotates y-axis labels). If <code>FALSE</code> will
implement current user values.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A data frame with one column <code>calendar_age_BP</code> containing the calendar ages, and the other
column <code>probability</code> containing the (smoothed) kernel density estimate of the probability at that
calendar age.
</p>


<h3>See Also</h3>

<p>CalibrateSingleDetermination for independent calibration of a sample against
a calibration curve.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># NOTE 1: These examples are shown with a small n_iter to speed up execution.
# When you run ensure n_iter gives convergence (try function default).

# NOTE 2: The examples only show application to  PolyaUrnBivarDirichlet output.
# The function can also be used with WalkerBivarDirichlet and PPcalibrate output.

polya_urn_output &lt;- PolyaUrnBivarDirichlet(
    two_normals$c14_age,
    two_normals$c14_sig,
    intcal20,
    n_iter = 500,
    n_thin = 2,
    show_progress = FALSE)

# Result for 15th determination
PlotCalendarAgeDensityIndividualSample(15, polya_urn_output)

# Now change to show 1 sigma interval for HPD range and calibration curve
# and plot in yr AD
PlotCalendarAgeDensityIndividualSample(
    15,
    polya_urn_output,
    plot_cal_age_scale = "AD",
    interval_width = "1sigma",
    show_hpd_ranges = TRUE,
    show_unmodelled_density = TRUE)

# Plot and then assign the returned probability
posterior_dens &lt;- PlotCalendarAgeDensityIndividualSample(15, polya_urn_output)
# Use this to find the mean posterior calendar age
weighted.mean(posterior_dens$calendar_age_BP, posterior_dens$probability)
</code></pre>


</div>