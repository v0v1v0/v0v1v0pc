<div class="container">

<table style="width: 100%;"><tr>
<td>plotHazardRatio</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot Hazards and Hazard Ratios</h2>

<h3>Description</h3>

<p>Plot method for objects returned by the <code>fitSmoothHazard</code>
function. Current plot types are hazard function and hazard ratio. The
<code>visreg</code> package must be installed for <code>type="hazard"</code>. This
function accounts for the possible time-varying exposure effects.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plotHazardRatio(x, newdata, newdata2, ci, ci.lvl, ci.col, rug, xvar, ...)

## S3 method for class 'singleEventCB'
plot(
  x,
  ...,
  type = c("hazard", "hr"),
  hazard.params = list(),
  newdata,
  exposed,
  increment = 1,
  var,
  xvar = NULL,
  ci = FALSE,
  ci.lvl = 0.95,
  rug = !ci,
  ci.col = "grey"
)

incrVar(var, increment = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Fitted object of class <code>glm</code>, <code>gam</code>, <code>cv.glmnet</code> or <code>gbm</code>. This is
the result from the <code>fitSmoothHazard()</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>Required for <code>type="hr"</code>. The <code>newdata</code> argument is
the "unexposed" group, while the exposed group is defined by either: (i) a
change (defined by the <code>increment</code> argument) in a variable in newdata
defined by the <code>var</code> argument ; or (ii) an exposed function that takes
a data-frame and returns the "exposed" group (e.g. <code>exposed =
  function(data) transform(data, treat=1)</code>). This is a generalization of the
behavior of the rstpm2 plot function. It allows both numeric and factor
variables to be incremented or decremented. See references for rstpm2
package. Only used for <code>type="hr"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata2</code></td>
<td>
<p><code>data.frame</code> for exposed group. calculated and passed
internally to <code>plotHazardRatio</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>Logical; if TRUE confidence bands are calculated. Only available
for <code>family="glm"</code> and <code>family="gam"</code>, and only used for <code>type="hr"</code>,
Default: !add. Confidence intervals for hazard ratios are calculated using
the Delta Method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.lvl</code></td>
<td>
<p>Confidence level. Must be in (0,1), Default: 0.95. Only used
for <code>type="hr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.col</code></td>
<td>
<p>Confidence band color. Only used if argument <code>ci=TRUE</code>,
Default: 'grey'. Only used for <code>type="hr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rug</code></td>
<td>
<p>Logical. Adds a rug representation (1-d plot) of the event times
(only for <code>status=1</code>), Default: !ci. Only used for <code>type="hr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xvar</code></td>
<td>
<p>Variable to be used on x-axis for hazard ratio plots. If NULL,
the function defaults to using the time variable used in the call to
<code>fitSmoothHazard</code>. In general, this should be any continuous variable
which has an interaction term with another variable. Only used for
<code>type="hr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to <code>plot</code>. Only used if <code>type="hr"</code>.
Any of <code>lwd</code>,<code>lty</code>,<code>col</code>,<code>pch</code>,<code>cex</code> will be applied to the hazard ratio
line, or point (if only one time point is supplied to <code>newdata</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>plot type. Choose one of either <code>"hazard"</code> for hazard
function or <code>"hr"</code> for hazard ratio.  Default: <code>type = "hazard"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hazard.params</code></td>
<td>
<p>Named list of arguments which will override the defaults
passed to <code>visreg::visreg()</code>, The default arguments are <code>list(fit = x,
  trans = exp, plot = TRUE, rug = FALSE, alpha = 1, partial = FALSE, overlay
  = TRUE)</code>. For example, if you want a 95% confidence band, specify
<code>hazard.params = list(alpha = 0.05)</code>. Note that The <code>cond</code> argument
must be provided as a named list. Each element of that list specifies the
value for one of the terms in the model; any elements left unspecified are
filled in with the median/most common category. Only used for
<code>type="hazard"</code>. All other argument are used for <code>type="hr"</code>. Note that the
<code>visreg</code> package must be installed for <code>type="hazard"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exposed</code></td>
<td>
<p>function that takes <code>newdata</code> and returns the exposed
dataset (e.g. function(data) transform(data, treat = 1)). This argument
takes precedence over the <code>var</code> argument, i.e., if both <code>var</code> and
<code>exposed</code> are correctly specified, only the <code>exposed</code> argument
will be used. Only used for <code>type="hr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>increment</code></td>
<td>
<p>Numeric value indicating how much to increment (if positive)
or decrement (if negative) the <code>var</code> variable in <code>newdata</code>. See
<code>var</code> argument for more details. Default is 1. Only used for
<code>type="hr"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>specify the variable name for the exposed/unexposed (name is given
as a character variable). If this argument is missing, then the
<code>exposed</code> argument must be specified. This is the variable which will
be incremented by the <code>increment</code> argument to give the exposed
category. If <code>var</code> is coded as a factor variable, then
<code>increment=1</code> will return the next level of the variable in
<code>newdata</code>. <code>increment=2</code> will return two levels above, and so on.
If the value supplied to <code>increment</code> is greater than the number of
levels, this will simply return the max level. You can also decrement the
categorical variable by specifying a negative value, e.g.,
<code>increment=-1</code> will return one level lower than the value in
<code>newdata</code>. If <code>var</code> is a numeric, than <code>increment</code> will
increment (if positive) or decrement (if negative) by the supplied value.
Only used for <code>type="hr"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function has only been thoroughly tested for <code>family="glm"</code>. If
the user wants more customized plot aesthetics, we recommend saving the
results to a <code>data.frame</code> and using  the graphical package of their choice.
</p>


<h3>Value</h3>

<p>a plot of the hazard function or hazard ratio. For <code>type="hazard"</code>, a
<code>data.frame</code> (returned invisibly) of the original data used in the fitting
along with the data used to create the plots including <code>predictedhazard</code>
which is the predicted hazard for a given covariate pattern and time.
<code>predictedloghazard</code> is the predicted hazard on the log scale. <code>lowerbound</code>
and <code>upperbound</code> are the lower and upper confidence interval bounds on the
hazard scale (i.e. used to plot the confidence bands). <code>standarderror</code> is
the standard error of the log hazard or log hazard ratio (only if
<code>family="glm"</code> or <code>family="gam"</code>). For <code>type="hr"</code>, <code>log_hazard_ratio</code> and
<code>hazard_ratio</code> is returned, and if <code>ci=TRUE</code>, <code>standarderror</code> (on the log
scale) and <code>lowerbound</code> and <code>upperbound</code> of the <code>hazard_ratio</code> are
returned.
</p>


<h3>References</h3>

<p>Mark Clements and Xing-Rong Liu (2019). rstpm2: Smooth Survival
Models, Including Generalized Survival Models. R package version 1.5.1.
https://CRAN.R-project.org/package=rstpm2
</p>
<p>Breheny P and Burchett W (2017). Visualization of Regression Models Using
visreg. The R Journal, 9: 56-71.
</p>


<h3>See Also</h3>

<p><code>modifyList</code>, <code>fitSmoothHazard()</code>,
<code>graphics::par()</code>, <code>visreg::visreg()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("splines", quietly = TRUE)) {
data("simdat") # from casebase package
library(splines)
simdat &lt;- transform(simdat[sample(1:nrow(simdat), size = 200),],
                    treat = factor(trt, levels = 0:1,
                    labels = c("control","treatment")))

fit_numeric_exposure &lt;- fitSmoothHazard(status ~ trt*bs(eventtime),
                                        data = simdat,
                                        ratio = 1,
                                        time = "eventtime")

fit_factor_exposure &lt;- fitSmoothHazard(status ~ treat*bs(eventtime),
                                       data = simdat,
                                       ratio = 1,
                                       time = "eventtime")

newtime &lt;- quantile(fit_factor_exposure[["data"]][[fit_factor_exposure[["timeVar"]]]],
                    probs = seq(0.05, 0.95, 0.01))

par(mfrow = c(1,3))
plot(fit_numeric_exposure,
     type = "hr",
     newdata = data.frame(trt = 0, eventtime = newtime),
     exposed = function(data) transform(data, trt = 1),
     xvar = "eventtime",
     ci = TRUE)

#by default this will increment `var` by 1 for exposed category
plot(fit_factor_exposure,
     type = "hr",
     newdata = data.frame(treat = factor("control",
              levels = c("control","treatment")), eventtime = newtime),
     var = "treat",
     increment = 1,
     xvar = "eventtime",
     ci = TRUE,
     ci.col = "lightblue",
     xlab = "Time",
     main = "Hazard Ratio for Treatment",
     ylab = "Hazard Ratio",
     lty = 5,
     lwd = 7,
     rug = TRUE)


# we can also decrement `var` by 1 to give hazard ratio for control/treatment
result &lt;- plot(fit_factor_exposure,
               type = "hr",
               newdata = data.frame(treat = factor("treatment",
                                    levels = c("control","treatment")),
                                    eventtime = newtime),
               var = "treat",
               increment = -1,
               xvar = "eventtime",
               ci = TRUE)

# see data used to create plot
head(result)
}
</code></pre>


</div>