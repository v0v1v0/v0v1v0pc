<div class="container">

<table style="width: 100%;"><tr>
<td>gofCopula</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Goodness-of-fit Tests for Copulas</h2>

<h3>Description</h3>

<p>The goodness-of-fit tests are based, by default, on the empirical
process comparing the empirical copula with a parametric estimate of
the copula derived under the null hypothesis, the default test
statistic, "Sn", being the Cramer-von Mises functional <code class="reqn">S_n</code>
defined in Equation (2) of Genest, Remillard and Beaudoin (2009). In
that case, approximate p-values for the test statistic can be obtained
either using a <em>parametric bootstrap</em> (see references two and
three) or by means of a faster <em>multiplier</em> approach (see
references four and five).
</p>
<p>Alternative test statistics can be used, in particular if a
<em>parametric bootstrap</em> is employed.
</p>
<p>The prinicipal function is <code>gofCopula()</code> which, depending on
<code>simulation</code> either calls <code>gofPB()</code> or <code>gofMB()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## Generic [and "rotCopula" method] ------ Main function ------
gofCopula(copula, x, ...)
## S4 method for signature 'copula'
gofCopula(copula, x, N = 1000,
          method = c("Sn", "SnB", "SnC", "Rn"),
          estim.method = c("mpl", "ml", "itau", "irho", "itau.mpl"),
          simulation = c("pb", "mult"), test.method = c("family", "single"),
          verbose = interactive(), ties = NA,
          ties.method = c("max", "average", "first", "last", "random", "min"),
          fit.ties.meth = eval(formals(rank)$ties.method), ...)

## (Deprecated) internal 'helper' functions : ---
gofPB(copula, x, N, method = c("Sn", "SnB", "SnC"),
      estim.method = c("mpl", "ml", "itau", "irho", "itau.mpl"),
      trafo.method = if(method == "Sn") "none" else c("cCopula", "htrafo"),
      trafoArgs = list(), test.method = c("family", "single"),
      verbose = interactive(), useR = FALSE, ties = NA,
      ties.method = c("max", "average", "first", "last", "random", "min"),
      fit.ties.meth = eval(formals(rank)$ties.method), ...)

gofMB(copula, x, N, method = c("Sn", "Rn"),
      estim.method = c("mpl", "ml", "itau", "irho"),
      test.method = c("family", "single"), verbose = interactive(),
      useR = FALSE, m = 1/2, zeta.m = 0, b = 1/sqrt(nrow(x)),
      ties.method = c("max", "average", "first", "last", "random", "min"),
      fit.ties.meth = eval(formals(rank)$ties.method), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>copula</code></td>
<td>
<p>object of class <code>"copula"</code> representing the
hypothesized copula family.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a data matrix that will be transformed to pseudo-observations
using <code>pobs()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>number of bootstrap or multiplier replications to be used to
obtain approximate realizations of the test statistic under the null
hypothesis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a <code>character</code> string specifying the
goodness-of-fit test statistic to be used.  For <code>simulation = "pb"</code>,
one of "Sn", "SnB" or "SnC" with <code>trafo.method != "none"</code> if
<code>method != "Sn"</code>.
For <code>simulation = "mult"</code>, one of
<code>"Sn"</code> or <code>"Rn"</code>, where the latter is <code class="reqn">R_n</code> from
Genest et al. (2013).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estim.method</code></td>
<td>
<p>a <code>character</code> string specifying the
estimation method to be used to estimate the dependence
parameter(s); see <code>fitCopula()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simulation</code></td>
<td>
<p>a string specifying the resampling method for
generating approximate realizations of the test statistic under the null
hypothesis; can be either <code>"pb"</code> (parametric bootstrap) or
<code>"mult"</code> (multiplier).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test.method</code></td>
<td>
<p>a <code>character</code> string specifying the
test method to be used. Only in exceptional cases should this be
different from the default <code>test.method = "family"</code>.
If <code>test.method = "single"</code>, a test precisely for the provided
copula (not its parametric family) is conducted. This makes sense only for
specific applications such as testing random number generators.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical specifying if progress of the parametric bootstrap
should be displayed via <code>txtProgressBar</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>for <code>gofCopula</code>, additional arguments passed to
<code>gofPB()</code> or <code>gofMB()</code>;
for <code>gofPB()</code> and <code>gofMB()</code>: additional arguments passed
to <code>fitCopula()</code>.  These may notably contain
<code>hideWarnings</code>, and
<code>optim.method</code>, <code>optim.control</code>, <code>lower</code>,
or <code>upper</code> depending on the <code>optim.method</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trafo.method</code></td>
<td>
<p>only for the parametric bootstrap (<code>"pb"</code>):
String specifying the transformation to
<code class="reqn">U[0,1]^d</code>; either <code>"none"</code> or one of <code>"cCopula"</code>,
see <code>cCopula()</code>, or <code>"htrafo"</code>, see
<code>htrafo()</code>.  If <code>method != "Sn"</code>, one needs to set
<code>trafo.method != "none"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trafoArgs</code></td>
<td>
<p>only for the parametric bootstrap.  A
<code>list</code> of optional arguments passed to the
transformation method (see <code>trafo.method</code> above).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useR</code></td>
<td>
<p>logical indicating whether an <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> or C implementation is
used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ties.method</code></td>
<td>
<p>string specifying how ranks should be computed,
except for fitting, if there are ties in any of the coordinate
samples of <code>x</code>; passed to <code>pobs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit.ties.meth</code></td>
<td>
<p>string specifying how ranks should be computed
when fitting by maximum pseudo-likelihood if there are ties in any
of the coordinate samples of <code>x</code>; passed to <code>pobs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ties</code></td>
<td>
<p>only for the parametric bootstrap.  Logical indicating
whether a version of the parametric boostrap adapted to the
presence of ties in any of the coordinate samples of <code>x</code>
should be used; the default value of <code>NA</code> indicates that the
presence/absence of ties will be checked for automatically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m, zeta.m</code></td>
<td>
<p>only for the multiplier with <code>method = "Rn"</code>.
<code>m</code> is the power and <code>zeta.m</code> is the adjustment
parameter <code class="reqn">\zeta_m</code> for the denominator of the test
statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>only for the multiplier.  <code>b</code> is the bandwidth required
for the estimation of the first-order partial derivatives based on
the empirical copula.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If the parametric bootstrap is used, the dependence parameters of
the hypothesized copula family can be estimated by any estimation
method available for the family, up to a few exceptions.
If the multiplier is used, any of the rank-based methods
can be used in the bivariate case, but only maximum pseudo-likelihood
estimation can be used in the multivariate (multiparameter) case.
</p>
<p>The price to pay for the higher computational efficiency of the
multiplier is more programming work as certain
partial derivatives need to be computed for each hypothesized
parametric copula family. When estimation is based on maximization of
the pseudo-likelihood, these have been implemented for six copula
families thus far: the Clayton, Gumbel-Hougaard, Frank, Plackett,
normal and <code class="reqn">t</code> copula families.  For other families, numerical
differentiation based on <code>grad()</code> from package
<a href="https://CRAN.R-project.org/package=numDeriv"><span class="pkg">numDeriv</span></a> is used (and a warning message is displayed).
</p>
<p>Although the empirical processes involved in the multiplier and the
parametric bootstrap-based test are asymptotically equivalent under
the null, the finite-sample behavior of the two tests might differ
significantly.
</p>
<p>Both for the parametric bootstrap and the multiplier,
the approximate p-value is computed as
</p>
<p style="text-align: center;"><code class="reqn">(0.5 +\sum_{b=1}^N\mathbf{1}_{\{T_b\ge T\}})/(N+1),</code>
</p>

<p>where <code class="reqn">T</code> and <code class="reqn">T_b</code> denote the test statistic and
the bootstrapped test statistc, respectively. This ensures that the
approximate p-value is a number strictly between 0 and 1, which is
sometimes necessary for further treatments. See Pesarin (2001) for
more details.
</p>
<p>For the normal and <code class="reqn">t</code> copulas, several dependence structures can
be hypothesized: <code>"ex"</code> for exchangeable, <code>"ar1"</code> for AR(1),
<code>"toep"</code> for Toeplitz, and <code>"un"</code> for unstructured (see
<code>ellipCopula()</code>). For the <code class="reqn">t</code> copula,
<code>"df.fixed"</code> has to be set to <code>TRUE</code>, which implies that the
degrees of freedom are not considered as a parameter to be estimated.
</p>
<p>The former argument <code>print.every</code> is deprecated and not
supported anymore; use <code>verbose</code> instead.
</p>


<h3>Value</h3>

<p>An object of <code>class</code> <code>htest</code> which is a list,
some of the components of which are
</p>
<table>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>value of the test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value</code></td>
<td>
<p>corresponding approximate p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameter</code></td>
<td>
<p>estimates of the parameters for the hypothesized
copula family.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>These tests were theoretically studied and implemented under the
assumption of continuous margins, which implies that ties in the
component samples occur with probability zero. The presence of ties in
the data might substantially affect the approximate p-values. Through
argument <code>ties</code>, the user can however select a version of the
parametric bootstrap adapted to the presence of ties. No such adaption
exists for the multiplier for the moment.
</p>







<h3>References</h3>

<p>Genest, C., Huang, W., and Dufour, J.-M. (2013).  A regularized
goodness-of-fit test for copulas.  <em>Journal de la
Société française de statistique</em>
<b>154</b>, 64–77.
</p>
<p>Genest, C. and Rémillard, B. (2008). Validity of the parametric
bootstrap for goodness-of-fit testing in semiparametric models.
<em>Annales de l'Institut Henri Poincare: Probabilites et Statistiques</em>
<b>44</b>, 1096–1127.
</p>
<p>Genest, C., Rémillard, B., and Beaudoin, D. (2009).
Goodness-of-fit tests for copulas: A review and a power study.
<em>Insurance: Mathematics and Economics</em> <b>44</b>, 199–214.
</p>
<p>Kojadinovic, I., Yan, J., and Holmes M. (2011).
Fast large-sample goodness-of-fit tests for copulas.
<em>Statistica Sinica</em> <b>21</b>, 841–871.
</p>
<p>Kojadinovic, I. and Yan, J. (2011). A goodness-of-fit test for
multivariate multiparameter copulas based on multiplier central limit
theorems. <em>Statistics and Computing</em> <b>21</b>, 17–30.
</p>
<p>Kojadinovic, I. and Yan, J. (2010).
Modeling Multivariate Distributions with Continuous Margins Using the
copula R Package.
<em>Journal of Statistical Software</em> <b>34</b>(9), 1–20,
<a href="https://www.jstatsoft.org/v34/i09/">https://www.jstatsoft.org/v34/i09/</a>.
</p>
<p>Kojadinovic, I. (2017). Some copula inference procedures adapted to
the presence of ties. <em>Computational Statistics and Data
Analysis</em> <b>112</b>, 24–41, <a href="https://arxiv.org/abs/1609.05519">https://arxiv.org/abs/1609.05519</a>.
</p>
<p>Pesarin, F. (2001).
<em>Multivariate Permutation Tests: With Applications in Biostatistics</em>.
Wiley.
</p>


<h3>See Also</h3>

<p><code>fitCopula()</code> for the underlying estimation procedure and
<code>gofTstat()</code> for details on *some* of the available test
statistics.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## The following example is available in batch through
## demo(gofCopula)

n &lt;- 200; N &lt;- 1000 # realistic (but too large for interactive use)
n &lt;-  60; N &lt;-  200 # (time (and tree !) saving ...)

## A two-dimensional data example ----------------------------------
set.seed(271)
x &lt;- rCopula(n, claytonCopula(3))

## Does the Gumbel family seem to be a good choice (statistic "Sn")?
gofCopula(gumbelCopula(), x, N=N)
## With "SnC", really s..l..o..w.. --- with "SnB", *EVEN* slower
gofCopula(gumbelCopula(), x, N=N, method = "SnC", trafo.method = "cCopula")
## What about the Clayton family?
gofCopula(claytonCopula(), x, N=N)

## Similar with a different estimation method
gofCopula(gumbelCopula (), x, N=N, estim.method="itau")
gofCopula(claytonCopula(), x, N=N, estim.method="itau")


## A three-dimensional example  ------------------------------------
x &lt;- rCopula(n, tCopula(c(0.5, 0.6, 0.7), dim = 3, dispstr = "un"))

## Does the Gumbel family seem to be a good choice?
g.copula &lt;- gumbelCopula(dim = 3)
gofCopula(g.copula, x, N=N)
## What about the t copula?
t.copula &lt;- tCopula(dim = 3, dispstr = "un", df.fixed = TRUE)
if(FALSE) ## this is *VERY* slow currently
  gofCopula(t.copula, x, N=N)

## The same with a different estimation method
gofCopula(g.copula, x, N=N, estim.method="itau")
if(FALSE) # still really slow
  gofCopula(t.copula, x, N=N, estim.method="itau")

## The same using the multiplier approach
gofCopula(g.copula, x, N=N, simulation="mult")
gofCopula(t.copula, x, N=N, simulation="mult")
if(FALSE) # no yet possible
    gofCopula(t.copula, x, N=N, simulation="mult", estim.method="itau")

</code></pre>


</div>