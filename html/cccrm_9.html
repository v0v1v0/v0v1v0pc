<div class="container">

<table style="width: 100%;"><tr>
<td>ccc_vc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Concordance Correlation Coefficient estimation by variance components.</h2>

<h3>Description</h3>

<p>Estimation of the concordance correlation coefficient for either non-repeated, non-longitudinal, or longitudinal repeated measurements using the variance components from a linear mixed model. The appropriate intraclass correlation coefficient is used as estimator of the concordance correlation coefficient.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ccc_vc(
  dataset,
  ry,
  rind,
  rmet = NULL,
  rtime = NULL,
  vecD = NULL,
  covar = NULL,
  int = F,
  rho = 0,
  cl = 0.95,
  control.lme = list(),
  transf = "F2",
  boot = FALSE,
  boot_param = FALSE,
  boot_ci = "BCa",
  nboot = 300,
  parallel = FALSE,
  future_seed = TRUE,
  workers = 15,
  sd_est = TRUE,
  apVar = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>an object of class <code>data.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ry</code></td>
<td>
<p>Character string. Name of the outcome in the data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rind</code></td>
<td>
<p>Character string. Name of the subject variable in the data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rmet</code></td>
<td>
<p>Character string. Name of the method variable in the data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rtime</code></td>
<td>
<p>Character string. Name of the time variable in the data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vecD</code></td>
<td>
<p>Vector of weights. The length of the vector must be the same as the number of repeated measures.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar</code></td>
<td>
<p>Character vector. Name of covariates to include in the linear mixed model as fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>int</code></td>
<td>
<p>Binary indicating if the subject-method interaction has to be included in the model when analyzing the non-longitudinal setting (defaults to FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Within subject correlation structure. A value of 0 (default option) stands for compound symmetry and 1 is used for autorregressive of order 1 structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl</code></td>
<td>
<p>Confidence level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control.lme</code></td>
<td>
<p>A list of control values for the estimation algorithm used in <code>lme</code> function. For further details see <code>lme</code> help.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transf</code></td>
<td>
<p>Character string. Whether to apply a transformation of the coefficient for inference. Valid options are: "F" for Fisher's Z-transformation; "F2" For Fisher's Z-transformation setting m=2 (default); "KG" Konishi-Gupta transformation; "None", no transformation is applied. See *Details* for further information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot</code></td>
<td>
<p>Logical. Whether to compute the CCC confidence interval by bootstrapping or asymptotic methods (defaults to FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot_param</code></td>
<td>
<p>Logical. Whether to compute a parametric bootstrap or a non-parametric bootstrap (defaults to FALSE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot_ci</code></td>
<td>
<p>Character. Type of bootstrap confidence interval. Either "BCa" (which is the default) or "empirical".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>Integer. Number of bootstrap resamples. Default is 300.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Logical. Whether the code is parallellized. The parallellization method is <code>multisession</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>future_seed</code></td>
<td>
<p>Logical/Integer. The seed to be used for parallellization. Further details in  <code>furrr_options</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>workers</code></td>
<td>
<p>Integer. Number of cores to be used for parallellization. Default is 15. Capped to number of available cores minus 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd_est</code></td>
<td>
<p>Logical. Whether to estimate the asymptotic standard deviation (defaults to TRUE) or to only report the <code>ccc/icc</code> value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apVar</code></td>
<td>
<p>Logical. Should the asymptotic variance-covariance matrix of the variance components be estimated in the linear mixed model? (Defaults to TRUE).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>To pass further arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The concordance correlation coefficient is estimated using the appropriate intraclass correlation coefficient (see Carrasco and Jover, 2003; Carrasco et al., 2009; Carrasco et al, 2013). 
</p>
<p>The scenarios considered are: a) reliability assessment (several measurements taken with one method); b) methods comparison data with non-repeated measurements (only one measurement by subject and method);
c) Methods comparison data with non-longitudinal repeated measurements, i.e. replicates (multiple measurements by subject and method); and d) Methods comparison data with longitudinal repeated measurements (multiple longitudinal measurements by subject and method).
</p>
<p>The variance components estimates are obtained from a linear mixed model (LMM) estimated by restricted maximum likelihood. The function <em>lme</em> from package <em>nlme</em> (Pinheiro et al., 2021) is used to estimate the LMM. 
</p>
<p>The standard error of CCC and its confidence interval can be obtained: a) asymptotically, using Taylor's series expansion of 1st order (Ver Hoef, 2012); b) using balanced randomized cluster bootstrap approach (Davison and Hinkley, 1997; Field and Welsh, 2007); c) using parametric bootstrap (Davison and Hinkley, 1997).
</p>
<p>When estimating asymptotically the standard error, the confidence intervals are built using the point estimate of the CCC/ICC, its standard error, and the appropriate quantile of the  standard Normal distribution.
However, the approximation to the asymptotic Normal distribution is improved if the CCC/ICC is transformed using the Fisher's Z-transformation (Fisher, 1925), or the Konishi-Gupta transformation (Konishi and Gupta, 1989).
In case the number of replicates is equal to 2, both transformations give the same result.
</p>


<h3>Value</h3>

<p>A <code>ccc</code> class object. Generic function <code>summary</code> show a summary of the results. The output is a list with the following components:
</p>

<ul>
<li> <p><code>ccc</code>. CCC/ICC estimate
</p>
</li>
<li> <p><code>model</code>. nlme object with the fitted linear mixed model.
</p>
</li>
<li> <p><code>vc</code>. Variance components estimates.
</p>
</li>
<li> <p><code>sigma</code>. Variance components asymptotic covariance matrix.
</p>
</li>
</ul>
<h3>References</h3>


<p>Carrasco, JL; Jover, L. (2003). Estimating the generalized concordance correlation coefficient through variance components. Biometrics, 59, 849:858.
</p>
<p>Carrasco, JL; King, TS; Chinchilli, VM. (2009). The concordance correlation coefficient for repeated measures estimated by variance components. Journal of Biopharmaceutical Statistics, 19, 90:105.
</p>
<p>Davison A.C., Hinkley D.V. (1997). Bootstrap Methods and Their Application. Cambridge: Cambridge University Press.
</p>
<p>Field, C.A., Welsh, A.H. (2007). Bootstrapping Clustered Data. Journal of the Royal Statistical Society. Series B (Statistical Methodology). 69(3), 369-390.
</p>
<p>Fisher, R. A. (1925) Statistical Methods for Research Workers. Edinburgh: Oliver
</p>
<p>Konishi, S. and Gupta, A. K. (1989) Testing the equality of several intraclass correlation coefficients. J Statist. Planng Inf., 21, 93-105.
</p>
<p>Pinheiro J, Bates D, DebRoy S, Sarkar D, R Core Team (2021). nlme: Linear and Nonlinear Mixed Effects Models. R package version 3.1-152, <a href="https://CRAN.R-project.org/package=nlme">https://CRAN.R-project.org/package=nlme</a>.
</p>
<p>Ver Hoef, J.M. (2012) Who Invented the Delta Method?, The American Statistician, 66:2, 124-127.

</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Scenario 1. Reliability 
newdat &lt;- bpres |&gt; dplyr::filter(METODE==1)
icc_rel&lt;-ccc_vc(newdat,"DIA","ID")
icc_rel
summary(icc_rel)

# Confidence interval using non-parametric bootstrap

icc_rel_bt&lt;-ccc_vc(newdat,"DIA","ID",boot=TRUE,sd_est=FALSE,
nboot=500,parallel=TRUE)
icc_rel_bt
summary(icc_rel_bt)


# Scenario 2. Non-longitudinal methods comparison.
# Only 1 measure by subject and method. 
# No subjects-method interaction included in the model.

newdat &lt;- bpres |&gt; dplyr::filter(NM==1)
ccc_mc&lt;-ccc_vc(newdat,"DIA","ID","METODE")
ccc_mc
summary(ccc_mc)

# Confidence interval using parametric bootstrap

ccc_mc_bt&lt;-ccc_vc(newdat,"DIA","ID",boot=TRUE,boot_param=TRUE,
sd_est=FALSE,nboot=500,parallel=TRUE)
ccc_mc_bt
summary(ccc_mc_bt)


# Scenario 3. Non-longitudinal methods comparison. 
# Two measures by subject and method. 
# No subject-method interaction included in the model.

ccc_mc_int=ccc_vc(bpres,"DIA","ID","METODE",int=TRUE,control.lme=nlme::lmeControl(opt = 'optim'))
ccc_mc_int
summary(ccc_mc_int)

# Scenario 4. Methods comparison in longitudinal repeated measures setting.
ccc_mc_lon&lt;-ccc_vc(bdaw,"AUC","SUBJ","MET","VNUM")
ccc_mc_lon
summary(ccc_mc_lon)

# Scenario 5. Methods comparison in longitudinal repeated measures setting.
# More weight given to readings from first time.

ccc_mc_lonw&lt;-ccc_vc(bfat,"BF","SUBJECT","MET","VISITNO",vecD=c(2,1,1))
ccc_mc_lonw
summary(ccc_mc_lonw)

</code></pre>


</div>