<div class="container">

<table style="width: 100%;"><tr>
<td>makeSimmap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate a character history</h2>

<h3>Description</h3>

<p>Produces a character history given some of the outputs of a corHMM object.</p>


<h3>Usage</h3>

<pre><code class="language-R">makeSimmap(tree, data, model, rate.cat, root.p="yang", nSim=1, nCores=1, fix.node=NULL,
fix.state=NULL, parsimony = FALSE, max.attempt = 1000, collapse=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>
<p>A phylogeny of class phylo.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data.frame containing species information. The first column must be species names matching the phylogeny. Additional columns contain discrete character data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>The transition rate matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rate.cat</code></td>
<td>
<p>The number of rate categories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>root.p</code></td>
<td>
<p>The root prior to begin the sampling at the root. Currently only "yang" allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nSim</code></td>
<td>
<p>The number of simmaps to be simulated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nCores</code></td>
<td>
<p>The number of cores to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.node</code></td>
<td>
<p>A vector specifying node numbers to be fixed. Also possible to fix tips if using a hidden Markov model. Tips are in the order of tree$tip.label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.state</code></td>
<td>
<p>Specifies which states to fix the nodes. States are specified according to position in the rate matrix. E.g. If I had binary observed characters 0/1 and two hidden rate classes A/B and wanted to fix a node as 1B, I would set this to 4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parsimony</code></td>
<td>
<p>A boolean indicating whether node states should be based on conditional likelihood (per Bollback 2006), or if they should be consistent with a parsimonious model (if TRUE). Parsimony states are evaluted by dividing the rates present in the variable, <code>model</code>, by 1000 and evaluating the conditional likelihood of each state. However, by lowering the rates we can approximate a parsimony reconstruction (Steel and Penny 2000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.attempt</code></td>
<td>
<p>A numeric value indicating the maximum number of attempts to create a possible path between an initial and final state on a branch. When the maximum value is reached we use the Floyd-Walsh algorithm to produce the shortest path between the two states and divide the branch into equal segments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>collapse</code></td>
<td>
<p>a boolean indicating whether to collapse multiple character combinations into only the observed states. For example, if true a two character dataset contained (0,0), (1,0), and (1,1), this would be collapsed into 1,2,3. However, if set to false it would 1,2,4. In combination with a custom rate matrix this allows for the estimation of transitions between the unobserved character combination. The default is <code>TRUE</code></p>
</td>
</tr>
</table>
<p>.
</p>


<h3>Details</h3>

<p>This function will generate a character history given a model and dataset. It has a similar structure to the simmap generated in phytools and follows the methods of Bollback (2006). If using hidden states, then it is necessary to reconstruct the tip probabilities as well as the node probabilities (i.e. get.tip.states must be <code>TRUE</code> when running <code>corHMM</code>). We chose not to implement any new plotting functions, instead <code>makeSimmap</code> produces a simmap object which is formatted so it can used with other R packages such as phytools (Revell, 2012). For additional capabilities, options, and biological examples we refer readers to the detailed _Generalized corHMM_ vignette.
</p>


<h3>Value</h3>

<p>A list of simmaps.
</p>


<h3>Author(s)</h3>

<p>James D. Boyko</p>


<h3>References</h3>

<p>Boyko, J. D., and J. M. Beaulieu. 2021. Generalized hidden Markov models for phylogenetic comparative datasets. Methods in Ecology and Evolution 12:468-478.
</p>
<p>Bollback, J. P. 2006. SIMMAP: stochastic character mapping of discrete traits on phylogenies. BMC Bioinformatics 7:88.
</p>
<p>Revell, L. J. 2012. phytools: an R package for phylogenetic comparative biology (and other things). Methods in Ecology and Evolution, 3(2), 217-223.
</p>
<p>Steel, M., and D. Penny. 2000. Parsimony, Likelihood, and the Role of Models in Molecular Phylogenetics. Molecular Biology and Evolution 17:839-850.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(primates)
phy &lt;- primates[[1]]
phy &lt;- multi2di(phy)
data &lt;- primates[[2]]

##run corhmm
MK &lt;- corHMM(phy, data, 1)

##get simmap from corhmm solution
model &lt;- MK$solution
simmap &lt;- makeSimmap(tree=phy, data=data, model=model, rate.cat=1, nSim=1, nCores=1)

## we import phytools plotSimmap for plotting
# library(phytools)
# plotSimmap(simmap[[1]])

</code></pre>


</div>