<div class="container">

<table style="width: 100%;"><tr>
<td>fitSmoothHazard</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit smooth-in-time parametric hazard functions.</h2>

<h3>Description</h3>

<p>Miettinen and Hanley (2009) explained how case-base sampling can be used to
estimate smooth-in-time parametric hazard functions. The idea is to sample
person-moments, which may or may not correspond to an event, and then fit the
hazard using logistic regression.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fitSmoothHazard(
  formula,
  data,
  time,
  family = c("glm", "gam", "glmnet"),
  censored.indicator,
  ratio = 100,
  ...
)

fitSmoothHazard.fit(
  x,
  y,
  formula_time,
  time,
  event,
  family = c("glm", "glmnet"),
  censored.indicator,
  ratio = 100,
  ...
)

prepareX(formula, data)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class "formula" (or one that can be coerced to
that class): a symbolic description of the model to be fitted. The details
of model specification are given under Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame, list or environment containing the variables in the
model. If not found in data, the variables are taken from
<code>environment(formula)</code>, typically the environment from which
<code>fitSmoothHazard</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>a character string giving the name of the time variable. See
Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a character string specifying the family of regression models
used to fit the hazard.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censored.indicator</code></td>
<td>
<p>a character string of length 1 indicating which
value in <code>event</code> is the censored. This function will use
<code>relevel</code> to set <code>censored.indicator</code> as the
reference level. This argument is ignored if the <code>event</code> variable is a
numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratio</code></td>
<td>
<p>integer, giving the ratio of the size of the base series to that
of the case series. Defaults to 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters passed to fitting functions (e.g.
<code>glm</code>, <code>glmnet</code>, <code>gam</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Matrix containing covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Matrix containing two columns: one corresponding to time, the other
to the event type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula_time</code></td>
<td>
<p>A formula describing how the hazard depends on time.
Defaults to linear.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>a character string giving the name of the event variable.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The object <code>data</code> should either be the output of the function
<code>sampleCaseBase</code> or the source dataset on which case-base
sampling will be performed. In the latter case, it is assumed that
<code>data</code> contains the two columns corresponding to the supplied time and
event variables. The variable <code>time</code> is used for the sampling the base
series, and therefore it should represent the time variable on its original
(i.e. non transformed) scale. If <code>time</code> is missing, the function looks
for a column named <code>"time"</code> in the data. Note that the event variable is
inferred from <code>formula</code>, since it is the left hand side.
</p>
<p>For single-event survival analysis, it is also possible to fit the hazard
function using <code>glmnet</code> or <code>gam</code>. The choice of fitting family is
controlled by the parameter <code>family</code>. The default value is <code>glm</code>,
which corresponds to logistic regression. For competing risk analysis, only
<code>glm</code> and <code>glmnet</code> are allowed.
</p>
<p>We also provide a matrix interface through <code>fitSmoothHazard.fit</code>, which
mimics <code>glm.fit</code>. This is mostly convenient for <code>family =
"glmnet"</code>, since a formula interface becomes quickly cumbersome as the number
of variables increases. In this setting, the matrix <code>y</code> should have two
columns and contain the time and event variables (e.g. like the output of
<code>survival::Surv</code>). We need this linear function of time in order to
perform case-base sampling. Therefore, nonlinear functions of time should be
specified as a one-sided formula through the argument <code>formula_time</code>
(the left-hand side is always ignored).
</p>
<p><code>prepareX</code> is a slightly modified version of the same function from
the <code>glmnet</code> package. It can be used to convert a data.frame to a matrix
with categorical variables converted to dummy variables using one-hot
encoding
</p>


<h3>Value</h3>

<p>An object of <code>glm</code> and <code>lm</code> when there is only one event of
interest, or of class <code>CompRisk</code>, which inherits from
<code>vglm</code>, for a competing risk analysis. As such, functions like
<code>summary</code>, <code>deviance</code> and <code>coefficients</code> give familiar
results.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Simulate censored survival data for two outcome types from exponential
# distributions
library(data.table)
nobs &lt;- 500
tlim &lt;- 20

# simulation parameters
b1 &lt;- 200
b2 &lt;- 50

# event type 0-censored, 1-event of interest, 2-competing event
# t observed time/endpoint
# z is a binary covariate
DT &lt;- data.table(z = rbinom(nobs, 1, 0.5))
DT[, `:=`(
  "t_event" = rweibull(nobs, 1, b1),
  "t_comp" = rweibull(nobs, 1, b2)
)]
DT[, `:=`(
  "event" = 1 * (t_event &lt; t_comp) + 2 * (t_event &gt;= t_comp),
  "time" = pmin(t_event, t_comp)
)]
DT[time &gt;= tlim, `:=`("event" = 0, "time" = tlim)]

out_linear &lt;- fitSmoothHazard(event ~ time + z, DT, ratio = 10)
out_log &lt;- fitSmoothHazard(event ~ log(time) + z, DT, ratio = 10)

# Use GAMs
library(mgcv)
DT[event == 2, event := 1]
out_gam &lt;- fitSmoothHazard(event ~ s(time) + z, DT,
                           ratio = 10, family = "gam")
</code></pre>


</div>