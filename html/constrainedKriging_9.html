<div class="container">

<table style="width: 100%;"><tr>
<td>constrainedKriging-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nonlinear Spatial Kriging Predictions under Change of Support</h2>

<h3>Description</h3>

<p>The package <span class="pkg">constrainedKriging</span> provides functions for
spatial interpolation by <em>constrained</em>,<br><em>covariance-matching constrained</em> and <em>universal</em>
(<em>external drift</em>) <em>Kriging</em> for points or blocks of any shape in
a two-dimensional domain from data with a non-stationary mean function and
an isotropic weakly stationary variogram.  The linear spatial interpolation
methods constrained and covariance-matching constrained Kriging provide
approximately unbiased predictions for non-linearly transformed target
values under change of support.
</p>
<p>The package provides two main user functions, <code>preCKrige</code> and
<code>CKrige</code>, to calculate spatial predictions in two steps:
</p>
 <ol>
<li> <p><code>preCKrige</code> computes the
variance-covariance matrices for sets of prediction points or
prediction blocks (polygons).
</p>
</li>
<li> <p><code>CKrige</code> computes from the output of
<code>preCKrige</code> spatial predictions by one of three Kriging
methods mentioned above.
</p>
</li>
</ol>
<h3>Details</h3>

<p> The constrained Kriging predictor introduced by
<cite>Cressie (1993)</cite> and the covariance-matching constrained Kriging
predictor proposed by <cite>Aldworth and Cressie (2003)</cite> are linear in the
data like the universal Kriging predictor.  However, the constrained
Kriging predictor satisfies in addition to the unbiasedness constraint of
universal Kriging a second constraint that matches the variances of the
predictions to the variances of the prediction targets (either point values
or block means).  The covariance-matching constrained Kriging predictor
matches for a set of points or blocks both the variances and covariances of
predictions and prediction targets and is the extended version of the
constrained Kriging predictor.  Like constrained Kriging,
covariance-matching constrained Kriging is less biased than universal
Kriging for predictions of non-linearly transformed functionals of a spatial
variable and exactly unbiased if the variable is Gaussian.  We summarize
the formulae of the three Kriging methods below for predicting block means
from point observations, but analogous equations could be given for
problems that do not involve change of support.
</p>
<p>For a set of <code class="reqn">m</code> blocks, <code class="reqn">B_1, \ldots, B_m</code>, the covariance-matching
constrained Kriging predictor is given by
</p>
<p style="text-align: center;"><code class="reqn">\widehat{\mathbf{Y}}_{\mathrm{CMCK}} =
  \mathbf{X}_{m}\widehat{\boldsymbol{\beta}}_{\mathrm{GLS}} +
  \mathbf{K}^{\prime}
  \mathbf{C}^{\prime}\boldsymbol{\Sigma}^{-1} (\mathbf{Z} -
  \mathbf{X}\widehat{\boldsymbol{\beta}}_{\mathrm{GLS}}),
</code>
</p>

<p>where
<code class="reqn">
  \mathbf{Y} = (Y(B_1), \ldots, Y(B_m))^\prime
</code> is the set of block means to be predicted,
with <code class="reqn">Y(B_i)</code> the mean value of
<code class="reqn">Y</code> averaged over the block <code class="reqn">B_i</code>;
<code class="reqn">
  \mathbf{Z} = (Z(\mathbf{s}_{1}), \ldots, Z(\mathbf{s}_{n}))^{^\prime}
</code> is the vector with data
<code class="reqn">
  Z(\mathbf{s}_{i}) = Y(\mathbf{s}_{i}) + \epsilon_i
</code> where the response
<code class="reqn">Y(\mathbf{s}_{i})</code> is possibly contaminated by measurement error
<code class="reqn">\epsilon_i</code>;
<code class="reqn">\mathbf{s} = (x,y)^{\prime}</code> indicates a location in
the survey domain;
<code class="reqn">
  \mathbf{X} = (\mathbf{x}(\mathbf{s}_{1}), \ldots,
  \mathbf{x}(\mathbf{s}_{n}))^{\prime}
</code>
is the design matrix of the data and
<code class="reqn">
  \mathbf{X}_m = (\mathbf{x}(B_{1}), \ldots, \mathbf{x}(B_{m}))^{\prime}
</code>  the design matrix of the target blocks;
<code class="reqn">\widehat{\boldsymbol{\boldsymbol{\beta}}}_{\mathrm{GLS}}</code>
is the vector with the generalised least square estimate of the
linear regression coefficients;
<code class="reqn">
  \mathbf{C} = (\mathbf{c}_{1}, \ldots, \mathbf{c}_{m})
</code> is a <code class="reqn">(n\times m)</code>-matrix that
contains the covariances between the <code class="reqn">n</code> data points and the <code class="reqn">m</code>
prediction targets;
<code class="reqn">\boldsymbol{\Sigma}</code> is the <code class="reqn">(n\times n)</code>-covariance
matrix of the data;
and <code class="reqn">\mathbf{K}</code> is the <code class="reqn">(m \times m)</code>-matrix
</p>
<p style="text-align: center;"><code class="reqn">
  \mathbf{K} = \mathbf{Q}_{1}^{-1}\mathbf{P_{1}},
</code>
</p>

<p>where <code class="reqn">\mathbf{P}_{1}</code> is the <code class="reqn">(m \times m)</code>-matrix
</p>
<p style="text-align: center;"><code class="reqn">
  \mathbf{P}_{1} = ( \mathrm{Cov}[\mathbf{Y}, \mathbf{Y}^{\prime}] -
    \mathrm{Cov}[\mathbf{X}_{m}\widehat{\boldsymbol{\boldsymbol{\beta}}}_{\mathrm{GLS}},
   (\mathbf{X}_{m}\widehat{\boldsymbol{\boldsymbol{\beta}}}_{\mathrm{GLS}})^{\prime}] )^{\frac{1}{2}}
</code>
</p>

<p>and <code class="reqn">\mathbf{Q}_{1}</code> the <code class="reqn">(m \times m)</code>-matrix
</p>
<p style="text-align: center;"><code class="reqn">
  \mathbf{Q}_{1} = (\mathrm{Cov}[\widehat{\mathbf{Y}}_{\mathrm{UK}},
  \widehat{\mathbf{Y}}_{\mathrm{UK}}^{\prime}] -
  \mathrm{Cov}[\mathbf{X}_{m}\widehat{\boldsymbol{\boldsymbol{\beta}}}_{\mathrm{GLS}},
  (\mathbf{X}_{m}\widehat{\boldsymbol{\boldsymbol{\beta}}}_{\mathrm{GLS}})^{\prime}])^{\frac{1}{2}}
</code>
</p>

<p>with
</p>
<p style="text-align: center;"><code class="reqn">\widehat{\mathbf{Y}}_{\mathrm{UK}} =
  \mathbf{X}_{m}\widehat{\boldsymbol{\beta}}_{\mathrm{GLS}} +
  \mathbf{C}^{\prime}\boldsymbol{\Sigma}^{-1} (\mathbf{Z} -
  \mathbf{X}\widehat{\boldsymbol{\beta}}_{\mathrm{GLS}}),
</code>
</p>

<p>denoting the universal Kriging predictor of <code class="reqn">\mathbf{Y}</code>.
</p>
<p>For <code class="reqn">m = 1</code> <code class="reqn">\widehat{\mathbf{Y}}_{\mathrm{CMCK}}</code> reduces
to the constrained Kriging predictor
</p>
<p style="text-align: center;"><code class="reqn">\widehat{Y}_{\mathrm{CK}}(B_1) =
  \mathbf{x}(B_1)^{\prime}\widehat{\boldsymbol{\beta}}_{\mathrm{GLS}} + K
  \mathbf{c_1}^{\prime} \boldsymbol{\Sigma}^{-1} ( \mathbf{Z} -
  \mathbf{X}\widehat{\boldsymbol{\beta}}_{\mathrm{GLS}}) ,
</code>
</p>

<p>with the scalar
</p>
<p style="text-align: center;"><code class="reqn">
  K = (\mathrm{Var}[Y(B_1)] -
  \mathrm{Var}[\mathbf{x}(B_1)^{\prime}\widehat{\boldsymbol{\boldsymbol{\beta}}}_{\mathrm{GLS}}] )^{\frac{1}{2}} /
  (\mathrm{Var}[\widehat{Y}_{\mathrm{UK}}(B_1)] - \mathrm{Var}[
  \mathbf{x}(B_1)^{\prime}\widehat{\boldsymbol{\boldsymbol{\beta}}}_{\mathrm{GLS}}] )^{\frac{1}{2}} =
  (P/Q)^{\frac{1}{2}}.
</code>
</p>

<p>The mean square prediction error (MSEP) of
<code class="reqn">\widehat{\mathbf{Y}}_{\mathrm{CMCK}}</code> is given by
</p>
<p style="text-align: center;"><code class="reqn">
  \mathrm{MSPE}[\widehat{\mathbf{Y}}_{\mathrm{CMCK}}] = \mathrm{MSPE}[
  \widehat{\mathbf{Y}}_{\mathrm{UK}} ] +
  (\mathbf{P}_{1}-\mathbf{Q}_{1})(\mathbf{P}_{1}-\mathbf{Q}_{1}).
</code>
</p>

<p>and of <code class="reqn">\widehat{Y}_{\mathrm{CK}}(B_1)</code> by
</p>
<p style="text-align: center;"><code class="reqn">
  \mathrm{MSPE}[\widehat{Y}_{\mathrm{CK}}(B_{1})] = \mathrm{MSPE}[
  \widehat{Y}_{\mathrm{UK}}(B_{1})] + (P^{\frac{1}{2}} - Q^{\frac{1}{2}})^{2},
</code>
</p>

<p>where the MSEP of universal Kriging is given by
</p>
<p style="text-align: center;"><code class="reqn">
  \mathrm{MSPE}[\widehat{\mathbf{Y}}_\mathrm{UK}] =
  \mathrm{Cov}[\mathbf{Y}, \mathbf{Y}^{\prime}] -
  \mathbf{C}^{\prime}\boldsymbol{\Sigma}^{-1}\mathbf{C} +
  (\mathbf{X}_{m}^{\prime} - \mathbf{X}^{\prime}\boldsymbol{\Sigma}^{-1}\mathbf{C})^{\prime}
  (\mathbf{X}^{\prime}\boldsymbol{\Sigma}^{-1}\mathbf{X})^{-1}
  (\mathbf{X}_{m}^{\prime} - \mathbf{X}^{\prime}\boldsymbol{\Sigma}^{-1}\mathbf{C}).
</code>
</p>



<h3>Author(s)</h3>

<p>Christoph Hofer, <a href="mailto:christoph.hofer@alumni.ethz.ch">christoph.hofer@alumni.ethz.ch</a>
</p>


<h3>References</h3>


<p>Aldworth, J. and Cressie, N. (2003). Prediction of non-linear spatial
functionals. <em>Journal of Statistical Planning and Inference</em>,
<b>112</b>, 3–41, <a href="https://doi.org/10.1016/S0378-3758%2802%2900321-X">doi:10.1016/S0378-3758(02)00321-X</a>.
</p>
<p>Cressie, N. (1993). Aggregation in geostatistical problems. In
A. Soares, editor, <em>Geostatistics Troia 92</em>, <b>1</b>, pages 25–36,
Dordrecht. Kluwer Academic Publishers, <a href="https://doi.org/10.1007/978-94-011-1739-5_3">doi:10.1007/978-94-011-1739-5_3</a>.
</p>
<p>Hofer, C. and Papritz, A. (2010).  Predicting threshold exceedance by
local block means in soil pollution surveys.  <em>Mathematical
Geosciences</em>.  <b>42</b>, 631–656, <a href="https://doi.org/10.1007/s11004-010-9287-4">doi:10.1007/s11004-010-9287-4</a>
</p>
<p>Hofer, C. and Papritz, A. (2011).  constrainedKriging: an R-package
for customary, constrained and covariance-matching constrained point
or block Kriging.  <em>Computers &amp; Geosciences</em>. <b>37</b>, 1562–1569,
<a href="https://doi.org/10.1016/j.cageo.2011.02.009">doi:10.1016/j.cageo.2011.02.009</a>
</p>


</div>