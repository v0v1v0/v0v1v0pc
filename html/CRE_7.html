<div class="container">

<table style="width: 100%;"><tr>
<td>cre</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Causal rule ensemble</h2>

<h3>Description</h3>

<p>Performs the Causal Rule Ensemble on a data set with a response variable,
a treatment variable, and various features.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cre(y, z, X, method_params = NULL, hyper_params = NULL, ite = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>An observed response vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>A treatment vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>A covariate matrix (or a data frame). Should be provided as
numerical values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method_params</code></td>
<td>
<p>The list of parameters to define the models used,
including:
</p>

<ul>
<li> <p><em>Parameters for Honest Splitting</em>
</p>

<ul><li> <p><em>ratio_dis</em>: The ratio of data delegated to rules discovery
(default: 0.5).
</p>
</li></ul>
</li>
<li> <p><em>Parameters for Discovery and Inference</em>
</p>

<ul>
<li> <p><em>ite_method</em>: The method for ITE (pseudo-outcome) estimation
(default: <code>"aipw"</code>, options: <code>"aipw"</code> for Augmented Inverse
Probability Weighting, <code>"cf"</code> for Causal Forest, <code>"bart"</code> for
Causal Bayesian Additive Regression Trees, <code>"slearner"</code> for S-Learner,
<code>"tlearner"</code> for T-Learner, <code>"xlearner"</code> for X-Learner,
<code>"tpoisson"</code> for T-Learner with Poisson regression).
</p>
</li>
<li> <p><em>learner_ps</em>: The model for the propensity score estimation
(default: <code>"SL.xgboost"</code>, options: any SuperLearner prediction model
i.e., <code>"SL.lm"</code>, <code>"SL.svm"</code>, used only for <code>"aipw"</code>,
<code>"bart"</code>, <code>"cf"</code> ITE estimators).
</p>
</li>
<li> <p><em>learner_y</em>: The model for the outcome estimation
(default: <code>"SL.xgboost"</code>, options: any SuperLearner prediction model
i.e., <code>"SL.lm"</code>, <code>"SL.svm"</code>, used only for <code>"aipw"</code>,
<code>"slearner"</code>, <code>"tlearner"</code> and <code>"xlearner"</code> ITE
estimators).
</p>
</li>
</ul>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyper_params</code></td>
<td>
<p>The list of hyper parameters to fine-tune the method,
including:
</p>

<ul>
<li> <p><em>General hyper parameters</em>
</p>

<ul>
<li> <p><em>intervention_vars</em>: Array with intervention-able covariates names used
for Rules Generation. Empty or null array means that all the covariates
are considered as intervention-able (default: <code>NULL</code>).
</p>
</li>
<li> <p><em>ntrees</em>: The number of decision trees for random forest (default: 20).
</p>
</li>
<li> <p><em>node_size</em>: Minimum size of the trees' terminal nodes (default: 20).
</p>
</li>
<li> <p><em>max_rules</em>: Maximum number of generated candidates rules (default: 50).
</p>
</li>
<li> <p><em>max_depth</em>: Maximum rules length (default: 3).
</p>
</li>
<li> <p><em>t_decay</em>: The decay threshold for rules pruning. Higher values will
carry out an aggressive pruning (default: 0.025).
</p>
</li>
<li> <p><em>t_ext</em>: The threshold to truncate too generic or too specific (extreme)
rules (default: 0.01, range: [0, 0.5)).
</p>
</li>
<li> <p><em>t_corr</em>: The threshold to define correlated rules (default: 1,
range: <code style="white-space: pre;">⁠[0,+inf)⁠</code>).
</p>
</li>
<li> <p><em>stability_selection</em>: Method for stability selection for selecting the
rules. <code>"vanilla"</code> for stability selection, <code>"error_control"</code>
for stability selection with error control and  <code>"no"</code> for no
stability selection (default: <code>"vanilla"</code>).
</p>
</li>
<li> <p><em>B</em>: Number of bootstrap samples for stability selection in rules
selection and uncertainty quantification in estimation (default: 20).
</p>
</li>
<li> <p><em>subsample</em>: Bootstrap ratio subsample for stability selection in rules
selection and uncertainty quantification in estimation (default: 0.5).
</p>
</li>
</ul>
</li>
<li> <p><em>Method specific hyper parameters</em>
</p>

<ul>
<li> <p><em>offset</em>: Name of the covariate to use as offset (i.e., <code>"x1"</code>) for
T-Poisson ITE estimation. Use <code>NULL</code> if offset is not used (default:
<code>NULL</code>).
</p>
</li>
<li> <p><em>cutoff</em>:  Threshold (percentage) defining the minimum cutoff value for
the stability scores for Stability Selection (default: 0.9).
</p>
</li>
<li> <p><em>pfer</em>: Upper bound for the per-family error rate (tolerated amount of
falsely selected rules) for Error Control Stability Selection (default: 1).
</p>
</li>
</ul>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ite</code></td>
<td>
<p>The estimated ITE vector. If given both the ITE estimation steps
in Discovery and Inference are skipped (default: <code>NULL</code>).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An S3 object composed by:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>M</code></td>
<td>
<p>the number of Decision Rules extracted at each step,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CATE</code></td>
<td>
<p>the data.frame of Conditional Average Treatment Effect
decomposition estimates with corresponding uncertainty quantification,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method_params</code></td>
<td>
<p>the list of method parameters,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyper_params</code></td>
<td>
<p>the list of hyper parameters,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rules</code></td>
<td>
<p>the list of rules (implicit form) decomposing the CATE.</p>
</td>
</tr>
</table>
<h3>Note</h3>


<ul><li>
<p> If <code>intervention_vars</code> are provided, it is important to note that the
individual treatment effect will still be computed using all covariates.
</p>
</li></ul>
<h3>Examples</h3>

<pre><code class="language-R">

set.seed(123)
dataset &lt;- generate_cre_dataset(n = 400,
                                rho = 0,
                                n_rules = 2,
                                p = 10,
                                effect_size = 2,
                                binary_covariates = TRUE,
                                binary_outcome = FALSE,
                                confounding = "no")
y &lt;- dataset[["y"]]
z &lt;- dataset[["z"]]
X &lt;- dataset[["X"]]

method_params &lt;- list(ratio_dis = 0.5,
                      ite_method ="aipw",
                      learner_ps = "SL.xgboost",
                      learner_y = "SL.xgboost")

hyper_params &lt;- list(intervention_vars = NULL,
                     offset = NULL,
                     ntrees = 20,
                     node_size = 20,
                     max_rules = 50,
                     max_depth = 3,
                     t_decay = 0.025,
                     t_ext = 0.025,
                     t_corr = 1,
                     stability_selection = "vanilla",
                     cutoff = 0.6,
                     pfer = 1,
                     B = 20,
                     subsample = 0.5)

cre_results &lt;- cre(y, z, X, method_params, hyper_params)


</code></pre>


</div>