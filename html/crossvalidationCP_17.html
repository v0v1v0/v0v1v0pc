<div class="container">

<table style="width: 100%;"><tr>
<td>VfoldCV</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>V-fold cross-validation</h2>

<h3>Description</h3>

<p>Selects the number of change-points by minimizing a V-fold cross-validation criterion. The criterion, the estimator, and the number of folds can be specified by the user.
</p>


<h3>Usage</h3>

<pre><code class="language-R">VfoldCV(Y, V = 5L, Kmax = 8L, adaptiveKmax = TRUE, tolKmax = 3L, estimator = leastSquares,
        criterion = criterionL1loss, output = c("param", "fit", "detailed"), ...) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>the observations, can be any data type that supports the function <code>length</code> and the operator <code>[]</code> and can be passed to <code>estimator</code> and <code>criterion</code>, e.g. a numeric vector or a list. Support for <code>matrices</code>, i.e. for multivariate data, is planned but not implemented so far</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>V</code></td>
<td>
<p>a single integer giving the number of folds. Ordered folds will automatically be created, i.e. fold <code>i</code> will be <code>seq(i, length(Y), folds)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Kmax</code></td>
<td>
<p>a single integer giving maximal number of change-points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptiveKmax</code></td>
<td>
<p>a single logical indicating whether <code>Kmax</code> should be chosen adaptively. If true <code>Kmax</code> will be double if the estimated number of change-points is not at least <code>Kmax - tolKmax</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolKmax</code></td>
<td>
<p>a single integer specifiying how much the estimated number of change-points have to be smaller than <code>Kmax</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimator</code></td>
<td>
<p>a function providing a local estimate. For pre-implemented estimators see estimators. The function must have the arguments <code>Y</code>, <code>param</code> and <code>...</code>, where <code>Y</code> will be a subset of the observations, <code>param</code> will be <code>list(0:Kmax)</code>, and <code>...</code> will be the argument <code>...</code> of <code>VfoldCV</code>. Note that <code>...</code> will be passed to <code>estimator</code> and <code>criterion</code>. The return value must be either a list of length <code>length(param)</code> with each entry containing the estimated change-point locations for the given entry in <code>param</code> or a list containing the named entries <code>cps</code> and <code>value</code>. In this case <code>cps</code> has to be a list of the estimated change-points as before and <code>value</code> has to be a list of the locally estimated values for each entry in <code>param</code>, i.e. each list entry has to be a list itself of length one entry longer than the corresponding entry in <code>cps</code>. The function <code>convertSingleParam</code> offers the conversion of an estimator allowing a single parameter into an estimator allowing multiple parameters. From the currently pre-implemented estimators only <code>leastSquares</code> accepts <code>param == list(0:Kmax)</code>. Estimators that allow <code>param</code> to differ from <code>list(0:Kmax)</code> can be used in <code>crossvalidationCP</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>a function providing the cross-validation criterion. For pre-implemented criteria see criteria. The function must have the arguments <code>testset</code>, <code>estset</code> and <code>value</code>. <code>testset</code> and <code>estset</code> are the observations of one segment that are in the test and estimation set, respectively. <code>value</code> is the local parameter on the segment if provided by <code>estimator</code>, otherwise <code>NULL</code>. Additionally, <code>...</code> is possible and potentially necessary to absorb arguments, since the argument <code>...</code> of <code>VfoldCV</code> will be passed to <code>estimator</code> and <code>criterion</code>. It must return a single numeric. All return values will be summed accordingly and <code>which.min</code> will be called on the vector to determine the parameter with the smallest criterion. Hence some <code>NaN</code> values etc. are allowed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>a string specifying the output, either <code>"param"</code>, <code>"fit"</code> or <code>"detailed"</code>. For details what they mean see <cite>Value</cite></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional parameters that are passed to <code>estimator</code> and <code>criterion</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>if <code>output == "param"</code>, the selected number of change-points, i.e. an integer between <code>0</code> and <code>Kmax</code>. If <code>output == "fit"</code>, a list with the entries <code>param</code>, giving the selected number of change-points, and <code>fit</code>. The named entry <code>fit</code> is a list giving the returned fit obtained by applying <code>estimator</code> to the whole data <code>Y</code> with the selected tuning parameter. The returned value is transformed to a list with an entry <code>cps</code> giving the estimated change-points and, if provided by <code>estimator</code>, an entry <code>value</code> giving the estimated local values. If <code>output == "detailed"</code>, the same as for <code>output == "fit"</code>, but additionally an entry <code>CP</code> giving all calculated cross-validation criteria. Those values are summed over all folds
</p>


<h3>References</h3>

<p>Pein, F., and Shah, R. D. (2021) Cross-validation for change-point regression: pitfalls and solutions. <em>arXiv:2112.03220</em>.
</p>


<h3>See Also</h3>

<p>estimators, criteria, <code>convertSingleParam</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># call with default parameters:
# 5-fold cross-validation with absolute error loss, least squares estimation,
# and 0 to 5 change-points
VfoldCV(Y = rnorm(100))

# more interesting data and more detailed output
set.seed(1L)
Y &lt;- c(rnorm(50), rnorm(50, 5), rnorm(50), rnorm(50, 5))
VfoldCV(Y = Y, output = "detailed")
# finds the correct change-points at 50, 100, 150
# (plus the start and end points 0 and 200)

# reducing the number of folds to 3
VfoldCV(Y = Y, V = 3L, output = "detailed")

# reducing the maximal number of change-points to 2
VfoldCV(Y = Y, Kmax = 2)

# different criterion: modified error loss
VfoldCV(Y = Y, output = "detailed", criterion = criterionMod)

# manually given criterion; identical to criterionL1loss()
testCriterion &lt;- function(testset, estset, value = NULL, ...) {
  if (!is.null(value)) {
    return(sum(abs(testset - value)))
  }
  
  sum(abs(testset - mean(estset)))
}
identical(VfoldCV(Y = Y, criterion = testCriterion, output = "detailed"),
          VfoldCV(Y = Y, output = "detailed"))
</code></pre>


</div>