<div class="container">

<table style="width: 100%;"><tr>
<td>PanelEstimation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Variance estimation for panel data</h2>

<h3>Description</h3>

<p>Variance estimation of linear combinations of totals and ratios based on
output from wideFromCalibrate
</p>


<h3>Usage</h3>

<pre><code class="language-R">PanelEstimation(
  x,
  numerator,
  denominator = NULL,
  linComb = matrix(0, 0, n),
  linComb0 = NULL,
  estType = "robustModel",
  leveragePower = 1/2,
  group = NULL,
  returnCov = FALSE,
  usewGross = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Output from wideFromCalibrate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numerator</code></td>
<td>
<p>y variable name or number.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>denominator</code></td>
<td>
<p>y variable name or number.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linComb</code></td>
<td>
<p>Matrix defining linear combinations of waves.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linComb0</code></td>
<td>
<p>Linear combination matrix to be used prior to ratio
calculations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estType</code></td>
<td>
<p>Estimation type: "robustModel" (default), "ssbAKU",
"robustModelww", "robustModelGroup" or "robustModelGroupww" (see below)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>leveragePower</code></td>
<td>
<p>Power used when adjusting residuals using leverages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>Extra variable name or number for cluster robust estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returnCov</code></td>
<td>
<p>Return covariance matrices instead of variance vectors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usewGross</code></td>
<td>
<p>Use wGross (if avaliable) instead of design weights to
adjust covariance matrix in the case of NA popTotals</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When denominator=NULL, only estimates for a single y-variable (numerator)
are calculated. When denominator is specified, estimates for numerator,
denominator and ratio are calculated. The default estimation type parameter,
"robustModel", is equation (12) in paper. "ssbAKU" is (16), "robustModelww"
is (9) and "robustModelGroup" and "robustModelGroupww" are cluster robust
variants based on <code class="reqn">(w-1)^2</code> and <code class="reqn">w^2</code> .
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>wTot</code></td>
<td>
<p>Sum of weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimates</code></td>
<td>
<p>Ordinary estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linCombs</code></td>
<td>
<p>Estimates of linear combinations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varEstimates</code></td>
<td>
<p>Variance of estimates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varLinCombs</code></td>
<td>
<p>Variance of
estimates of linear combinations</p>
</td>
</tr>
</table>
<p> When denominator is specified the above
output refer to ratios. Then, similar output for numerator and denominator
are also included.
</p>


<h3>See Also</h3>

<p><code>CalibrateSSB</code>, <code>CalSSBobj</code>, <code>WideFromCalibrate</code>, <code>CalibrateSSBpanel</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Generates data  - two years
z    = AkuData(3000)  # 3000 in each quarter
zPop = AkuData(10000)[,1:7]

# Calibration and "WideFromCalibrate"
b = CalibrateSSB(z,calmodel="~ sex*age", partition=c("year","q"),
        popData=zPop, y=c("unemployed","workforce"))
bWide = WideFromCalibrate(b,CrossStrata(z[,c("year","q")]),z$id)

# Define linear combination matrix
lc = rbind(LagDiff(8,4),PeriodDiff(8,4))
rownames(lc) = c("diffQ1","diffQ2","diffQ3","diffQ4","diffYearMean")
colnames(lc) = colnames(head(bWide$y[[1]]))
lc

# Unemployed: Totals and linear combinations
d1=PanelEstimation(bWide,"unemployed",linComb=lc)  #

# Table of output
cbind(tot=d1$estimates,se=sqrt(d1$varEstimates))
cbind(tot=d1$linCombs,se=sqrt(d1$varLinCombs))

# Ratio: Totals and linear combinations
d=PanelEstimation(bWide,numerator="unemployed",denominator="workforce",linComb=lc)
cbind(tot=d$estimates,se=sqrt(d$varEstimates))
cbind(tot=d$linCombs,se=sqrt(d$varLinCombs))

## Not run: 
# Calibration when som population totals unknown (edu)
# Leverages in output (will be used to adjust residuals)
# Cluster robust estimation (families/famid)
b2 = CalibrateSSB(z,popData=zPop,calmodel="~ edu*sex + sex*age",
           partition=c("year","q"), y=c("unemployed","workforce"),
           leverageOutput=TRUE)
b2Wide = WideFromCalibrate(b2,CrossStrata(z[,c("year","q")]),z$id,extra=z$famid)
d2 = PanelEstimation(b2Wide,"unemployed",linComb=lc,group=1,estType = "robustModelGroup")
cbind(tot=d2$linCombs,se=sqrt(d2$varLinCombs))

## End(Not run)


# Yearly mean before ratio calculation (linComb0)
# and difference between years (linComb)
g=PanelEstimation(bWide,numerator="unemployed",denominator="workforce",
    linComb= LagDiff(2),linComb0=Period(8,4))
cbind(tot=g$linCombs,se=sqrt(g$varLinCombs))

</code></pre>


</div>