<div class="container">

<table style="width: 100%;"><tr>
<td>calc.Crude</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Crude event probabilities</h2>

<h3>Description</h3>

<p>Function for computing crude event probabilties based on relative survival models.
</p>


<h3>Usage</h3>

<pre><code class="language-R">calc.Crude(
  object,
  newdata = NULL,
  type = c("disease", "other", "condother"),
  time = NULL,
  tau = 100,
  reverse = FALSE,
  var.type = c("ci", "se", "n"),
  exp.fun = NULL,
  ratetable = cuRe::survexp.dk,
  rmap,
  scale = ayear,
  smooth.exp = FALSE,
  pars = NULL,
  link = "loglog",
  n = 100
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Fitted model to do predictions from. Possible classes are
<code>gfcm</code>, <code>cm</code>, <code>stpm2</code>, and <code>pstpm2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>Data frame from which to compute predictions. If empty, predictions are made on the the data which
the model was fitted on.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Probability to compute. Possible values are <code>disease</code> (default),
<code>other</code>, and <code>condother</code> (see details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>Time points at which to compute predictions. If empty, a grid of 100 time points between 0
and <code>tau</code> is selected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>Upper bound of the integral used to compute the probability of disease-related death (see details).
The argument is only used for <code>type = condother</code>. Default is 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reverse</code></td>
<td>
<p>Logical. If <code>TRUE</code>, 1 - probability is provided (default is <code>FALSE</code>).
Only applicable for <code>type = condother</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.type</code></td>
<td>
<p>Character. Possible values are "<code>ci</code>" (default) for confidence intervals,
"<code>se</code>" for standard errors, and "<code>n</code>" for neither.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp.fun</code></td>
<td>
<p>Object of class <code>list</code> containing functions for the expected survival
of each row in <code>newdata</code>. If not specified, the function computes the expected
survival based on <code>newdata</code> using the <code>survival::survexp</code> function. If <code>newdata</code> is not provided,
the expected survival is based on the data which the model was fitted on.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratetable</code></td>
<td>
<p>Object of class <code>ratetable</code> used to compute the general population survival.
Default is <code>survexp.dk</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rmap</code></td>
<td>
<p>List to be passed to <code>survexp</code> from the <code>survival</code> package if <code>exp.fun = NULL</code>.
Detailed documentation on this argument can be found by <code>?survexp</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>Numeric. Passed to the <code>survival::survexp</code> function and defaults to 365.24.
That is, the time scale is assumed to be in years.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth.exp</code></td>
<td>
<p>Logical. If <code>TRUE</code>, the general population survival function is smoothed by the function
<code>smooth.spline</code> using the the argument <code>all.knots = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pars</code></td>
<td>
<p>A vector of parameter values for the model given in <code>object</code>. Currently not used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link</code></td>
<td>
<p>Link function for computing variance in order to restrict confidence intervals to [0, 1].
Default is <code>loglog</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Number of knots used for the Gauss-Legendre quadrature.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function estimates crude probabilities by using the relative survival, expected survival,
and the cause-specific hazard function.
The crude cumulative incidence of disease-related death (<code>type = "disease"</code>) is
</p>
<p style="text-align: center;"><code class="reqn">P(T \leq t, D = disease) = \int_0^t S^*(u) R(u) \lambda(u)du.</code>
</p>

<p>The crude cumulative incidence of death from other causes (<code>type = "other"</code>) is
</p>
<p style="text-align: center;"><code class="reqn">P(T \leq t, D = other) = \int_0^t S^*(u) R(u) h^*(u)du.</code>
</p>

<p>The conditional probability of eventually dying from other causes than disease (<code>type = "condother"</code>) is
</p>
<p style="text-align: center;"><code class="reqn">P(D = other| T &gt; t) = \frac{P(D = disease) - P(T \leq t, D = disease)}{P(T &gt; t)}.</code>
</p>

<p>The probability of disease-related death, P(D = disease),
can be computed by using <code>type = "disease"</code> and choosing a sufficiently large time point.
For P(D = other| T&gt;t), the argument <code>tau</code> controls this time point (default is 100).
</p>


<h3>Value</h3>

<p>A list containing the crude probability estimates
of each individual in <code>newdata</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">##Use data cleaned version of the colon disease data from the rstpm2 package
data("colonDC")
set.seed(2)
colonDC &lt;- colonDC[sample(1:nrow(colonDC), 1000), ]

##Extract general population hazards
colonDC$bhaz &lt;- general.haz(time = "FU", rmap = list(age = "agedays", sex = "sex", year= "dx"),
                            data = colonDC, ratetable = survexp.dk)

##Spline-base cure model
#Fit cure model
fit &lt;- rstpm2::stpm2(Surv(FUyear, status) ~ 1, data = colonDC, df = 6,
                     bhazard = colonDC$bhaz, cure = TRUE)

#Compute the probability of disease-related death
res &lt;- calc.Crude(fit, time = seq(0, 20, length.out = 50),
                  rmap = list(age = agedays, sex = sex, year = dx),
                  var.type = "n")
plot(res)

#Compute the conditional probability of dying from other causes than disease
res &lt;- calc.Crude(fit, time = seq(0, 20, length.out = 50), type = "condother",
                  rmap = list(age = agedays, sex = sex, year = dx), var.type = "n")
plot(res)


#Simple parametric cure model
#Fit cure model
fit &lt;- fit.cure.model(Surv(FUyear, status) ~ 1, data = colonDC, bhazard = "bhaz",
                      type = "mixture", dist = "weibull", link = "logit")

#Compute the probability of disease-related death
res &lt;- calc.Crude(fit, time = seq(0, 20, length.out = 50),
                  rmap = list(age = agedays, sex = sex, year = dx),
                  var.type = "n")
plot(res)

#Compute the conditional probability of disease-related death
res2 &lt;- calc.Crude(fit, time = seq(0, 20, length.out = 50), type = "condother",
                  rmap = list(age = agedays, sex = sex, year = dx), reverse = TRUE,
                  var.type = "n")
plot(res2)
</code></pre>


</div>