<div class="container">

<table style="width: 100%;"><tr>
<td>bsplineD</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>B-spline Derivatives</h2>

<h3>Description</h3>

<p>Generate the first and second derivatives of a B-spline Basis.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bsplineD(
  x,
  iknots = NULL,
  df = NULL,
  bknots = range(x),
  order = 4L,
  derivative = 1L
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a numeric vector</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iknots</code></td>
<td>
<p>internal knots</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>degrees of freedom: sum of the order and internal knots.  Ignored
if <code>iknots</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bknots</code></td>
<td>
<p>boundary knot locations, defaults to <code>range(x)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>order of the piecewise polynomials, defaults to 4L.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>derivative, </code></td>
<td>
<p>(integer) first or second derivative</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a numeric matrix
</p>


<h3>References</h3>

<p>C. de Boor, "A practical guide to splines. Revised Edition," Springer, 2001.
</p>
<p>H. Prautzsch, W. Boehm, M. Paluszny, "Bezier and B-spline Techniques," Springer, 2002.
</p>


<h3>See Also</h3>

<p><code>bsplines</code> for bspline basis.  <code>get_spline</code>
will give you the spline or the derivative thereof for a control polygon.
</p>


<h3>Examples</h3>

<pre><code class="language-R">################################################################################
# Example 1 - pefectly fitting a cubic function
f &lt;- function(x) {
  x^3 - 2 * x^2 - 5 * x + 6
}

fprime &lt;- function(x) { # first derivatives of f(x)
  3 * x^2 - 4 * x - 5
}

fdoubleprime &lt;- function(x) { # second derivatives of f(x)
  6 * x - 4
}

# Build a spline to fit
bknots = c(-3, 5)

x     &lt;- seq(-3, 4.999, length.out = 200)
bmat  &lt;- bsplines(x, bknots = bknots)
theta &lt;- matrix(coef(lm(f(x) ~ bmat + 0)), ncol = 1)

bmatD1 &lt;- bsplineD(x, bknots = bknots, derivative = 1L)
bmatD2 &lt;- bsplineD(x, bknots = bknots, derivative = 2L)

# Verify that we have perfectly fitted splines to the function and its
# derivatives.
# check that the function f(x) is recovered
all.equal(f(x), as.numeric(bmat %*% theta))
all.equal(fprime(x), as.numeric(bmatD1 %*% theta))
all.equal(fdoubleprime(x), as.numeric(bmatD2 %*% theta))

# Plot the results
old_par &lt;- par()
par(mfrow = c(1, 3))
plot(x, f(x), type = "l", main = bquote(f(x)), ylab = "", xlab = "")
points(x, bmat %*% theta, col = 'blue')
grid()

plot(
    x
  , fprime(x)
  , type = "l"
  , main = bquote(frac(d,dx)~f(x))
  , ylab = ""
  , xlab = ""
)
points(x, bmatD1 %*% theta, col = 'blue')
grid()

plot(
    x
  , fdoubleprime(x)
  , type = "l"
  , main = bquote(frac(d^2,dx^2)~f(x))
  , ylab = ""
  , xlab = ""
)
points(x, bmatD2 %*% theta, col = 'blue')
grid()

par(old_par)

################################################################################
# Example 2
set.seed(42)

xvec &lt;- seq(0.1, 9.9, length = 1000)
iknots &lt;- sort(runif(rpois(1, 3), 1, 9))
bknots &lt;- c(0, 10)

# basis matrix and the first and second derivatives thereof, for cubic
# (order = 4) b-splines
bmat  &lt;- bsplines(xvec, iknots, bknots = bknots)
bmat1 &lt;- bsplineD(xvec, iknots, bknots = bknots, derivative = 1)
bmat2 &lt;- bsplineD(xvec, iknots, bknots = bknots, derivative = 2)

# control polygon ordinates
theta &lt;- runif(length(iknots) + 4L, -5, 5)

# plot data
plot_data &lt;-
  data.frame(
      Spline            = as.numeric(bmat %*% theta)
    , First_Derivative  = as.numeric(bmat1 %*% theta)
    , Second_Derivative = as.numeric(bmat2 %*% theta)
  )
plot_data &lt;- stack(plot_data)
plot_data &lt;- cbind(plot_data, data.frame(x = xvec))

ggplot2::ggplot(plot_data) +
ggplot2::theme_bw() +
ggplot2::aes(x = x, y = values, color = ind) +
ggplot2::geom_line() +
ggplot2::geom_hline(yintercept = 0) +
ggplot2::geom_vline(xintercept = iknots, linetype = 3)

</code></pre>


</div>