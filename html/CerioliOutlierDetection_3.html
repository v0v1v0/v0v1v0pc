<div class="container">

<table style="width: 100%;"><tr>
<td>cerioli2010.irmcd.test</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Iterated RMCD test of Cerioli (2010)
</h2>

<h3>Description</h3>

<p>Given a set of observations, this function tests whether 
there are outliers in the data set and identifies outlying
points. Outlier testing/identification is done using the
Mahalanobis-distances based on the MCD dispersion estimate. 
The iterated reweighted MCD method of Cerioli (2010) is used 
to ensure the intersection test has the specified nominal size (Type I
error rate).
</p>


<h3>Usage</h3>

<pre><code class="language-R">cerioli2010.irmcd.test(datamat, 
  mcd.alpha = max.bdp.mcd.alpha(n,v), 
  signif.gamma = 0.05, nsamp = 500, 
  nmini = 300, trace = FALSE, 
  delta = 0.025, hrdf.method=c("GM14","HR05"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>datamat</code></td>
<td>
<p> (Data Frame or Matrix)
Data set to test for outliers (rows = observations, 
columns = variables). <code>datamat</code> cannot have
missing values; please deal with them prior to
calling this function. <code>datamat</code> will be converted
to a matrix.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcd.alpha</code></td>
<td>
<p> (Numeric)
Value to control the fraction
of observations used to compute the covariance matrices
in the MCD calculation.
Default value is corresponds to the maximum breakpoint
case of the MCD; valid values are between
0.5 and 1. See the <code>covMcd</code> documentation 
in the <code>robustbase</code> library for further details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>signif.gamma</code></td>
<td>
<p> (Numeric)
Desired nominal size of the <em>intersection</em> outlier 
test (e.g., 0.05), i.e., a test that there are no outliers 
in the data. (This is the <code class="reqn">\gamma</code> parameter in 
Cerioli (2010).) The corresponding <code class="reqn">\alpha</code> parameter
for testing individual observations for outlyingness will
be calculated from <code class="reqn">\gamma</code> as 
</p>
<p style="text-align: center;"><code class="reqn"> \alpha = 1 - ( 1 - \gamma )^{(1/n)}. </code>
</p>

</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsamp</code></td>
<td>
<p> (Integer)
Number of subsamples to use in computing the MCD. See the
<code>covMcd</code> documentation in the
<code>robustbase</code> library.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nmini</code></td>
<td>
<p> (Integer)
See the <code>covMcd</code> documentation in the
<code>robustbase</code> library.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p> (Logical)
See the <code>covMcd</code> documentation in the
<code>robustbase</code> library.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p> (Numeric)
False-positive rate to use in the reweighting 
step (Step 2). Defaults to 0.025 as used in
Cerioli (2010). When the ratio <code class="reqn">n/\nu</code> of
sample size to dimension is very small, using
a smaller delta can improve the accuracy of
the method.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hrdf.method</code></td>
<td>
<p> (String)
Method to use for computing degrees of freedom
and cutoff values for the non-MCD subset. The
original method of Hardin and Rocke (2005) and
the expanded method of Green and Martin (2017)
are available as the options “HR05” and “GM14”,
respectively. “GM14” is the default, as it 
is more accurate across a wider range of <code>mcd.alpha</code>
values.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Calls the finite-sample reweighted MCD (FSRMCD) outlier 
detection function <code>cerioli2010.fsrmcd.test</code>
first to test for the existence of any outliers in the
data. If the FSRMCD method rejects the null hypothesis of
no outliers in the data, individual observations are then
tested for outlyingness using the critical value function
returned by <code>cerioli2010.fsrmcd.test</code> with 
significance <code class="reqn">\gamma</code>.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>outliers</code></td>
<td>
<p>A matrix of dimension <code>nrow(datamat)</code> by 
<code>length(signif.gamma)</code> indicating 
whether each row of <code>datamat</code> is an outlier. The <code>i-th</code> 
column corresponds to the result of testing observations
for outlyingness at significance level <code>signif.gamma[i]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mahdist.rw</code></td>
<td>
<p>a matrix of dimension <code>nrow(datamat)</code> by
<code>length(signif.gamma)</code> of Mahalanobis distances computed
using the finite-sample reweighted MCD methodology in
Cerioli (2010). Even though the distances do not depend
on <code>signif.gamma</code>, there is one column per entry in 
<code>signif.gamma</code> for user convenience.
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Written and maintained by Christopher G. Green &lt;christopher.g.green@gmail.com&gt;
</p>


<h3>References</h3>

<p>Andrea Cerioli. Multivariate outlier detection with high-breakdown estimators. 
Journal of the American Statistical Association, 105(489):147-156, 2010.
<a href="https://doi.org/10.1198/jasa.2009.tm09147">doi:10.1198/jasa.2009.tm09147</a>
</p>
<p>Andrea Cerioli, Marco Riani, and Anthony C. Atkinson. Controlling the size of multivariate
outlier tests with the MCD estimator of scatter. Statistical Computing, 19:341-353, 2009.
<a href="https://doi.org/10.1007/s11222-008-9096-5">doi:10.1007/s11222-008-9096-5</a>
</p>


<h3>See Also</h3>

<p><code>cerioli2010.fsrmcd.test</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(mvtnorm, quiet=TRUE)

############################################
# dimension v, number of observations n
v &lt;- 5
n &lt;- 200
simdata &lt;- array( rmvnorm(n*v, mean=rep(0,v), 
    sigma = diag(rep(1,v))), c(n,v) )
# detect outliers
results &lt;- cerioli2010.irmcd.test( simdata, 
    signif.gamma=c(0.05,0.01,0.001) )
# count number of outliers detected for each 
# significance level
colSums( results$outliers )


#############################################
# add some contamination to illustrate how to 
# detect outliers using the irmcd test
# 10/200 = 5% contamination
simdata[ sample(n,10), ] &lt;- array( 
  rmvnorm( 10*v, mean=rep(2,v), sigma = diag(rep(1,v))),
  c(10,v)
)
results &lt;- cerioli2010.irmcd.test( simdata, 
  signif.gamma=0.01 )
mean( results$outliers[,1,drop=TRUE] )

#############################################
# banknote example from Cerioli (2010)
## Not run: 

  require(rrcov) # for CovMcd
  require(mclust)  # banknote data set lives here
  data(banknote, package="mclust")
  # length, width of left edge, width of right edge,
  # width of bottom edge, width of top edge, length
  # of image diagonal, counterfeit (1=counterfeit)

  bnk.gamma &lt;- 0.01
  # genuine banknotes
  # classical mean and covariance
  banknote.real &lt;- banknote[ banknote[,"Status"]=="genuine", 2:7 ]
  cov.cls &lt;- CovClassic( banknote.real  )
  # 1 - (1 - 0.01)^(1/100) quantile of scaled-Beta distribution
  # with m=100 and v=6
  bnk.m &lt;- nrow( banknote.real )
  bnk.v &lt;- ncol( banknote.real ) 
  bnk.alpha &lt;- 1. - ((1. - bnk.gamma)^(1./bnk.m))
  cutoff.cls &lt;- (bnk.m-1.)*(bnk.m-1.)*qbeta( 1. - bnk.alpha, bnk.v/2., 
  (bnk.m - bnk.v - 1.)/2.)/bnk.m
  # Figure 4 (left) in Cerioli (2010)
  plot( getDistance( cov.cls ), xlab="Index number", 
  ylab="Squared Mahalanobis Distance", type="p", 
  ylim=c(0,45)
  )
  abline( h=cutoff.cls )

  # reweighted MCD, maximum breakdown point case
  cov.rob &lt;- CovMcd( banknote.real, 
  alpha=floor((bnk.m + bnk.v + 1.)/2.)/bnk.m, nsamp="best" )
  # cutoff using chi-squared individually
  cutoff.rmcdind &lt;- qchisq(1. - bnk.gamma, df=bnk.v)
  # cufoff using simultaneous chi-square
  cutoff.rmcdsim &lt;- qchisq(1. - bnk.alpha, df=bnk.v)
  # scaled-F cutoff using FSRMCD
  # cutoff value is returned by critvalfcn for observations
  # with weight=0
  tmp.fsrmcd &lt;- cerioli2010.fsrmcd.test( banknote.real, 
  signif.alpha=bnk.alpha )
  cutoff.fsrmcd &lt;- unique(tmp.fsrmcd$critvalfcn( bnk.alpha )[tmp.fsrmcd$weights==0])
  # Figure 4 (right)
  plot( getDistance( cov.rob ), xlab="Index number",
  ylab="Squared Robust Reweighted Distance", type="p",
  ylim=c(0,45)
  )
  abline( h=cutoff.rmcdind, lty="dotted" )
  abline( h=cutoff.rmcdsim, lty="dashed" )
  abline( h=cutoff.fsrmcd, lty="solid" )
  legend( "topright", c("RMCD_ind","RMCD","FSRMCD"), 
    lty=c("dotted","dashed","solid") )

  # forged banknotes
  # classical mean and covariance
  banknote.fake &lt;- banknote[ banknote[,"Status"]=="counterfeit", 2:7 ]
  cov.cls &lt;- CovClassic( banknote.fake  )
  # 1 - (1 - 0.01)^(1/100) quantile of scaled-Beta distribution
  # with m=100 and v=6
  bnk.m &lt;- nrow( banknote.fake )
  bnk.v &lt;- ncol( banknote.fake ) 
  bnk.alpha &lt;- 1. - ((1. - bnk.gamma)^(1./bnk.m))
  cutoff.cls &lt;- (bnk.m-1.)*(bnk.m-1.)*qbeta( 1. - bnk.alpha, bnk.v/2., 
    (bnk.m - bnk.v - 1.)/2.)/bnk.m
  # Figure 5 (left) in Cerioli (2010)
  plot( getDistance( cov.cls ), xlab="Index number", 
    ylab="Squared Mahalanobis Distance", type="p", 
    ylim=c(0,45)
  )
  abline( h=cutoff.cls )
  
  
  # reweighted MCD, maximum breakdown point case
  cov.rob &lt;- CovMcd( banknote.fake, 
    alpha=floor((bnk.m + bnk.v + 1.)/2.)/bnk.m, nsamp="best" )
  # cutoff using chi-squared individually
  cutoff.rmcdind &lt;- qchisq(1. - bnk.gamma, df=bnk.v)
  # scaled-F cutoff using FSRMCD
  # cutoff value is returned by critvalfcn for observations
  # with weight=0
  tmp.fsrmcd &lt;- cerioli2010.fsrmcd.test( banknote.fake, 
    signif.alpha=bnk.alpha )
  cutoff.fsrmcd &lt;- unique(tmp.fsrmcd$critvalfcn( bnk.alpha )[tmp.fsrmcd$weights==0])
  cutoff.irmcd &lt;- unique(tmp.fsrmcd$critvalfcn( bnk.gamma )[tmp.fsrmcd$weights==0])
  # Figure 5 (right) in Cerioli (2010)
  plot( getDistance( cov.rob ), xlab="Index number",
    ylab="Squared robust reweighted Distance", type="p",
    ylim=c(0,150)
  )
  abline( h=cutoff.rmcdind, lty="dotted" )
  abline( h=cutoff.fsrmcd, lty="dashed" )
  abline( h=cutoff.irmcd, lty="solid" )
  legend( "topright", c("RMCD_ind","FSRMCD","IRMCD"), 
    lty=c("dotted","dashed","solid") )


## End(Not run)

#############################################
# example of how to ensure the size of the intersection test is correct
## Not run: 
  n.sim &lt;- 5000
  simdata &lt;- array( 
    rmvnorm(n*v*n.sim, mean=rep(0,v), sigma=diag(rep(1,v))),
    c(n,v,n.sim)
  )
  # in practice we'd do this using one of the parallel processing
  # methods out there
  results &lt;- apply( simdata, 3, function(dm) {
    z &lt;- cerioli2010.irmcd.test( dm, 
      signif.gamma=0.01 )
    # true if outliers were detected in the data, false otherwise
    any(z$outliers[,1,drop=TRUE])
  })
  # count the percentage of samples where outliers were detected;
  # should be close to the significance level value used (0.01) in these
  # samples for the intersection test
  mean(results)

## End(Not run)
</code></pre>


</div>