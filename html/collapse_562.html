<div class="container">

<table style="width: 100%;"><tr>
<td>TRA</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Transform Data by (Grouped) Replacing or Sweeping out Statistics
</h2>

<h3>Description</h3>

<p><code>TRA</code> is an S3 generic that efficiently transforms data by either (column-wise) replacing data values with supplied statistics or sweeping the statistics out of the data. <code>TRA</code> supports grouped operations and data transformation by reference, and is thus a generalization of <code>sweep</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">   TRA(x, STATS, FUN = "-", ...)
setTRA(x, STATS, FUN = "-", ...) # Shorthand for invisible(TRA(..., set = TRUE))

## Default S3 method:
TRA(x, STATS, FUN = "-", g = NULL, set = FALSE, ...)

## S3 method for class 'matrix'
TRA(x, STATS, FUN = "-", g = NULL, set = FALSE, ...)

## S3 method for class 'data.frame'
TRA(x, STATS, FUN = "-", g = NULL, set = FALSE, ...)

## S3 method for class 'grouped_df'
TRA(x, STATS, FUN = "-", keep.group_vars = TRUE, set = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a atomic vector, matrix, data frame or grouped data frame (class 'grouped_df').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>STATS</code></td>
<td>
<p>a matching set of summary statistics. See Details and Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>FUN</code></td>
<td>
<p>an integer or character string indicating the operation to perform. There are 11 supported operations:
</p>

<table>
<tr>
<td style="text-align: left;">
<em> Int. </em>   </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> <em> String </em>   </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> <em> Description </em>  </td>
</tr>
<tr>
<td style="text-align: left;">
                 0 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "na" or "replace_na"   </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> replace missing values in <code>x</code> </td>
</tr>
<tr>
<td style="text-align: left;">
                 1 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "fill" or "replace_fill"   </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> replace data and missing values in <code>x</code> </td>
</tr>
<tr>
<td style="text-align: left;">
                 2 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "replace" </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> replace data but preserve missing values in <code>x</code> </td>
</tr>
<tr>
<td style="text-align: left;">
                 3 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "-"   </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> subtract (i.e. center) </td>
</tr>
<tr>
<td style="text-align: left;">
                 4 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "-+"  </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> subtract group-statistics but add group-frequency weighted average of group statistics (i.e. center on overall average statistic) </td>
</tr>
<tr>
<td style="text-align: left;">
                 5 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "/"   </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> divide (i.e. scale. For mean-preserving scaling see also <code>fscale</code>) </td>
</tr>
<tr>
<td style="text-align: left;">
                 6 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "%"     </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> compute percentages (i.e. divide and multiply by 100) </td>
</tr>
<tr>
<td style="text-align: left;">
                 7 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "+" </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> add </td>
</tr>
<tr>
<td style="text-align: left;">
                 8 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "*" </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> multiply </td>
</tr>
<tr>
<td style="text-align: left;">
                 9 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "%%" </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> modulus (i.e. remainder from division by  <code>STATS</code>) </td>
</tr>
<tr>
<td style="text-align: left;">
                 10 </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> "-%%" </td>
<td style="text-align: left;"></td>
<td style="text-align: left;"> subtract modulus (i.e. make data divisible by <code>STATS</code>)
  </td>
</tr>
</table>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>g</code></td>
<td>
<p>a factor, <code>GRP</code> object, atomic vector (internally converted to factor) or a list of vectors / factors (internally converted to a <code>GRP</code> object) used to group <code>x</code>. Number of groups must match rows of <code>STATS</code>. See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>set</code></td>
<td>
<p>logical. <code>TRUE</code> transforms data by reference i.e. performs in-place modification of the data without creating a copy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.group_vars</code></td>
<td>
<p><em>grouped_df method:</em> Logical. <code>FALSE</code> removes grouping variables after computation. See Details and Examples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>arguments to be passed to or from other methods.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Without groups (<code>g = NULL</code>), <code>TRA</code> is little more than a column based version of <code>sweep</code>, albeit many times more efficient. In this case all methods support an atomic vector of statistics of length <code>NCOL(x)</code> passed to <code>STATS</code>. The matrix and data frame methods also support a 1-row matrix or 1-row data frame / list, respectively. <code>TRA</code> always preserves all attributes of <code>x</code>.
</p>
<p>With groups passed to <code>g</code>, <code>STATS</code> needs to be of the same type as <code>x</code> and of appropriate dimensions [such that <code>NCOL(x) == NCOL(STATS)</code> and <code>NROW(STATS)</code> equals the number of groups (i.e. the number of levels if <code>g</code> is a factor)]. If this condition is satisfied, <code>TRA</code> will assume that the first row of <code>STATS</code> is the set of statistics computed on the first group/level of <code>g</code>, the second row on the second group/level etc. and do groupwise replacing or sweeping out accordingly.
</p>
<p>For example Let <code>x = c(1.2, 4.6, 2.5, 9.1, 8.7, 3.3)</code>, g is an integer vector in 3 groups <code>g = c(1,3,3,2,1,2)</code> and <code>STATS = fmean(x,g) = c(4.95, 6.20, 3.55)</code>. Then <code>out = TRA(x,STATS,"-",g) = c(-3.75,  1.05, -1.05,  2.90,  3.75, -2.90)</code> [same as <code>fmean(x, g, TRA = "-")</code>] does the equivalent of the following for-loop: <code>for(i in 1:6) out[i] = x[i] - STATS[g[i]]</code>.
</p>
<p>Correct computation requires that <code>g</code> as used in <code>fmean</code> and <code>g</code> passed to <code>TRA</code> are exactly the same vector. Using <code>g = c(1,3,3,2,1,2)</code> for <code>fmean</code> and <code>g = c(3,1,1,2,3,2)</code> for <code>TRA</code> will not give the right result. The safest way of programming with <code>TRA</code> is thus to repeatedly employ the same factor or <code>GRP</code> object for all grouped computations. Atomic vectors passed to <code>g</code> will be converted to factors (see <code>qF</code>) and lists will be converted to <code>GRP</code> objects. This is also done by all Fast Statistical Functions and <code>BY</code>, thus together with these functions, <code>TRA</code> can also safely be used with atomic- or list-groups (as long as all functions apply sorted grouping, which is the default in <em>collapse</em>). 
</p>

<p>If <code>x</code> is a grouped data frame ('grouped_df'), <code>TRA</code> matches the columns of <code>x</code> and <code>STATS</code> and also checks for grouping columns in <code>x</code> and <code>STATS</code>. <code>TRA.grouped_df</code> will then only transform those columns in <code>x</code> for which matching counterparts were found in <code>STATS</code> (exempting grouping columns) and return <code>x</code> again (with columns in the same order). If <code>keep.group_vars = FALSE</code>, the grouping columns are dropped after computation, however the "groups" attribute is not dropped (it can be removed using <code>fungroup()</code> or <code>dplyr::ungroup()</code>).
</p>


<h3>Value</h3>

<p><code>x</code> with columns replaced or swept out using <code>STATS</code>, (optionally) grouped by <code>g</code>.
</p>


<h3>Note</h3>

<p>In most cases there is no need to call the <code>TRA()</code> function, because of the TRA-argument to all Fast Statistical Functions (ensuring that the exact same grouping vector is used for computing statistics and subsequent transformation). In addition the functions <code>fbetween/B</code> and <code>fwithin/W</code> and <code>fscale/STD</code> provide optimized solutions for frequent scaling, centering and averaging tasks. 
</p>


<h3>See Also</h3>

<p><code>sweep</code>, Fast Statistical Functions, Data Transformations, Collapse Overview
</p>


<h3>Examples</h3>

<pre><code class="language-R">v &lt;- iris$Sepal.Length          # A numeric vector
f &lt;- iris$Species               # A factor
dat &lt;- num_vars(iris)           # Numeric columns
m &lt;- qM(dat)                    # Matrix of numeric data

head(TRA(v, fmean(v)))                # Simple centering [same as fmean(v, TRA = "-") or W(v)]
head(TRA(m, fmean(m)))                # [same as sweep(m, 2, fmean(m)), fmean(m, TRA = "-") or W(m)]
head(TRA(dat, fmean(dat)))            # [same as fmean(dat, TRA = "-") or W(dat)]
head(TRA(v, fmean(v), "replace"))     # Simple replacing [same as fmean(v, TRA = "replace") or B(v)]
head(TRA(m, fmean(m), "replace"))     # [same as sweep(m, 2, fmean(m)), fmean(m, TRA = 1L) or B(m)]
head(TRA(dat, fmean(dat), "replace")) # [same as fmean(dat, TRA = "replace") or B(dat)]
head(TRA(m, fsd(m), "/"))             # Simple scaling... [same as fsd(m, TRA = "/")]...

# Note: All grouped examples also apply for v and dat...
head(TRA(m, fmean(m, f), "-", f))       # Centering [same as fmean(m, f, TRA = "-") or W(m, f)]
head(TRA(m, fmean(m, f), "replace", f)) # Replacing [same fmean(m, f, TRA = "replace") or B(m, f)]
head(TRA(m, fsd(m, f), "/", f))         # Scaling [same as fsd(m, f, TRA = "/")]

head(TRA(m, fmean(m, f), "-+", f))      # Centering on the overall mean ...
                                        # [same as fmean(m, f, TRA = "-+") or
                                        #           W(m, f, mean = "overall.mean")]
head(TRA(TRA(m, fmean(m, f), "-", f),   # Also the same thing done manually !!
     fmean(m), "+"))

# Grouped data method
library(magrittr)
iris %&gt;% fgroup_by(Species) %&gt;% TRA(fmean(.))
iris %&gt;% fgroup_by(Species) %&gt;% fmean(TRA = "-")        # Same thing
iris %&gt;% fgroup_by(Species) %&gt;% TRA(fmean(.)[c(2,4)])   # Only transforming 2 columns
iris %&gt;% fgroup_by(Species) %&gt;% TRA(fmean(.)[c(2,4)],   # Dropping species column
                                        keep.group_vars = FALSE)
</code></pre>


</div>