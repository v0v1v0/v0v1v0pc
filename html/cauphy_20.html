<div class="container">

<table style="width: 100%;"><tr>
<td>fitCauchy</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Model fitting for a Cauchy Process</h2>

<h3>Description</h3>

<p>Fit the Cauchy process on a phylogeny, using numerical optimization.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fitCauchy(
  phy,
  trait,
  model = c("cauchy", "lambda"),
  method = c("reml", "random.root", "fixed.root"),
  starting.value = list(x0 = NULL, disp = NULL, lambda = NULL),
  lower.bound = list(disp = 0, lambda = 0),
  upper.bound = list(disp = Inf, lambda = NULL),
  root.edge = 100,
  hessian = FALSE,
  optim = c("local", "global"),
  method.init.disp = c("Qn", "Sn", "MAD", "IQR")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>phy</code></td>
<td>
<p>a phylogenetic tree of class <code>phylo</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trait</code></td>
<td>
<p>named vector of traits at the tips.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a model for the trait evolution. One of <code>"cauchy"</code> or <code>"lambda"</code> (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the method used to fit the process.
One of <code>reml</code> (the default), <code>fixed.root</code> or <code>random.root</code>.
See Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>starting.value</code></td>
<td>
<p>starting value for the parameters of the Cauchy.
This should be a named list, with <code>x0</code> and <code>disp</code> the root starting value and the dispersion parameter.
The default initial values are computed from standard statistics used on (independent) Cauchy variables, see Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower.bound</code></td>
<td>
<p>named list with lower bound values for the parameters. See Details for the default values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper.bound</code></td>
<td>
<p>named list with upper bound values for the parameters. See Details for the default values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>root.edge</code></td>
<td>
<p>multiplicative factor for the root dispersion, equal to the length of the root edge. Ignored if <code>method!=random.root</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hessian</code></td>
<td>
<p>if <code>TRUE</code>, then the numerical hessian is computed, for confidence interval computations. See <code>compute_vcov</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>optim</code></td>
<td>
<p>if "local", only a local optimization around the initial parameter values is performed (the default).
If "global", a global maximization is attempted using the "MLSL" approach (see <code>nloptr</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method.init.disp</code></td>
<td>
<p>the initialization method for the dispersion.
One of "Qn", "Sn", "MAD", "IQR". Default to the "Qn" statistics.
See Details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For the default <code>model="cauchy"</code>, the parameters of the Cauchy Process (CP)
are <code>disp</code>, the dispersion of the process,
and <code>x0</code>, the starting value of the process at the root (for <code>method="fixed.root"</code>).
</p>
<p>The model assumes that each increment of the trait <code class="reqn">X</code> on a branch going from node <code class="reqn">k</code> to <code class="reqn">l</code> 
follows a Cauchy distribution, with a dispersion proportional to the length <code class="reqn">t_l</code> of the branch:
</p>
<p style="text-align: center;"><code class="reqn">X_l - X_k \sim \mathcal{C}(0, \mbox{disp} \times t_l).</code>
</p>

<p>Unless specified by the user, the initial values for the parameters are taken according to the following heuristics:
</p>

<dl>
<dt>
<code>x0</code>:</dt>
<dd>
<p> is the trimmed mean of the trait,
keeping only 24% of the observations, as advocated in Rothenberg et al. 1964
(for <code>method="fixed.root"</code>);</p>
</dd>
<dt>
<code>disp</code>:</dt>
<dd>
<p> is initialized from the trait centered and normalized 
by tip heights, with one of the following statistics, taken from Rousseeuw &amp; Croux 1993:</p>
</dd>
</dl>
<dl>
<dt>
<code>IQR</code>:</dt>
<dd>
<p> half of the inter-quartile range (see <code>IQR</code>);</p>
</dd>
<dt>
<code>MAD</code>:</dt>
<dd>
<p> median absolute deviation with constant equal to 1 (see <code>mad</code>);</p>
</dd>
<dt>
<code>Sn</code>:</dt>
<dd>
<p> Sn statistics with constant 0.7071 (see <code>Sn</code>);</p>
</dd>
<dt>
<code>Qn</code>:</dt>
<dd>
<p> (default) Qn statistics with constant 1.2071 (see <code>Qn</code>).</p>
</dd>
</dl>
<p>Unless specified by the user, <code>x0</code> is taken to be unbounded,
<code>disp</code> positive unbounded.
</p>
<p>The <code>method</code> argument specifies the method used for the fit:
</p>

<dl>
<dt>
<code>method="reml"</code>:</dt>
<dd> 
<p>the dispersion parameter is fitted using the REML criterion,
obtained by re-rooting the tree to one of the tips.
See <code>logDensityTipsCauchy</code> for the default choice of the re-rooting tip;
</p>
</dd>
<dt>
<code>method="random.root"</code>:</dt>
<dd> 
<p>the root value is assumed to be a random Cauchy variable, centered at <code>x0=0</code>,
and with a dispersion <code>disp_root = disp * root.edge</code>;
</p>
</dd>
<dt>
<code>method="fixed.root"</code>:</dt>
<dd> 
<p>the model is fitted conditionally on the root value <code>x0</code>,
i.e. with a model where the root value is fixed and inferred from the data.
</p>
</dd>
</dl>
<p>In the first two cases, the optimization is done on the dispersion only,
while in the last case the optimization is on the root value and the dispersion.
</p>
<p>The function uses <code>nloptr</code> for the numerical optimization of the 
(restricted) likelihood, computed with function <code>logDensityTipsCauchy</code>.
It uses algorithms <a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/#bobyqa"><code>BOBYQA</code></a>
and <a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/#mlsl-multi-level-single-linkage"><code>MLSL_LDS</code></a>
for local and global optimization.
</p>
<p>If <code>model="lambda"</code>, the CP is fit on a tree with branch lengths re-scaled 
using the Pagel's lambda transform (see <code>transf.branch.lengths</code>),
and the <code>lambda</code> value is estimated using numerical optimization.
The default initial value for the <code>lambda</code> parameter is computed using adequate robust moments.
The default maximum value is computed using <code>phytools:::maxLambda</code>,
and is the ratio between the maximum height of a tip node over the maximum height of an internal node.
This can be larger than 1.
The default minimum value is 0.
</p>


<h3>Value</h3>

<p>An object of S3 class <code>cauphyfit</code>, with fields:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>x0</code></td>
<td>
<p>the fitted starting value (for <code>method="fixed.root"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>disp</code></td>
<td>
<p>the ml or reml estimate of the dispersion parameter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>the ml or reml estimate of the lambda parameter (for <code>model="lambda"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logLik</code></td>
<td>
<p>the maximum of the log (restricted) likelihood</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>the number of parameters of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aic</code></td>
<td>
<p>the AIC value of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trait</code></td>
<td>
<p>the named vector of traits at the tips used in the fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the named vector of traits at the tips used in the fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>the number of tips in the tree</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>the number of dependent variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the original call of the function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>the phylogenetic model (one of <code>"cauchy"</code> or <code>"lambda"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phy</code></td>
<td>
<p>the phylogenetic tree</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the method used (one of <code>"reml"</code>, <code>"fixed.root"</code>, <code>"random.root"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.root</code></td>
<td>
<p><code>TRUE</code> if <code>method="random.root"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reml</code></td>
<td>
<p><code>TRUE</code> if <code>method="reml"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>root_tip_reml</code></td>
<td>
<p>name of the tip used to reroot the tree (for  <code>method="reml"</code>)</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Bastide, P. and Didier, G. 2023. The Cauchy Process on Phylogenies: a Tractable Model for Pulsed Evolution. Systematic Biology. doi:10.1093/sysbio/syad053.
</p>
<p>Rothenberg T. J., Fisher F. M., Tilanus C. B. 1964. A Note on Estimation from a Cauchy Sample. Journal of the American Statistical Association. 59:460–463.
</p>
<p>Rousseeuw P.J., Croux C. 1993. Alternatives to the Median Absolute Deviation. Journal of the American Statistical Association. 88:1273–1283.
</p>


<h3>See Also</h3>

<p><code>confint.cauphyfit</code>, <code>profile.cauphyfit</code>, <code>ancestral</code>, <code>increment</code>, <code>logDensityTipsCauchy</code>, <code>cauphylm</code>, <code>fitContinuous</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Simulate tree and data
set.seed(1289)
phy &lt;- ape::rphylo(20, 0.1, 0)
dat &lt;- rTraitCauchy(n = 1, phy = phy, model = "cauchy",
                    parameters = list(root.value = 10, disp = 0.1))
# Fit the data
fit &lt;- fitCauchy(phy, dat, model = "cauchy", method = "reml")
fit
# Approximate confidence intervals
confint(fit)
# Profile likelihood
pl &lt;- profile(fit)
plot(pl)

</code></pre>


</div>