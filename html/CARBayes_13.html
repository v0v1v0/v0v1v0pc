<div class="container">

<table style="width: 100%;"><tr>
<td>S.CARlocalised</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fit a spatial generalised linear mixed model to data, where a set of spatially 
smooth random effects  are augmented with a piecewise constant intercept process.
</h2>

<h3>Description</h3>

<p>Fit a spatial generalised linear mixed model to areal unit data, where the response
variable can be binomial or Poisson. Note, a Gaussian likelihood is not allowed 
because of a lack of identifiability among the parameters. The linear predictor is 
modelled by known covariates, a vector of random effects and a piecewise constant 
intercept process. The random effects are modelled by an intrinsic CAR prior, while 
the piecewise constant intercept process was proposed by Lee and Sarran (2015), and 
allow neighbouring areas to have very different values. Further details are given 
in the vignette accompanying this package. Inference is conducted in a Bayesian 
setting using Markov chain Monte Carlo (MCMC) simulation. Missing (NA) values are 
not allowed in this model. For a full model specification see the vignette 
accompanying this package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">S.CARlocalised(formula, family, data=NULL, G, trials=NULL, W, burnin, n.sample, 
thin=1, n.chains=1, n.cores=1, prior.mean.beta=NULL, prior.var.beta=NULL,
prior.tau2=NULL,prior.delta=NULL, MALA=TRUE, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>

<p>A formula for the covariate part of the model using the syntax of the
lm() function. Offsets can be included here using the offset() function. The 
response, offset and each covariate is a vector of length K*1.The  response 
cannot contain missing (NA) values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>

<p>One of either "binomial" or "poisson", which respectively specify a 
binomial likelihood model with a logistic link function, or a Poisson likelihood 
model with a log link function. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>An optional data.frame containing the  variables in the formula.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>G</code></td>
<td>

<p>The maximum number of distinct intercept terms (groups) to allow in the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trials</code></td>
<td>

<p>A vector the same length as the response containing the total number of trials 
for each area. Only used if family="binomial". 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>

<p>A non-negative K by K neighbourhood matrix (where K is the number of spatial units). 
Typically a binary specification is used, where the jkth element equals one if areas 
(j, k) are spatially close (e.g. share a common border) and is zero otherwise. The 
matrix can be non-binary, but each row must contain at least one non-zero entry.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin</code></td>
<td>

<p>The number of MCMC samples to discard as the burn-in period in each chain.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.sample</code></td>
<td>

<p>The overall number of MCMC samples to generate in each chain.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>

<p>The level of thinning to apply to the MCMC samples in each chain to reduce their 
autocorrelation. Defaults to 1 (no thinning).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.chains</code></td>
<td>

<p>The number of MCMC chains to run when fitting the model. Defaults to 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.cores</code></td>
<td>

<p>The number of computer cores to run the MCMC chains on. Must be less than or 
equal to n.chains. Defaults to 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.mean.beta</code></td>
<td>

<p>A vector of prior means for the regression parameters beta (Gaussian priors are 
assumed). Defaults to a vector of zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.var.beta</code></td>
<td>

<p>A vector of prior variances for the regression parameters beta (Gaussian priors 
are assumed). Defaults to a vector with values 100,000.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.tau2</code></td>
<td>

<p>The prior shape and scale in the form of c(shape, scale) for an Inverse-Gamma(shape, scale) 
prior for tau2. Defaults to c(1, 0.01).  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.delta</code></td>
<td>

<p>The prior maximum for the cluster smoothing parameter delta. Defaults to 10.  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MALA</code></td>
<td>

<p>Logical, should the function use Metropolis adjusted Langevin algorithm 
(MALA) updates (TRUE, default) or simple random walk updates (FALSE) for 
the regression parameters.   
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>Logical, should the function update the user on its progress.  
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>summary.results </code></td>
<td>
<p>A summary table of the parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samples </code></td>
<td>
<p>A list containing the MCMC samples from the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted.values </code></td>
<td>
<p>The fitted values based on posterior means from the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals </code></td>
<td>
<p>A matrix with 2 columns where each column is a type of 
residual and each row relates to an area. The types are "response" (raw), 
and "pearson".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelfit </code></td>
<td>
<p>Model fit criteria including the Deviance Information Criterion 
(DIC) and its corresponding estimated effective number of parameters (p.d), the Log 
Marginal Predictive Likelihood (LMPL), the Watanabe-Akaike Information Criterion 
(WAIC) and its corresponding estimated number of effective parameters (p.w), and
the loglikelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>accept </code></td>
<td>
<p>The acceptance probabilities for the parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>localised.structure </code></td>
<td>
<p>A vector giving the posterior median of which intercept 
group each area is in.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula </code></td>
<td>
<p>The formula (as a text string) for the response, covariate and 
offset parts of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model </code></td>
<td>
<p>A text string describing the model fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc.info </code></td>
<td>
<p>A vector giving details of the numbers of MCMC samples generated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X </code></td>
<td>
<p>The design matrix of covariates.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Duncan Lee
</p>


<h3>References</h3>

<p>Lee, D and Sarran, C  (2015). Controlling for unmeasured confounding and spatial 
misalignment in long-term air pollution and health studies, Environmetrics, 26, 
477-487.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#################################################
#### Run the model on simulated data on a lattice
#################################################
#### Load other libraries required
library(MASS)

#### Set up a square lattice region
x.easting &lt;- 1:10
x.northing &lt;- 1:10
Grid &lt;- expand.grid(x.easting, x.northing)
K &lt;- nrow(Grid)

#### Split the area into two groups between which there will be a boundary.
groups &lt;-rep(1, K) 
groups[Grid$Var1&gt;5] &lt;- 2

#### set up distance and neighbourhood (W, based on sharing a common border) matrices
distance &lt;- as.matrix(dist(Grid))
W &lt;-array(0, c(K,K))
W[distance==1] &lt;-1 
	
#### Generate the response data
phi &lt;- mvrnorm(n=1, mu=groups, Sigma=0.2 * exp(-0.1 * distance))
logit &lt;- phi
prob &lt;- exp(logit) / (1 + exp(logit))
trials &lt;- rep(50,K)
Y &lt;- rbinom(n=K, size=trials, prob=prob)


#### Run the localised smoothing model
formula &lt;- Y ~ 1
## Not run: model &lt;- S.CARlocalised(formula=formula, family="binomial", trials=trials,
G=2, W=W,burnin=20000, n.sample=100000)
## End(Not run)

#### Toy example for checking
model &lt;- S.CARlocalised(formula=formula, family="binomial", trials=trials,
G=2, W=W,burnin=10, n.sample=50)
</code></pre>


</div>