<div class="container">

<table style="width: 100%;"><tr>
<td>caRamel</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>MAIN FUNCTION: multi-objective optimizer</h2>

<h3>Description</h3>

<p>Multi-objective optimizer. It requires to define a multi-objective function (func) to calibrate the model and bounds on the parameters to optimize.
</p>


<h3>Usage</h3>

<pre><code class="language-R">caRamel(
  nobj,
  nvar,
  minmax,
  bounds,
  func,
  popsize,
  archsize,
  maxrun,
  prec,
  repart_gene = c(5, 5, 5, 5),
  gpp = NULL,
  blocks = NULL,
  pop = NULL,
  funcinit = NULL,
  objnames = NULL,
  listsave = NULL,
  write_gen = FALSE,
  carallel = 1,
  numcores = NULL,
  graph = TRUE,
  sensitivity = FALSE,
  verbose = TRUE,
  worklist = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>nobj</code></td>
<td>
<p>: (integer, length = 1) the number of objectives to optimize (nobj &gt;= 2)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nvar</code></td>
<td>
<p>: (integer, length = 1) the number of variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minmax</code></td>
<td>
<p>: (logical, length = nobj) the objective is either a minimization (FALSE value) or a maximization (TRUE value)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bounds</code></td>
<td>
<p>: (matrix, nrow = nvar, ncol = 2) lower and upper bounds for the variables</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>func</code></td>
<td>
<p>: (function) the objective function to optimize. Input argument is the number of parameter set (integer) in the x matrix. The function has to return a vector of at least 'nobj' values (Objectives 1 to nobj are used for optimization, values after nobj are recorded for information.).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>popsize</code></td>
<td>
<p>: (integer, length = 1) the population size for the genetic algorithm</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>archsize</code></td>
<td>
<p>: (integer, length = 1) the size of the Pareto front</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxrun</code></td>
<td>
<p>: (integer, length = 1) the max. number of simulations allowed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prec</code></td>
<td>
<p>: (double, length = nobj) the desired accuracy for the optimization of the objectives</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>repart_gene</code></td>
<td>
<p>: (integer, length = 4) optional, number of new parameter sets for each rule and per generation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gpp</code></td>
<td>
<p>: (integer, length = 1) optional, calling frequency for the rule "Fireworks"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocks</code></td>
<td>
<p>(optional): groups for parameters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pop</code></td>
<td>
<p>: (matrix, nrow = nset, ncol = nvar or nvar+nobj ) optional, initial population (used to restart an optimization)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>funcinit</code></td>
<td>
<p>(function, optional): the initialization function applied on each node of cluster when parallel computation. The arguments are cl and numcores</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>objnames</code></td>
<td>
<p>(optional): names of the objectives</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>listsave</code></td>
<td>
<p>(optional): names of the listing files. Default: None (no output). If exists, fields to be defined: "pmt" (file of parameters on the Pareto Front), "obj" (file of corresponding objective values), "evol" (evolution of maximum objectives by generation). Optional field: "totalpop" (total population and corresponding objectives, useful to restart a computation)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>write_gen</code></td>
<td>
<p>: (logical, length = 1) optional, if TRUE, save files 'pmt' and 'obj' at each generation (FALSE by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>carallel</code></td>
<td>
<p>: (integer, length = 1) optional, do parallel computations? (0: sequential, 1:parallel (default) , 2:user-defined choice)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numcores</code></td>
<td>
<p>: (integer, length = 1) optional, the number of cores for the parallel computations (all cores by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>graph</code></td>
<td>
<p>: (logical, length = 1) optional, plot graphical output at each generation (TRUE by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sensitivity</code></td>
<td>
<p>: (logical, length = 1) optional, compute the first order derivatives of the pareto front (FALSE by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>: (logical, length = 1) optional, verbosity mode (TRUE by default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>worklist</code></td>
<td>
<p>: optional values to be transmitted to the user's function (not used)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The optimizer was originally written for Scilab by Nicolas Le Moine.
The algorithm is a hybrid of the MEAS algorithm (Efstratiadis and Koutsoyiannis (2005) &lt;doi:10.13140/RG.2.2.32963.81446&gt;) by using the directional search method based on the simplexes of the objective space
and the epsilon-NGSA-II algorithm with the method of classification of the parameter vectors archiving management by epsilon-dominance (Reed and Devireddy &lt;doi:10.1142/9789812567796_0004&gt;).
Reference : "Multi-objective calibration by combination of stochastic and gradient-like parameter generation rules â€“ the caRamel algorithm"
Celine Monteil (EDF), Fabrice Zaoui (EDF), Nicolas Le Moine (UPMC) and Frederic Hendrickx (EDF)
June 2020 Hydrology and Earth System Sciences 24(6):3189-3209
DOI: 10.5194/hess-24-3189-2020
Documentation : "Principe de l'optimiseur CaRaMEL et illustration au travers d'exemples de parametres dans le cadre de la modelisation hydrologique conceptuelle"
Frederic Hendrickx (EDF) and Nicolas Le Moine (UPMC)
Report EDF H-P73-2014-09038-FR
</p>


<h3>Value</h3>

<p>List of seven elements:
</p>

<dl>
<dt>success</dt>
<dd>
<p>return value (logical, length = 1) : TRUE if successfull</p>
</dd>
<dt>parameters</dt>
<dd>
<p>Pareto front (matrix, nrow = archsize, ncol = nvar)</p>
</dd>
<dt>objectives</dt>
<dd>
<p>objectives of the Pareto front (matrix, nrow = archsize, ncol = nobj+nadditional)</p>
</dd>
<dt>derivatives</dt>
<dd>
<p>list of the Jacobian matrices of the Pareto front if the sensitivity parameter is TRUE or NA otherwise</p>
</dd>
<dt>save_crit</dt>
<dd>
<p>evolution of the optimal objectives</p>
</dd>
<dt>total_pop</dt>
<dd>
<p>total population (matrix, nrow = popsize+archsize, ncol = nvar+nobj+nadditional)</p>
</dd>
<dt>gpp</dt>
<dd>
<p>the calling period for the third generation rule (independent sampling with a priori parameters variance)</p>
</dd>
</dl>
<h3>Author(s)</h3>

<p>Fabrice Zaoui - Celine Monteil
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Definition of the test function
viennet &lt;- function(i) {
  val1 &lt;- 0.5*(x[i,1]*x[i,1]+x[i,2]*x[i,2])+sin(x[i,1]*x[i,1]+x[i,2]*x[i,2])
  val2 &lt;- 15+(x[i,1]-x[i,2]+1)*(x[i,1]-x[i,2]+1)/27+(3*x[i,1]-2*x[i,2]+4)*(3*x[i,1]-2*x[i,2]+4)/8
  val3 &lt;- 1/(x[i,1]*x[i,1]+x[i,2]*x[i,2]+1) -1.1*exp(-(x[i,1]*x[i,1]+x[i,2]*x[i,2]))
  return(c(val1,val2,val3))
}
# Number of objectives
nobj &lt;- 3
# Number of variables
nvar &lt;- 2
# All the objectives are to be minimized
minmax &lt;- c(FALSE, FALSE, FALSE)
# Define the bound constraints
bounds &lt;- matrix(data = 1, nrow = nvar, ncol = 2)
bounds[, 1] &lt;- -3 * bounds[, 1]
bounds[, 2] &lt;- 3 * bounds[, 2]

# Caramel optimization
results &lt;-
  caRamel(nobj = nobj,
          nvar = nvar,
          minmax =  minmax,
          bounds = bounds,
          func = viennet,
          popsize = 100,
          archsize = 100,
          maxrun = 500,
          prec = matrix(1.e-3, nrow = 1, ncol = nobj),
          carallel = 0)

</code></pre>


</div>