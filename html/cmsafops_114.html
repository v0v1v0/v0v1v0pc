<div class="container">

<table style="width: 100%;"><tr>
<td>selpoint.multi</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extract data at multiple points.</h2>

<h3>Description</h3>

<p>This function extracts all data at given points. The points are given by a
pair of vectors with longitude and latitude coordinates. The function will
find the closest grid points to the given coordinates and extracts the data
for these points. For each point a separate output file is written. The
output-files can be optional in NetCDF or csv. Input can be a single NetCDF
file (given by the infile attribute) or a bunch of NetCDF files (given by the
path and pattern attributes).
</p>


<h3>Usage</h3>

<pre><code class="language-R">selpoint.multi(
  var,
  infile,
  path,
  pattern,
  outpath,
  lon1,
  lat1,
  station_names = NULL,
  format = "nc",
  nc34 = 4,
  verbose = FALSE,
  nc = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>Name of NetCDF variable (character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>infile</code></td>
<td>
<p>Filename of input NetCDF file. This may include the directory
(character). Infile is not needed if path and pattern are given.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>Directory of input files (character). Will not be used if infile
is given.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pattern</code></td>
<td>
<p>Pattern that all desired files in the 'path' directory have in
common (character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outpath</code></td>
<td>
<p>Directory where output files will be stored (character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon1</code></td>
<td>
<p>Longitude vector of desired points (numeric vector). Must
have the same length as <code>lat1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat1</code></td>
<td>
<p>Latitude vector of desired points (numeric vector). Must have
the same length as <code>lon1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>station_names</code></td>
<td>
<p>Optional vector of names, which will be used for the
output files (character vector). Must have the same length as
<code>lon1</code> and <code>lat1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>format</code></td>
<td>
<p>Intended output format. Options are <code>nc</code> or <code>csv</code>. Default is
<code>nc</code> (character).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nc34</code></td>
<td>
<p>NetCDF version of output file. If <code>nc34 = 3</code> the output file will be
in NetCDFv3 format (numeric). Default output is NetCDFv4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical; if TRUE, progress messages are shown</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nc</code></td>
<td>
<p>Alternatively to <code>infile</code> you can specify the input as an
object of class <code>ncdf4</code> (as returned from <code>ncdf4::nc_open</code>).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>For each pair of longitude and latitude coordinates one separate
NetCDF or csv file including the selected data is written. The csv files are
tested for use in Excel and include four columns (Time ; Data ; Longitude ;
Latitude), which are separated by ';'. If station_names are defined, the
output files will be named according to this vector. Otherwise, the output
files will be named as selpoint_longitude_latitude.format. Already existing
files will be overwritten in case that station_names are given or renamed
(e.g., <code>selpoint1_longitude_latitude.nc</code>) in case that no station_names are
given.
</p>


<h3>See Also</h3>

<p>Other selection and removal functions: 
<code>extract.level()</code>,
<code>extract.period()</code>,
<code>sellonlatbox()</code>,
<code>selmon()</code>,
<code>selperiod()</code>,
<code>selpoint()</code>,
<code>seltime()</code>,
<code>selyear()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Create an example NetCDF file with a similar structure as used by CM
## SAF. The file is created with the ncdf4 package.  Alternatively
## example data can be freely downloaded here: &lt;https://wui.cmsaf.eu/&gt;

library(ncdf4)

## create some (non-realistic) example data

lon &lt;- seq(5, 15, 0.5)
lat &lt;- seq(45, 55, 0.5)
time &lt;- seq(as.Date("2000-01-01"), as.Date("2010-12-31"), "month")
origin &lt;- as.Date("1983-01-01 00:00:00")
time &lt;- as.numeric(difftime(time, origin, units = "hour"))
data &lt;- array(250:350, dim = c(21, 21, 132))

## create example NetCDF

x &lt;- ncdim_def(name = "lon", units = "degrees_east", vals = lon)
y &lt;- ncdim_def(name = "lat", units = "degrees_north", vals = lat)
t &lt;- ncdim_def(name = "time", units = "hours since 1983-01-01 00:00:00",
 vals = time, unlim = TRUE)
var1 &lt;- ncvar_def("SIS", "W m-2", list(x, y, t), -1, prec = "short")
vars &lt;- list(var1)
ncnew &lt;- nc_create(file.path(tempdir(),"CMSAF_example_file.nc"), vars)
ncvar_put(ncnew, var1, data)
ncatt_put(ncnew, "lon", "standard_name", "longitude", prec = "text")
ncatt_put(ncnew, "lat", "standard_name", "latitude", prec = "text")
nc_close(ncnew)

## Select two points of the example CM SAF NetCDF file and write the
## output to a csv-file.
selpoint.multi(var = "SIS", infile = file.path(tempdir(),"CMSAF_example_file.nc"),
 outpath = tempdir(), lon1 = c(8, 9), lat1 = c(48, 49),
 station_names = c("A", "B"), format = "csv")

unlink(c(file.path(tempdir(),"CMSAF_example_file.nc"), file.path(tempdir(),"A.csv"), 
 file.path(tempdir(),"B.csv")))
</code></pre>


</div>