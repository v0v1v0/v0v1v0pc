<div class="container">

<table style="width: 100%;"><tr>
<td>ChromoteSession</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>ChromoteSession class</h2>

<h3>Description</h3>

<p>This represents one <em>session</em> in a Chromote object. Note that in the Chrome
DevTools Protocol a session is a debugging session connected to a <em>target</em>,
which is a browser window/tab or an iframe.
</p>
<p>A single target can potentially have more than one session connected to it,
but this is not currently supported by chromote.
</p>


<h3>Public fields</h3>

<div class="r6-fields">

<dl>
<dt><code>parent</code></dt>
<dd>
<p><code>Chromote</code> object</p>
</dd>
<dt><code>default_timeout</code></dt>
<dd>
<p>Default timeout in seconds for <span class="pkg">chromote</span> to
wait for a Chrome DevTools Protocol response.</p>
</dd>
<dt><code>protocol</code></dt>
<dd>
<p>Dynamic protocol implementation. For expert use only!</p>
</dd>
</dl>
</div>


<h3>Methods</h3>



<h4>Public methods</h4>


<ul>
<li> <p><a href="#method-ChromoteSession-new"><code>ChromoteSession$new()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-view"><code>ChromoteSession$view()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-close"><code>ChromoteSession$close()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-screenshot"><code>ChromoteSession$screenshot()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-screenshot_pdf"><code>ChromoteSession$screenshot_pdf()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-new_session"><code>ChromoteSession$new_session()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-get_session_id"><code>ChromoteSession$get_session_id()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-respawn"><code>ChromoteSession$respawn()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-get_target_id"><code>ChromoteSession$get_target_id()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-wait_for"><code>ChromoteSession$wait_for()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-debug_log"><code>ChromoteSession$debug_log()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-get_child_loop"><code>ChromoteSession$get_child_loop()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-send_command"><code>ChromoteSession$send_command()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-get_auto_events"><code>ChromoteSession$get_auto_events()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-invoke_event_callbacks"><code>ChromoteSession$invoke_event_callbacks()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-mark_closed"><code>ChromoteSession$mark_closed()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-is_active"><code>ChromoteSession$is_active()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-check_active"><code>ChromoteSession$check_active()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-get_init_promise"><code>ChromoteSession$get_init_promise()</code></a>
</p>
</li>
<li> <p><a href="#method-ChromoteSession-print"><code>ChromoteSession$print()</code></a>
</p>
</li>
</ul>
<hr>
<a id="method-ChromoteSession-new"></a>



<h4>Method <code>new()</code>
</h4>

<p>Create a new <code>ChromoteSession</code> object.
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre># Create a new `ChromoteSession` object.
b &lt;- ChromoteSession$new()

# Create a ChromoteSession with a specific height,width
b &lt;- ChromoteSession$new(height = 1080, width = 1920)

# Navigate to page
b$Page$navigate("http://www.r-project.org/")

# View current chromote session
if (interactive()) b$view()
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$new(
  parent = default_chromote_object(),
  width = 992,
  height = 1323,
  targetId = NULL,
  wait_ = TRUE,
  auto_events = NULL
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>parent</code></dt>
<dd>
<p><code>Chromote</code> object to use; defaults to
<code>default_chromote_object()</code></p>
</dd>
<dt><code>width, height</code></dt>
<dd>
<p>Width and height of the new window.</p>
</dd>
<dt><code>targetId</code></dt>
<dd>
<p><a href="https://chromedevtools.github.io/devtools-protocol/tot/Target/">Target</a>
ID of an existing target to attach to. When a <code>targetId</code> is provided, the
<code>width</code> and <code>height</code> arguments are ignored. If NULL (the default) a new
target is created and attached to, and the <code>width</code> and <code>height</code>
arguments determine its viewport size.</p>
</dd>
<dt><code>wait_</code></dt>
<dd>
<p>If <code>FALSE</code>, return a <code>promises::promise()</code> of a new
<code>ChromoteSession</code> object. Otherwise, block during initialization, and
return a <code>ChromoteSession</code> object directly.</p>
</dd>
<dt><code>auto_events</code></dt>
<dd>
<p>If <code>NULL</code> (the default), use the <code>auto_events</code> setting
from the parent <code>Chromote</code> object. If <code>TRUE</code>, enable automatic
event enabling/disabling; if <code>FALSE</code>, disable automatic event
enabling/disabling.</p>
</dd>
</dl>
</div>



<h5>Returns</h5>

<p>A new <code>ChromoteSession</code> object.
</p>


<hr>
<a id="method-ChromoteSession-view"></a>



<h4>Method <code>view()</code>
</h4>

<p>Display the current session in the <code>Chromote</code> browser.
</p>
<p>If a <code>Chrome</code> browser is being used, this method will open a new tab
using your <code>Chrome</code> browser. When not using a <code>Chrome</code> browser, set
<code>options(browser=)</code> to change the default behavior of <code>browseURL()</code>.
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre># Create a new `ChromoteSession` object.
b &lt;- ChromoteSession$new()

# Navigate to page
b$Page$navigate("http://www.r-project.org/")

# View current chromote session
if (interactive()) b$view()
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$view()</pre></div>


<hr>
<a id="method-ChromoteSession-close"></a>



<h4>Method <code>close()</code>
</h4>

<p>Close the Chromote session.
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre># Create a new `ChromoteSession` object.
b &lt;- ChromoteSession$new()

# Navigate to page
b$Page$navigate("http://www.r-project.org/")

# Close current chromote session
b$close()
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$close(wait_ = TRUE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>wait_</code></dt>
<dd>
<p>If <code>FALSE</code>, return a <code>promises::promise()</code> that will resolve
when the <code>ChromoteSession</code> is closed. Otherwise, block until the
<code>ChromoteSession</code> has closed.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-screenshot"></a>



<h4>Method <code>screenshot()</code>
</h4>

<p>Take a PNG screenshot
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre># Create a new `ChromoteSession` object.
b &lt;- ChromoteSession$new()

# Navigate to page
b$Page$navigate("http://www.r-project.org/")

# Take screenshot
tmppngfile &lt;- tempfile(fileext = ".png")
is_interactive &lt;- interactive() # Display screenshot if interactive
b$screenshot(tmppngfile, show = is_interactive)

# Show screenshot file info
unlist(file.info(tmppngfile))


# Take screenshot using a selector
sidebar_file &lt;- tempfile(fileext = ".png")
b$screenshot(sidebar_file, selector = ".sidebar", show = is_interactive)

# ----------------------------
# Take screenshots in parallel

urls &lt;- c(
  "https://www.r-project.org/",
  "https://github.com/",
  "https://news.ycombinator.com/"
)
# Helper method that:
# 1. Navigates to the given URL
# 2. Waits for the page loaded event to fire
# 3. Takes a screenshot
# 4. Prints a message
# 5. Close the ChromoteSession
screenshot_p &lt;- function(url, filename = NULL) {
  if (is.null(filename)) {
    filename &lt;- gsub("^.*://", "", url)
    filename &lt;- gsub("/", "_", filename)
    filename &lt;- gsub("\\.", "_", filename)
    filename &lt;- sub("_$", "", filename)
    filename &lt;- paste0(filename, ".png")
  }

  b2 &lt;- b$new_session()
  b2$Page$navigate(url, wait_ = FALSE)
  b2$Page$loadEventFired(wait_ = FALSE)$
    then(function(value) {
      b2$screenshot(filename, wait_ = FALSE)
    })$
    then(function(value) {
      message(filename)
    })$
    finally(function() {
      b2$close()
    })
}

# Take multiple screenshots simultaneously
ps &lt;- lapply(urls, screenshot_p)
pa &lt;- promises::promise_all(.list = ps)$then(function(value) {
  message("Done!")
})

# Block the console until the screenshots finish (optional)
b$wait_for(pa)
#&gt; www_r-project_org.png
#&gt; github_com.png
#&gt; news_ycombinator_com.png
#&gt; Done!
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$screenshot(
  filename = "screenshot.png",
  selector = "html",
  cliprect = NULL,
  region = c("content", "padding", "border", "margin"),
  expand = NULL,
  scale = 1,
  show = FALSE,
  delay = 0.5,
  options = list(),
  wait_ = TRUE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filename</code></dt>
<dd>
<p>File path of where to save the screenshot. The format of
the screenshot is inferred from the file extension; use
<code>options = list(format = "jpeg")</code> to manually choose the format. See
<a href="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-captureScreenshot"><code>Page.captureScreenshot</code></a>
for supported formats; at the time of this release the format options
were <code>"png"</code> (default), <code>"jpeg"</code>, or <code>"webp"</code>.</p>
</dd>
<dt><code>selector</code></dt>
<dd>
<p>CSS selector to use for the screenshot.</p>
</dd>
<dt><code>cliprect</code></dt>
<dd>
<p>An unnamed vector or list containing values for <code>top</code>,
<code>left</code>, <code>width</code>, and <code>height</code>, in that order. See
<a href="https://chromedevtools.github.io/devtools-protocol/tot/Page/#type-Viewport"><code>Page.Viewport</code></a>
for more information. If provided, <code>selector</code> and <code>expand</code> will be
ignored. To provide a scale, use the <code>scale</code> parameter.</p>
</dd>
<dt><code>region</code></dt>
<dd>
<p>CSS region to use for the screenshot.</p>
</dd>
<dt><code>expand</code></dt>
<dd>
<p>Extra pixels to expand the screenshot. May be a single
value or a numeric vector of top, right, bottom, left values.</p>
</dd>
<dt><code>scale</code></dt>
<dd>
<p>Page scale factor</p>
</dd>
<dt><code>show</code></dt>
<dd>
<p>If <code>TRUE</code>, the screenshot will be displayed in the viewer.</p>
</dd>
<dt><code>delay</code></dt>
<dd>
<p>The number of seconds to wait before taking the screenshot
after resizing the page. For complicated pages, this may need to be
increased.</p>
</dd>
<dt><code>options</code></dt>
<dd>
<p>Additional options passed to
<a href="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-captureScreenshot"><code>Page.captureScreenshot</code></a>.</p>
</dd>
<dt><code>wait_</code></dt>
<dd>
<p>If <code>FALSE</code>, return a <code>promises::promise()</code> that will resolve
when the <code>ChromoteSession</code> has saved the screenshot. Otherwise, block
until the <code>ChromoteSession</code> has saved the screenshot.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-screenshot_pdf"></a>



<h4>Method <code>screenshot_pdf()</code>
</h4>

<p>Take a PDF screenshot
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre># Create a new `ChromoteSession` object.
b &lt;- ChromoteSession$new()

# Navigate to page
b$Page$navigate("http://www.r-project.org/")

# Take screenshot
tmppdffile &lt;- tempfile(fileext = ".pdf")
b$screenshot_pdf(tmppdffile)

# Show PDF file info
unlist(file.info(tmppdffile))
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$screenshot_pdf(
  filename = "screenshot.pdf",
  pagesize = "letter",
  margins = 0.5,
  units = c("in", "cm"),
  landscape = FALSE,
  display_header_footer = FALSE,
  print_background = FALSE,
  scale = 1,
  wait_ = TRUE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>filename</code></dt>
<dd>
<p>File path of where to save the screenshot.</p>
</dd>
<dt><code>pagesize</code></dt>
<dd>
<p>A single character value in the set <code>"letter"</code>,
<code>"legal"</code>, <code>"tabloid"</code>, <code>"ledger"</code> and <code>"a0"</code> through <code>"a1"</code>. Or a
numeric vector <code>c(width, height)</code> specifying the page size.</p>
</dd>
<dt><code>margins</code></dt>
<dd>
<p>A numeric vector <code>c(top, right, bottom, left)</code> specifying
the page margins.</p>
</dd>
<dt><code>units</code></dt>
<dd>
<p>Page and margin size units. Either <code>"in"</code> or <code>"cm"</code> for
inches and centimeters respectively.</p>
</dd>
<dt><code>landscape</code></dt>
<dd>
<p>Paper orientation.</p>
</dd>
<dt><code>display_header_footer</code></dt>
<dd>
<p>Display header and footer.</p>
</dd>
<dt><code>print_background</code></dt>
<dd>
<p>Print background graphics.</p>
</dd>
<dt><code>scale</code></dt>
<dd>
<p>Page scale factor.</p>
</dd>
<dt><code>wait_</code></dt>
<dd>
<p>If <code>FALSE</code>, return a <code>promises::promise()</code> that will resolve
when the <code>ChromoteSession</code> has saved the screenshot. Otherwise, block
until the <code>ChromoteSession</code> has saved the screnshot.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-new_session"></a>



<h4>Method <code>new_session()</code>
</h4>

<p>Create a new tab / window
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre>b1 &lt;- ChromoteSession$new()
b1$Page$navigate("http://www.google.com")
b2 &lt;- b1$new_session()
b2$Page$navigate("http://www.r-project.org/")
b1$Runtime$evaluate("window.location", returnByValue = TRUE)$result$value$href
#&gt; [1] "https://www.google.com/"
b2$Runtime$evaluate("window.location", returnByValue = TRUE)$result$value$href
#&gt; [1] "https://www.r-project.org/"
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$new_session(
  width = 992,
  height = 1323,
  targetId = NULL,
  wait_ = TRUE
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>width, height</code></dt>
<dd>
<p>Width and height of the new window.</p>
</dd>
<dt><code>targetId</code></dt>
<dd>
<p><a href="https://chromedevtools.github.io/devtools-protocol/tot/Target/">Target</a>
ID of an existing target to attach to. When a <code>targetId</code> is provided, the
<code>width</code> and <code>height</code> arguments are ignored. If NULL (the default) a new
target is created and attached to, and the <code>width</code> and <code>height</code>
arguments determine its viewport size.</p>
</dd>
<dt><code>wait_</code></dt>
<dd>
<p>If <code>FALSE</code>, return a <code>promises::promise()</code> that will resolve
when the <code>ChromoteSession</code> has created a new session. Otherwise, block
until the <code>ChromoteSession</code> has created a new session.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-get_session_id"></a>



<h4>Method <code>get_session_id()</code>
</h4>

<p>Retrieve the session id
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$get_session_id()</pre></div>


<hr>
<a id="method-ChromoteSession-respawn"></a>



<h4>Method <code>respawn()</code>
</h4>

<p>Create a new session that connects to the same target (i.e. page)
as this session. This is useful if the session has been closed but the target still
exists.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$respawn()</pre></div>


<hr>
<a id="method-ChromoteSession-get_target_id"></a>



<h4>Method <code>get_target_id()</code>
</h4>

<p>Retrieve the target id
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$get_target_id()</pre></div>


<hr>
<a id="method-ChromoteSession-wait_for"></a>



<h4>Method <code>wait_for()</code>
</h4>

<p>Wait for a Chromote Session to finish. This method will block the R
session until the provided promise resolves. The loop from
<code style="white-space: pre;">⁠$get_child_loop()⁠</code> will only advance just far enough for the promise to
resolve.
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre>b &lt;- ChromoteSession$new()

# Async with promise
p &lt;- b$Browser$getVersion(wait_ = FALSE)
p$then(str)

# Async with callback
b$Browser$getVersion(wait_ = FALSE, callback_ = str)
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$wait_for(p)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>p</code></dt>
<dd>
<p>A promise to resolve.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-debug_log"></a>



<h4>Method <code>debug_log()</code>
</h4>

<p>Send a debug log message to the parent Chromote object
</p>


<h5>Examples</h5>

<div class="sourceCode r"><pre>b &lt;- ChromoteSession$new()
b$parent$debug_messages(TRUE)
b$Page$navigate("https://www.r-project.org/")
#&gt; SEND {"method":"Page.navigate","params":{"url":"https://www.r-project.org/"}| __truncated__}
# Turn off debug messages
b$parent$debug_messages(FALSE)
</pre></div>



<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$debug_log(...)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>Arguments pasted together with <code>paste0(..., collapse = "")</code>.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-get_child_loop"></a>



<h4>Method <code>get_child_loop()</code>
</h4>

<p><span class="pkg">later</span> loop.
</p>
<p>For expert async usage only.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$get_child_loop()</pre></div>


<hr>
<a id="method-ChromoteSession-send_command"></a>



<h4>Method <code>send_command()</code>
</h4>

<p>Send command through Chrome DevTools Protocol.
</p>
<p>For expert use only.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$send_command(
  msg,
  callback = NULL,
  error = NULL,
  timeout = NULL
)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>msg</code></dt>
<dd>
<p>A JSON-serializable list containing <code>method</code>, and <code>params</code>.</p>
</dd>
<dt><code>callback</code></dt>
<dd>
<p>Method to run when the command finishes successfully.</p>
</dd>
<dt><code>error</code></dt>
<dd>
<p>Method to run if an error occurs.</p>
</dd>
<dt><code>timeout</code></dt>
<dd>
<p>Number of milliseconds for Chrome DevTools Protocol
execute a method.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-get_auto_events"></a>



<h4>Method <code>get_auto_events()</code>
</h4>

<p>Resolved <code>auto_events</code> value.
</p>
<p>For internal use only.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$get_auto_events()</pre></div>


<hr>
<a id="method-ChromoteSession-invoke_event_callbacks"></a>



<h4>Method <code>invoke_event_callbacks()</code>
</h4>

<p>Immediately call all event callback methods.
</p>
<p>For internal use only.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$invoke_event_callbacks(event, params)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>event</code></dt>
<dd>
<p>A single event string</p>
</dd>
<dt><code>params</code></dt>
<dd>
<p>A list of parameters to pass to the event callback methods.</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-mark_closed"></a>



<h4>Method <code>mark_closed()</code>
</h4>

<p>Mark a session, and optionally, the underlying target,
as closed. For internal use only.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$mark_closed(target_closed)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>target_closed</code></dt>
<dd>
<p>Has the underlying target been closed as well as the
active debugging session?</p>
</dd>
</dl>
</div>


<hr>
<a id="method-ChromoteSession-is_active"></a>



<h4>Method <code>is_active()</code>
</h4>

<p>Retrieve active status
Once initialized, the value returned is <code>TRUE</code>. If <code style="white-space: pre;">⁠$close()⁠</code> has been
called, this value will be <code>FALSE</code>.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$is_active()</pre></div>


<hr>
<a id="method-ChromoteSession-check_active"></a>



<h4>Method <code>check_active()</code>
</h4>

<p>Check that a session is active, erroring if not.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$check_active()</pre></div>


<hr>
<a id="method-ChromoteSession-get_init_promise"></a>



<h4>Method <code>get_init_promise()</code>
</h4>

<p>Initial promise
</p>
<p>For internal use only.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$get_init_promise()</pre></div>


<hr>
<a id="method-ChromoteSession-print"></a>



<h4>Method <code>print()</code>
</h4>

<p>Summarise the current state of the object.
</p>


<h5>Usage</h5>

<div class="r"><pre>ChromoteSession$print(..., verbose = FALSE)</pre></div>



<h5>Arguments</h5>

<div class="arguments">

<dl>
<dt><code>...</code></dt>
<dd>
<p>Passed on to <code>format()</code> when <code>verbose</code> = TRUE</p>
</dd>
<dt><code>verbose</code></dt>
<dd>
<p>The print method defaults to a brief summary
of the most important debugging info; use <code>verbose = TRUE</code> tp
see the complex R6 object.</p>
</dd>
</dl>
</div>




</div>