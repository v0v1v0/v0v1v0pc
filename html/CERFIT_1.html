<div class="container">

<table style="width: 100%;"><tr>
<td>CERFIT</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fits a Random Forest of Interactions Trees</h2>

<h3>Description</h3>

<p>Estimates an observations individualized treatment effect for RCT
and observational data. Treatment can be an binary, categorical, ordered, or continuous
variable. Currently if response is binary useRes must be set equal to TRUE.
</p>


<h3>Usage</h3>

<pre><code class="language-R">CERFIT(
  formula,
  data,
  ntrees,
  subset = NULL,
  search = c("exhaustive", "sss"),
  method = c("RCT", "observational"),
  PropForm = c("randomForest", "CBPS", "GBM", "HI"),
  split = c("t.test"),
  mtry = NULL,
  nsplit = NULL,
  nsplit.random = FALSE,
  minsplit = 20,
  minbucket = round(minsplit/3),
  maxdepth = 30,
  a = 50,
  sampleMethod = c("bootstrap", "subsample", "subsampleByID", "allData"),
  useRes = TRUE,
  scale.y = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Formula to build CERFIT.  Categorical predictors must be listed as a factor. e.g., Y ~ x1 + x2 | treatment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data to grow a tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntrees</code></td>
<td>
<p>Number of Trees to grow</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>A logical vector that controls what observations are used to grow the forest.
The default value will use the entire dataframe</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>search</code></td>
<td>
<p>Method to search through candidate splits</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>For observational study data, method="observational";for randomized study data, method="RCT".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PropForm</code></td>
<td>
<p>Method to estimate propensity score</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split</code></td>
<td>
<p>Impurity measure splitting statistic</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mtry</code></td>
<td>
<p>Number of variables to consider at each split</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsplit</code></td>
<td>
<p>Number of cut points selected</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsplit.random</code></td>
<td>
<p>Logical: indicates if process to select cut points are random</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minsplit</code></td>
<td>
<p>Number of observations required to continue growing tree</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minbucket</code></td>
<td>
<p>Number of observations required in each child node</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxdepth</code></td>
<td>
<p>Maximum depth of tree</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>Sigmoid approximation variable (for "sss" which is still under development)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sampleMethod</code></td>
<td>
<p>Method to sample learning sample. Default is bootstrap. Subsample
takes a subsample of the original data. SubsamplebyID samples by an ID column and
uses all observations that have that ID. allData uses the entire data set
for every tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useRes</code></td>
<td>
<p>Logical indicator if you want to fit the CERFIT model to
the residuals from a linear model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale.y</code></td>
<td>
<p>Logical, standardize y when creating splits (For "sss" to increase stability)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function implements Random Forest of Interaction Trees proposed
in Su (2018). Which is a modification of the Random Forest algorithm where
instead of a split being chosen to maximize prediction accuracy each split
is chosen to maximized subgroup treatment heterogeneity. It chooses the best
split by maximizing the test statistic for <code class="reqn">H_0: \beta_3=0</code> in the
following linear model
</p>
<p><code class="reqn">Y_i = \beta_0 + \beta_1I(X_{ij} &lt; c) + \beta_2I(Z = 1) + \beta_3I(X_{ij} &lt; c)I(Z = 1) + \varepsilon_i</code>
</p>
<p>Where <code class="reqn">X_{ij}</code> represents the splitting variable and Z = 1 represents
treatment. So, by maximizing the  test statistic for <code class="reqn">\beta_3</code> we are
maximizing the treatment difference between the nodes.
</p>
<p>The above equation only works when the data comes from a randomized controlled
trial. But we can modify it to gives us unbiased estimates of treatment
effect in observational studies Li et al. (2022). To do that we add propensity score into the
linear model.
</p>
<p><code class="reqn">Y_i = \beta_0 + \beta_1I(X_{ij} &lt; c) + \beta_2I(Z = 1) + \beta_3I(X_{ij} &lt; c)I(Z = 1) + \beta_4e_i + \varepsilon_i</code>
</p>
<p>Where <code class="reqn">e_i</code> represents the propensity score. The CERIT function will estimate
propensity score automatically when the method argument is set to observational.
</p>
<p>To control how this function estimates propensity score you can use the
PropForm argument. Which can take four possible values randomForest, CBPS,
GBM and HI. randomForest uses the randomForest package to use a random forest
to estimate propensity score, CBPS uses Covariate balancing propensity score
to estimate propensity score GBM uses generalized boosted regression models
to estimate propensity score, and HI is for continuous treatment and
estimates the general propensity score. Some of these options only work
for certain treatment types. Full list below
</p>

<ul>
<li>
<p> binary: GBM, CBPS, randomForest
</p>
</li>
<li>
<p> categorical: GBM, CBPS
</p>
</li>
<li>
<p> ordered: GBM, CBPS
</p>
</li>
<li>
<p> continuous: CBPS, HI
</p>
</li>
</ul>
<h3>Value</h3>

<p>Returns a fitted CERFIT object which is a list with the following elements
</p>

<ul>
<li>
<p> RandFor: The Random forest of interaction trees
</p>
</li>
<li>
<p> trt.type: A string containing the treatment type of the data used to fit the model.
Cant be binary, multiple, ordered or continuous.
</p>
</li>
<li>
<p> response.type: A string representing the response type of the data. Can be
binary or continuous.
</p>
</li>
<li>
<p> useRes: A logical indicator that is TRUE if the model was fit on the
residuals of a linear model
</p>
</li>
<li>
<p> data: The data used to fit the model also contains the propensity score if
method was set to observational</p>
</li>
</ul>
<h3>References</h3>


<ul>
<li>
<p> Li, Luo, et al. Causal Effect Random Forest of
Interaction Trees for Learning Individualized Treatment Regimes with
Multiple Treatments in Observational Studies. Stat, 2022,
https://doi.org/10.1002/sta4.457.
</p>
</li>
<li>
<p> Su, X., Peña, A., Liu, L., &amp; Levine, R. (2018). Random forests of interaction trees for estimating individualized treatment effects in randomized trials.
Statistics in Medicine, 37(17), 2547- 2560.
</p>
</li>
<li>
<p> G. W. Imbens, The role of the propensity score in estimating dose-response
functions., Biometrika, 87 (2000), pp. 706–710.
</p>
</li>
<li>
<p> G. Ridgeway, D. McCarey, and A. Morral, The twang package: Toolkit for
weighting and analysis of nonequivalent groups, (2006).
</p>
</li>
<li>
<p> A. Liaw and M. Wiener, Classification and regression by randomforest, R
News, 2 (2002), pp. 18–22</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">fit &lt;- CERFIT(Result_of_Treatment ~ sex + age + Number_of_Warts + Area + Time + Type | treatment,
data = warts,
ntrees = 30,
method = "RCT",
mtry = 2)

</code></pre>


</div>