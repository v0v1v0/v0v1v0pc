<div class="container">

<table style="width: 100%;"><tr>
<td>chkpt_stan</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Checkpoint Sampling: Stan</h2>

<h3>Description</h3>

<p>Fit Bayesian  models using Stan with checkpointing.
</p>


<h3>Usage</h3>

<pre><code class="language-R">chkpt_stan(
  model_code,
  data,
  iter_warmup = 1000,
  iter_sampling = 1000,
  iter_per_chkpt = 100,
  iter_typical = 150,
  parallel_chains = 2,
  threads_per = 1,
  chkpt_progress = TRUE,
  control = NULL,
  seed = 1,
  path,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model_code</code></td>
<td>
<p>Character string corresponding to the Stan model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A named list of R objects (like for RStan).
Further details can be found in <code>sample</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_warmup</code></td>
<td>
<p>(positive integer) The number of warmup iterations to run
per chain (defaults to 1000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_sampling</code></td>
<td>
<p>(positive integer) The number of post-warmup iterations
to run per chain (defaults to 1000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_per_chkpt</code></td>
<td>
<p>(positive integer). The number of iterations per
checkpoint. Note that <code>iter_sampling</code> is divided
by <code>iter_per_chkpt</code> to determine the number of
checkpoints. This must result in an integer
(if not, there will be an error).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_typical</code></td>
<td>
<p>(positive integer) The number of iterations in the
initial warmup, which finds the so-called typical set.
This is an initial phase, and not included in
<code>iter_warmup</code>. Note that a large enough value
is required to ensure converge (defaults to 150).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel_chains</code></td>
<td>
<p>(positive integer) The <em>maximum number</em> of MCMC
chains to run in parallel. If parallel_chains is not
specified then the default is to look for the option
<code>mc.cores</code>, which can be set for an entire R session by
<code>options(mc.cores=value)</code>. If the <code>mc.cores</code>
option has not been set then the default is <code>1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threads_per</code></td>
<td>
<p>(positive integer) Number of threads to use in within-chain
parallelization (defaults to <code>1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chkpt_progress</code></td>
<td>
<p>logical. Should the <code>chkptstanr</code> progress
be printed (defaults to <code>TRUE</code>) ? If set to
<code>FALSE</code>, the standard <code>cmdstanr</code> progress
bar is printed for each checkpoint
(which does not actually keep track of
checkpointing progress)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A named list of parameters to control the sampler's behavior.
It defaults to NULL so all the default values are used.
For a comprehensive overview see <code>stan</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>(positive integer). The seed for random number generation to
make results reproducible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>Character string. The path to the folder, that is used for
saving the checkpoints.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Currently ignored.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An objet of class <code>chkpt_stan</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

# path for storing checkpoint info
path &lt;- create_folder(folder_name = "chkpt_folder_fit1")

stan_code &lt;- make_stancode(bf(formula = count ~ zAge + zBase * Trt + (1|patient),
                              family = poisson()),
                           data = epilepsy)
stan_data &lt;- make_standata(bf(formula = count ~ zAge + zBase * Trt + (1|patient),
                              family = poisson()),
                           data = epilepsy)

# "random" intercept
fit1 &lt;- chkpt_stan(model_code = stan_code, 
                   data = stan_data,
                   iter_warmup = 1000,
                   iter_sampling = 1000,
                   iter_per_chkpt = 250,
                   path = path)

draws &lt;- combine_chkpt_draws(object = fit1)

posterior::summarise_draws(draws)


# eight schools example
 
# path for storing checkpoint info
path &lt;- create_folder(parent_folder = "chkpt_folder_fit2")

stan_code &lt;- "
data {
 int&lt;lower=0&gt; n;
  real y[n]; 
  real&lt;lower=0&gt; sigma[n]; 
}
parameters {
  real mu;
  real&lt;lower=0&gt; tau; 
  vector[n] eta; 
}
transformed parameters {
  vector[n] theta; 
  theta = mu + tau * eta; 
}
model {
  target += normal_lpdf(eta | 0, 1); 
  target += normal_lpdf(y | theta, sigma);  
}
"
stan_data &lt;- schools.data &lt;- list(
  n = 8,
  y = c(28,  8, -3,  7, -1,  1, 18, 12),
  sigma = c(15, 10, 16, 11,  9, 11, 10, 18)
)

fit2 &lt;- chkpt_stan(model_code = stan_code, 
                   data = stan_data,
                   iter_warmup = 1000,
                   iter_sampling = 1000,
                   iter_per_chkpt = 250,
                   path = path)

draws &lt;- combine_chkpt_draws(object = fit2)

posterior::summarise_draws(draws)

## End(Not run)
</code></pre>


</div>