<div class="container">

<table style="width: 100%;"><tr>
<td>chkpt_brms</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Checkpoint Sampling: brms</h2>

<h3>Description</h3>

<p>Fit Bayesian generalized (non-)linear multivariate multilevel models using brms
with checkpointing.
</p>


<h3>Usage</h3>

<pre><code class="language-R">chkpt_brms(
  formula,
  data,
  iter_warmup = 1000,
  iter_sampling = 1000,
  iter_per_chkpt = 100,
  iter_typical = 150,
  parallel_chains = 2,
  threads_per = 1,
  chkpt_progress = TRUE,
  control = NULL,
  brmsfit = TRUE,
  seed = 1,
  path,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>An object of class <code>formula</code>,
<code>brmsformula</code>, or <code>brms{mvbrmsformula}</code>.
Further information can be found in  <code>brmsformula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An object of class <code>data.frame</code> (or one that can be coerced to that class)
containing data of all variables used in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_warmup</code></td>
<td>
<p>(positive integer) The number of warmup iterations to run
per chain (defaults to 1000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_sampling</code></td>
<td>
<p>(positive integer) The number of post-warmup iterations
to run per chain (defaults to 1000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_per_chkpt</code></td>
<td>
<p>(positive integer). The number of iterations per
checkpoint. Note that <code>iter_sampling</code> is divided
by <code>iter_per_chkpt</code> to determine the number of
checkpoints. This must result in an integer
(if not, there will be an error).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter_typical</code></td>
<td>
<p>(positive integer) The number of iterations in the
initial warmup, which finds the so-called typical set.
This is an initial phase, and not included in
<code>iter_warmup</code>. Note that a large enough value
is required to ensure convergence (defaults to 150).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel_chains</code></td>
<td>
<p>(positive integer) The <em>maximum number</em> of MCMC
chains to run in parallel. If parallel_chains is not
specified then the default is to look for the option
<code>mc.cores</code>, which can be set for an entire R session by
<code>options(mc.cores=value)</code>. If the <code>mc.cores</code>
option has not been set then the default is <code>1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threads_per</code></td>
<td>
<p>(positive integer) Number of threads to use in within-chain
parallelization (defaults to <code>1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chkpt_progress</code></td>
<td>
<p>logical. Should the <code>chkptstanr</code> progress
be printed (defaults to <code>TRUE</code>) ? If set to
<code>FALSE</code>, the standard <code>cmdstanr</code> progress
bar is printed for each checkpoint
(which does not actually keep track of
checkpointing progress)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A named list of parameters to control the sampler's behavior.
It defaults to NULL so all the default values are used.
For a comprehensive overview see <code>stan</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>brmsfit</code></td>
<td>
<p>Logical. Should a <code>brmsfit</code> object be returned
(defaults to <code>TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>(positive integer). The seed for random number generation to
make results reproducible.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>Character string. The path to the folder, that is used for
saving the checkpoints.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments based to <code>make_stancode</code>,
including, for example, user-defined prior distributions and the
<code>brmsfamily</code> (e.g., <code>family = poisson())</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>brmsfit</code> (with <code>brmsfit = TRUE</code>)
or <code>chkpt_brms</code> (with <code>brmsfit = FALSE</code>)
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
library(brms)
library(cmdstanr)

# path for storing checkpoint info
path &lt;- create_folder(folder_name  = "chkpt_folder_fit1")

# "random" intercept
fit1 &lt;- chkpt_brms(bf(formula = count ~ zAge + zBase * Trt + (1|patient),
                      family = poisson()), 
                   data = epilepsy, , 
                   iter_warmup = 1000, 
                   iter_sampling = 1000, 
                   iter_per_chkpt = 250, 
                   path = path)
                   
# brmsfit output
fit1

# path for storing checkpoint info
 path &lt;- create_folder(folder_name  = "chkpt_folder_fit2")

# remove "random" intercept (for model comparison)
fit2 &lt;- chkpt_brms(bf(formula = count ~ zAge + zBase * Trt, 
                      family = poisson()), 
                   data = epilepsy, , 
                   iter_warmup = 1000, 
                   iter_sampling = 1000, 
                   iter_per_chkpt = 250, 
                   path = path)
                   
# brmsfit output
fit2

# compare models
loo(fit1, fit2)


# using custom priors
path &lt;- create_folder(folder_name = "chkpt_folder_fit3")

# priors
bprior &lt;- prior(constant(1), class = "b") +
  prior(constant(2), class = "b", coef = "zBase") +
  prior(constant(0.5), class = "sd")

# fit model
fit3 &lt;-
  chkpt_brms(
    bf(
      formula = count ~ zAge + zBase + (1 | patient),
      family = poisson()
    ),
    data = epilepsy,
    path  = path,
    prior = bprior,
    iter_warmup = 1000,
    iter_sampling = 1000,
    iter_per_chkpt = 250, 
  )


# check priors
prior_summary(fit3)


## End(Not run)
</code></pre>


</div>