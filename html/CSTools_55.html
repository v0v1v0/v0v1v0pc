<div class="container">

<table style="width: 100%;"><tr>
<td>PlotMostLikelyQuantileMap</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot Maps of Most Likely Quantiles</h2>

<h3>Description</h3>

<p>This function receives as main input (via the parameter 
<code>probs</code>) a collection of longitude-latitude maps, each containing the 
probabilities (from 0 to 1) of the different grid cells of belonging to a 
category. As many categories as maps provided as inputs are understood to 
exist. The maps of probabilities must be provided on a common rectangular 
regular grid, and a vector with the longitudes and a vector with the latitudes 
of the grid must be provided. The input maps can be provided in two forms, 
either as a list of multiple two-dimensional arrays (one for each category) or 
as a three-dimensional array, where one of the dimensions corresponds to the 
different categories.
</p>


<h3>Usage</h3>

<pre><code class="language-R">PlotMostLikelyQuantileMap(
  probs,
  lon,
  lat,
  cat_dim = "bin",
  bar_titles = NULL,
  col_unknown_cat = "white",
  drawleg = T,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>A list of bi-dimensional arrays with the named dimensions 
'latitude' (or 'lat') and 'longitude' (or 'lon'), with equal size and in the 
same order, or a single tri-dimensional array with an additional dimension 
(e.g. 'bin') for the different categories. The arrays must contain 
probability values between 0 and 1, and the probabilities for all categories 
of a grid cell should not exceed 1 when added.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>A numeric vector with the longitudes of the map grid, in the same 
order as the values along the corresponding dimension in <code>probs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>A numeric vector with the latitudes of the map grid, in the same 
order as the values along the corresponding dimension in <code>probs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat_dim</code></td>
<td>
<p>The name of the dimension along which the different categories 
are stored in <code>probs</code>. This only applies if <code>probs</code> is provided in 
the form of 3-dimensional array. The default expected name is 'bin'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bar_titles</code></td>
<td>
<p>Vector of character strings with the names to be drawn on 
top of the color bar for each of the categories. As many titles as 
categories provided in <code>probs</code> must be provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col_unknown_cat</code></td>
<td>
<p>Character string with a colour representation of the 
colour to be used to paint the cells for which no category can be clearly 
assigned. Takes the value 'white' by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>drawleg</code></td>
<td>
<p>Where to draw the common colour bar. Can take values TRUE, 
FALSE or:<br>
'up', 'u', 'U', 'top', 't', 'T', 'north', 'n', 'N'<br>
'down', 'd', 'D', 'bottom', 'b', 'B', 'south', 's', 'S' (default)<br>
'right', 'r', 'R', 'east', 'e', 'E'<br>
'left', 'l', 'L', 'west', 'w', 'W'</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters to be sent to <code>PlotCombinedMap</code> and 
<code>PlotEquiMap</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Veronica Torralba, <a href="mailto:veronica.torralba@bsc.es">veronica.torralba@bsc.es</a>, Nicolau Manubens, 
<a href="mailto:nicolau.manubens@bsc.es">nicolau.manubens@bsc.es</a>
</p>


<h3>See Also</h3>

<p><code>PlotCombinedMap</code> and <code>PlotEquiMap</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Simple example
x &lt;- array(1:(20 * 10), dim = c(lat = 10, lon = 20)) / 200
a &lt;- x * 0.6
b &lt;- (1 - x) * 0.6
c &lt;- 1 - (a + b)
lons &lt;- seq(0, 359.5, length = 20)
lats &lt;- seq(-89.5, 89.5, length = 10)
## Not run: 
PlotMostLikelyQuantileMap(list(a, b, c), lons, lats, 
                         toptitle = 'Most likely tercile map',
                         bar_titles = paste('% of belonging to', c('a', 'b', 'c')), 
                         brks = 20, width = 10, height = 8)

## End(Not run)

# More complex example
n_lons &lt;- 40
n_lats &lt;- 20
n_timesteps &lt;- 100
n_bins &lt;- 4

# 1. Generation of sample data
lons &lt;- seq(0, 359.5, length = n_lons)
lats &lt;- seq(-89.5, 89.5, length = n_lats)

# This function builds a 3-D gaussian at a specified point in the map.
make_gaussian &lt;- function(lon, sd_lon, lat, sd_lat) {
 w &lt;- outer(lons, lats, function(x, y) dnorm(x, lon, sd_lon) * dnorm(y, lat, sd_lat))
 min_w &lt;- min(w)
 w &lt;- w - min_w
 w &lt;- w / max(w)
 w &lt;- t(w)
 names(dim(w)) &lt;- c('lat', 'lon')
 w
}

# This function generates random time series (with values ranging 1 to 5) 
# according to 2 input weights.
gen_data &lt;- function(w1, w2, n) {
 r &lt;- sample(1:5, n, 
             prob = c(.05, .9 * w1, .05, .05, .9 * w2), 
             replace = TRUE)
 r &lt;- r + runif(n, -0.5, 0.5)
 dim(r) &lt;- c(time = n)
 r
}

# We build two 3-D gaussians.
w1 &lt;- make_gaussian(120, 80, 20, 30)
w2 &lt;- make_gaussian(260, 60, -10, 40)

# We generate sample data (with dimensions time, lat, lon) according 
# to the generated gaussians
sample_data &lt;- multiApply::Apply(list(w1, w2), NULL, 
                                gen_data, n = n_timesteps)$output1

# 2. Binning sample data
prob_thresholds &lt;- 1:n_bins / n_bins
prob_thresholds &lt;- prob_thresholds[1:(n_bins - 1)]
thresholds &lt;- quantile(sample_data, prob_thresholds)

binning &lt;- function(x, thresholds) {
 n_samples &lt;- length(x)
 n_bins &lt;- length(thresholds) + 1

 thresholds &lt;- c(thresholds, max(x))
 result &lt;- 1:n_bins
 lower_threshold &lt;- min(x) - 1
 for (i in 1:n_bins) {
   result[i] &lt;- sum(x &gt; lower_threshold &amp; x &lt;= thresholds[i]) / n_samples
   lower_threshold &lt;- thresholds[i]
 }

 dim(result) &lt;- c(bin = n_bins)
 result
}

bins &lt;- multiApply::Apply(sample_data, 'time', binning, thresholds)$output1

# 3. Plotting most likely quantile/bin
## Not run: 
PlotMostLikelyQuantileMap(bins, lons, lats, 
                         toptitle = 'Most likely quantile map',
                         bar_titles = paste('% of belonging to', letters[1:n_bins]),
                         mask = 1 - (w1 + w2 / max(c(w1, w2))), 
                         brks = 20, width = 10, height = 8)

## End(Not run)
</code></pre>


</div>