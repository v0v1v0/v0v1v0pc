<div class="container">

<table style="width: 100%;"><tr>
<td>NSconvo_fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit the nonstationary spatial model</h2>

<h3>Description</h3>

<p><code>NSconvo_fit</code> estimates the parameters of the nonstationary
convolution-based spatial model. Required inputs are the observed data and
locations. Optional inputs include mixture component locations (if not provided,
the number of mixture component locations are required), the fit radius,
the covariance model (exponential is the default), and whether or not the
nugget and process variance will be spatially-varying.
</p>


<h3>Usage</h3>

<pre><code class="language-R">NSconvo_fit(
  sp.SPDF = NULL,
  coords = NULL,
  data = NULL,
  cov.model = "exponential",
  mean.model = data ~ 1,
  mc.locations = NULL,
  N.mc = NULL,
  lambda.w = NULL,
  fixed.nugg2.var = NULL,
  mean.model.df = NULL,
  mc.kernels = NULL,
  fit.radius = NULL,
  ns.nugget = FALSE,
  ns.variance = FALSE,
  ns.mean = FALSE,
  local.aniso = TRUE,
  fix.tausq = FALSE,
  tausq = 0,
  fix.kappa = FALSE,
  kappa = 0.5,
  method = "reml",
  print.progress = TRUE,
  local.pars.LB = NULL,
  local.pars.UB = NULL,
  global.pars.LB = NULL,
  global.pars.UB = NULL,
  local.ini.pars = NULL,
  global.ini.pars = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sp.SPDF</code></td>
<td>
<p>A "<code>SpatialPointsDataFrame</code>" object, which contains the
spatial coordinates and additional attribute variables corresponding to the
spatoal coordinates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>An N x 2 matrix where each row has the two-dimensional
coordinates of the N data locations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A vector or matrix with N rows, containing the data values.
Inputting a vector corresponds to a single replicate of data, while
inputting a matrix corresponds to replicates. In the case of replicates,
the model assumes the replicates are independent and identically
distributed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.model</code></td>
<td>
<p>A string specifying the model for the correlation
function; defaults to <code>"exponential"</code>.
Options available in this package are: "<code>exponential</code>",
<code>"matern"</code>, and <code>"gaussian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean.model</code></td>
<td>
<p>An object of class <code>formula</code>,
specifying the mean model to be used. Defaults to an intercept only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.locations</code></td>
<td>
<p>Optional; matrix of mixture component locations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N.mc</code></td>
<td>
<p>Optional; if <code>mc.locations</code> is not specified, the
function will create a rectangular grid of size <code>N.mc</code> over the
spatial domain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda.w</code></td>
<td>
<p>Scalar; tuning parameter for the weight function.
Defaults to be the square of one-half of the minimum distance between
mixture component locations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.nugg2.var</code></td>
<td>
<p>Optional; describes the variance/covariance for
a fixed (second) nugget term (represents a known error term). Either
a vector of length N containing a station-specific variances (implying
independent error) or an NxN covariance matrix (implying dependent error).
Defaults to zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean.model.df</code></td>
<td>
<p>Optional data frame; refers to the variables used
in <code>mean.model</code>. Important when using categorical variables in
<code>mean.model</code>, as a subset of the full design matrix will likely
be rank deficient. Specifying <code>mean.model.df</code> allows <code>NSconvo_fit</code>
to calculate a design matrix specific to the points used to fit each
local model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.kernels</code></td>
<td>
<p>Optional specification of mixture component kernel
matrices (based on expert opinion, etc.).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit.radius</code></td>
<td>
<p>Scalar; specifies the fit radius or neighborhood size
for the local likelihood estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ns.nugget</code></td>
<td>
<p>Logical; indicates if the nugget variance (tausq) should
be spatially-varying (<code>TRUE</code>) or constant (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ns.variance</code></td>
<td>
<p>Logical; indicates if the process variance (sigmasq)
should be spatially-varying (<code>TRUE</code>) or constant (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ns.mean</code></td>
<td>
<p>Logical; indicates if the mean coefficeints (beta)
should be spatially-varying (<code>TRUE</code>) or constant (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>local.aniso</code></td>
<td>
<p>Logical; indicates if the local covariance should be
anisotropic (<code>TRUE</code>) or isotropic (<code>FALSE</code>). Defaults to <code>TRUE</code>.
In the case of a locally isotropic model, the bounds and initial values
for lam will default to the first element of <code>local.pars.LB</code>,
<code>local.pars.UB</code>, and <code>local.ini.pars</code> (while still required, the
second and third elements of these vectors will be ignored.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.tausq</code></td>
<td>
<p>Logical; indicates whether the default nugget term
(tau^2) should be fixed (<code>TRUE</code>) or estimated (<code>FALSE</code>). Defaults to
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tausq</code></td>
<td>
<p>Scalar; fixed value for the nugget variance (when
<code>fix.tausq = TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.kappa</code></td>
<td>
<p>Logical; indicates if the kappa parameter should be
fixed (<code>TRUE</code>) or estimated (<code>FALSE</code>). Defaults to <code>FALSE</code>
(only valid for <code>cov.model = "matern"</code> and <code>cov.model = "cauchy"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa</code></td>
<td>
<p>Scalar; value of the kappa parameter. Only used if
<code>fix.kappa = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Indicates the estimation method, either maximum likelihood
(<code>"ml"</code>) or restricted maximum likelihood (<code>"reml"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.progress</code></td>
<td>
<p>Logical; if <code>TRUE</code>, text indicating the progress
of local model fitting in real time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>local.pars.LB, local.pars.UB</code></td>
<td>
<p>Optional vectors of lower and upper
bounds, respectively, used by the <code>"L-BFGS-B"</code> method option in the
<code>optim</code> function for the local parameter estimation.
Each vector must be of length five,
containing values for lam1, lam2, tausq, sigmasq, and nu. Default for
<code>local.pars.LB</code> is <code>rep(1e-05,5)</code>; default for
<code>local.pars.UB</code> is <code>c(max.distance/2, max.distance/2, 4*resid.var, 4*resid.var, 100)</code>,
where <code>max.distance</code> is the maximum interpoint distance of the
observed data and <code>resid.var</code> is the residual variance from using
<code>lm</code> with <code>mean.model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>global.pars.LB, global.pars.UB</code></td>
<td>
<p>Optional vectors of lower and upper
bounds, respectively, used by the <code>"L-BFGS-B"</code> method option in the
<code>optim</code> function for the global parameter estimation.
Each vector must be of length three,
containing values for tausq, sigmasq, and nu. Default for
<code>global.pars.LB</code> is <code>rep(1e-05,3)</code>; default for
<code>global.pars.UB</code> is <code>c(4*resid.var, 4*resid.var, 100)</code>,
where <code>resid.var</code> is the residual variance from using
<code>lm</code> with <code>mean.model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>local.ini.pars</code></td>
<td>
<p>Optional vector of initial values used by the
<code>"L-BFGS-B"</code> method option in the <code>optim</code>
function for the local parameter estimation. The vector must be of length
five, containing values for lam1, lam2, tausq, sigmasq, and nu. Defaults
to <code>c(max.distance/10, max.distance/10, 0.1*resid.var, 0.9*resid.var, 1)</code>,
where <code>max.distance</code> is the maximum interpoint distance of the
observed data and <code>resid.var</code> is the residual variance from using
<code>lm</code> with <code>mean.model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>global.ini.pars</code></td>
<td>
<p>Optional vector of initial values used by the
<code>"L-BFGS-B"</code> method option in the <code>optim</code>
function for the global parameter estimation. The vector must be of length
three, containing values for tausq, sigmasq, and nu. Defaults to
<code>c(0.1*resid.var, 0.9*resid.var, 1)</code>, where <code>resid.var</code> is the
residual variance from using <code>lm</code> with <code>mean.model</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A "NSconvo" object, with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>mc.locations</code></td>
<td>
<p>Mixture component locations used for the simulated
data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.kernels</code></td>
<td>
<p>Mixture component kernel matrices used for the simulated
data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MLEs.save</code></td>
<td>
<p>Table of local maximum likelihood estimates for each
mixture component location.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kernel.ellipses</code></td>
<td>
<p><code>N.obs</code> x 2 x 2 array, containing the kernel
matrices corresponding to each of the simulated values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Observed data values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta.GLS</code></td>
<td>
<p>Generalized least squares estimates of beta,
the mean coefficients. For <code>ns.mean = FALSE</code>, this is a vector
(containing the global mean coefficients); for <code>ns.mean = TRUE</code>,
this is a matrix (one column for each mixture component location).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta.cov</code></td>
<td>
<p>Covariance matrix of the generalized least squares
estimate of beta. For <code>ns.mean = FALSE</code>, this is a matrix
(containing the covariance of theglobal mean coefficients); for
<code>ns.mean = TRUE</code>, this is an array (one matrix for each mixture
component location).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Mean.coefs</code></td>
<td>
<p>"Regression table" for the mean coefficient estimates,
listing the estimate, standard error, and t-value (for <code>ns.mean =
FALSE</code> only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tausq.est</code></td>
<td>
<p>Estimate of tausq (nugget variance), either scalar (when
<code>ns.nugget = "FALSE"</code>) or a vector of length N (when
<code>ns.nugget = "TRUE"</code>), which contains the estimated nugget variance
for each observation location.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigmasq.est</code></td>
<td>
<p>Estimate of sigmasq (process variance), either scalar
(when <code>ns.variance = "FALSE"</code>) or a vector of length N (when
<code>ns.variance = "TRUE"</code>), which contains the estimated process
variance for each observation location.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta.est</code></td>
<td>
<p>Estimate of beta (mean coefficients), either a vector
(when <code>ns.mean = "FALSE"</code>) or a matrix with N rows (when
<code>ns.mean = "TRUE"</code>), each row of which contains the estimated
(smoothed) mean coefficients for each observation location.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa.MLE</code></td>
<td>
<p>Scalar maximum likelihood estimate for kappa (when
applicable).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cov.mat</code></td>
<td>
<p>Estimated covariance matrix (<code>N.obs</code> x <code>N.obs</code>)
using all relevant parameter estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cov.mat.chol</code></td>
<td>
<p>Cholesky of <code>Cov.mat</code> (i.e., <code>chol(Cov.mat)</code>),
the estimated covariance matrix (<code>N.obs</code> x <code>N.obs</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.model</code></td>
<td>
<p>String; the correlation model used for estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ns.nugget</code></td>
<td>
<p>Logical, indicating if the nugget variance was estimated
as spatially-varing (<code>TRUE</code>) or constant (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ns.variance</code></td>
<td>
<p>Logical, indicating if the process variance was
estimated as spatially-varying (<code>TRUE</code>) or constant (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.nugg2.var</code></td>
<td>
<p>N x N matrix with the fixed
variance/covariance for the second (measurement error) nugget term (defaults
to zero).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>N x 2 matrix of observation locations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>global.loglik</code></td>
<td>
<p>Scalar value of the maximized likelihood from the
global optimization (if available).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xmat</code></td>
<td>
<p>Design matrix, obtained from using <code>lm</code>
with <code>mean.model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda.w</code></td>
<td>
<p>Tuning parameter for the weight function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix.kappa</code></td>
<td>
<p>Logical, indicating if kappa was fixed (<code>TRUE</code>) or
estimated (<code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa</code></td>
<td>
<p>Scalar; fixed value of kappa.</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Using white noise data
fit.model &lt;- NSconvo_fit( coords = cbind( runif(100), runif(100)),
data = rnorm(100), fit.radius = 0.4, N.mc = 4 )

## End(Not run)

</code></pre>


</div>