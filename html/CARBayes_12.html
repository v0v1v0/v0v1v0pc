<div class="container">

<table style="width: 100%;"><tr>
<td>S.CARleroux</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fit a spatial generalised linear mixed model to data, where the random effects 
have a Leroux conditional autoregressive prior.
</h2>

<h3>Description</h3>

<p>Fit a spatial generalised linear mixed model to areal unit data, where the response
variable can be binomial, Gaussian, Poisson or zero-inflated Poisson (ZIP). The 
linear predictor is modelled by known covariates and a vector of random effects. 
The latter are modelled by the conditional autoregressive prior proposed by 
Leroux et al. (2000), and further details are given in the vignette accompanying 
this package. Independent random effects can be obtained by setting rho=0, while 
the intrinsic CAR model can be obtained by setting rho=1. Inference is conducted 
in a Bayesian setting using Markov chain Monte Carlo (MCMC) simulation. Missing 
(NA) values are allowed in the response, and posterior predictive distributions 
are created for the missing values using data augmentation. These are saved in 
the"samples" argument in the output of the function and are denoted by "Y". For 
the ZIP model covariates can be used to estimate the probability of an observation 
being a structural zero, via a logistic regression equation. For a full model 
specification see the vignette accompanying this package.
</p>


<h3>Usage</h3>

<pre><code class="language-R">S.CARleroux(formula, formula.omega=NULL, family, data=NULL,  trials=NULL, W, 
burnin, n.sample, thin=1, n.chains=1,  n.cores=1, prior.mean.beta=NULL, 
prior.var.beta=NULL, prior.nu2=NULL, prior.tau2=NULL, prior.mean.delta=NULL, 
prior.var.delta=NULL, rho=NULL, MALA=TRUE, verbose=TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>

<p>A formula for the covariate part of the model using the syntax of the
lm() function. Offsets can be included here using the offset() function. The 
response, offset and each covariate is a vector of length K*1. The response can 
contain missing (NA) values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula.omega</code></td>
<td>

<p>A one-sided formula object with no response variable (left side of the "~") 
needed, specifying the covariates in the logistic regression model for 
modelling the probability of an observation being a structural zero. Each 
covariate (or an offset) needs to be a vector of length K*1. Only required for 
zero-inflated Poisson models.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>

<p>One of either "binomial", "gaussian", "poisson" or "zip", which respectively 
specify a binomial likelihood model with a logistic link function, 
a Gaussian likelihood model with an identity link function, a Poisson likelihood 
model with a log link function, or a zero-inflated Poisson model with a log link 
function. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>An optional data.frame containing the  variables in the formula.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trials</code></td>
<td>

<p>A vector the same length as the response containing the total number of trials 
for each area. Only used if family="binomial". 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>
<p>A non-negative K by K neighbourhood matrix (where K is the number of 
spatial units). Typically a binary specification is used, where the jkth 
element equals one if areas (j, k) are spatially close (e.g. share a common 
border) and is zero otherwise. The matrix can be non-binary, but each row must 
contain at least one non-zero entry.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin</code></td>
<td>

<p>The number of MCMC samples to discard as the burn-in period in each chain.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.sample</code></td>
<td>

<p>The overall number of MCMC samples to generate in each chain.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>

<p>The level of thinning to apply to the MCMC samples in each chain to reduce their 
autocorrelation. Defaults to 1 (no thinning).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.chains</code></td>
<td>

<p>The number of MCMC chains to run when fitting the model. Defaults to 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.cores</code></td>
<td>

<p>The number of computer cores to run the MCMC chains on. Must be less than or 
equal to n.chains. Defaults to 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.mean.beta</code></td>
<td>

<p>A vector of prior means for the regression parameters beta (Gaussian priors are 
assumed). Defaults to a vector of zeros.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.var.beta</code></td>
<td>

<p>A vector of prior variances for the regression parameters beta (Gaussian priors 
are assumed). Defaults to a vector with values 100,000.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.nu2</code></td>
<td>

<p>The prior shape and scale in the form of c(shape, scale) for an Inverse-Gamma(shape, scale) 
prior for nu2. Defaults to c(1, 0.01) and only used if family="Gaussian".   
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.tau2</code></td>
<td>

<p>The prior shape and scale in the form of c(shape, scale) for an Inverse-Gamma(shape, scale) 
prior for tau2. Defaults to c(1, 0.01).  
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.mean.delta</code></td>
<td>

<p>A vector of prior means for the regression parameters delta (Gaussian priors are 
assumed) for the zero probability logistic regression component of the model. 
Defaults to a vector of zeros. Only used if family="multinomial".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.var.delta</code></td>
<td>

<p>A vector of prior variances for the regression parameters delta (Gaussian priors 
are assumed) for the zero probability logistic regression component of the model. 
Defaults to a vector with values 100,000. Only used if family="multinomial".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>

<p>The value in the interval [0, 1] that the spatial dependence parameter rho is 
fixed at if it should not be estimated. If this arugment is NULL then rho is
estimated in the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MALA</code></td>
<td>

<p>Logical, should the function use Metropolis adjusted Langevin algorithm 
(MALA) updates (TRUE, default) or simple random walk updates (FALSE) for 
the regression parameters. Not applicable if family="gaussian".   
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>Logical, should the function update the user on its progress.  
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>summary.results </code></td>
<td>
<p>A summary table of the parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samples </code></td>
<td>
<p>A list containing the MCMC samples from the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted.values </code></td>
<td>
<p>The fitted values based on posterior means from the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals </code></td>
<td>
<p>A matrix with 2 columns where each column is a type of 
residual and each row relates to an area. The types are "response" (raw), 
and "pearson".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelfit </code></td>
<td>
<p>Model fit criteria including the Deviance Information Criterion 
(DIC) and its corresponding estimated effective number of parameters (p.d), the Log 
Marginal Predictive Likelihood (LMPL), the Watanabe-Akaike Information Criterion 
(WAIC) and its corresponding estimated number of effective parameters (p.w), and
the loglikelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>accept </code></td>
<td>
<p>The acceptance probabilities for the parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>localised.structure </code></td>
<td>
<p>NULL, for compatability with other models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula </code></td>
<td>
<p>The formula (as a text string) for the response, covariate and 
offset parts of the model. If family="zip" this also includes the zero probability
logistic regression formula.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model </code></td>
<td>
<p>A text string describing the model fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc.info </code></td>
<td>
<p>A vector giving details of the numbers of MCMC samples generated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X </code></td>
<td>
<p>The design matrix of covariates.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Duncan Lee
</p>


<h3>References</h3>

<p>Leroux B, Lei X, Breslow N (2000). "Estimation of Disease Rates in SmallAreas: A 
New Mixed Model for Spatial Dependence." In M Halloran, D Berry (eds.), 
<em>Statistical Models in Epidemiology, the Environment and Clinical Trials</em>,
pp. 179-191. Springer-Verlag, New York.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#################################################
#### Run the model on simulated data on a lattice
#################################################
#### Load other libraries required
library(MASS)

#### Set up a square lattice region
x.easting &lt;- 1:10
x.northing &lt;- 1:10
Grid &lt;- expand.grid(x.easting, x.northing)
K &lt;- nrow(Grid)

#### set up distance and neighbourhood (W, based on sharing a common border) matrices
distance &lt;- as.matrix(dist(Grid))
W &lt;-array(0, c(K,K))
W[distance==1] &lt;-1 	
	
#### Generate the covariates and response data
x1 &lt;- rnorm(K)
x2 &lt;- rnorm(K)
theta &lt;- rnorm(K, sd=0.05)
phi &lt;- mvrnorm(n=1, mu=rep(0,K), Sigma=0.4 * exp(-0.1 * distance))
logit &lt;- x1 + x2 + theta + phi
prob &lt;- exp(logit) / (1 + exp(logit))
trials &lt;- rep(50,K)
Y &lt;- rbinom(n=K, size=trials, prob=prob)


#### Run the Leroux model
formula &lt;- Y ~ x1 + x2
## Not run: model &lt;- S.CARleroux(formula=formula, family="binomial", 
trials=trials, W=W, burnin=20000, n.sample=100000)
## End(Not run)

#### Toy example for checking
model &lt;- S.CARleroux(formula=formula, family="binomial", 
trials=trials, W=W, burnin=10, n.sample=50)
</code></pre>


</div>