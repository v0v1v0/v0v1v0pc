<div class="container">

<table style="width: 100%;"><tr>
<td>spatialDetectionHistory</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generate a <code>capthist</code> object for spatial capture-recapture analyses
from camera-trapping data</h2>

<h3>Description</h3>

<p>This function generates spatial detection histories of individuals of a
species for spatial capture-recapture analyses with package
<code>secr</code>. Data are stored in a
<code>capthist</code> object. The <code>capthist</code> object
contains detection histories, camera-trap station location and possibly
individual and station-level covariates. Detection histories can have
adjustable occasion length and occasion start time (as in the function
<code>detectionHistory</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">spatialDetectionHistory(
  recordTableIndividual,
  species,
  camOp,
  CTtable,
  output = c("binary", "count"),
  stationCol = "Station",
  speciesCol = "Species",
  sessionCol,
  Xcol,
  Ycol,
  stationCovariateCols,
  individualCol,
  individualCovariateCols,
  recordDateTimeCol = "DateTimeOriginal",
  recordDateTimeFormat = "ymd HMS",
  occasionLength,
  minActiveDaysPerOccasion,
  occasionStartTime = "deprecated",
  maxNumberDays,
  day1,
  buffer,
  includeEffort = TRUE,
  scaleEffort = FALSE,
  binaryEffort = FALSE,
  timeZone,
  makeRMarkInput
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>recordTableIndividual</code></td>
<td>
<p>data.frame. the record table with individual
IDs created by <code>recordTableIndividual</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>species</code></td>
<td>
<p>character. the species for which to compute the detection
history</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>camOp</code></td>
<td>
<p>The camera operability matrix as created by
<code>cameraOperation</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CTtable</code></td>
<td>
<p>data.frame. contains station IDs and coordinates. Same as
used in <code>cameraOperation</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>character. Return individual counts ("count") or binary
observations ("binary")?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stationCol</code></td>
<td>
<p>character. name of the column specifying Station ID in
<code>recordTableIndividual</code> and <code>CTtable</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>speciesCol</code></td>
<td>
<p>character. name of the column specifying species in
<code>recordTableIndividual</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sessionCol</code></td>
<td>
<p>character. name of the column specifying session IDs,
either in <code>recordTableIndividual</code> or in <code>CTtable</code>. See 'Details'
for more information. Session ID values must be a sequence of integer
numbers beginning with 1 (i.e., 1,2,3,...).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xcol</code></td>
<td>
<p>character. name of the column specifying x coordinates in
<code>CTtable</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ycol</code></td>
<td>
<p>character. name of the column specifying y coordinates in
<code>CTtable</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stationCovariateCols</code></td>
<td>
<p>character. name of the column(s) specifying
station-level covariates in <code>CTtable</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>individualCol</code></td>
<td>
<p>character. name of the column specifying individual IDs
in <code>recordTableIndividual</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>individualCovariateCols</code></td>
<td>
<p>character. name of the column(s) specifying
individual covariates in <code>recordTableIndividual</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recordDateTimeCol</code></td>
<td>
<p>character. name of the column specifying date and
time in <code>recordTableIndividual</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recordDateTimeFormat</code></td>
<td>
<p>format of column <code>recordDateTimeCol</code> in
<code>recordTableIndividual</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>occasionLength</code></td>
<td>
<p>integer. occasion length in days</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minActiveDaysPerOccasion</code></td>
<td>
<p>integer. minimum number of active trap days
for occasions to be included (optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>occasionStartTime</code></td>
<td>
<p>(DEPRECATED) integer. time of day (the full hour)
at which to begin occasions. Please use argument <code>occasionStartTime</code> in
<code>cameraOperation</code> instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxNumberDays</code></td>
<td>
<p>integer. maximum number of trap days per station
(optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>day1</code></td>
<td>
<p>character. When should occasions begin: station setup date
("station"), first day of survey ("survey"), a specific date (e.g.
"2015-12-31")?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffer</code></td>
<td>
<p>integer. Makes the first occasion begin a number of days after
station setup. (optional)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>includeEffort</code></td>
<td>
<p>logical. Include trapping effort (number of active
camera trap days per station and occasion) as usage in
<code>capthist</code> object?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scaleEffort</code></td>
<td>
<p>logical. scale and center effort matrix to mean = 0 and
sd = 1? Currently not used. Must be FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binaryEffort</code></td>
<td>
<p>logical. Should effort be binary (1 if &gt;1 active day per
occasion, 0 otherwise)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timeZone</code></td>
<td>
<p>character. Must be a value returned by
<code>OlsonNames</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>makeRMarkInput</code></td>
<td>
<p>logical. If <code>FALSE</code>, output will be a data frame
for RMark. If <code>FALSE</code> or not specified, a secr
<code>capthist</code> object</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function creates a <code>capthist</code> object by combining
three different objects: 1) a record table of identified individuals of a
species, 2) a camera trap station table with station coordinates and 3) a
camera operation matrix computed with <code>cameraOperation</code>. The
record table must contain a column with individual IDs and optionally
individual covariates. The camera trap station table must contain station
coordinates and optionally station-level covariates. The camera operation
matrix provides the dates stations were active or not and the number of
active stations.
</p>
<p><code>day1</code> defines if each stations detection history will begin on that
station's setup day (<code>day1 = "station"</code>) or if all station's detection
histories have a common origin (the day the first station was set up if
<code>day1 = "survey"</code> or a fixed date if, e.g. <code>day1 = "2015-12-31"</code>).
</p>
<p><code>includeEffort</code> controls whether an effort matrix is computed or not.
If TRUE, effort will be used for object <code>usage</code>
information in a <code>traps</code>. <code>binaryEffort</code> makes the
effort information binary. <code>scaleEffort</code> is currently not used and must
be set to FALSE. The reason is that <code>usage</code> can only be
either binary, or nonnegative real values, whereas scaling effort would
return negative values.
</p>
<p>The number of days that are aggregated is controlled by
<code>occasionLength</code>. <code>occasionStartTime</code> will be removed from the
function. It has moved to <code>cameraOperation</code>, to ensure daily
effort is computed correctly and takes the occasion start time into
account.
another hour than midnight (the default). This may be relevant for nocturnal
animals, in which 1 whole night would be considered an occasion.
</p>
<p>Output can be returned as individual counts per occasion (<code>output =
"count"</code>) or as binary observation (<code>output = "binary"</code>).
</p>
<p>Argument <code>sessionCol</code> can be used to a create multi-session
<code>capthist</code> object. There are two different ways in which
the argument is interpreted. It depends on whether a column with the name
you specify in argument <code>sessionCol</code> exists in
<code>recordTableIndividual</code> or in <code>CTtable</code>. If <code>sessionCol</code> is
found in <code>recordTableIndividual</code>, the records will be assigned to the
specified sessions, and it will be assumed that all camera trap station were
used in all sessions. Alternatively, if <code>sessionCol</code> is found
in<code>CTtable</code>, it will be assumed that only a subset of stations was used
in each session, and the records will be assigned automatically (using the
station IDs to identify which session they belong into). In both cases,
session information must be provided as a sequence of integer numbers
beginnign with 1, i.e., you provide the session number directly in
<code>sessionCol</code>. See <code>session</code> for more information
about sessions in <span class="pkg">secr</span>.
</p>
<p><code>capthist</code> objects (as created by
<code>spatialDetectionHistory</code> for spatial capture-recapture
analyses) expect the units of coordinates (<code>Xcol</code> and <code>col</code> in
<code>CTtable</code>) to be meters. Therefore, please use a suitable coordinate
system (e.g. UTM).
</p>
<p><code>recordDateTimeFormat</code> defaults to the "YYYY-MM-DD HH:MM:SS"
convention, e.g. "2014-09-30 22:59:59". <code>recordDateTimeFormat</code> can be
interpreted either by base-R via <code>strptime</code> or in
<span class="pkg">lubridate</span> via <code>parse_date_time</code> (argument
"orders"). <span class="pkg">lubridate</span> will be used if there are no "%" characters in
<code>recordDateTimeFormat</code>.
</p>
<p>For "YYYY-MM-DD HH:MM:SS", <code>recordDateTimeFormat</code> would be either
"%Y-%m-%d %H:%M:%S" or "ymd HMS". For details on how to specify date
and time formats in R see <code>strptime</code> or
<code>parse_date_time</code>.
</p>


<h3>Value</h3>

<p>Output depends on argument <code>makeRMarkInput</code>:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>list("makeRMarkInput = FALSE")</code></td>
<td>
<p>A <code>capthist</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>list("makeRMarkInput = TRUE")</code></td>
<td>
<p>A data frame for use in RMark</p>
</td>
</tr>
</table>
<h3>Warning </h3>

<p>Please note the section about defining argument
<code>timeZone</code> in the vignette on data extraction (accessible via
<code>vignette("DataExtraction")</code> or online
(<a href="https://cran.r-project.org/package=camtrapR/vignettes/camtrapr3.pdf">https://cran.r-project.org/package=camtrapR/vignettes/camtrapr3.pdf</a>)).
</p>


<h3>Author(s)</h3>

<p>Juergen Niedballa
</p>


<h3>See Also</h3>

<p><span class="pkg">secr</span> <span class="pkg">RMark</span>
</p>


<h3>Examples</h3>

<pre><code class="language-R">

data(recordTableIndividualSample)
data(camtraps)

# create camera operation matrix (with problems/malfunction)
camop_problem &lt;- cameraOperation(CTtable      = camtraps,
                                 stationCol   = "Station",
                                 setupCol     = "Setup_date",
                                 retrievalCol = "Retrieval_date",
                                 writecsv     = FALSE,
                                 hasProblems  = TRUE,
                                 dateFormat   = "dmy"
)

sdh &lt;- spatialDetectionHistory(recordTableIndividual = recordTableIndividualSample,
                               species               = "LeopardCat",
                               camOp                 = camop_problem,
                               CTtable               = camtraps,
                               output                = "binary",
                               stationCol            = "Station",
                               speciesCol            = "Species",
                               Xcol                  = "utm_x",
                               Ycol                  = "utm_y",
                               individualCol         = "Individual",
                               recordDateTimeCol     = "DateTimeOriginal",
                               recordDateTimeFormat  = "ymd HMS",
                               occasionLength        = 10,
                               day1                  = "survey",
                               includeEffort         = TRUE,
                               timeZone              = "Asia/Kuala_Lumpur"
  )

# missing space in species = "LeopardCat" was introduced by recordTableIndividual
# (because of CRAN package policies.
# In your data you can have spaces in your directory names)

  summary(sdh)
  plot(sdh, tracks = TRUE)

  ## multi-season capthist object
  # see vignette "3. Extracting Data from Camera Trapping Images, creating occupancy &amp; secr input"
  
  data(camtrapsMultiSeason)
  camtrapsMultiSeason$session[camtrapsMultiSeason$session == 2009] &lt;- 1
  camtrapsMultiSeason$session[camtrapsMultiSeason$session == 2010] &lt;- 2

  data(recordTableIndividualSampleMultiSeason)

  # create camera operation matrix (with problems/malfunction)
  camop_session &lt;- cameraOperation(CTtable         = camtrapsMultiSeason,
                                      stationCol   = "Station",
                                      setupCol     = "Setup_date",
                                      sessionCol   = "session",
                                      retrievalCol = "Retrieval_date",
                                      hasProblems  = TRUE,
                                      dateFormat   = "dmy"
  )

sdh_multi &lt;- spatialDetectionHistory(recordTableIndividual = recordTableIndividualSampleMultiSeason,
                               species               = "LeopardCat",
                               output                = "binary",
                               camOp                 = camop_session,
                               CTtable               = camtrapsMultiSeason,
                               stationCol            = "Station",
                               speciesCol            = "Species",
                               sessionCol            = "session",
                               Xcol                  = "utm_x",
                               Ycol                  = "utm_y",
                               individualCol         = "Individual",
                               recordDateTimeCol     = "DateTimeOriginal",
                               recordDateTimeFormat  = "ymd HMS",
                               occasionLength        = 10,
                               day1                  = "survey",
                               includeEffort         = TRUE,
                               timeZone              = "Asia/Kuala_Lumpur",
                               stationCovariateCols  = "utm_y",         # example
                               individualCovariateCols = "Individual"   # example
  )

  summary(sdh_multi)
  plot(sdh_multi, tracks = TRUE)

</code></pre>


</div>