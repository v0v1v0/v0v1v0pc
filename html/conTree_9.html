<div class="container">

<table style="width: 100%;"><tr>
<td>contrast</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Build contrast tree</h2>

<h3>Description</h3>

<p>Build contrast tree
</p>
<p>Build boosted contrast tree model
</p>
<p>Bootstrap contrast trees
</p>


<h3>Usage</h3>

<pre><code class="language-R">contrast(
  x,
  y,
  z,
  w = rep(1, nrow(x)),
  cat.vars = NULL,
  not.used = NULL,
  qint = 10,
  xmiss = 9e+35,
  tree.size = 10,
  min.node = 500,
  mode = c("onesamp", "twosamp"),
  type = "dist",
  pwr = 2,
  quant = 0.5,
  nclass = NULL,
  costs = NULL,
  cdfsamp = 500,
  verbose = FALSE,
  tree.store = 1e+06,
  cat.store = 1e+05,
  nbump = 1,
  fnodes = 0.25,
  fsamp = 1,
  doprint = FALSE
)

modtrast(
  x,
  y,
  z,
  w = rep(1, nrow(x)),
  cat.vars = NULL,
  not.used = NULL,
  qint = 10,
  xmiss = 9e+35,
  tree.size = 10,
  min.node = 500,
  learn.rate = 0.1,
  type = c("dist", "diff", "class", "quant", "prob", "maxmean", "diffmean"),
  pwr = 2,
  quant = 0.5,
  cdfsamp = 500,
  verbose = FALSE,
  tree.store = 1e+06,
  cat.store = 1e+05,
  nbump = 1,
  fnodes = 0.25,
  fsamp = 1,
  doprint = FALSE,
  niter = 100,
  doplot = FALSE,
  span = 0,
  plot.span = 0.15,
  print.itr = 10
)

bootcri(
  x,
  y,
  z,
  w = rep(1, nrow(x)),
  cat.vars = NULL,
  not.used = NULL,
  qint = 10,
  xmiss = 9e+35,
  tree.size = 10,
  min.node = 500,
  mode = "onesamp",
  type = "dist",
  pwr = 2,
  quant = 0.5,
  nclass = NULL,
  costs = NULL,
  cdfsamp = 500,
  verbose = FALSE,
  tree.store = 1e+06,
  cat.store = 1e+05,
  nbump = 100,
  fnodes = 1,
  fsamp = 1,
  doprint = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>training input predictor data matrix or data frame. Rows
are observations and columns are variables. Must be a numeric
matrix or a data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>vector, or matrix containing training data input outcome
values or censoring intervals for each observation. if y is a
vector then it implies that y uncensored outcome values or
other contrasting quantity. If y is a matrix, then then y is
assumed to be censoring intervals for each observation; see
details below</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>vector containing values of a second contrasting quantity
for each observation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>training observation weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat.vars</code></td>
<td>
<p>vector of column labels (numbers or names)
indicating categorical variables (factors). All variables not
so indicated are assumed to be orderable numeric; see details
below</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>not.used</code></td>
<td>
<p>vector of column labels (numbers or names)
indicating predictor variables not to be used in the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qint</code></td>
<td>
<p>maximum number of split evaluation points on each
predictor variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmiss</code></td>
<td>
<p>missing value flag. Must be numeric and larger than
any non missing predictor/abs(response) variable value.
Predictor variable values greater than or equal to xmiss are
regarded as missing. Predictor variable data values of <code>NA</code> are
internally set to the value of xmiss and thereby regarded as
missing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree.size</code></td>
<td>
<p>maximum number of terminal nodes in generated
trees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.node</code></td>
<td>
<p>minimum number of training observations in each
tree terminal node</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mode</code></td>
<td>
<p>indicating one or two-sample contrast; see details
below for how it works with type</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>type of contrast; see details below for how it works
with mode</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pwr</code></td>
<td>
<p>center split bias parameter. Larger values produce less
center split bias.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quant</code></td>
<td>
<p>specified quantile p (type='quant' only)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nclass</code></td>
<td>
<p>number of classes (type ='class' only) default=2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>costs</code></td>
<td>
<p>nclass by nclass misclassification cost matrix
(type='class' only); default is equal valued diagonal (error
rate)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cdfsamp</code></td>
<td>
<p>= maximum subsample size used to compute censored
CDF (censoring only)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical flag indicating print/don't print censored
CDF computation progress, default <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree.store</code></td>
<td>
<p>size of internal tree storage. Decrease value in
response to memory allocation error. Increase value for very
large values of max.trees and/or tree.size, or in response to
diagnostic message or erratic program behavior</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cat.store</code></td>
<td>
<p>size of internal categorical value
storage. Decrease value in response to memory allocation
error. Increase value for very large values of max.trees and/or
tree.size in the presence of many categorical variables
(factors) with many levels, or in response to diagnostic
message or erratic program behavior</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbump</code></td>
<td>
<p>number of bootstrap replications</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fnodes</code></td>
<td>
<p>top fraction of node criteria used to evaluate trial
bumped trees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fsamp</code></td>
<td>
<p>fraction of observations used in each bootstrap sample
for bumped trees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doprint</code></td>
<td>
<p>logical flag <code>TRUE/FALSE</code> implies do/don't plot iteration progress</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>learn.rate</code></td>
<td>
<p>learning rate parameter in <code style="white-space: pre;">⁠(0,1]⁠</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter</code></td>
<td>
<p>number of trees</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doplot</code></td>
<td>
<p>a flag to display/not display graphical plots</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>span</code></td>
<td>
<p>span for qq-plot transformation smoother</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.span</code></td>
<td>
<p>running median smoother span for discrepancy plot (<code>doplot = TRUE</code>, only)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.itr</code></td>
<td>
<p>tree discrepancy printing iteration interval</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The varible <code>xmiss</code> is the missing value flag, Must be
numeric and larger than any non missing predictor/abs(response) variable value.  Predictor variable values greater than or equal to <code>xmiss</code> are regarded as missing. Predictor variable data values of <code>NA</code> are internally set to the value of xmiss and thereby regarded as missing.
</p>
<p>If the response y is a matrix, it is assumed to contain censoring
intervals for each observation. Rows are observations.
</p>

<ul>
<li>
<p> First/second column are lower/upper boundary of censoring interval (Can be same value for uncensored observations) respectively
</p>
</li>
<li> <p><code>y[,1] = -xmiss</code> implies outcome less than or equal to <code>y[,2]</code> (censored from above)
</p>
</li>
<li> <p><code>y[,2] = xmiss</code> implies outcome greater than or equal to <code>y[,1]</code>
</p>
</li>
</ul>
<p>Note that censoring is only allowed for <code>type='dist'</code>; see further below.
</p>
<p>If x is a data frame and <code>cat.vars</code> (the columns indicating
categorical variables), is missing, then components of type factor
are treated as categorical variables. Ordered factors should be
input as type numeric with appropriate numerical scores. If
<code>cat.vars</code> is present it will over ride the data frame typing.
</p>
<p>The <code>mode</code> argument is either
</p>

<ul>
<li> <p><code>'onesamp'</code> (default) meaning one <code>x</code>-vector for each <code style="white-space: pre;">⁠(x,z)⁠</code> pair
</p>
</li>
<li> <p><code>'twosamp'</code> implies two-sample contrast with
</p>

<ul>
<li> <p><code>x</code> are predictor variables for both samples
</p>
</li>
<li> <p><code>y</code> are outcomes for both samples
</p>
</li>
<li> <p><code>z</code> is sample identity flag with <code>z &lt; 0</code> implying first sample observations and <code>z &gt; 0</code>, the second sample observations.
The <code>type</code> argument indicates the type of contrast. It can be either a user defined function or a string. If <code>mode</code> is <code>'onesamp'</code>, the default,
</p>
</li>
</ul>
</li>
<li> <p><code>type = 'dist'</code> (default) implies contrast distribution of <code>y</code> with that of <code>z</code> (<code>y</code> may be censored - see above)
</p>
</li>
<li> <p><code>type = 'diff'</code> implies contrast joint paired values of <code>y</code> and <code>z</code>
</p>
</li>
<li> <p><code>type = 'class'</code> implies classification: contrast class labels <code>y[i]</code> and <code>z[i]</code> are two class labels (in <code>1:nclass</code>) for each observation.
</p>
</li>
<li> <p><code>type = 'prob'</code> implies contrast predicted with empirical probabilities: <code>y[i] = 0/1</code> and  <code>z[i]</code> is predicted probability <code class="reqn">P(y=1)</code> for <code class="reqn">i</code>-th observation
</p>
</li>
<li> <p><code>type = 'quant'</code> is contrast predicted with empirical quantiles: <code>y[i]</code> is outcome value for <code class="reqn">i</code>-th observation and <code>z[i]</code> is predicted <code class="reqn">p</code>-th quantile value (see below) for <code class="reqn">i</code>-th observation <code class="reqn">(0 &lt; p &lt;1)</code>
</p>
</li>
<li> <p><code>type = 'diffmean'</code> implies maximize absolute mean difference between <code>y</code> and <code>z</code>
</p>
</li>
<li> <p><code>type = 'maxmean'</code> implies maximize signed mean difference between <code>y</code> and <code>z</code>
</p>
</li>
</ul>
<p>When mode is <code>'twosamp'</code>
</p>

<ul>
<li> <p><code>type= 'dist'</code> (default) implies contrast <code>y</code> distributions of both samples
</p>
</li>
<li> <p><code>type = 'diffmean'</code> implies maximize absolute difference between means of two samples
</p>
</li>
<li> <p><code>type = 'maxmean'</code> maximize signed difference between means of two samples
</p>
</li>
</ul>
<p>When <code>type</code> is a function, it must be a function of three arguments
<code>f(y,z,w)</code> where <code>y</code> and <code>z</code> are double vectors and <code>w</code> is a weight
vector, not necessarily normalized. The function should return a
double vector of length 1 as the result. See example below.
</p>


<h3>Value</h3>

<p>a contrast model object use as input to interpretation
procedures
</p>
<p>a contrast model object to be used with predtrast()
</p>
<p>a named list with <code>out$bcri</code> the bootstraped discrepancy values
</p>


<h3>Author(s)</h3>

<p>Jerome H. Friedman
</p>


<h3>References</h3>

<p>Jerome H. Friedman (2020). <a href="doi:10.1073/pnas.1921562117">doi:10.1073/pnas.1921562117</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(census, package = "conTree")
dx &lt;- 1:10000; dxt &lt;- 10001:16281;
# Build contrast tree
tree &lt;- contrast(census$xt[dx,], census$yt[dx], census$gblt[dx], type = 'prob')
# Summarize tree
treesum(tree)
# Get terminal node identifiers for regions containing observations 1 through 10
getnodes(tree, x = census$xt[1:10, ])
# Plot nodes
nodeplots(tree, x = census$xt[dx, ], y = census$yt[dx], z = census$gblt[dx])
# Summarize contrast tree against (precomputed) gradient boosting
# on logistic scale using maximum likelihood (GBL)
nodesum(tree, census$xt[dxt,], census$yt[dxt], census$gblt[dxt])
# Use a custom R discrepancy function to build a contrast tree
dfun &lt;- function(y, z, w) {
   w  &lt;- w / sum(w)
   abs(sum(w * (y - z)))
}
tree2 &lt;- contrast(census$xt[dx,], census$yt[dx], census$gblt[dx], type = dfun)
nodesum(tree2, census$xt[dxt,], census$yt[dxt], census$gblt[dxt])
# Generate lack of fit curve
lofcurve(tree, census$xt[dx,], census$yt[dx], census$gblt[dx])
# Build contrast tree boosting models
# Use small # of iterations for illustration (typically &gt;= 200)
modgbl = modtrast(census$x, census$y, census$gbl, type = 'prob', niter = 10)
# Plot model accuracy as a function of iteration number
xval(modgbl, census$x, census$y, census$gbl, col = 'red')
# Produce predictions from modtrast() for new data.
ypred &lt;- predtrast(modgbl, census$xt, census$gblt, num = modgbl$niter)
# Produce distribution boosting estimates
yhat &lt;- predtrast(modgbl, census$xt, census$gblt, num = modgbl$niter)
</code></pre>


</div>