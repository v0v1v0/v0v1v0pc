<div class="container">

<table style="width: 100%;"><tr>
<td>CST_MergeRefToExp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Merge a Reference To Experiments</h2>

<h3>Description</h3>

<p>Some indicators are defined for specific temporal periods (e.g.: summer from 
June 21st to September 21st). If the initialization forecast date is later 
than the one required for the indicator (e.g.: July 1st), the user may want to 
merge past observations, or other references, to the forecast (or hindcast) to 
compute the indicator. If the forecast simulation doesn't cover the required
period because it is initialized too early (e.g.: Initialization on November
1st the forecast covers until the beginning of June next year), a climatology
(or other references) could be added at the end of the forecast lead time to 
cover the desired period (e.g.: until the end of summer).
</p>


<h3>Usage</h3>

<pre><code class="language-R">CST_MergeRefToExp(
  data1,
  data2,
  start1 = NULL,
  end1 = NULL,
  start2 = NULL,
  end2 = NULL,
  time_dim = "time",
  memb_dim = "member",
  ncores = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data1</code></td>
<td>
<p>An 's2dv_cube' object with the element 'data' being a
multidimensional array with named dimensions. All dimensions must be 
equal to 'data2' dimensions except for the ones specified with 'memb_dim' 
and 'time_dim'. If 'start1' and 'end1' are used to subset a period, the
Dates must be stored in element '$attrs$Dates' of the object. Dates must 
have same time dimensions as element 'data'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data2</code></td>
<td>
<p>An 's2dv_cube' object with the element 'data' being a 
multidimensional array of named dimensions matching the dimensions of 
parameter 'data1'. All dimensions must be equal to 'data1' except for the 
ones specified with 'memb_dim' and 'time_dim'. If 'start2' and 'end2' are 
used to subset a period, the Dates must be stored in element '$attrs$Dates' 
of the object. Dates must have same time dimensions as element 'data'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start1</code></td>
<td>
<p>A list to define the initial date of the period to select from 
'data1' by providing a list of two elements: the initial date of the period 
and the initial month of the period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end1</code></td>
<td>
<p>A list to define the final date of the period to select from 
'data1' by providing a list of two elements: the final day of the period and 
the final month of the period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start2</code></td>
<td>
<p>A list to define the initial date of the period to select from 
'data2' by providing a list of two elements: the initial date of the period 
and the initial month of the period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end2</code></td>
<td>
<p>A list to define the final date of the period to select from 
'data2' by providing a list of two elements: the final day of the period and 
the final month of the period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time_dim</code></td>
<td>
<p>A character string indicating the name of the temporal 
dimension that will be used to combine the two arrays. By default, it is set 
to 'time'. Also, it will be used to subset the data in a requested 
period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>memb_dim</code></td>
<td>
<p>A character string indicating the name of the member 
dimension. If the data are not ensemble ones, set as NULL. The default 
value is 'member'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>An integer indicating the number of cores to use in parallel 
computation.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is created to merge observations and forecasts, known as the 
‘blending’ strategy (see references). The basis for this strategy is that the 
predictions are progressively replaced with observational data as soon as they 
become available (i.e., when entering the indicator definition period). This 
key strategy aims to increase users’ confidence in the reformed predictions.
</p>


<h3>Value</h3>

<p>An 's2dv_cube' object containing the indicator in the element 
<code>data</code>. The element <code>data</code> will be a multidimensional array created 
from the combination of 'data1' and 'data2'. The resulting array will contain 
the following dimensions: the original dimensions of the input data, which are 
common to both arrays and for the 'time_dim' dimension, the sum of the 
corresponding dimension of 'data1' and 'data2'. If 'memb_dim' is not null, 
regarding member dimension, two different situations can occur: (1) in the 
case that one of the arrays does not have member dimension or is equal to 1 
and the other array has multiple member dimension, the result will contain the 
repeated values of the array one up to the lenght of member dimension of array 
two; (2) in the case that both arrays have member dimension and is greater 
than 1, all combinations of member dimension will be returned. The other 
elements of the 's2dv_cube' will be updated with the combined information of 
both datasets.
</p>


<h3>References</h3>

<p>Chou, C., R. Marcos-Matamoros, L. Palma Garcia, N. Pérez-Zanón, 
M. Teixeira, S. Silva, N. Fontes, A. Graça, A. Dell'Aquila, S. Calmanti and 
N. González-Reviriego (2023). Advanced seasonal predictions for vine 
management based on bioclimatic indicators tailored to the wine sector. 
Climate Services, 30, 100343, doi: <a href="https://doi.org/10.1016/j.cliser.2023.100343">10.1016/j.cliser.2023.100343</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data_dates &lt;- c(seq(as.Date("01-07-1993", "%d-%m-%Y", tz = 'UTC'),
                   as.Date("01-12-1993","%d-%m-%Y", tz = 'UTC'), "day"),
               seq(as.Date("01-07-1994", "%d-%m-%Y", tz = 'UTC'),
                   as.Date("01-12-1994","%d-%m-%Y", tz = 'UTC'), "day"))
dim(data_dates) &lt;- c(time = 154, sdate = 2)
data &lt;- NULL
data$data &lt;- array(1:(2*154*2), c(time = 154, sdate = 2, member = 2))
data$attrs$Dates&lt;- data_dates
class(data) &lt;- 's2dv_cube'
ref_dates &lt;- seq(as.Date("01-01-1993", "%d-%m-%Y", tz = 'UTC'),
                as.Date("01-12-1994","%d-%m-%Y", tz = 'UTC'), "day")
dim(ref_dates) &lt;- c(time = 350, sdate = 2)
ref &lt;- NULL
ref$data &lt;- array(1001:1700, c(time = 350, sdate = 2))
ref$attrs$Dates &lt;- ref_dates
class(ref) &lt;- 's2dv_cube'
new_data &lt;- CST_MergeRefToExp(data1 = ref, data2 = data, 
                             start1 = list(21, 6), end1 = list(30, 6),
                             start2 = list(1, 7), end2 = list(21, 9))

</code></pre>


</div>