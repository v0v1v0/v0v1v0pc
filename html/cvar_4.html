<div class="container">

<table style="width: 100%;"><tr>
<td>ES</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute expected shortfall (ES) of distributions</h2>

<h3>Description</h3>

<p>Compute the expected shortfall for a distribution.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ES(dist, p_loss = 0.05, ...)

## Default S3 method:
ES(
  dist,
  p_loss = 0.05,
  dist.type = "qf",
  qf,
  ...,
  intercept = 0,
  slope = 1,
  control = list(),
  x
)

## S3 method for class 'numeric'
ES(
  dist,
  p_loss = 0.05,
  dist.type = "qf",
  qf,
  ...,
  intercept = 0,
  slope = 1,
  control = list(),
  x
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>specifies the distribution whose ES is computed, usually a function or a name
of a function computing quantiles, cdf, pdf, or a random number generator, see
Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_loss</code></td>
<td>
<p>level, default is 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>passed on to <code>dist</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist.type</code></td>
<td>
<p>a character string specifying what is computed by <code>dist</code>, such as
"qf" or "cdf".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>qf</code></td>
<td>
<p>quantile function, only used if <code>dist.type = "pdf"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept, slope</code></td>
<td>
<p>compute ES for the linear transformation <code>intercept +
slope*X</code>, where <code>X</code> has distribution specified by <code>dist</code>, see Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>additional control parameters for the numerical integration routine.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>deprecated and will soon be removed. <code>x</code> was renamed to <code>p_loss</code>,
please use the latter.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ES</code> computes the expected shortfall for distributions specified by the
arguments. <code>dist</code> is typically a function (or the name of one). What <code>dist</code>
computes is determined by <code>dist.type</code>, whose default setting is <code>"qf"</code> (the
quantile function). Other possible settings of <code>dist.type</code> include <code>"cdf"</code>
and <code>"pdf"</code>.  Additional arguments for <code>dist</code> can be given with the
<code>"..."</code> arguments.
</p>
<p>Argument <code>dist</code> can also be a numeric vector. In that case the ES is computed,
effectively, for the empirical cumulative distribution function (ecdf) of the
vector. The ecdf is not created explicitly and the <code>quantile</code>
function is used instead for the computation of VaR. Arguments in <code>"..."</code> are
passed eventually to <code>quantile()</code> and can be used, for example, to select a
non-defult method for the computation of quantiles.
</p>
<p>Except for the exceptions discussed below, a function computing VaR for the specified
distribution is constructed and the expected shortfall is computed by numerically
integrating it. The numerical integration can be fine-tuned with argument
<code>control</code>, which should be a named list, see <code>integrate</code> for the
available options.
</p>
<p>If <code>dist.type</code> is <code>"pdf"</code>, VaR is not computed, Instead, the partial
expectation of the lower tail is computed by numerical integration of <code>x *
    pdf(x)</code>.  Currently the quantile function is required anyway, via argument <code>qf</code>,
to compute the upper limit of the integral. So, this case is mainly for testing and
comparison purposes.
</p>
<p>A bunch of expected shortfalls is computed if argument <code>x</code> or any of the
arguments in <code>"..."</code> are of length greater than one. They are recycled to equal
length, if necessary, using the normal <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> recycling rules.
</p>
<p><code>intercept</code> and <code>slope</code> can be used to compute the expected shortfall for
the location-scale transformation <code>Y = intercept + slope * X</code>, where the
distribution of <code>X</code> is as specified by the other parameters and <code>Y</code> is the
variable of interest. The expected shortfall of <code>X</code> is calculated and then
transformed to that of <code>Y</code>. Note that the distribution of <code>X</code> doesn't need
to be standardised, although it typically will.
</p>
<p>The <code>intercept</code> and the <code>slope</code> can be vectors. Using them may be
particularly useful for cheap calculations in, for example, forecasting, where the
predictive distributions are often from the same family, but with different location
and scale parameters. Conceptually, the described treatment of <code>intercept</code> and
<code>slope</code> is equivalent to recycling them along with the other arguments, but more
efficiently.
</p>
<p>The names, <code>intercept</code> and <code>slope</code>, for the location and scale parameters
were chosen for their expressiveness and to minimise the possibility for a clash with
parameters of <code>dist</code> (e.g., the Gamma distribution has parameter <code>scale</code>).
</p>


<h3>Value</h3>

<p>a numeric vector
</p>


<h3>See Also</h3>

<p><code>VaR</code> for VaR,
</p>
<p><code>predict</code> for examples with fitted models
</p>


<h3>Examples</h3>

<pre><code class="language-R">ES(qnorm)

## Gaussian
ES(qnorm, dist.type = "qf")
ES(pnorm, dist.type = "cdf")

## t-dist
ES(qt, dist.type = "qf", df = 4)
ES(pt, dist.type = "cdf", df = 4)

ES(pnorm, 0.95, dist.type = "cdf")
ES(qnorm, 0.95, dist.type = "qf")
## - VaRES::esnormal(0.95, 0, 1)
## - PerformanceAnalytics::ETL(p=0.05, method = "gaussian", mu = 0,
##                             sigma = 1, weights = 1)             # same

cvar::ES(pnorm, dist.type = "cdf")
cvar::ES(qnorm, dist.type = "qf")
cvar::ES(pnorm, 0.05, dist.type = "cdf")
cvar::ES(qnorm, 0.05, dist.type = "qf")

## this uses "pdf"
cvar::ES(dnorm, 0.05, dist.type = "pdf", qf = qnorm)


## this gives warning (it does more than simply computing ES):
## PerformanceAnalytics::ETL(p=0.95, method = "gaussian", mu = 0, sigma = 1, weights = 1)

## run this if VaRRES is present
## Not run: 
x &lt;- seq(0.01, 0.99, length = 100)
y &lt;- sapply(x, function(p) cvar::ES(qnorm, p, dist.type = "qf"))
yS &lt;- sapply(x, function(p) - VaRES::esnormal(p))
plot(x, y)
lines(x, yS, col = "blue")

## End(Not run)

</code></pre>


</div>