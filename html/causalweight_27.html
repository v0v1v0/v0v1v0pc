<div class="container">

<table style="width: 100%;"><tr>
<td>treatweight</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Treatment evaluation based on inverse probability weighting with optional sample selection correction.</h2>

<h3>Description</h3>

<p>Treatment evaluation based on inverse probability weighting with optional sample selection correction.
</p>


<h3>Usage</h3>

<pre><code class="language-R">treatweight(
  y,
  d,
  x,
  s = NULL,
  z = NULL,
  selpop = FALSE,
  ATET = FALSE,
  trim = 0.05,
  logit = FALSE,
  boot = 1999,
  cluster = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Dependent variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>Treatment, must be binary (either 1 or 0), must not contain missings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Confounders of the treatment and outcome, must not contain missings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s</code></td>
<td>
<p>Selection indicator. Must be one if <code>y</code> is observed (non-missing) and zero if <code>y</code> is not observed (missing). Default is <code>NULL</code>, implying that <code>y</code> does not contain any missings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>Optional instrumental variable(s) for selection <code>s</code>. If <code>NULL</code>, outcome selection based on observables (<code>x</code>,<code>d</code>) - known as "missing at random" - is assumed.
If <code>z</code> is defined, outcome selection based on unobservables - known as "non-ignorable missingness" - is assumed. Default is <code>NULL</code>. If <code>s</code> is <code>NULL</code>, <code>z</code> is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>selpop</code></td>
<td>
<p>Only to be used if both <code>s</code> and <code>z</code> are defined. If <code>TRUE</code>, the effect is estimated for the selected subpopulation with <code>s</code>=1 only. If <code>FALSE</code>, the effect is estimated for the total population.
(note that this relies on somewhat stronger statistical assumptions). Default is <code>FALSE</code>. If <code>s</code> or  <code>z</code> is <code>NULL</code>, <code>selpop</code> is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ATET</code></td>
<td>
<p>If <code>FALSE</code>, the average treatment effect (ATE) is estimated. If <code>TRUE</code>, the average treatment effect on the treated (ATET)  is estimated. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim</code></td>
<td>
<p>Trimming rule for discarding observations with extreme propensity scores. If <code>ATET=FALSE</code>, observations with Pr(D=1|X)&lt;<code>trim</code> or Pr(D=1|X)&gt;(1-<code>trim</code>) are dropped.
If <code>ATET=TRUE</code>, observations with Pr(D=1|X)&gt;(1-<code>trim</code>) are dropped. If <code>s</code> is defined and <code>z</code> is <code>NULL</code>, observations with extremely low selection propensity scores, Pr(S=1|D,X)&lt;<code>trim</code>, are discarded, too. If <code>s</code> and <code>z</code> are defined, the treatment propensity scores to be trimmed change to Pr(D=1|X,Pr(S=1|D,X,Z)). If in addition <code>selpop</code> is <code>FALSE</code>, observation with Pr(S=1|D,X,Z)&lt;<code>trim</code> are discarded, too. Default for <code>trim</code> is 0.05.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logit</code></td>
<td>
<p>If <code>FALSE</code>, probit regression is used for propensity score estimation. If <code>TRUE</code>, logit regression is used. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot</code></td>
<td>
<p>Number of bootstrap replications for estimating standard errors. Default is 1999.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>A cluster ID for block or cluster bootstrapping when units are clustered rather than iid. Must be numerical. Default is NULL (standard bootstrap without clustering).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Estimation of treatment effects of a binary treatment under a selection on observables assumption assuming that all confounders of the treatment and the outcome are observed. Units are weighted by the inverse of their conditional treatment propensities given the observed confounders, which are estimated by probit or logit regression. Standard errors are obtained by bootstrapping the effect.
If <code>s</code> is defined, the procedure allows correcting for sample selection due to missing outcomes based on the inverse of the conditional selection probability. The latter might either be related to observables, which implies a missing at random assumption, or in addition also to unobservables, if an instrument for sample selection is available. See Huber (2012, 2014) for further details.
</p>


<h3>Value</h3>

<p>A treatweight object contains six components: <code>effect</code>, <code>se</code>, <code>pval</code>, <code>y1</code>, <code>y0</code>, and <code>ntrimmed</code>.
</p>
<p><code>effect</code>: average treatment effect (ATE) if <code>ATET=FALSE</code> or the average treatment effect on the treated (ATET) if <code>ATET=TRUE</code>.
</p>
<p><code>se</code>: bootstrap-based standard error of the effect.
</p>
<p><code>pval</code>: p-value of the effect.
</p>
<p><code>y1</code>: mean potential outcome under treatment.
</p>
<p><code>y0</code>: mean potential outcome under control.
</p>
<p><code>ntrimmed</code>: number of discarded (trimmed) observations due to extreme propensity score values.
</p>


<h3>References</h3>

<p>Horvitz, D. G., and Thompson, D. J. (1952): "A generalization of sampling without replacement from a finite universe", Journal of the American Statistical Association, 47, 663â€“685.
</p>
<p>Huber, M. (2012): "Identification of average treatment effects in social experiments under alternative forms of attrition", Journal of Educational and Behavioral Statistics, 37, 443-474.
</p>
<p>Huber, M. (2014): "Treatment evaluation in the presence of sample selection", Econometric Reviews, 33, 869-905.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># A little example with simulated data (10000 observations)
## Not run: 
n=10000
x=rnorm(n); d=(0.25*x+rnorm(n)&gt;0)*1
y=0.5*d+0.25*x+rnorm(n)
# The true ATE is equal to 0.5
output=treatweight(y=y,d=d,x=x,trim=0.05,ATET=FALSE,logit=TRUE,boot=19)
cat("ATE: ",round(c(output$effect),3),", standard error: ",
    round(c(output$se),3), ", p-value: ",round(c(output$pval),3))
output$ntrimmed
## End(Not run)
# An example with non-random outcome selection and an instrument for selection
## Not run: 
n=10000
sigma=matrix(c(1,0.6,0.6,1),2,2)
e=(2*rmvnorm(n,rep(0,2),sigma))
x=rnorm(n)
d=(0.5*x+rnorm(n)&gt;0)*1
z=rnorm(n)
s=(0.25*x+0.25*d+0.5*z+e[,1]&gt;0)*1
y=d+x+e[,2]; y[s==0]=0
# The true ATE is equal to 1
output=treatweight(y=y,d=d,x=x,s=s,z=z,selpop=FALSE,trim=0.05,ATET=FALSE,
       logit=TRUE,boot=19)
cat("ATE: ",round(c(output$effect),3),", standard error: ",
    round(c(output$se),3), ", p-value: ",round(c(output$pval),3))
output$ntrimmed
## End(Not run)
</code></pre>


</div>