<div class="container">

<table style="width: 100%;"><tr>
<td>cf_age</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Identify Fossils with Outlier Age</h2>

<h3>Description</h3>

<p>Removes or flags records that are temporal outliers based on
interquantile ranges.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cf_age(
  x,
  lon = "decimalLongitude",
  lat = "decimalLatitude",
  min_age = "min_ma",
  max_age = "max_ma",
  taxon = "accepted_name",
  method = "quantile",
  size_thresh = 7,
  mltpl = 5,
  replicates = 5,
  flag_thresh = 0.5,
  uniq_loc = FALSE,
  value = "clean",
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>data.frame. Containing fossil records with taxon names, ages, 
and geographic coordinates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>character string. The column with the longitude coordinates.
To identify unique records if <code>uniq_loc  = TRUE</code>.
Default = “decimalLongitude”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>character string. The column with the longitude coordinates.
Default = “decimalLatitude”. To identify unique records if <code>uniq_loc  = T</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min_age</code></td>
<td>
<p>character string. The column with the minimum age. Default
= “min_ma”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_age</code></td>
<td>
<p>character string. The column with the maximum age. Default
= “max_ma”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>taxon</code></td>
<td>
<p>character string. The column with the taxon name. If
“”, searches for outliers over the entire dataset, otherwise per
specified taxon. Default = “accepted_name”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character string.  Defining the method for outlier
selection.  See details. Either “quantile” or “mad”.  Default
= “quantile”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size_thresh</code></td>
<td>
<p>numeric.  The minimum number of records needed for a
dataset to be tested. Default = 10.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mltpl</code></td>
<td>
<p>numeric. The multiplier of the interquartile range
(<code>method == 'quantile'</code>) or median absolute deviation (<code>method ==
'mad'</code>) to identify outliers. See details.  Default = 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replicates</code></td>
<td>
<p>numeric. The number of replications for the distance
matrix calculation. See details.  Default = 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flag_thresh</code></td>
<td>
<p>numeric.  The fraction of passed replicates necessary to pass the test. 
See details. Default = 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uniq_loc</code></td>
<td>
<p>logical.  If TRUE only single records per location and time
point (and taxon if <code>taxon</code> != "") are used for the outlier testing.
Default = T.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>value</code></td>
<td>
<p>character string.  Defining the output value. See value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical. If TRUE reports the name of the test and the number
of records flagged.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The outlier detection is based on an interquantile range test. A temporal
distance matrix among all records is calculated based on a single point selected by random
between the minimum and maximum age for each record. The mean distance for
each point to all neighbours is calculated and the sum of these distances
is then tested against the interquantile range and flagged as an outlier if
<code class="reqn">x &gt; IQR(x) + q_75 * mltpl</code>. The test is replicated ‘replicates’
times, to account for dating uncertainty. Records are flagged as outliers
if they are flagged by a fraction of more than ‘flag.thresh’
replicates. Only datasets/taxa comprising more than ‘size_thresh’
records are tested. Distance are calculated as Euclidean distance.
</p>


<h3>Value</h3>

<p>Depending on the ‘value’ argument, either a <code>data.frame</code>
containing the records considered correct by the test (“clean”) or a
logical vector (“flagged”), with TRUE = test passed and FALSE = test
failed/potentially problematic . Default = “clean”.
</p>


<h3>Note</h3>

<p>See <a href="https://ropensci.github.io/CoordinateCleaner/">https://ropensci.github.io/CoordinateCleaner/</a> for more
details and tutorials.
</p>


<h3>See Also</h3>

<p>Other fossils: 
<code>cf_equal()</code>,
<code>cf_outl()</code>,
<code>cf_range()</code>,
<code>write_pyrate()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
minages &lt;- c(runif(n = 11, min = 10, max = 25), 62.5)
x &lt;- data.frame(species = c(letters[1:10], rep("z", 2)),
                min_ma = minages,
                max_ma = c(minages[1:11] + runif(n = 11, min = 0, max = 5), 65))

cf_age(x, value = "flagged", taxon = "")

# unique locations only
x &lt;- data.frame(species = c(letters[1:10], rep("z", 2)),
                decimalLongitude = c(runif(n = 10, min = 4, max = 16), 75, 7),
                decimalLatitude = c(runif(n = 12, min = -5, max = 5)),
                min_ma = minages, 
                max_ma = c(minages[1:11] + runif(n = 11, min = 0, max = 5), 65))

cf_age(x, value = "flagged", taxon = "", uniq_loc = TRUE)

</code></pre>


</div>