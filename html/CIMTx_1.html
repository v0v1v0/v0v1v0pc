<div class="container">

<table style="width: 100%;"><tr>
<td>ce_estimate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Causal inference with multiple treatments using observational data</h2>

<h3>Description</h3>

<p>The function <code>ce_estimate</code> implements the 6
different methods for causal inference with
multiple treatments using observational data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ce_estimate(
  y,
  x,
  w,
  method,
  formula = NULL,
  discard = FALSE,
  estimand,
  trim_perc = NULL,
  sl_library,
  reference_trt,
  boot = FALSE,
  nboots,
  verbose_boot = TRUE,
  ndpost = 1000,
  caliper = 0.25,
  n_cluster = 5,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A numeric vector (0, 1) representing a binary outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A dataframe, including all the covariates but not treatments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>A numeric vector representing the treatment groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string. Users can selected from the
following methods including <code>"RA"</code>, <code>"VM"</code>, <code>"BART"</code>,
<code>"TMLE"</code>, <code>"IPTW-Multinomial"</code>, <code>"IPTW-GBM"</code>,
<code>"IPTW-SL"</code>, <code>"RAMS-Multinomial"</code>, <code>"RAMS-GBM"</code>,
<code>"RAMS-SL"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A <code>formula</code> object representing
the variables used for the analysis.
The default is to use all terms specified in <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discard</code></td>
<td>
<p>A logical indicating whether to use the discarding rules
for the BART based methods. The default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimand</code></td>
<td>
<p>A character string representing the type of causal estimand.
Only <code>"ATT"</code> or <code>"ATE"</code> is allowed.
When the <code>estimand = "ATT"</code>, users also need to specify
the reference treatment group by setting the <code>reference_trt</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim_perc</code></td>
<td>
<p>A 2-vector numeric value indicating the percentile
at which the inverse probability of treatment weights should be trimmed.
The default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sl_library</code></td>
<td>
<p>A character vector of prediction algorithms.
A list of functions included in the SuperLearner package
can be found with <code>listWrappers</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reference_trt</code></td>
<td>
<p>A numeric value indicating reference
treatment group for ATT effect.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot</code></td>
<td>
<p>A logical indicating whether or not to use nonparametric
bootstrap to calculate the 95% confidence intervals of the causal
effect estimates. The default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboots</code></td>
<td>
<p>A numeric value representing the number of bootstrap samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose_boot</code></td>
<td>
<p>A logical value indicating whether to
print the progress of nonparametric bootstrap.
The default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ndpost</code></td>
<td>
<p>A numeric value indicating the number of posterior draws
for the Bayesian methods (<code>"BART"</code> and <code>"RA"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>caliper</code></td>
<td>
<p>A numeric value denoting the caliper which should be used
when matching (<code>method = "VM"</code>) on the logit of GPS within each cluster
formed by K-means clustering.
The caliper is in standardized units. For example, <code>caliper = 0.25</code>
means that all matches greater than 0.25 standard deviations of the
logit of GPS are dropped. The default value is 0.25.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_cluster</code></td>
<td>
<p>A numeric value denoting the number of clusters to form
using K means clustering on the logit of GPS when <code>method = "VM"</code>.
The default value is 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters that can be passed through to functions.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A summary of the effect estimates can be obtained
with <code>summary</code> function. For VM, the output contains the number
of matched individuals. For BART and <code>discard = TRUE</code>,
the output contains number of discarded individuals. For IPTW related
method and <code>boot = FALSE</code>, the weight distributions can be
visualized using <code>plot</code> function. For BART and RA, the output
contains a list of the posterior samples of causal estimands.
</p>


<h3>References</h3>

<p>Hu, L., Gu, C., Lopez, M., Ji, J., &amp; Wisnivesky, J. (2020).
Estimation of causal effects of multiple treatments in
observational studies with a binary outcome.
<em>Statistical Methods in Medical Research</em>, <strong>29</strong>(11), 3218–3234.
</p>
<p>Hu, L., Gu, C.
Estimation of causal effects of multiple treatments in healthcare
database studies with rare outcomes.
<em>Health Service Outcomes Research Method</em> <strong>21</strong>, 287–308 (2021).
</p>
<p>Sparapani R, Spanbauer C, McCulloch R
Nonparametric Machine Learning and  Efficient Computation
with Bayesian Additive Regression Trees: The BART R Package.
<em>Journal of Statistical Software</em>, <strong>97</strong>(1), 1-66.
</p>
<p>Hadley Wickham, Romain François, Lionel Henry and Kirill Müller (2021).
<em>dplyr: A Grammar of Data Manipulation</em>.
R package version 1.0.7.
URL: <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>
</p>
<p>Venables, W. N. &amp; Ripley, B. D. (2002)
<em>Modern Applied Statistics with S</em>.
Fourth Edition. Springer, New York. ISBN 0-387-95457-0
</p>
<p>Matthew Cefalu, Greg Ridgeway, Dan McCaffrey, Andrew Morral,
Beth Ann Griffin and Lane Burgette (2021).
<em>twang: Toolkit for Weighting and Analysis of Nonequivalent Groups</em>.
R package version 2.5.
URL:<a href="https://CRAN.R-project.org/package=twang">https://CRAN.R-project.org/package=twang</a>
</p>
<p>Noah Greifer (2021).
<em>WeightIt: Weighting for Covariate Balance in Observational Studies</em>.
R package version 0.12.0.
URL:<a href="https://CRAN.R-project.org/package=WeightIt">https://CRAN.R-project.org/package=WeightIt</a>
</p>
<p>Hadley Wickham (2019).
<em>stringr: Simple, Consistent Wrappers for Common String Operations</em>.
R package version 1.4.0.
URL:<a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>
</p>
<p>Andrew Gelman and Yu-Sung Su (2020).
<em>arm: Data Analysis Using Regression and
Multilevel/Hierarchical Models</em>.
R package version 1.11-2.
URL:<a href="https://CRAN.R-project.org/package=arm">https://CRAN.R-project.org/package=arm</a>
</p>
<p>Wood, S.N. (2011)
Fast stable restricted maximum likelihood and marginal likelihood
estimation of semiparametric generalized linear models.
<em>Journal of the Royal Statistical Society (B)</em> <strong>73</strong>(1):3-36
</p>
<p>Eric Polley, Erin LeDell, Chris Kennedy and Mark van der Laan (2021).
<em>SuperLearner: Super Learner Prediction</em>.
R package version 2.0-28.
URL:<a href="https://CRAN.R-project.org/package=SuperLearner">https://CRAN.R-project.org/package=SuperLearner</a>
</p>
<p>Susan Gruber, Mark J. van der Laan (2012).
tmle: An R Package for Targeted Maximum Likelihood Estimation.
<em>Journal of Statistical Software</em>,
<strong>51</strong>(13), 1-35.
</p>
<p>Jasjeet S. Sekhon (2011).
Multivariate and Propensity Score Matching Software with
Automated Balance Optimization: The Matching Package for R.
<em>Journal of Statistical Software</em>, <strong>42</strong>(7), 1-52
</p>
<p>H. Wickham.
<em>ggplot2: Elegant Graphics for Data Analysis</em>.
Springer-Verlag New York, 2016.
</p>
<p>Claus O. Wilke (2020).
<em>cowplot: Streamlined Plot Theme and Plot Annotations for 'ggplot2'</em>.
R package version 1.1.1.
URL:<a href="https://CRAN.R-project.org/package=cowplot">https://CRAN.R-project.org/package=cowplot</a>
</p>
<p>Elio Campitelli (2021).
<em>metR: Tools for Easier Analysis of Meteorological Fields</em>.
R package version 0.11.0.
URL:<a href="https://github.com/eliocamp/metR">https://github.com/eliocamp/metR</a>
</p>
<p>Hadley Wickham (2021).
<em>tidyr: Tidy Messy Data</em>. R package version 1.1.4.
<em>https://CRAN.R-project.org/package=tidyr</em>
</p>
<p>Microsoft Corporation and Steve Weston (2020).
<em>doParallel: Foreach Parallel Adaptor for the 'parallel' Package</em>.
R package version 1.0.16.
URL:<a href="https://CRAN.R-project.org/package=doParallel">https://CRAN.R-project.org/package=doParallel</a>
</p>
<p>Microsoft and Steve Weston (2020).
<em>foreach: Provides Foreach Looping Construct. R package version 1.5.1</em>.
URL:<a href="https://CRAN.R-project.org/package=foreach">https://CRAN.R-project.org/package=foreach</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">lp_w_all &lt;-
  c(
    ".4*x1 + .1*x2  - .1*x4 + .1*x5", # w = 1
    ".2 * x1 + .2 * x2  - .2 * x4 - .3 * x5"
  ) # w = 2
nlp_w_all &lt;-
  c(
    "-.5*x1*x4  - .1*x2*x5", # w = 1
    "-.3*x1*x4 + .2*x2*x5"
  ) # w = 2
lp_y_all &lt;- rep(".2*x1 + .3*x2 - .1*x3 - .1*x4 - .2*x5", 3)
nlp_y_all &lt;- rep(".7*x1*x1  - .1*x2*x3", 3)
X_all &lt;- c(
  "rnorm(0, 0.5)", # x1
  "rbeta(2, .4)", # x2
  "runif(0, 0.5)", # x3
  "rweibull(1,2)", # x4
  "rbinom(1, .4)" # x5
)

set.seed(111111)
data &lt;- data_sim(
  sample_size = 300,
  n_trt = 3,
  x = X_all,
  lp_y = lp_y_all,
  nlp_y = nlp_y_all,
  align = FALSE,
  lp_w = lp_w_all,
  nlp_w = nlp_w_all,
  tau = c(-1.5, 0, 1.5),
  delta = c(0.5, 0.5),
  psi = 1
)
ce_estimate(
  y = data$y, x = data$covariates, w = data$w,
  ndpost = 100, method = "RA", estimand = "ATE"
)
</code></pre>


</div>