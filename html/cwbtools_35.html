<div class="container">

<table style="width: 100%;"><tr>
<td>p_attribute_encode</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Encode Positional Attribute(s).</h2>

<h3>Description</h3>

<p>Generate positional attribute from a character vector of
tokens (the token stream).
</p>


<h3>Usage</h3>

<pre><code class="language-R">p_attribute_encode(
  token_stream,
  p_attribute = "word",
  registry_dir,
  corpus,
  data_dir,
  method = c("R", "CWB"),
  verbose = TRUE,
  quietly = FALSE,
  encoding = get_encoding(token_stream),
  compress = FALSE,
  reload = TRUE
)

p_attribute_recode(
  data_dir,
  p_attribute,
  from = c("UTF-8", "latin1"),
  to = c("UTF-8", "latin1")
)

p_attribute_rename(
  corpus,
  old,
  new,
  registry_dir,
  verbose = TRUE,
  dryrun = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>token_stream</code></td>
<td>
<p>A <code>character</code> vector with the tokens of the corpus. The
maximum length is 2 147 483 647 (2^31 - 1); a warning is issued if this
threshold is exceeded. See the <a href="https://cwb.sourceforge.io/files/CWB_Encoding_Tutorial.pdf">CWB Encoding Tutorial</a> for
size limitations of corpora. May also be a file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p_attribute</code></td>
<td>
<p>The positional attribute to create - a <code>character</code> vector
containing only lowercase ASCII characters (a-z), digits (0-9), -, and _:
No non-ASCII or uppercase letters allowed. If method is "R", only one
positional attribute can be encoded at a time. If <code>method</code> is "CWB", more
than one p-attribute allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>registry_dir</code></td>
<td>
<p>Registry directory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corpus</code></td>
<td>
<p>ID of the CWB corpus to create.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_dir</code></td>
<td>
<p>The data directory for the binary files of the corpus.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Either 'CWB' or 'R', defaults to 'R'. See section 'Details'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A <code>logical</code> value, whether to output progress messages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quietly</code></td>
<td>
<p>A <code>logical</code> value passed into <code>RcppCWB::cwb_makeall()</code>,
<code>RcppCWB::cwb_huffcode()</code> and <code>RcppCWB::cwb_compress_rdx</code> to control
verbosity of these functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>encoding</code></td>
<td>
<p>Encoding as defined in the charset corpus property of the
registry file for the corpus ('latin1' to 'latin9', and 'utf8').</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compress</code></td>
<td>
<p>A <code>logical</code> value, whether to run <code>RcppCWB::cwb_huffcode()</code>
and <code>RcppCWB::cwb_compress_rdx()</code> (method 'R'), or command line tools
<code>cwb-huffcode</code> and <code>cwb-compress-rdx</code> (method 'CWB'). Defaults to <code>FALSE</code>
as compression is not stable on Windows.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reload</code></td>
<td>
<p>A <code>logical</code> value that defaults to <code>TRUE</code> to ensure that all
features are available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>from</code></td>
<td>
<p>Character string describing the current encoding of the attribute.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>to</code></td>
<td>
<p>Character string describing the target encoding of the attribute.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>old</code></td>
<td>
<p>A <code>character</code> vector with p-attributes to be renamed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>new</code></td>
<td>
<p>A <code>character</code> vector with new names of p-attributes. The vector
needs to have the same length as vector <code>old</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dryrun</code></td>
<td>
<p>A <code>logical</code> value, whether to suppress actual renaming
operation for inspecting output messages</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Four steps generate the binary CWB corpus data format for positional
attributes: (1) Encode the token stream of the corpus, (2) create index
files, (3) compress token stream and (4) compress index files. Whereas steps
1 and 2 are required to make a corpus work, steps 3 and 4 are optional yet
useful to reduce disk usage and improve performance. See the <a href="https://cwb.sourceforge.io/files/CWB_Encoding_Tutorial.pdf">CQP Corpus Encoding Tutorial</a>
(sections 2-4) for an explanation of the procedure.
</p>
<p><code>p_attribute_encode()</code> offers an R and a CWB implementation controlled by
argument <code>method</code>. When choosing method 'R', the token stream is encoded in
'pure R', then the C implementation of CWB functionality as exposed to R via
the RcppCWB package is used (functions <code>RcppCWB::cwb_makeall()</code> for indexing,
<code>RcppCWB::cwb_huffcode()</code> and <code>RcppCWB::cwb_compress_rdx()</code> for compression).
When choosing method 'CWB', the token stream is written to disk, then CWB
command line utilities 'cwb-encode', cwb-makeall', 'cwb-huffcode' and
'cwb-compress-rdx' are called using <code>system2()</code>. The CWB-method requires an
installation of the 'CWB'. The <code>cwb_install()</code> function will download and #
install the CWB command line tools within the package. The 'CWB'-method is
still supported as it is used in the test suite of the packaage. The
'R'-method is robust and is recommended.
</p>
<p><code>p_attribute_recode()</code> will recode the values in the avs-file and
change the attribute value index in the avx file. The rng-file remains
unchanged. The registry file remains unchanged, and it is highly
recommended to consider <code>s_attribute_recode()</code> as a helper for
<code>corpus_recode()</code> that will recode all s-attributes, all p-attributes, and
will reset the encoding in the registry file.
</p>
<p>Function <code>p_attribute_rename()</code> can be used to rename a
positional attribute. Note that the corpus is not refreshed (unloaded,
re-loaded), so it may be necessary to restart R for changes to become
effective.
</p>


<h3>Value</h3>

<p><code>TRUE</code> is returned invisibly, if encoding has been successful.
<code>FALSE</code> indicates an error has occurred.
</p>


<h3>Author(s)</h3>

<p>Christoph Leonhardt, Andreas Blaette
</p>


<h3>Examples</h3>

<pre><code class="language-R"># In this example, we follow a "pure R" approach. 
library(dplyr)

reu &lt;- system.file(package = "RcppCWB", "extdata", "examples", "reuters.txt")
tokens &lt;- readLines(reu)

# Create new (and empty) directory structure

registry_tmp &lt;- fs::path(tempdir(), "registry")
data_dir_tmp &lt;- fs::path(tempdir(), "data_dir", "reuters")

if (dir.exists(registry_tmp)) unlink(registry_tmp, recursive = TRUE)
if (dir.exists(data_dir_tmp)) unlink(data_dir_tmp, recursive = TRUE)

dir.create(registry_tmp)
dir.create(data_dir_tmp, recursive = TRUE)

# Encode token stream (without compression)

p_attribute_encode(
  corpus = "reuters",
  token_stream = tokens,
  p_attribute = "word",
  data_dir = data_dir_tmp,
  registry_dir = registry_tmp,
  method = "R",
  compress = FALSE,
  quietly = TRUE,
  encoding = "utf8"
)

# Augment registry file 

registry_file_parse(corpus = "REUTERS", registry_dir = registry_tmp) %&gt;%
  registry_set_name("Reuters Sample Corpus") %&gt;%
  registry_set_property("charset", "utf8") %&gt;%
  registry_set_property("language", "en") %&gt;%
  registry_set_property("build_date", as.character(Sys.Date())) %&gt;%
  registry_file_write()

# Run query as a test

library(RcppCWB)

cqp_query(corpus = "REUTERS", query = '[]{3} "oil" []{3};')
regions &lt;- cqp_dump_subcorpus(corpus = "REUTERS")

kwic &lt;- apply(
  regions, 1,
  function(region){
    ids &lt;- cl_cpos2id(
      "REUTERS",
      p_attribute = "word",
      registry = registry_tmp,
      cpos = region[1]:region[2]
    )
    words &lt;- cl_id2str(
      corpus = "REUTERS",
      p_attribute = "word",
      registry = registry_tmp,
      id = ids
    )
    paste0(words, collapse = " ")
  }
)
kwic[1:10]
</code></pre>


</div>