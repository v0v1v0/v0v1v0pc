<div class="container">

<table style="width: 100%;"><tr>
<td>AsyVar</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Asymptotic Variance and Confidence Interval Estimation of the ATE</h2>

<h3>Description</h3>

<p><code>AsyVar</code> estimates the asymptotic variance of the ATE obtained with the CBPS or oCBPS method. It also returns the finite variance estimate, the finite standard error, and a CI for the ATE.
</p>


<h3>Usage</h3>

<pre><code class="language-R">AsyVar(
  Y,
  Y_1_hat = NULL,
  Y_0_hat = NULL,
  CBPS_obj,
  method = "CBPS",
  X = NULL,
  TL = NULL,
  pi = NULL,
  mu = NULL,
  CI = 0.95
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Y</code></td>
<td>
<p>The vector of actual outcome values (observations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y_1_hat</code></td>
<td>
<p>The vector of estimated outcomes according to the treatment model. (AsyVar automatically sets the treatment model as a linear regression model and it is fitted within the function.) If <code>CBPS_obj</code> is specified, or if <code>X</code> <code class="reqn">and</code> <code>TL</code> are specified, this is unnecessary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y_0_hat</code></td>
<td>
<p>The vector of estimated outcomes according to the control model. (AsyVar automatically sets the control model as a linear regression model and it is fitted within the function.) If <code>CBPS_obj</code> is specified, or if <code>X</code> <code class="reqn">and</code> <code>TL</code> are specified, this is unnecessary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CBPS_obj</code></td>
<td>
<p>An object obtained with the CBPS function. If this object is not sepecified, then <code>X</code>, <code>TL</code>, <code>pi</code>, and <code>mu</code> must <code class="reqn">all</code> be specified instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>The specific method to be considered. Either <code>"CBPS"</code> or <code>"oCBPS"</code> must be selected.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>The matrix of covariates with the rows corresponding to the observations and the columns corresponding to the variables. The left most column must be a column of 1's for the intercept. (<code>X</code> is not necessary if <code>CBPS_obj</code> is specified.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>TL</code></td>
<td>
<p>The vector of treatment labels. More specifically, the label is 1 if it is in the treatment group and 0 if it is in the control group. (<code>TL</code> is not necessary if <code>CBPS_obj</code> is specified.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pi</code></td>
<td>
<p>The vector of estimated propensity scores. (<code>pi</code> is not necessary if <code>CBPS_obj</code> is specified.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>The estimated average treatment effect obtained with either the CBPS or oCBPS method. (<code>mu</code> is not necessary if <code>CBPS_obj</code> is specified.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI</code></td>
<td>
<p>The specified confidence level (between 0 and 1) for calculating the confidence interval for the average treatment effect. Default value is 0.95.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mu.hat</code></td>
<td>
<p>The estimated average treatment effect, <code class="reqn">hat{\mu}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asy.var</code></td>
<td>
<p>The estimated asymptotic variance of <code class="reqn">\sqrt{n}*hat{\mu}</code> obtained with the CBPS or oCBPS method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>The estimated variance of <code class="reqn">hat{\mu}</code> obtained with the CBPS or oCBPS method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std.err</code></td>
<td>
<p>The standard error of <code class="reqn">hat{\mu}</code> obtained with the CBPS or oCBPS method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI.mu.hat</code></td>
<td>
<p>The confidence interval of <code class="reqn">hat{\mu}</code> obtained with the CBPS or oCBPS method with the confidence level specified in the input argument.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Inbeom Lee
</p>


<h3>References</h3>

<p>Fan, Jianqing and Imai, Kosuke and Lee, Inbeom and Liu, Han and Ning, Yang and Yang, Xiaolin. 2021. 
“Optimal Covariate Balancing Conditions in Propensity Score Estimation.” Journal of Business &amp; Economic Statistics. 
<a href="https://imai.fas.harvard.edu/research/CBPStheory.html">https://imai.fas.harvard.edu/research/CBPStheory.html</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#GENERATING THE DATA
n=300
          
#Initialize the X matrix.
X_v1 &lt;- rnorm(n,3,sqrt(2))
X_v2 &lt;- rnorm(n,0,1)
X_v3 &lt;- rnorm(n,0,1)
X_v4 &lt;- rnorm(n,0,1)
X_mat &lt;- as.matrix(cbind(rep(1,n), X_v1, X_v2, X_v3, X_v4)) 
          
#Initialize the Y_1 and Y_0 vector using the treatment model and the control model.
Y_1 &lt;- X_mat %*% matrix(c(200, 27.4, 13.7, 13.7, 13.7), 5, 1) + rnorm(n)
Y_0 &lt;- X_mat %*% matrix(c(200, 0 , 13.7, 13.7, 13.7), 5, 1) + rnorm(n)
          
#True Propensity Score calculation.
pre_prop &lt;- X_mat[,2:5] %*% matrix(c(0, 0.5, -0.25, -0.1), 4, 1)
propensity_true &lt;- (exp(pre_prop))/(1+(exp(pre_prop)))
          
#Generate T_vec, the treatment vector, with the true propensity scores.
T_vec &lt;- rbinom(n, size=1, prob=propensity_true)
          
#Now generate the actual outcome Y_outcome (accounting for treatment/control groups).
Y_outcome &lt;- Y_1*T_vec + Y_0*(1-T_vec)
          
#Use oCBPS.
ocbps.fit &lt;- CBPS(T_vec ~ X_mat, ATT=0, baseline.formula = ~X_mat[,c(1,3:5)], 
                 diff.formula = ~X_mat[,2])
          
#Use the AsyVar function to get the asymptotic variance of the 
#estimated average treatment effect and its confidence interval when using oCBPS.
AsyVar(Y=Y_outcome, CBPS_obj=ocbps.fit, method="oCBPS", CI=0.95)

#Use CBPS.
cbps.fit &lt;- CBPS(T_vec ~ X_mat, ATT=0)

#Use the AsyVar function to get the asymptotic variance of the
#estimated average treatment effect and its confidence interval when using CBPS.
AsyVar(Y=Y_outcome, CBPS_obj=cbps.fit, method="CBPS", CI=0.95)

</code></pre>


</div>