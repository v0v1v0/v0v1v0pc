<div class="container">

<table style="width: 100%;"><tr>
<td>contrast_nns</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Contrast nearest neighbors</h2>

<h3>Description</h3>

<p>Computes the ratio of cosine similarities between group embeddings and features
–that is, for any given feature it first computes the similarity between that feature
and each group embedding, and then takes the ratio of these two similarities.
This ratio captures how "discriminant" a feature is of a given group.
</p>


<h3>Usage</h3>

<pre><code class="language-R">contrast_nns(
  x,
  groups = NULL,
  pre_trained = NULL,
  transform = TRUE,
  transform_matrix = NULL,
  bootstrap = TRUE,
  num_bootstraps = 100,
  confidence_level = 0.95,
  permute = TRUE,
  num_permutations = 100,
  candidates = NULL,
  N = 20,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>(quanteda) <code>tokens-class</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>
<p>(numeric, factor, character) a binary variable of the same length as <code>x</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pre_trained</code></td>
<td>
<p>(numeric) a F x D matrix corresponding to pretrained embeddings.
F = number of features and D = embedding dimensions.
rownames(pre_trained) = set of features for which there is a pre-trained embedding.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform</code></td>
<td>
<p>(logical) if TRUE (default) apply the 'a la carte' transformation,
if FALSE ouput untransformed averaged embeddings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>transform_matrix</code></td>
<td>
<p>(numeric) a D x D 'a la carte' transformation matrix.
D = dimensions of pretrained embeddings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bootstrap</code></td>
<td>
<p>(logical) if TRUE, use bootstrapping – sample from texts with replacement and
re-estimate cosine ratios for each sample. Required to get std. errors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_bootstraps</code></td>
<td>
<p>(numeric) - number of bootstraps to use</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confidence_level</code></td>
<td>
<p>(numeric in (0,1)) confidence level e.g. 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>permute</code></td>
<td>
<p>(logical) - if TRUE, compute empirical p-values using a permutation test</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_permutations</code></td>
<td>
<p>(numeric) - number of permutations to use</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>candidates</code></td>
<td>
<p>(character) vector of candidate features for nearest neighbors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>(numeric) - nearest neighbors are subset to the union of the N neighbors of each group (if NULL, ratio is computed for all features)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>(logical) - if TRUE, report the documents that had
no overlapping features with the pretrained embeddings provided.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a data.frame with following columns:
</p>

<dl>
<dt><code>feature</code></dt>
<dd>
<p>(character) vector of feature terms corresponding to the nearest neighbors.</p>
</dd>
<dt><code>value</code></dt>
<dd>
<p>(numeric) ratio of cosine similarities. Average over bootstrapped samples if bootstrap = TRUE.</p>
</dd>
<dt><code>std.error</code></dt>
<dd>
<p>(numeric) std. error of the ratio of cosine similarties. Column is dropped if bootsrap = FALSE.</p>
</dd>
<dt><code>lower.ci</code></dt>
<dd>
<p>(numeric) (if bootstrap = TRUE) lower bound of the confidence interval.</p>
</dd>
<dt><code>upper.ci</code></dt>
<dd>
<p>(numeric) (if bootstrap = TRUE) upper bound of the confidence interval.</p>
</dd>
<dt><code>p.value</code></dt>
<dd>
<p>(numeric) empirical p-value. Column is dropped if permute = FALSE.</p>
</dd>
</dl>
<h3>Examples</h3>

<pre><code class="language-R">
library(quanteda)

cr_toks &lt;- tokens(cr_sample_corpus)

immig_toks &lt;- tokens_context(x = cr_toks,
pattern = "immigration", window = 6L, hard_cut = FALSE, verbose = TRUE)

# sample 100 instances of the target term, stratifying by party (only for example purposes)
set.seed(2022L)
immig_toks &lt;- tokens_sample(immig_toks, size = 100, by = docvars(immig_toks, 'party'))

set.seed(42L)
party_nns &lt;- contrast_nns(x = immig_toks,
groups = docvars(immig_toks, 'party'),
pre_trained = cr_glove_subset,
transform = TRUE, transform_matrix = cr_transform,
bootstrap = TRUE,
num_bootstraps = 100,
confidence_level = 0.95,
permute = TRUE, num_permutations = 10,
candidates = NULL, N = 20,
verbose = FALSE)

head(party_nns)
</code></pre>


</div>