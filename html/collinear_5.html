<div class="container">

<table style="width: 100%;"><tr>
<td>collinear</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Automated multicollinearity management</h2>

<h3>Description</h3>

<p>Automates multicollinearity management in data frames with numeric and categorical predictors by combining four methods:
</p>

<ul>
<li>
<p> Pairwise correlation filtering: Pearson, Spearman, and Cramer's V statistics to identify pairs of highly correlated predictors.
</p>
</li>
<li>
<p> Variance Inflation Factor (VIF) filtering: identifies predictors that are linear combinations of other predictors.
</p>
</li>
<li>
<p> Target encoding: to transform categorical predictors to numeric using a numeric variable as reference.
</p>
</li>
<li>
<p> Flexible prioritization method: to help the user select a meaningful set of non-correlated predictors.
</p>
</li>
</ul>
<p>The pairwise correlation filtering is implemented in <code>cor_select()</code>. This function applies a recursive forward selection algorithm to keep predictors with a Pearson correlation with all other selected predictors lower than the value of the argument <code>max_cor</code>.  When two predictors are correlated above this threshold, the one with the lowest preference order is removed. At this stage, if <code>preference_order</code> is NULL, predictors are ranked from lower to higher sum of absolute pairwise correlation with the other predictors.
</p>
<p>The VIF-based filtering is implemented in <code>vif_select()</code>, which removes variables and recomputes VIF scores iteratively, until all variables in the resulting selection have a VIF below the value of the argument <code>max_vif</code>. The VIF for a given variable <code>y</code> is computed as <code>1/(1-R2)</code>, where <code>R2</code> is the R-squared of a multiple regression model fitted using <code>y</code> as response against the other predictors. The equation can be interpreted as "the rate of perfect model's R-squared to the unexplained variance of this model". The possible range of VIF values is (1, Inf], but the recommended thresholds for maximum VIF (argument <code>max_vif</code>) may vary, being 2.5, 5, and 10 the values most commonly mentioned in the relevant bibliography. At this stage, if <code>preference_order</code> is NULL, predictors are ranked from lower to higher Variance Inflation Factor.
</p>
<p>When a 'response' argument is provided, categorical predictors are converted to numeric via target encoding with the function <code>target_encoding_lab()</code>, and all predictors are then handled as numeric during the multicollinearity filtering. When the 'response' argument is not provided, categorical variables are ignored. However, in such case, the function <code>cor_select()</code> can handle categorical variables, albeit with a lower computation speed.
</p>
<p>The argument <code>preference_order</code> allows prioritizing variables that might be interesting or even required for a given analysis. If <code>preference_order</code> is not provided, then the predictors are ranked from lower to higher sum of their absolute correlations with the other predictors in <code>cor_select()</code>, and by their VIF in <code>vif_select()</code>, and removed one by one until the maximum R-squared of the correlation matrix is lower than <code>max_cor</code> and the maximum VIF is below <code>max_vif</code>.
</p>
<p>Please note that near-zero variance columns are identified by <code>identify_zero_variance_predictors()</code>, and ignored by <code>collinear()</code>, <code>cor_select()</code>, and <code>vif_select()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">collinear(
  df = NULL,
  response = NULL,
  predictors = NULL,
  preference_order = NULL,
  cor_method = "pearson",
  max_cor = 0.75,
  max_vif = 5,
  encoding_method = "mean"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>(required; data frame) A data frame with numeric and/or character predictors predictors, and optionally, a response variable. Default: NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>(recommended, character string) Name of a numeric response variable. Character response variables are ignored. Please, see 'Details' to better understand how providing this argument or not leads to different results when there are character variables in 'predictors'. Default: NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predictors</code></td>
<td>
<p>(optional; character vector) character vector with predictor names in 'df'. If omitted, all columns of 'df' are used as predictors. Default: NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>preference_order</code></td>
<td>
<p>(optional; character vector) vector with column names in 'predictors' in the desired preference order, or result of the function <code>preference_order()</code>. Allows defining a priority order for selecting predictors, which can be particularly useful when some predictors are more critical for the analysis than others. Predictors not included in this argument are ranked by their Variance Inflation Factor. Default: NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cor_method</code></td>
<td>
<p>(optional; character string) Method used to compute pairwise correlations. Accepted methods are "pearson" (with a recommended minimum of 30 rows in 'df') or "spearman" (with a recommended minimum of 10 rows in 'df'). Default: "pearson".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_cor</code></td>
<td>
<p>(optional; numeric) Maximum correlation allowed between any pair of predictors. Higher values return larger number of predictors with higher multicollinearity. Default: <code>0.75</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_vif</code></td>
<td>
<p>(optional, numeric) Numeric with recommended values between 2.5 and 10 defining the maximum VIF allowed for any given predictor in the output dataset. Higher VIF thresholds should result in a higher number of selected variables. Default: 5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>encoding_method</code></td>
<td>
<p>(optional; character string). Name of the target encoding method to convert character and factor predictors to numeric. One of "mean", "rank", "loo", "rnorm" (see <code>target_encoding_lab()</code> for further details). Default: "mean"</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Character vector with the names of uncorrelated predictors.
</p>


<h3>Author(s)</h3>

<p>Blas M. Benito
</p>


<h3>References</h3>


<ul>
<li>
<p> David A. Belsley, D.A., Kuh, E., Welsch, R.E. (1980). Regression Diagnostics: Identifying Influential Data and Sources of Collinearity. John Wiley &amp; Sons. <a href="https://doi.org/10.1002/0471725153">doi:10.1002/0471725153</a>.
</p>
</li>
<li>
<p> Micci-Barreca, D. (2001) A Preprocessing Scheme for High-Cardinality Categorical Attributes in Classification and Prediction Problems. SIGKDD Explor. Newsl. 3, 1, 27-32 <a href="https://doi.org/10.1145/507533.507538">doi:10.1145/507533.507538</a>
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
data(
  vi,
  vi_predictors
)

#subset to limit example run time
vi &lt;- vi[1:1000, ]

#without response
#without preference_order
#permissive max_cor and max_vif
#only numeric variables in output
selected.predictors &lt;- collinear(
  df = vi,
  predictors = vi_predictors,
  max_cor = 0.8,
  max_vif = 10
  )

selected.predictors

#without response
#without preference_order
#restrictive max_cor and max_vif
#only numeric variables in output
selected.predictors &lt;- collinear(
  df = vi,
  predictors = vi_predictors,
  max_cor = 0.5,
  max_vif = 2.5
)

selected.predictors

#with response
#without preference_order
#restrictive max_cor and max_vif
#numerics and categorical variables in output
selected.predictors &lt;- collinear(
  df = vi,
  response = "vi_mean",
  predictors = vi_predictors,
  max_cor = 0.5,
  max_vif = 2.5
)

selected.predictors

#with response
#with user-defined preference_order
#restrictive max_cor and max_vif
#numerics and categorical variables in output
selected.predictors &lt;- collinear(
  df = vi,
  response = "vi_mean",
  predictors = vi_predictors,
  preference_order = c(
    "soil_temperature_mean",
    "swi_mean",
    "rainfall_mean",
    "evapotranspiration_mean"
  ),
  max_cor = 0.5,
  max_vif = 2.5
)

selected.predictors


#with response
#with automated preference_order
#restrictive max_cor and max_vif
#numerics and categorical variables in output
preference.order &lt;- preference_order(
  df = vi,
  response = "vi_mean",
  predictors = vi_predictors,
  f = f_rsquared, #cor(response, predictor)
  workers = 1
)

selected.predictors &lt;- collinear(
  df = vi,
  response = "vi_mean",
  predictors = vi_predictors,
  preference_order = preference.order,
  max_cor = 0.5,
  max_vif = 2.5
)

selected.predictors

</code></pre>


</div>