<div class="container">

<table style="width: 100%;"><tr>
<td>cvCompute</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Utility Functions for the cv Package</h2>

<h3>Description</h3>

<p>These functions are primarily useful for writing methods for the
<code>cv()</code> generic function. They are used internally in the package
and can also be used for extensions (see the vignette "Extending the cv package,
<code>vignette("cv-extend", package="cv")</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">cvCompute(
  model,
  data = insight::get_data(model),
  criterion = mse,
  criterion.name,
  k = 10L,
  reps = 1L,
  seed,
  details = k &lt;= 10L,
  confint,
  level = 0.95,
  method = NULL,
  ncores = 1L,
  type = "response",
  start = FALSE,
  f,
  fPara = f,
  locals = list(),
  model.function = NULL,
  model.function.name = NULL,
  ...
)

cvMixed(
  model,
  package,
  data = insight::get_data(model),
  criterion = mse,
  criterion.name,
  k,
  reps = 1L,
  confint,
  level = 0.95,
  seed,
  details,
  ncores = 1L,
  clusterVariables,
  predict.clusters.args = list(object = model, newdata = data),
  predict.cases.args = list(object = model, newdata = data),
  fixed.effects,
  ...
)

cvSelect(
  procedure,
  data,
  criterion = mse,
  criterion.name,
  model,
  y.expression,
  k = 10L,
  confint = n &gt;= 400,
  level = 0.95,
  reps = 1L,
  save.coef,
  details = k &lt;= 10L,
  save.model = FALSE,
  seed,
  ncores = 1L,
  ...
)

folds(n, k)

fold(folds, i, ...)

## S3 method for class 'folds'
fold(folds, i, ...)

## S3 method for class 'folds'
print(x, ...)

GetResponse(model, ...)

## Default S3 method:
GetResponse(model, ...)

## S3 method for class 'merMod'
GetResponse(model, ...)

## S3 method for class 'lme'
GetResponse(model, ...)

## S3 method for class 'glmmTMB'
GetResponse(model, ...)

## S3 method for class 'modList'
GetResponse(model, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a regression model object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data frame to which the model was fit (not usually necessary,
except for <code>cvSelect()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>cross-validation criterion ("cost" or lack-of-fit) function of form <code>f(y, yhat)</code>
where <code>y</code> is the observed values of the response and
<code>yhat</code> the predicted values; the default is <code>mse</code>
(the mean-squared error).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion.name</code></td>
<td>
<p>a character string giving the name of the CV criterion function
in the returned <code>"cv"</code> object).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>perform k-fold cross-validation (default is <code>10</code>); <code>k</code>
may be a number or <code>"loo"</code> or <code>"n"</code> for n-fold (leave-one-out)
cross-validation; for <code>folds()</code>, <code>k</code> must be a number.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reps</code></td>
<td>
<p>number of times to replicate k-fold CV (default is <code>1</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>for R's random number generator; optional, if not
supplied a random seed will be selected and saved; not needed
for n-fold cross-validation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>details</code></td>
<td>
<p>if <code>TRUE</code> (the default if the number of
folds <code>k &lt;= 10</code>), save detailed information about the value of the
CV criterion for the cases in each fold and the regression coefficients
with that fold deleted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confint</code></td>
<td>
<p>if <code>TRUE</code> (the default if the number of cases is 400
or greater), compute a confidence interval for the bias-corrected CV
criterion, if the criterion is the average of casewise components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>confidence level (default <code>0.95</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>computational method to apply; use by some <code>cv()</code>
methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>number of cores to use for parallel computations
(default is <code>1</code>, i.e., computations aren't done in parallel).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>used by some <code>cv()</code> methods, such as the default method,
where <code>type</code> is passed to the <code>type</code> argument of <code>predict()</code>;
the default is <code>type="response"</code>, which is appropriate, e.g., for a <code>"glm"</code> model
and may be recognized or ignored by <code>predict()</code> methods for other model classes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>used by some <code>cv()</code> methods;
if <code>TRUE</code> (the default is <code>FALSE</code>), the <code>start</code> argument,
set to the vector of regression coefficients for the model fit to the full data, is passed
to <code>update()</code>, possibly making the CV updates faster, e.g. for a GLM.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>function to be called by <code>cvCompute()</code> for each fold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fPara</code></td>
<td>
<p>function to be called by <code>cvCompute()</code> for each fold
using parallel computation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locals</code></td>
<td>
<p>a named list of objects that are required in the local environment
of <code>cvCompute()</code> for <code>f()</code> or <code>fPara()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.function</code></td>
<td>
<p>a regression function, typically for a new <code>cv()</code> method,
residing in a package that's not a declared dependency of the <span class="pkg">cv</span> package,
e.g., <code>nnet::multinom</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.function.name</code></td>
<td>
<p>the quoted name of the regression function, e.g.,
<code>"multinom"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>to match generic; passed to <code>predict()</code> for the default method,
and to <code>fPara()</code> (for parallel computations) in <code>cvCompute()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>package</code></td>
<td>
<p>the name of the package in which mixed-modeling function (or functions) employed resides;
used to get the namespace of the package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clusterVariables</code></td>
<td>
<p>a character vector of names of the variables
defining clusters for a mixed model with nested or crossed random effects;
if missing, cross-validation is performed for individual cases rather than
for clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict.clusters.args</code></td>
<td>
<p>a list of arguments to be used to predict
the whole data set from a mixed model when performing CV on clusters;
the first two elements should be
<code>model</code> and <code>newdata</code>; see the "Extending the cv package" vignette
(<code>vignette("cv-extend", package="cv")</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predict.cases.args</code></td>
<td>
<p>a list of arguments to be used to predict
the whole data set from a mixed model when performing CV on cases;
the first two elements should be
<code>model</code> and <code>newdata</code>; see the "Extending the cv package" vignette
(<code>vignette("cv-extend", package="cv")</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.effects</code></td>
<td>
<p>a function to be used to compute fixed-effect
coefficients for cluster-based CV when <code>details = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>procedure</code></td>
<td>
<p>a model-selection procedure function (see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.expression</code></td>
<td>
<p>normally the response variable is found from the
<code>model</code> argument; but if, for a particular selection procedure, the
<code>model</code> argument is absent, or if the response can't be inferred from the
model, the response can be specified by an expression, such as <code>expression(log(income))</code>,
to be evaluated within the data set provided by the <code>data</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.coef</code></td>
<td>
<p>save the coefficients from the selected models? Deprecated
in favor of the <code>details</code> argument; if specified, <code>details</code> is set
is set to the value of <code>save.coef</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.model</code></td>
<td>
<p>save the model that's selected using the <em>full</em> data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>number of cases, for constructed folds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>folds</code></td>
<td>
<p>an object of class <code>"folds"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>i</code></td>
<td>
<p>a fold number for an object of class <code>"folds"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a <code>"cv"</code>, <code>"cvList"</code>, or <code>"folds"</code> object to be printed</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The utility functions return various kinds of objects:
</p>

<ul>
<li> <p><code>cvCompute()</code> returns an object of class <code>"cv"</code>, with the CV criterion
(<code>"CV crit"</code>), the bias-adjusted CV criterion (<code>"adj CV crit"</code>),
the criterion for the model applied to the full data (<code>"full crit"</code>),
the confidence interval and level for the bias-adjusted CV criterion (<code>"confint"</code>),
the number of folds (<code>"k"</code>), and the seed for R's random-number
generator (<code>"seed"</code>). If <code>details=TRUE</code>, then the returned object
will also include a <code>"details"</code> component, which is a list of two
elements: <code>"criterion"</code>, containing the CV criterion computed for the
cases in each fold; and <code>"coefficients"</code>, regression coefficients computed
for the model with each fold deleted.  Some <code>cv()</code> methods calling <code>cvCompute()</code>
may return a subset of these components and may add additional information.
If <code>reps</code> &gt; <code>1</code>, then an object of class <code>"cvList"</code> is returned,
which is literally a list of <code>"cv"</code> objects.
</p>
</li>
<li> <p><code>cvMixed()</code> also returns an object of class <code>"cv"</code> or
<code>"cvList"</code>.
</p>
</li>
<li> <p><code>cvSelect</code> returns an object of class
<code>"cvSelect"</code> inheriting from <code>"cv"</code>, or an object of
class <code>"cvSelectList"</code> inheriting from <code>"cvList"</code>.
</p>
</li>
<li> <p><code>folds()</code> returns an object of class folds, for which
there are <code>fold()</code> and <code>print()</code> methods.
</p>
</li>
<li> <p><code>GetResponse()</code> returns the (numeric) response variable
from the model.
</p>
<p>The supplied <code>default</code> method returns the <code>model$y</code> component
of the model object, or, if <code>model</code> is an S4 object, the result
returned by the <code>get_response()</code> function in
the <span class="pkg">insight</span> package. If this result is <code>NULL</code>, the result of
<code>model.response(model.frame(model))</code> is returned, checking in any case whether
the result is a numeric vector.
</p>
<p>There are also  <code>"lme"</code>, <code>"merMod"</code>
and <code>"glmmTMB"</code> methods that convert factor
responses to numeric 0/1 responses, as would be appropriate
for a generalized linear mixed model with a binary response.
</p>
</li>
</ul>
<h3>Functions</h3>


<ul>
<li> <p><code>cvCompute()</code>: used internally by <code>cv()</code> methods (not for direct use);
exported to support new <code>cv()</code> methods.
</p>
</li>
<li> <p><code>cvMixed()</code>: used internally by <code>cv()</code> methods
for mixed-effect models (not for direct use);
exported to support new <code>cv()</code> methods.
</p>
</li>
<li> <p><code>cvSelect()</code>: used internally by <code>cv()</code> methods for
cross-validating a model-selection procedure; may also be called
directly for this purpose, but use via <code>cv()</code> is preferred.
<code>cvSelect()</code> is exported primarily to support new model-selection procedures.
</p>
</li>
<li> <p><code>folds()</code>: used internally by <code>cv()</code> methods (not for direct use).
</p>
</li>
<li> <p><code>fold()</code>: to extract a fold from a <code>"folds"</code> object.
</p>
</li>
<li> <p><code>fold(folds)</code>: <code>fold()</code> method for <code>"folds"</code> objects.
</p>
</li>
<li> <p><code>print(folds)</code>: <code>print()</code> method for <code>"folds"</code> objects.
</p>
</li>
<li> <p><code>GetResponse()</code>: function to return the response variable
from a regression model.
</p>
</li>
<li> <p><code>GetResponse(default)</code>: default method.
</p>
</li>
<li> <p><code>GetResponse(merMod)</code>: <code>"merMod"</code> method.
</p>
</li>
<li> <p><code>GetResponse(lme)</code>: <code>"lme"</code> method.
</p>
</li>
<li> <p><code>GetResponse(glmmTMB)</code>: <code>"glmmTMB"</code> method.
</p>
</li>
<li> <p><code>GetResponse(modList)</code>: <code>"modList"</code> method.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>cv</code>, <code>cv.merMod</code>,
<code>cv.function</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">fit &lt;- lm(mpg ~ gear, mtcars)
GetResponse(fit)

set.seed(123)
(ffs &lt;- folds(n=22, k=5))
fold(ffs, 2)

</code></pre>


</div>