<div class="container">

<table style="width: 100%;"><tr>
<td>fFtest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fast (Weighted) F-test for Linear Models (with Factors)
</h2>

<h3>Description</h3>

<p><code>fFtest</code> computes an R-squared based F-test for the exclusion of the variables in <code>exc</code>, where the full (unrestricted) model is defined by variables supplied to both <code>exc</code> and <code>X</code>. The test is efficient and designed for cases where both <code>exc</code> and <code>X</code> may contain multiple factors and continuous variables. There is also an efficient 2-part formula method.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fFtest(...) # Internal method dispatch: formula if is.call(..1) || is.call(..2)

## Default S3 method:
fFtest(y, exc, X = NULL, w = NULL, full.df = TRUE, ...)

## S3 method for class 'formula'
fFtest(formula, data = NULL, weights = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a numeric vector: the dependent variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exc</code></td>
<td>
<p>a numeric vector, factor, numeric matrix or list / data frame of numeric vectors and/or factors: variables to test / exclude.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a numeric vector, factor, numeric matrix or list / data frame of numeric vectors and/or factors: covariates to include in both the restricted (without <code>exc</code>) and unrestricted model. If left empty (<code>X = NULL</code>), the test amounts to the F-test of the regression of <code>y</code> on <code>exc</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>numeric. A vector of (frequency) weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a 2-part formula: <code>y ~ exc | X</code>, where both <code>exc</code> and <code>X</code> are expressions connected with <code>+</code>, and <code>X</code> can be omitted. <em>Note</em> that other operators (<code>:</code>, <code>*</code>, <code>^</code>, <code>-</code>, etc.) are not supported, you can interact variables using standard functions like <code>finteraction/itn</code> or <code>magrittr::multiply_by</code> inside the formula e.g. <code>log(y) ~ x1 + itn(x2, x3) | x4</code> or <code>log(y) ~ x1 + multiply_by(x2, x3) | x4</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a named list or data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>a weights vector or expression that results in a vector when evaluated in the <code>data</code> environment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>full.df</code></td>
<td>
<p>logical. If <code>TRUE</code> (default), the degrees of freedom are calculated as if both restricted and unrestricted models were estimated using <code>lm()</code> (i.e. as if factors were expanded to matrices of dummies). <code>FALSE</code> only uses one degree of freedom per factor.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments passed to <code>fFtest.default</code> or to <code>fhdwithin</code>. Sensible options might be the <code>lm.method</code> argument or further control parameters to <code>fixest::demean</code>, the workhorse function underlying <code>fhdwithin</code> for higher-order centering tasks. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Factors and continuous regressors are efficiently projected out using <code>fhdwithin</code>, and the option <code>full.df</code> regulates whether a degree of freedom is subtracted for each used factor level (equivalent to dummy-variable estimator / expanding factors), or only one degree of freedom per factor (treating factors as variables). The test automatically removes missing values and considers only the complete cases of <code>y, exc</code> and <code>X</code>. Unused factor levels in <code>exc</code> and <code>X</code> are dropped.
</p>
<p><em>Note</em> that an intercept is always added by <code>fhdwithin</code>, so it is not necessary to include an intercept in data supplied to <code>exc</code> / <code>X</code>.
</p>


<h3>Value</h3>

<p>A 5 x 3 numeric matrix of statistics. The columns contain statistics:
</p>

<ol>
<li>
<p> the R-squared of the model
</p>
</li>
<li>
<p> the numerator degrees of freedom i.e. the number of variables (k) and used factor levels if <code>full.df = TRUE</code>
</p>
</li>
<li>
<p> the denominator degrees of freedom: N - k - 1.
</p>
</li>
<li>
<p> the F-statistic
</p>
</li>
<li>
<p> the corresponding P-value
</p>
</li>
</ol>
<p>The rows show these statistics for:
</p>

<ol>
<li>
<p> the Full (unrestricted) Model (<code>y ~ exc + X</code>)
</p>
</li>
<li>
<p> the Restricted Model (<code>y ~ X</code>)
</p>
</li>
<li>
<p> the Exclusion Restriction of <code>exc</code>. The R-squared shown is simply the difference of the full and restricted R-Squared's, not the R-Squared of the model <code>y ~ exc</code>.
</p>
</li>
</ol>
<p>If <code>X = NULL</code>, only a vector of the same 5 statistics testing the model (<code>y ~ exc</code>) is shown.
</p>







<h3>See Also</h3>

<p><code>flm</code>, <code>fhdwithin</code>, Data Transformations, Collapse Overview
</p>


<h3>Examples</h3>

<pre><code class="language-R">## We could use fFtest as a simple seasonality test:
fFtest(AirPassengers, qF(cycle(AirPassengers)))         # Testing for level-seasonality
fFtest(AirPassengers, qF(cycle(AirPassengers)),         # Seasonality test around a cubic trend
        poly(seq_along(AirPassengers), 3))
fFtest(fdiff(AirPassengers), qF(cycle(AirPassengers)))  # Seasonality in first-difference

## A more classical example with only continuous variables
fFtest(mpg ~ cyl + vs | hp + carb, mtcars)
fFtest(mtcars$mpg, mtcars[c("cyl","vs")], mtcars[c("hp","carb")])
 
## Now encoding cyl and vs as factors
fFtest(mpg ~ qF(cyl) + qF(vs) | hp + carb, mtcars)
fFtest(mtcars$mpg, lapply(mtcars[c("cyl","vs")], qF), mtcars[c("hp","carb")])

## Using iris data: A factor and a continuous variable excluded
fFtest(Sepal.Length ~ Petal.Width + Species | Sepal.Width + Petal.Length, iris)
fFtest(iris$Sepal.Length, iris[4:5], iris[2:3])

## Testing the significance of country-FE in regression of GDP on life expectancy
fFtest(log(PCGDP) ~ iso3c | LIFEEX, wlddev)
fFtest(log(wlddev$PCGDP), wlddev$iso3c, wlddev$LIFEEX)
 
## Ok, country-FE are significant, what about adding time-FE
fFtest(log(PCGDP) ~ qF(year) | iso3c + LIFEEX, wlddev)
fFtest(log(wlddev$PCGDP), qF(wlddev$year), wlddev[c("iso3c","LIFEEX")])

# Same test done using lm:
data &lt;- na_omit(get_vars(wlddev, c("iso3c","year","PCGDP","LIFEEX")))
full &lt;- lm(PCGDP ~ LIFEEX + iso3c + qF(year), data)
rest &lt;- lm(PCGDP ~ LIFEEX + iso3c, data)
anova(rest, full)

</code></pre>


</div>