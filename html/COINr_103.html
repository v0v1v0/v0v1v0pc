<div class="container">

<table style="width: 100%;"><tr>
<td>plot_corr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Static heatmaps of correlation matrices</h2>

<h3>Description</h3>

<p>Generates heatmaps of correlation matrices using ggplot2, which can be tailored according to the grouping and structure
of the index. This enables correlating any set of indicators against any other,
and supports calling named aggregation groups of indicators. The <code>withparent</code> argument generates tables of correlations only with
parents of each indicator. Also supports discrete colour maps using <code>flagcolours</code>, different types of correlation, and groups
plots by higher aggregation levels.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_corr(
  coin,
  dset,
  iCodes = NULL,
  Levels = 1,
  ...,
  cortype = "pearson",
  withparent = FALSE,
  grouplev = NULL,
  box_level = NULL,
  showvals = TRUE,
  flagcolours = FALSE,
  flagthresh = NULL,
  pval = 0.05,
  insig_colour = "#F0F0F0",
  text_colour = NULL,
  discrete_colours = NULL,
  box_colour = NULL,
  order_as = NULL,
  use_directions = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coin</code></td>
<td>
<p>The coin object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dset</code></td>
<td>
<p>The target data set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iCodes</code></td>
<td>
<p>An optional list of character vectors where the first entry specifies the indicator/aggregate
codes to correlate against the second entry (also a specification of indicator/aggregate codes)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Levels</code></td>
<td>
<p>The aggregation levels to take the two groups of indicators from. See <code>get_data()</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Optional further arguments to pass to <code>get_data()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cortype</code></td>
<td>
<p>The type of correlation to calculate, either <code>"pearson"</code>, <code>"spearman"</code>, or <code>"kendall"</code> (see <code>stats::cor()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>withparent</code></td>
<td>
<p>If <code>aglev[1] != aglev[2]</code>, and equal <code>TRUE</code> will only plot correlations of each row with its parent.
If <code>"family"</code>, plots the lowest aggregation level in <code>Levels</code> against all its parent levels.
If <code>FALSE</code> plots the full correlation matrix (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grouplev</code></td>
<td>
<p>The aggregation level to group correlations by if <code>aglev[1] == aglev[2]</code>. By default, groups correlations into the
aggregation level above. Set to 0 to disable grouping and plot the full matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>box_level</code></td>
<td>
<p>The aggregation level to draw boxes around if <code>aglev[1] == aglev[2]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showvals</code></td>
<td>
<p>If <code>TRUE</code>, shows correlation values. If <code>FALSE</code>, no values shown.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flagcolours</code></td>
<td>
<p>If <code>TRUE</code>, uses discrete colour map with thresholds defined by <code>flagthresh</code>. If <code>FALSE</code> uses continuous colour map.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flagthresh</code></td>
<td>
<p>A 3-length vector of thresholds for highlighting correlations, if <code>flagcolours = TRUE</code>.
<code>flagthresh[1]</code> is the negative threshold (default -0.4). Below this value, values will be flagged red.
<code>flagthresh[2]</code> is the "weak" threshold (default 0.3). Values between <code>flagthresh[1]</code> and <code>flagthresh[2]</code> are coloured grey.
<code>flagthresh[3]</code> is the "high" threshold (default 0.9). Anything between <code>flagthresh[2]</code> and <code>flagthresh[3]</code> is flagged "OK",
and anything above <code>flagthresh[3]</code> is flagged "high".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pval</code></td>
<td>
<p>The significance level for plotting correlations. Correlations with <code class="reqn">p &lt; pval</code> will be shown,
otherwise they will be plotted as the colour specified by <code>insig_colour</code>. Set to 0 to disable this.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>insig_colour</code></td>
<td>
<p>The colour to plot insignificant correlations. Defaults to a light grey.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>text_colour</code></td>
<td>
<p>The colour of the correlation value text (default white).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discrete_colours</code></td>
<td>
<p>An optional 4-length character vector of colour codes or names to define the discrete
colour map if <code>flagcolours = TRUE</code> (from high to low correlation categories). Defaults to a green/blue/grey/purple.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>box_colour</code></td>
<td>
<p>The line colour of grouping boxes, default black.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order_as</code></td>
<td>
<p>Optional list for ordering the plotting of variables. If specified, this must be a list of length 2, where each entry of the list is
a character vector of the iCodes plotted on the x and y axes of the plot. The plot will then follow the order of these character vectors. Note this must
be used with care because the <code>grouplev</code> and <code>boxlev</code> arguments will not follow the reordering. Hence this argument is probably best used for plots
with no grouping, or for simply re-ordering within groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_directions</code></td>
<td>
<p>Logical: if <code>TRUE</code> the extracted data is adjusted using directions found inside the coin (i.e. the "Direction"
column input in <code>iMeta</code>: any indicators with negative direction will have their values multiplied by -1 which will reverse the
direction of correlation). This should only be set to <code>TRUE</code> if the data set has <em>not</em> yet been normalised. For example, this can be
useful to set to <code>TRUE</code> to analyse correlations in the raw data, but would make no sense to analyse correlations in the normalised
data because that already has the direction adjusted! So you would reverse direction twice. In other words, use this at your
discretion.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function calls <code>get_corr()</code>.
</p>
<p>Note that this function can only call correlations within the same data set (i.e. only one data set in <code>.$Data</code>).
</p>
<p>This function uses ggplot2 to generate plots, so the plot can be further manipulated using ggplot2 commands.
See <code>vignette("visualisation")</code> for more details on plotting.
</p>
<p>This function replaces the now-defunct <code>plotCorr()</code> from COINr &lt; v1.0.
</p>


<h3>Value</h3>

<p>A plot object generated with ggplot2, which can be edited further with ggplot2 commands.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># build example coin
coin &lt;- build_example_coin(up_to = "Normalise", quietly = TRUE)

# plot correlations between indicators in Sust group, using Normalised dset
plot_corr(coin, dset = "Normalised", iCodes = list("Sust"),
          grouplev = 2, flagcolours = TRUE)

</code></pre>


</div>