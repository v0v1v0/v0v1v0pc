<div class="container">

<table style="width: 100%;"><tr>
<td>cv.function</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Cross-Validate a Model-Selection Procedure</h2>

<h3>Description</h3>

<p>The <code>cv()</code> <code>"function"</code> method
is a general function to cross-validate a model-selection procedure,
such as the following:
<code>selectStepAIC()</code> is a procedure that applies the <code>stepAIC()</code>
model-selection function in the <span class="pkg">MASS</span> package; <code>selectTrans()</code> is a procedure
for selecting predictor and response transformations in regression, which
uses the <code>powerTransform()</code> function in the
<span class="pkg">car</span> package; <code>selectTransAndStepAIC()</code> combines predictor and response
transformations with predictor selection; and <code>selectModelList()</code>
uses cross-validation to select a model from a list of models created by
<code>models()</code> and employs (meta) cross-validation to assess the predictive
accuracy of this procedure.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class ''function''
cv(
  model,
  data,
  criterion = mse,
  k = 10L,
  reps = 1L,
  seed = NULL,
  working.model = NULL,
  y.expression = NULL,
  confint = n &gt;= 400L,
  level = 0.95,
  details = k &lt;= 10L,
  save.model = FALSE,
  ncores = 1L,
  ...
)

selectStepAIC(
  data,
  indices,
  model,
  criterion = mse,
  AIC = TRUE,
  details = TRUE,
  save.model = FALSE,
  ...
)

selectTrans(
  data,
  indices,
  details = TRUE,
  save.model = FALSE,
  model,
  criterion = mse,
  predictors,
  response,
  family = c("bcPower", "bcnPower", "yjPower", "basicPower"),
  family.y = c("bcPower", "bcnPower", "yjPower", "basicPower"),
  rounded = TRUE,
  ...
)

selectTransStepAIC(
  data,
  indices,
  details = TRUE,
  save.model = FALSE,
  model,
  criterion = mse,
  predictors,
  response,
  family = c("bcPower", "bcnPower", "yjPower", "basicPower"),
  family.y = c("bcPower", "bcnPower", "yjPower", "basicPower"),
  rounded = TRUE,
  AIC = TRUE,
  ...
)

selectModelList(
  data,
  indices,
  model,
  criterion = mse,
  k = 10L,
  k.meta = k,
  details = k &lt;= 10L,
  save.model = FALSE,
  seed = FALSE,
  quietly = TRUE,
  ...
)

compareFolds(object, digits = 3, ...)

## S3 method for class 'cvSelect'
coef(object, average, NAs = 0, ...)

## S3 method for class 'cvSelect'
cvInfo(
  object,
  what = c("CV criterion", "adjusted CV criterion", "full CV criterion", "confint", "SE",
    "k", "seed", "method", "criterion name", "selected model"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>a regression model object fit to data, or for the
<code>cv()</code> <code>"function"</code> method, a model-selection procedure function
(see Details).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>full data frame for model selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>criterion</code></td>
<td>
<p>a CV criterion ("cost" or lack-of-fit) function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>perform k-fold cross-validation (default is 10); <code>k</code>
may be a number or <code>"loo"</code> or <code>"n"</code> for n-fold (leave-one-out)
cross-validation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reps</code></td>
<td>
<p>number of times to replicate k-fold CV (default is <code>1</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>for R's random number generator; not used for n-fold cross-validation.
If not explicitly set, a seed is randomly generated and saved to make the results
reproducible. In some cases, for internal use only, <code>seed</code> is set to
<code>FALSE</code> to suppress automatically setting the seed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>working.model</code></td>
<td>
<p>a regression model object fit to data, typically
to begin a model-selection process; for use with <code>selectModelList()</code>,
a list of competing models created by <code>models()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.expression</code></td>
<td>
<p>normally the response variable is found from the
<code>model</code> or <code>working.model</code> argument; but if, for a particular selection procedure, the
<code>model</code> or <code>working.model</code> argument is absent, or if the response can't be inferred from the
model, the response can be specified by an expression, such as <code>expression(log(income))</code>,
to be evaluated within the data set provided by the <code>data</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>confint</code></td>
<td>
<p>if <code>TRUE</code> (the default if the number of cases is 400
or greater), compute a confidence interval for the bias-corrected CV
criterion, if the criterion is the average of casewise components.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>confidence level (default <code>0.95</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>details</code></td>
<td>
<p>if <code>TRUE</code>, save detailed information about the value of the
CV criterion for the cases in each fold and the regression coefficients
(and possibly other information)
with that fold deleted; default is <code>TRUE</code> if <code>k</code> is 10 or smaller,
<code>FALSE</code> otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.model</code></td>
<td>
<p>save the model that's selected using the <em>full</em> data set
(default, <code>FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>number of cores to use for parallel computations
(default is <code>1</code>, i.e., computations aren't done in parallel)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>for <code>cvSelect()</code> and the <code>cv()</code> <code>"function"</code> method,
arguments to be passed to <code>procedure()</code>;
for <code>selectStepAIC()</code> and <code>selectTransStepAIC()</code>,
arguments to be passed to <code>stepAIC()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indices</code></td>
<td>
<p>indices of cases in data defining the current fold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AIC</code></td>
<td>
<p>if <code>TRUE</code> (the default) use the AIC as the
model-selection criterion; if <code>FALSE</code>, use the BIC.
The <code>k</code> argument to <code>stepAIC()</code>
is set accordingly (note that this is distinct from the number of
folds <code>k</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predictors</code></td>
<td>
<p>character vector of names of the predictors in the model
to transform; if missing, no predictors will be transformed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>name of the response variable; if missing, the response
won't be transformed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>transformation family for the predictors, one of
<code>"bcPower", "bcnPower", "yjPower", "basicPower"</code>,
with <code>"bcPower"</code> as the default. These are the names of transformation
functions in the <span class="pkg">car</span> package; see <code>bcPower()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family.y</code></td>
<td>
<p>transformation family for the response,
with <code>"bcPower"</code> as the default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rounded</code></td>
<td>
<p>if <code>TRUE</code> (the default) use nicely rounded versions
of the estimated transformation parameters (see <code>bcPower()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k.meta</code></td>
<td>
<p>the number of folds for meta CV; defaults
to the value of <code>k</code>; may be specified as <code>"loo"</code> or
<code>"n"</code> as well as an integer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quietly</code></td>
<td>
<p>if <code>TRUE</code> (the default), simple messages (for example about the
value to which the random-number generator seed is set), but not warnings or
errors, are suppressed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class <code>"cvSelect"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>significant digits for printing coefficients
(default <code>3</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>average</code></td>
<td>
<p>if supplied, a function, such as <code>mean</code> or <code>median</code>,
to use us in averaging estimates across folds; if missing, the
estimates for each fold are returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>NAs</code></td>
<td>
<p>values to substitute for <code>NA</code>s in calculating
averaged estimates; the default, <code>0</code>, is appropriate, e.g.,
for regression coefficients; the value <code>1</code> might be appropriate
for power-transformation estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>what</code></td>
<td>
<p>the information to extract from a <code>"cvSelect"</code> object,
one of: <code>"CV criterion"</code>, <code>"adjusted CV criterion"</code>,
<code>"full CV criterion"</code> (the CV criterion applied to the model fit to the
full data set), <code>"SE"</code> (the standard error of the adjusted CV criterion),
<code>"confint"</code> (confidence interval for the adjusted CV criterion),
<code>"k"</code>, (the number of folds), <code>"seed"</code> (the seed employed for
R's random-number generator), <code>"method"</code> (the computational method
employed, e.g., for a <code>"lm"</code> model object), <code>"criterion name"</code>
(the CV criterion employed), or <code>"selected model"</code> (the model object
for the model that was selected); not all of these elements may be present, in
which case <code>cvInfo()</code> would return <code>NULL</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The model-selection function supplied as the <code>procedure</code> (for <code>cvSelect()</code>)
or <code>model</code> (for <code>cv()</code>) argument
should accept the following arguments:
</p>

<dl>
<dt><code>data</code></dt>
<dd>
<p>set to the <code>data</code> argument to <code>cvSelect()</code> or <code>cv()</code>.</p>
</dd>
<dt><code>indices</code></dt>
<dd>
<p>the indices of the rows of <code>data</code> defining the current fold; if missing,
the model-selection procedure is applied to the full <code>data</code>.</p>
</dd>
<dt>other arguments</dt>
<dd>
<p>to be passed via <code>...</code>
from <code>cvSelect()</code> or <code>cv()</code>.</p>
</dd>
</dl>
<p><code>procedure()</code> or <code>model()</code> should return a list with the following
named elements: <code>fit.i</code>, the vector of predicted values for the cases in
the current fold computed from the model omitting these cases;
<code>crit.all.i</code>, the CV criterion computed for all of the cases using
the model omitting the current fold; and (optionally) <code>coefficients</code>,
parameter estimates from the model computed omitting the current fold.
</p>
<p>When the <code>indices</code> argument is missing, <code>procedure()</code> returns the cross-validation criterion for all of the cases based on
the model fit to all of the cases.
</p>
<p>For examples of model-selection functions for the <code>procedure</code>
argument, see the code for <code>selectStepAIC()</code>,
<code>selectTrans()</code>, and <code>selectTransAndStepAIC()</code>.
</p>
<p>For additional information, see the "Cross-validating model selection"
vignette (<code>vignette("cv-select", package="cv")</code>)
and the "Extending the cv package" vignette
(<code>vignette("cv-extend", package="cv")</code>).
</p>


<h3>Value</h3>

<p>An object of class <code>"cvSelect"</code>,
inheriting from class <code>"cv"</code>, with the CV criterion
(<code>"CV crit"</code>), the bias-adjusted CV criterion (<code>"adj CV crit"</code>),
the criterion for the model applied to the full data (<code>"full crit"</code>),
the confidence interval and level for the bias-adjusted CV criterion (<code>"confint"</code>),
the number of folds (<code>"k"</code>), the seed for R's random-number
generator (<code>"seed"</code>), and (optionally) a list of coefficients
(or, in the case of <code>selectTrans()</code>, estimated transformation
parameters, and in the case of <code>selectTransAndStepAIC()</code>, both regression coefficients
and transformation parameters) for the selected models
for each fold (<code>"coefficients"</code>).
If <code>reps</code> &gt; <code>1</code>, then an object of class <code>c("cvSelectList", "cvList")</code> is returned,
which is literally a list of <code>c("cvSelect", "cv")</code> objects.
</p>


<h3>Functions</h3>


<ul>
<li> <p><code>cv(`function`)</code>: <code>cv()</code> method for applying a model
model-selection (or specification) procedure.
</p>
</li>
<li> <p><code>selectStepAIC()</code>: select a regression model using the
<code>stepAIC()</code> function in the <span class="pkg">MASS</span> package.
</p>
</li>
<li> <p><code>selectTrans()</code>: select transformations of the predictors and response
using <code>powerTransform()</code> in the <span class="pkg">car</span> package.
</p>
</li>
<li> <p><code>selectTransStepAIC()</code>: select transformations of the predictors and response,
and then select predictors.
</p>
</li>
<li> <p><code>selectModelList()</code>: select a model using (meta) CV.
</p>
</li>
<li> <p><code>compareFolds()</code>: print the coefficients from the selected models
for the several folds.
</p>
</li>
<li> <p><code>coef(cvSelect)</code>: extract the coefficients from the selected models
for the several folds and possibly average them.
</p>
</li>
</ul>
<h3>See Also</h3>

<p><code>stepAIC</code>, <code>bcPower</code>,
<code>powerTransform</code>, <code>cv</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("ISLR2", quietly=TRUE)){
withAutoprint({
data("Auto", package="ISLR2")
m.auto &lt;- lm(mpg ~ . - name - origin, data=Auto)
cv(selectStepAIC, Auto, seed=123, working.model=m.auto)
cv(selectStepAIC, Auto, seed=123, working.model=m.auto,
         AIC=FALSE, k=5, reps=3) # via BIC
})
} else {
cat("\n install the 'ISLR2' package to run these examples\n")
}
if (requireNamespace("carData", quietly=TRUE)){
withAutoprint({
data("Prestige", package="carData")
m.pres &lt;- lm(prestige ~ income + education + women,
             data=Prestige)
cvt &lt;- cv(selectTrans, data=Prestige, working.model=m.pres, seed=123,
          predictors=c("income", "education", "women"),
          response="prestige", family="yjPower")
cvt
compareFolds(cvt)
coef(cvt, average=median, NAs=1) # NAs not really needed here
cv(m.pres, seed=123)
})
} else {
cat("install the 'carData' package to run these examples\n")
}
if (requireNamespace("ISLR2", quietly=TRUE)){
withAutoprint({
Auto$year &lt;- as.factor(Auto$year)
Auto$origin &lt;- factor(Auto$origin,
                      labels=c("America", "Europe", "Japan"))
rownames(Auto) &lt;- make.names(Auto$name, unique=TRUE)
Auto$name &lt;- NULL
m.auto &lt;- lm(mpg ~ . , data=Auto)
cvs &lt;- cv(selectTransStepAIC, data=Auto, seed=76692, working.model=m.auto,
          criterion=medAbsErr,
          predictors=c("cylinders", "displacement", "horsepower",
                       "weight", "acceleration"),
          response="mpg", AIC=FALSE)
cvs
compareFolds(cvs)
})
}
data("Duncan", package="carData")
m1 &lt;- lm(prestige ~ income + education, data=Duncan)
m2 &lt;- lm(prestige ~ income + education + type, data=Duncan)
m3 &lt;- lm(prestige ~ (income + education)*type, data=Duncan)
summary(cv.sel &lt;- cv(selectModelList, data=Duncan, seed=5963,
                     working.model=models(m1, m2, m3),
                     save.model=TRUE)) # meta CV
cvInfo(cv.sel, "selected model")

</code></pre>


</div>