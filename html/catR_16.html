<div class="container">

<table style="width: 100%;"><tr>
<td>KL</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Kullback-Leibler (KL) and posterior Kullback-Leibler (KLP) values for item selection</h2>

<h3>Description</h3>

<p>This command returns the value of the Kullback-Leibler (KL) or posterior Kullback-Leibler (KLP) for a given item, an item bank and a set of previously administered items.
</p>


<h3>Usage</h3>

<pre><code class="language-R">KL(itemBank, item, x, it.given, model = NULL, theta = NULL, lower = -4, 
  upper = 4, nqp = 33, type = "KL", priorDist = "norm", priorPar = c(0, 1), 
  D = 1, X = NULL, lik = NULL) 
 </code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>itemBank</code></td>
<td>
<p>numeric: a suitable matrix of item parameters. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>item</code></td>
<td>
<p>numeric: the item (referred to as its rank in the item bank) for which the KL or KLP must be computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>numeric: a vector of item responses, coded as 0 or 1 only (for dichotomous items) or from 0 to the number of response categories minus one (for polytomous items).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>it.given</code></td>
<td>
<p>numeric: a matrix with one row per item and four columns, with the values of the discrimination, the difficulty, the pseudo-guessing and the inattention parameters (in this order). The number of rows of <code>it</code> must be equal to the length of <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>either <code>NULL</code> (default) for dichotomous models, or any suitable acronym for polytomous models. Possible values are <code>"GRM"</code>, <code>"MGRM"</code>, <code>"PCM"</code>, <code>"GPCM"</code>, <code>"RSM"</code> and <code>"NRM"</code>. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>either a numeric value for provisional ability estimate or <code>NULL</code>. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower</code></td>
<td>
<p>numeric: the lower bound for numercal integration (default is -4).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper</code></td>
<td>
<p>numeric: the upper bound for numercal integration (default is 4).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nqp</code></td>
<td>
<p>numeric: the number of quadrature points (default is 33).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>character: the type of information to be computed. Possible values are <code>"KL"</code> (default) and <code>"KLP"</code>. See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorDist</code></td>
<td>
<p>character: the prior ability distribution. Possible values are <code>"norm"</code> (default) for the normal distribution, and <code>"unif"</code> for the uniform distribution. Ignored if <code>type</code> is <code>"KL"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorPar</code></td>
<td>
<p>numeric: a vector of two components with the prior parameters. If <code>priorDist</code> is <code>"norm"</code>, then <code>priorPar</code> contains the mean and the standard deviation of the normal distribution. If <code>priorDist</code> is <code>"unif"</code>, then <code>priorPar</code> contains the bounds of the uniform distribution. The default values are 0 and 1 respectively. Ignored if <code>type</code> is <code>"KL"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>numeric: the metric constant. Default is <code>D=1</code> (for logistic metric); <code>D=1.702</code> yields approximately the normal metric (Haley, 1952).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>either a vector of numeric values or <code>NULL</code> (default). See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lik</code></td>
<td>
<p>either a vector of numeric values or <code>NULL</code> (default). See <b>Details</b>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Kullback-Leibler information can be used as a rule for selecting the next item in the CAT process (Barrada, Olea, Ponsoda and Abad, 2010; Chang and Ying, 1996), both with dichotomous and polytomous IRT models. This command serves as a subroutine for the <code>nextItem</code> function.
</p>
<p>Dichotomous IRT models are considered whenever <code>model</code> is set to <code>NULL</code> (default value). In this case, <code>itemBank</code> must be a matrix with one row per item and four columns, with the values of the discrimination, the difficulty, the pseudo-guessing and the inattention parameters (in this order). These are the parameters of the four-parameter logistic (4PL) model (Barton and Lord, 1981). 
</p>
<p>Polytomous IRT models are specified by their respective acronym: <code>"GRM"</code> for Graded Response Model, <code>"MGRM"</code> for Modified Graded Response Model, <code>"PCM"</code> for Partical Credit Model, <code>"GPCM"</code> for Generalized Partial Credit Model, <code>"RSM"</code> for Rating Scale Model and <code>"NRM"</code> for Nominal Response Model. The <code>itemBank</code> still holds one row per item, end the number of columns and their content depends on the model. See <code>genPolyMatrix</code> for further information and illustrative examples of suitable polytomous item banks.
</p>
<p>Under polytomous IRT models, let <em>k</em> be the number of administered items, and set <code class="reqn">x_1, ..., x_k</code> as the provisional response pattern (where each response <code class="reqn">x_l</code> takes values in <code class="reqn">\{0, 1, ..., g_l\}</code>). Set <code class="reqn">\hat{\theta}_k</code> as the provisional ability estimate (with the first <em>k</em> responses) and let <em>j</em> be the item of interest (not previously administered). Set also <code class="reqn">L(\theta | x_1, ..., x_k) </code> as the likelihood function of the first <code class="reqn">k</code> items and evaluated at <code class="reqn">\theta</code>. Set finally <code class="reqn">P_{jt}(\theta)</code> as the probability of answering response category <em>t</em> to item <em>j</em> for a given ability level <code class="reqn">\theta</code>. Then, Kullack-Leibler (KL) information is defined as
</p>
<p style="text-align: center;"><code class="reqn">KL_j(\theta || \hat{\theta}_k) = \sum_{t=0}^{g_j} \,P_{jt}(\hat{\theta}_k) \,\log \left( \frac{P_{jt}(\hat{\theta}_k)}{P_{jt}(\theta)}\right).</code>
</p>

<p>In case of dichotomous IRT models, all <code class="reqn">g_l</code> values reduce to 1, so that item responses <code class="reqn">x_l</code> equal either 0 or 1. Set simply <code class="reqn">P_j(\theta)</code> as the probability of answering item <em>j</em> correctly for a given ability level <code class="reqn">\theta</code>. Then, KL information reduces to
</p>
<p style="text-align: center;"><code class="reqn">KL_j(\theta || \hat{\theta}) = P_j(\hat{\theta}) \,\log \left( \frac{P_j(\hat{\theta}_k)}{P_j(\theta)}\right) + [1-P_j(\hat{\theta}_k)] \,\log \left( \frac{1-P_j(\hat{\theta}_k)}{1-P_j(\theta)}\right).</code>
</p>

<p>The quantity that is returned by this <code>KL</code> function is either: the likelihood function weighted by Kullback-Leibler information (the KL value):
</p>
<p style="text-align: center;"><code class="reqn">KL_j(\hat{\theta}_k) = \int KL_j(\theta || \hat{\theta}_k) \, L(\theta | x_1, ..., x_k) \,d\theta</code>
</p>

<p>or the posterior function weighted by Kullback-Leibler information (the KLP value):
</p>
<p style="text-align: center;"><code class="reqn">KLP_j(\hat{\theta}) = \int KL_j(\theta || \hat{\theta}_k) \, \pi(\theta) \,L(\theta | x_1, ..., x_k) \,d\theta</code>
</p>

<p>where <code class="reqn">\pi(\theta)</code> is the prior distribution of the ability level.
</p>
<p>These integrals are approximated by the <code>integrate.catR</code> function. The range of integration is set up 
by the arguments <code>lower</code>, <code>upper</code> and <code>nqp</code>, giving respectively the lower bound, the upper bound and the number of quadrature points. The default range goes from -4 to 4 with length 33 (that is, by steps of 0.25).
</p>
<p>To speed up the computation, both the range of integration of values <code class="reqn">\theta</code> and the values of the likelihood function <code class="reqn">L(\theta)</code> can be directly provided to the function through the arguments <code>X</code> and <code>lik</code>. If <code>X</code> is set to <code>NULL</code> (default), the sequence of ability values for integration is determined by the arguments <code>lower</code>, <code>upper</code> and <code>nqp</code> as explained above. If <code>lik</code> is <code>NULL</code> (default), it is also internally computed from an implementation of the likelihood function.
</p>
<p>The provisional response pattern and the related item parameters are provided by the arguments <code>x</code> and <code>it.given</code> respectively. The target item (for which the KL information is computed) is given by its rank number in the item bank, through the <code>item</code> argument. 
</p>
<p>An ability level estimate must be provided to compute KL and KLP information values. Either the value is specified through the <code>theta</code> argument, or it is left equal to <code>NULL</code> (default). In this case, ability estimate is computed internally by maximum likelihood, using the <code>thetaEst</code> function with arguments <code>it.given</code> and <code>x</code>.
</p>
<p>Note that the provisional response pattern <code>x</code> can also be set to <code>NULL</code> (which is useful when the number <code>nrItems</code> of starting items is set to zero). In this case, <code>it.given</code> must be a matrix with zero rows, such as e.g., <code>itemBank[NULL,]</code>. In this very specific configuration, the likelihood function <code class="reqn">L(\theta | x_1, ..., x_k)</code> reduces to the constant value 1 on the whole <code class="reqn">\theta</code> range (that is, a uniform likelihood). 
</p>
<p>The argument <code>type</code> defines the type of KL information to be computed. The default value, <code>"KL"</code>, computes the usual Kullback-Leibler information, while the posterior Kullback-Leibler value is obtained with <code>type="KLP"</code>. For the latter, the <code>priorDist</code> and <code>priorPar</code> arguments fix the prior ability distribution. The normal distribution is set up by <code>priorDist="norm"</code> and then, <code>priorPar</code> contains the mean and the standard deviation of the normal distribution. If <code>priorDist</code> is <code>"unif"</code>, then the uniform distribution is considered, and <code>priorPar</code> fixes the lower and upper bounds of that uniform distribution. By default, the standard normal prior distribution is assumed. These arguments are ignored whenever <code>method</code> is <code>"KL"</code>.
</p>


<h3>Value</h3>

<p>The required KL or KLP value for the selected item.
</p>


<h3>Author(s)</h3>

<p>David Magis <br>
Department of Psychology, University of Liege, Belgium <br><a href="mailto:david.magis@uliege.be">david.magis@uliege.be</a>
</p>
<p>Juan Ramon Barrada <br>
Department of Psychology and Sociology, Universidad Zaragoza, Spain <br><a href="mailto:barrada@unizar.es">barrada@unizar.es</a>
</p>


<h3>References</h3>

<p>Barrada, J. R., Olea, J., Ponsoda, V., and Abad, F. J. (2010). A method for the comparison of item selection rules in computerized adaptive testing. <em>Applied Psychological Measurement</em>, <em>20</em>, 213-229. doi: <a href="https://doi.org/10.1177/0146621610370152">10.1177/0146621610370152</a>
</p>
<p>Barton, M.A., and Lord, F.M. (1981). <em>An upper asymptote for the three-parameter logistic item-response model</em>.
Research Bulletin 81-20. Princeton, NJ: Educational Testing Service.
</p>
<p>Chang, H.-H., and Ying, Z. (1996). A global information approach to computerized adaptive testing. <em>Applied Psychological Measurement, 34</em>, 438-452. doi: <a href="https://doi.org/10.1177/014662169602000303">10.1177/014662169602000303</a>
</p>
<p>Haley, D.C. (1952). <em>Estimation of the dosage mortality relationship when the dose is subject to error</em>. Technical report no 15. Palo Alto, CA: Applied Mathematics and Statistics Laboratory, Stanford University. 
</p>
<p>Magis, D. and Barrada, J. R. (2017). Computerized Adaptive Testing with R: Recent Updates of the Package <em>catR</em>. <em>Journal of Statistical Software</em>, <em>Code Snippets</em>, <em>76(1)</em>, 1-18. doi: <a href="https://doi.org/10.18637/jss.v076.c01">10.18637/jss.v076.c01</a>
</p>
<p>Magis, D., and Raiche, G. (2012). Random Generation of Response Patterns under Computerized Adaptive Testing with the R Package <em>catR</em>. <em>Journal of Statistical Software</em>, <em>48 (8)</em>, 1-31. doi: <a href="https://doi.org/10.18637/jss.v048.i08">10.18637/jss.v048.i08</a>
</p>


<h3>See Also</h3>

<p><code>integrate.catR</code>, <code>nextItem</code>, <code>genPolyMatrix</code> 
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Dichotomous models ##

 # Loading the 'tcals' parameters 
 data(tcals)

 # Selecting item parameters only
 bank &lt;- as.matrix(tcals[,1:4])
 
 # Selection of two arbitrary items (15 and 20) of the
 # 'tcals' data set
 it.given &lt;- bank[c(15, 20),]

 # Creation of a response pattern
 x &lt;- c(0, 1)

 # KL for item 1, ML estimate of ability computed
 KL(bank, 1, x, it.given)

 # Current (ML) ability estimate 
 theta &lt;- thetaEst(it.given, x, method = "ML")
 KL(bank, 1, x, it.given, theta = theta)

 # WL ability estimate instead
 theta &lt;- thetaEst(it.given, x, method = "WL")
 KL(bank, 1, x, it.given, theta = theta)

 # KLP for item 1
 KL(bank, 1, x, it.given, theta = theta, type = "KLP")

 # KLP for item 1, different integration range
 KL(bank, 1, x, it.given, theta = theta, type = "KLP", lower = -2, upper = 2, nqp = 20)

 # KL for item 1, uniform prior distribution on the range [-2,2]
 KL(bank, 1, x, it.given, theta = theta, type = "KLP", priorDist = "unif", 
    priorPar = c(-2, 2))

 # Computation of likelihood function beforehand
 L &lt;- function(th, r, param) 
  prod(Pi(th, param)$Pi^r * (1 - Pi(th,param)$Pi)^(1 - r))
 xx &lt;- seq(from = -4, to = 4, length = 33)
 y &lt;- sapply(xx, L, x, it.given) 
 KL(bank, 1, x, it.given, theta = theta, X = xx, lik = y)


## Polytomous models ##

 # Generation of an item bank under GRM with 100 items and at most 4 categories
 m.GRM &lt;- genPolyMatrix(100, 4, "GRM")
 m.GRM &lt;- as.matrix(m.GRM)

 # Selection of two arbitrary items (15 and 20) 
 it.given &lt;- m.GRM[c(15, 20),]

 # Generation of a response pattern (true ability level 0)
 x &lt;- genPattern(0, it.given, model = "GRM")

 # KL for item 1, ML estimate of ability computed
 KL(m.GRM, 1, x, it.given, model = "GRM")

 # Current (ML) ability estimate 
 theta &lt;- thetaEst(it.given, x, method = "ML", model = "GRM")
 KL(m.GRM, 1, x, it.given, theta = theta, model = "GRM")

 # WL ability estimate instead
 theta &lt;- thetaEst(it.given, x, method = "WL", model = "GRM")
 KL(m.GRM, 1, x, it.given, theta = theta, model = "GRM")

 # KLP for item 1
 KL(m.GRM, 1, x, it.given, theta = theta, model = "GRM", type = "KLP")

 # KLP for item 1, different integration range
 KL(m.GRM, 1, x, it.given, theta = theta, model = "GRM", type = "KLP", lower = -2, 
    upper = 2, nqp = 20)

 # KL for item 1, uniform prior distribution on the range [-2,2]
 KL(m.GRM, 1, x, it.given, theta = theta, model = "GRM", type = "KLP", 
    priorDist = "unif", priorPar = c(-2, 2))


 # Loading the cat_pav data
 data(cat_pav)
 cat_pav &lt;- as.matrix(cat_pav)

 # Selection of two arbitrary items (15 and 20) 
 it.given &lt;- cat_pav[c(15, 20),]

 # Generation of a response pattern (true ability level 0)
 x &lt;- genPattern(0, it.given, model = "GPCM")

  # KL for item 1, ML estimate of ability computed
 KL(cat_pav, 1, x, it.given, model = "GPCM")

 # Current (ML) ability estimate 
 theta &lt;- thetaEst(it.given, x, method = "ML", model = "GPCM")
 KL(cat_pav, 1, x, it.given, theta = theta, model = "GPCM")

 # WL ability estimate instead
 theta &lt;- thetaEst(it.given, x, method = "WL", model = "GPCM")
 KL(cat_pav, 1, x, it.given, theta = theta, model = "GPCM")

 # KLP for item 1
 KL(cat_pav, 1, x, it.given, theta = theta, model = "GPCM", type = "KLP")

 # KLP for item 1, different integration range
 KL(cat_pav, 1, x, it.given, theta = theta, model = "GPCM", type = "KLP", lower = -2, 
    upper = 2, nqp = 20)

 # KL for item 1, uniform prior distribution on the range [-2,2]
 KL(cat_pav, 1, x, it.given, theta = theta, model = "GPCM", type = "KLP", 
    priorDist = "unif", priorPar = c(-2, 2))
 </code></pre>


</div>