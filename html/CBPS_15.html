<div class="container">

<table style="width: 100%;"><tr>
<td>npCBPS</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Non-Parametric Covariate Balancing Propensity Score (npCBPS) Estimation</h2>

<h3>Description</h3>

<p><code>npCBPS</code> is a method to estimate weights interpretable as (stabilized)
inverse generlized propensity score weights, w_i = f(T_i)/f(T_i|X), without
actually estimating a model for the treatment to arrive at f(T|X) estimates.
In brief, this works by maximizing the empirical likelihood of observing the
values of treatment and covariates that were observed, while constraining
the weights to be those that (a) ensure balance on the covariates, and (b)
maintain the original means of the treatment and covariates.
</p>
<p>In the continuous treatment context, this balance on covariates means zero
correlation of each covariate with the treatment. In binary or categorical
treatment contexts, balance on covariates implies equal means on the
covariates for observations at each level of the treatment.  When given a
numeric treatment the software handles it continuously. To handle the
treatment as binary or categorical is must be given as a factor.
</p>
<p>Furthermore, we apply a Bayesian variant that allows the correlation of each
covariate with the treatment to be slightly non-zero, as might be expected
in a a given finite sample.
</p>
<p>Estimates non-parametric covariate balancing propensity score weights.
</p>
<p>### @aliases npCBPS npCBPS.fit
</p>


<h3>Usage</h3>

<pre><code class="language-R">npCBPS(formula, data, na.action, corprior = 0.01, print.level = 0, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>An object of class <code>formula</code> (or one that can be coerced
to that class): a symbolic description of the model to be fitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An optional data frame, list or environment (or object coercible
by as.data.frame to a data frame) containing the variables in the model. If
not found in data, the variables are taken from <code>environment(formula)</code>,
typically the environment from which <code>CBPS</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>A function which indicates what should happen when the data
contain NAs. The default is set by the na.action setting of options, and is
na.fail if that is unset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>corprior</code></td>
<td>
<p>Prior hyperparameter controlling the expected amount of
correlation between each covariate and the treatment. Specifically, the
amount of correlation between the k-dimensional covariates, X, and the
treatment T after weighting is assumed to have prior distribution
MVN(0,sigma^2 I_k). We conceptualize sigma^2 as a tuning parameter to be
used pragmatically. It's default of 0.1 ensures that the balance constraints
are not too harsh, and that a solution is likely to exist. Once the
algorithm works at such a high value of sigma^2, the user may wish to
attempt values closer to 0 to get finer balance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.level</code></td>
<td>
<p>Controls verbosity of output to the screen while npCBPS
runs. At the default of print.level=0, little output is produced. It
print.level&gt;0, it outputs diagnostics including the log posterior
(log_post), the log empirical likelihood associated with the weights
(log_el), and the log prior probability of the (weighted) correlation of
treatment with the covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other parameters to be passed.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>The optimal weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>The treatment vector
used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The covariate matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>The model frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>The matched call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>The formula supplied</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The data argument</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log.p.eta</code></td>
<td>
<p>The log density for the
(weighted) correlation of the covariates with the treatment, given the
choice of prior (<code>corprior</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log.el</code></td>
<td>
<p>The log empirical
likelihood of the observed data at the chosen set of IPW weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eta</code></td>
<td>
<p>A vector describing the correlation between the treatment and
each covariate on the weighted data at the solution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sumw0</code></td>
<td>
<p>The sum
of weights, provided as a check on convergence. This is always 1 when
convergence occurs unproblematically. If it differs from 1 substantially, no
solution perfectly satisfying the conditions was found, and the user may
consider a larger value of <code>corprior</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Christian Fong, Chad Hazlett, and Kosuke Imai
</p>


<h3>References</h3>

<p>Fong, Christian, Chad Hazlett, and Kosuke Imai.  “Parametric
and Nonparametric Covariate Balancing Propensity Score for General Treatment
Regimes.” Unpublished Manuscript.
<a href="http://imai.princeton.edu/research/files/CBGPS.pdf">http://imai.princeton.edu/research/files/CBGPS.pdf</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
##Generate data
data(LaLonde)

## Restricted two only two covariates so that it will run quickly.
## Performance will remain good if the full LaLonde specification is used
fit &lt;- npCBPS(treat ~ age + educ, data = LaLonde, corprior=.1/nrow(LaLonde))
plot(fit)

</code></pre>


</div>