<div class="container">

<table style="width: 100%;"><tr>
<td>coca</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit Co-Correspondence Analysis Ordination Models</h2>

<h3>Description</h3>

<p><code>coca</code> is used to fit Co-Correspondence Analysis (CoCA)
models. It can fit predictive or symmetric models to two community
data matrices containing species abundance data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">coca(y, ...)

## Default S3 method:
coca(y, x, method = c("predictive", "symmetric"),
     reg.method = c("simpls", "eigen"), weights = NULL,
     n.axes = NULL, symmetric = FALSE, quiet = FALSE, ...)

## S3 method for class 'formula'
coca(formula, data, method = c("predictive", "symmetric"),
     reg.method = c("simpls", "eigen"), weights = NULL,
     n.axes = NULL, symmetric = FALSE, quiet = FALSE, ...)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a data frame containing the response community data matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a data frame containing the predictor community data matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a symbolic description of the model to be fit. The
details of model specification are given below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame containing the variables in the model.
If not found in <code>data</code>, the variables are taken from
<code>environment(formula)</code>, typically the environment from which
<code>coca</code> is called.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>a character string indicating which co-correspondence
analysis method to use. One of <code>"predictive"</code>(default), or
<code>"symmetric"</code>, can be abbreviated.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reg.method</code></td>
<td>
<p>One of <code>"simpls"</code> (default) or
<code>"eigen"</code>. If <code>method</code> is <code>"predictive"</code> then
<code>reg.method</code> controls whether the co-correspondence analysis
should be fitted using the SIMPLS algorithm or via an eigen
analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>a vector of length <code>nrow(y)</code> of user supplied
weights for <code class="reqn">R_0</code>. If <code>weights = NULL</code> (default) then the
weights are determined from <code>y</code> (default) or <code>x</code> and <code>y</code>
(<code>symmetric = TRUE</code> only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.axes</code></td>
<td>
<p>the number of CoCA axes to extract. If missing (default)
the <code>n.axes</code> is </p>
<p style="text-align: center;"><code class="reqn">min(ncol(y), ncol(x), nrow(y), nrow(x)) -
      1</code>
</p>
<p>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>symmetric</code></td>
<td>
<p>if <code>method</code> is <code>"symmetric"</code> then
<code>symmetric</code> determines whether weights for <code class="reqn">R_0</code> are
symmetric and taken as the average of the row sums of <code>x</code> and
<code>y</code> (<code>symmetric = TRUE</code>). If <code>symmetric = FALSE</code>
(default) then the weights <code class="reqn">R_0</code> are taken as the row sums of <code>y</code>
unless user defined weights are provided via argument
<code>weights</code>. Ignored if <code>method</code> is <code>"predictive"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>logical; suppress messages due to removal of species with
no data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to be passed to lower level methods.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>coca</code> is the main user-callable function.
</p>
<p>A typical model has the form <code>response ~ terms</code> where
<code>response</code> is the (numeric) response data frame and <code>terms</code>
is a series of terms which specifies a linear predictor for
<code>response</code>. A typical form for <code>terms</code> is <code>.</code>,
which is shorthand for "all variables" in <code>data</code>. If <code>.</code> is
used, <code>data</code> must also be provided. If specific species
(variables) are required then <code>terms</code> should take the form
<code>spp1 + spp2 + spp3</code>.
</p>
<p>The default is to fit a predictive CoCA model using SIMPLS via a
modified version of <code>simpls.fit</code> from package
<code>pls</code>. Alternatively, <code>reg.method = "eigen"</code> fits the model
using an older, slower eigen analysis version of the SIMPLS
algorithm. <code>reg.method = "eigen"</code> is about 100% slower than
<code>reg.method = "simpls"</code>.
</p>


<h3>Value</h3>

<p><code>coca</code> returns a list with <code>method</code> and <code>reg.method</code>
determining the actual components returned.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>nam.dat</code></td>
<td>
<p>list with components <code>namY</code> and
<code>namX</code> containing the names of the response and the
predictor(s) respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the matched call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the CoCA method used, one of <code>"predictive"</code>
or <code>"symmetric"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scores</code></td>
<td>
<p>the species and site scores of the fitted
model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loadings</code></td>
<td>
<p>the site loadings of the fitted model for the response
and the predictor. (Predictive CoCA via SIMPLS only.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted</code></td>
<td>
<p>the fitted values for the response. A list with 2
components <code>Yhat</code> (the fitted values on the original scale) and
<code>Yhat1</code> (the fitted values on the chi-square transformed
scale). (Predictive CoCA via SIMPLS only.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varianceExp</code></td>
<td>
<p>list with components <code>Yblock</code> and
<code>Xblock</code> containing the variances in the response and
the predictor respectively, explained by each fitted PLS
axis. (Predictive CoCA via SIMPLS only.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>totalVar</code></td>
<td>
<p>list with components <code>Yblock</code> and
<code>Xblock</code> containing the total variance in the response
and the predictor respectively. (Predictive CoCA via SIMPLS only.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>the Eigenvalues of the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.axes</code></td>
<td>
<p>the number of fitted axes</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ychi</code></td>
<td>
<p>a list containing the mean-centered chi-square matrices
for the response (<code>Ychi1</code>) and the predictor
(<code>Ychi2</code>). (Predictive CoCA only.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R0</code></td>
<td>
<p>the (possibly user-supplied) row weights used in the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>X-Matrix (symmetric CoCA only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>Residuals of a symmetric model (symmetric CoCA
only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inertia</code></td>
<td>
<p>list with components <code>total</code> and
<code>residual</code> containing the total and residual inertia
for the response and the predictor (symmetric CoCA only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rowsum</code></td>
<td>
<p>a list with the row sums for the response
(<code>rsum1</code>) and the preditor (<code>rsum2</code>)
(symmetric CoCA only).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colsum</code></td>
<td>
<p>a list with the column sums for the response
(<code>csum1</code>)and the preditor (<code>csum2</code>)
(symmetric CoCA only).</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Original Matlab code by C.J.F. ter Braak and A.P. Schaffers. R
port by Gavin L. Simpson. Formula method for <code>coca</code> uses a
modified version of <code>ordiParseFormula</code> by Jari
Oksanen to handle formulea.
</p>


<h3>References</h3>

<p>ter Braak, C.J.F and Schaffers, A.P. (2004) Co-Correspondence
Analysis: a new ordination method to relate two community
compositions. <em>Ecology</em> <b>85(3)</b>, 834â€“846
</p>


<h3>See Also</h3>

<p><code>crossval</code> for cross-validation and
<code>permutest.coca</code> for permutation test to determine the
number of PLS axes to retain in for predictive CoCA.
</p>
<p><code>summary.predcoca</code> and <code>summary.symcoca</code> for
summary methods.</p>


<h3>Examples</h3>

<pre><code class="language-R">
## symmetric CoCA
data(beetles)
## log transform the bettle data
beetles &lt;- log(beetles + 1)
data(plants)
## fit the model
bp.sym &lt;- coca(beetles ~ ., data = plants, method = "symmetric")
bp.sym
summary(bp.sym)
biplot(bp.sym)                          # produces a Benzecri biplot

## extract eigenvalues of the analysis
eigenvals(bp.sym)

## correlations between beetle and plant score scores on Co-CA axes
corAxis(bp.sym)

## predictive CoCA using SIMPLS and formula interface
bp.pred &lt;- coca(beetles ~ ., data = plants)
## should retain only the useful PLS components for a parsimonious model


## Leave-one-out crossvalidation - this takes a while
crossval(beetles, plants)
## so 2 axes are sufficient
## permutation test to assess significant PLS components - takes a while
bp.perm &lt;- permutest(bp.pred, permutations = 99)
bp.perm


## agrees with the Leave-one-out cross-validation
## refit the model with only 2 PLS components
bp.pred &lt;- coca(beetles ~ ., data = plants, n.axes = 2)
bp.pred
summary(bp.pred)
biplot(bp.pred)                     # plots correct scores or loadings

## predictive CoCA using Eigen-analysis
data(bryophyte)
data(vascular)
carp.pred &lt;- coca(y = bryophyte, x = vascular, reg.method = "eigen")
carp.pred


## determine important PLS components - takes a while
crossval(bryophyte, vascular)
(carp.perm &lt;- permutest(carp.pred, permutations = 99))


## 2 components again, refit
carp.pred &lt;- coca(y = bryophyte, x = vascular,
                  reg.method = "eigen", n.axes = 2)
carp.pred
## drawn biplot
biplot(carp.pred)

</code></pre>


</div>