<div class="container">

<table style="width: 100%;"><tr>
<td>IMCE</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Heterogeneous Effects Analysis of Conjoint Results</h2>

<h3>Description</h3>

<p><code>IMCE</code> calculates the individual-level marginal component effects from a BART-estimated conjoint model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">IMCE(
  data,
  model,
  attribs,
  ref_levels,
  method = "bayes",
  alpha = 0.05,
  keep_omce = FALSE,
  cores = 1,
  skip_checks = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data.frame, containing all attributes, covariates, the outcome and id variables to analyze.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A model object, the result of running <code>cjbart()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>attribs</code></td>
<td>
<p>Vector of attribute names for which IMCEs will be predicted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_levels</code></td>
<td>
<p>Vector of reference levels, used to calculate marginal effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Character string, setting the variance estimation method to use. When method is "parametric", a typical combined variance estimate is employed; when <code>method = "bayes"</code>, the 95% posterior interval is calculated; and when <code>method = "rubin"</code>, combination rules are used to combine the variance analogous to in multiple imputation analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Number between 0 and 1 â€“ the significance level used to compute confidence/posterior intervals. When <code>method = "bayes"</code>, the posterior interval is calculated by taking the alpha/2 and (1-alpha/2) quantiles of the posterior draws. When <code>method = "rubin"</code>, the confidence interval equals the IMCE +/- <code>qnorm(alpha/2)</code>. By default, alpha is 0.05 i.e. generating a 95% confidence/posterior interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep_omce</code></td>
<td>
<p>Boolean, indicating whether to keep the OMCE-level results (default = <code>FALSE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Number of CPU cores used during prediction phase</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skip_checks</code></td>
<td>
<p>Boolean, indicating whether to check the structure of the data (default = <code>FALSE</code>). Only set this to <code>TRUE</code> if you are confident that the data is structured appropriately</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The OMCE estimates are the result of subtracting the predicted value of each observation under the reference-level category from the predicted value of each observation under the given attribute level.
If an attribute has <em>k</em> levels, then this will yield <em>k-1</em> estimates per observation.
The IMCE is the average of the OMCEs for each individual within the data.
</p>


<h3>Value</h3>

<p><code>IMCE</code> returns an object of type "cjbart", a list object.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>omce</code></td>
<td>
<p>A data.frame containing the observation-level marginal effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imce</code></td>
<td>
<p>A data.frame containing the individual-level marginal effects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imce_upper</code></td>
<td>
<p>A data.frame containing the upper bound of the IMCE confidence/credible interval</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imce_lower</code></td>
<td>
<p>A data.frame containing the lower bound of the IMCE confidence/credible interval</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>att_levels</code></td>
<td>
<p>A vector containing the attribute levels</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>cjbart()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">subjects &lt;- 5
rounds &lt;- 2
profiles &lt;- 2
obs &lt;- subjects*rounds*profiles

fake_data &lt;- data.frame(A = sample(c("a1","a2"), obs, replace = TRUE),
                        B = sample(c("b1","b2"), obs, replace = TRUE),
                        id1 = rep(1:subjects, each=rounds),
                        stringsAsFactors = TRUE)

fake_data$Y &lt;- sample(c(0,1), obs, replace = TRUE)

cj_model &lt;- cjbart(data = fake_data,
                   Y = "Y",
                   id = "id1")

## Skip if not Unix due to longer CPU time
if (.Platform$OS.type=='unix') {

  het_effects &lt;- IMCE(data = fake_data,
                      model = cj_model,
                      attribs = c("A","B"),
                      ref_levels = c("a1","b1"),
                      cores = 1)

  summary(het_effects)
}


</code></pre>


</div>