<div class="container">

<table style="width: 100%;"><tr>
<td>csranks</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Confidence sets for ranks</h2>

<h3>Description</h3>

<p>Marginal and simultaneous confidence sets for ranks.
</p>


<h3>Usage</h3>

<pre><code class="language-R">csranks(
  x,
  Sigma,
  coverage = 0.95,
  cstype = "two-sided",
  stepdown = TRUE,
  R = 1000,
  simul = TRUE,
  indices = NA,
  na.rm = FALSE,
  seed = NA
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>vector of estimates containing estimated features by which the populations are to be ranked.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>estimated covariance matrix of <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coverage</code></td>
<td>
<p>nominal coverage of the confidence set. Default is 0.95.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cstype</code></td>
<td>
<p>type of confidence set (<code>two-sided</code>, <code>upper</code>, <code>lower</code>). Default is <code>two-sided</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stepdown</code></td>
<td>
<p>logical; if <code>TRUE</code> (default), stepwise procedure is used, otherwise single step procedure is used. See Details section for more.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>number of bootstrap replications. Default is 1000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simul</code></td>
<td>
<p>logical; if <code>TRUE</code> (default), then simultaneous confidence sets are computed, which jointly cover all populations indicated by <code>indices</code>.
Otherwise, for each population indicated in <code>indices</code> a marginal confidence set is computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indices</code></td>
<td>
<p>vector of indices of <code>x</code> for whose ranks the confidence sets are computed. <code>indices=NA</code> (default) means computation of confidence sets for all populations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>logical; if <code>TRUE</code>, then <code>NA</code>'s are removed from <code>x</code> and <code>Sigma</code> (if any).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>seed for bootstrap random variable draws. If set to <code>NA</code> (default), then seed is not set.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>csranks</code> object, which is a list with three items:
</p>

<dl>
<dt><code>L</code></dt>
<dd>
<p>Lower bounds of the confidence sets for ranks indicated in <code>indices</code></p>
</dd>
<dt><code>rank</code></dt>
<dd>
<p>Estimated ranks from <code>irank</code> with default parameters</p>
</dd>
<dt><code>U</code></dt>
<dd>
<p>Upper bounds of the confidence sets.</p>
</dd>
</dl>
<h3>Details</h3>

<p>Suppose <code class="reqn">j=1,\ldots,p</code> populations (e.g., schools, hospitals, political parties, countries) are to be ranked according to
some measure <code class="reqn">\theta=(\theta_1,\ldots,\theta_p)</code>. We do not observe the true values <code class="reqn">\theta_1,\ldots,\theta_p</code>. Instead, for each population,
we have data from which we have estimated these measures, <code class="reqn">\hat{\theta}=(\hat{\theta}_1,\ldots,\hat{\theta}_p)</code>. The values <code class="reqn">\hat{\theta}_1,\ldots,\hat{\theta}_p</code>
are estimates of the true values <code class="reqn">\theta_1,\ldots,\theta_p</code> and thus contain statistical uncertainty. In consequence, a ranking of the populations by
the values <code class="reqn">\hat{\theta}_1,\ldots,\hat{\theta}_p</code> contains statistical uncertainty and is not necessarily equal to the true ranking of <code class="reqn">\theta_1,\ldots,\theta_p</code>.
</p>
<p>The function computes confidence sets for the rank of one, several or all of the populations (<code>indices</code> indicates which of the <code class="reqn">1,\ldots,p</code> populations are of interest). <code>x</code> is a vector containing the estimates
<code class="reqn">\hat{\theta}_1,\ldots,\hat{\theta}_p</code> and <code>Sigma</code> is an estimate of the covariance matrix of <code>x</code>. The method assumes that the estimates are asymptotically normal and the sample sizes of the datasets
are large enough so that <code class="reqn">\hat{\theta}-\theta</code> is approximately distributed as <code class="reqn">N(0,\Sigma)</code>. The argument <code>Sigma</code> should contain an estimate of the covariance matrix <code class="reqn">\Sigma</code>. For instance, if for each population <code class="reqn">j</code>
</p>
<p style="text-align: center;"><code class="reqn">\sqrt{n_j} (\hat{\theta}_j-\theta_j) \to_d N(0, \sigma_j^2)</code>
</p>

<p>and the datasets for each population are drawn independently of each other, then <code>Sigma</code> is a diagonal matrix </p>
<p style="text-align: center;"><code class="reqn">diag(\hat{\sigma}_1^2/n_1,\ldots,\hat{\sigma}_p^2/n_p)</code>
</p>

<p>containing estimates of the asymptotic variances divided by the sample size. More generally, the estimates in <code>x</code> may be dependent, but then <code>Sigma</code>
must be an estimate of its covariance matrix including off-diagonal terms.
</p>
<p>Marginal confidence sets (<code>simul=FALSE</code>) are such that the confidence set for a population <code class="reqn">j</code> contains the true rank of that population <code class="reqn">j</code> with probability approximately
equal to the nominal coverage level. Simultaneous confidence sets (<code>simul=TRUE</code>) on the other hand are such that the confidence sets for populations indicated in <code>indices</code> cover the true ranks
of all of these populations simultaneously with probability approximately equal to the nominal coverage level. For instance, in the PISA example below, a marginal confidence set of a country <code class="reqn">j</code> covers the true
rank of country <code class="reqn">j</code> with probability approximately equal to 0.95. A simultaneous confidence set for all countries covers the true ranks of all countries simultaneously with probability approximately equal to 0.95.
</p>
<p>The function implements the procedures developed and described in more detail in Mogstad, Romano, Shaikh, and Wilhelm (2023). The procedure is based on
on testing a large family of hypotheses for pairwise comparisons. Stepwise methods can be used to improve the power of the procedure by, potentially,
rejecting more hypotheses without violating the desired coverage property of the resulting confidence set. These are employed when
<code>stepdown=TRUE</code>. From a practical point of view, <code>stepdown=TRUE</code> is computationally more demanding, but often results
in tighter confidence sets.
</p>
<p>The procedure uses a parametric bootstrap procedure based on the above approximate multivariate normal distribution.
</p>


<h3>References</h3>

<p>Mogstad, Romano, Shaikh, and Wilhelm (2023), "Inference for Ranks with Applications to Mobility across Neighborhoods and Academic Achievements across Countries", forthcoming at Review of Economic Studies
<a href="http://dwilhelm.userweb.mwn.de/papers/cwp0323.pdf">cemmap working paper</a>
<a href="https://doi.org/10.1093/restud/rdad006">doi:10.1093/restud/rdad006</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># simple simulated example:
n &lt;- 100
p &lt;- 10
X &lt;- matrix(rep(1:p,n)/p, ncol=p, byrow=TRUE) + matrix(rnorm(n*p), 100, 10)
thetahat &lt;- colMeans(X)
Sigmahat &lt;- cov(X) / n
csranks(thetahat, Sigmahat)

# PISA example:
data(pisa2018)
math_score &lt;- pisa2018$math_score
math_se &lt;- pisa2018$math_se
math_cov_mat &lt;- diag(math_se^2)

# marginal confidence set for each country:
csranks(math_score, math_cov_mat, simul=FALSE)

# simultaneous confidence set for all countries:
csranks(math_score, math_cov_mat, simul=TRUE)
</code></pre>


</div>