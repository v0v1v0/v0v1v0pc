<div class="container">

<table style="width: 100%;"><tr>
<td>calibration_simplex</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calibration Simplex</h2>

<h3>Description</h3>

<p>Generates an object of class <code>calibration_simplex</code> which can be used to assess the calibration
of ternary probability forecasts. The Calibration Simplex can be seen as generalization of the reliability diagram
for binary probability forecasts. For details on the interpretation of the calibration simplex, see Wilks (2013). Be
aware that some minor changes have been made compared to the calibration simplex as suggested by Wilks (2013) (see note below).
</p>
<p>As a somewhat experimental feature, multinomial p-values can be used for uncertainty quantification, that is, as a tool
to judge whether the observed discrepancies may be merely coincidental or whether the predictions may in fact be miscalibrated, see Resin (2020, Section 4.2).
</p>


<h3>Usage</h3>

<pre><code class="language-R">calibration_simplex(n, p1, p2, p3, obs, test_stat, percentagewise)

## Default S3 method:
calibration_simplex(
  n = 10,
  p1 = NULL,
  p2 = NULL,
  p3 = NULL,
  obs = NULL,
  test_stat = "LLR",
  percentagewise = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>A natural number.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p1</code></td>
<td>
<p>A vector containing the forecasted probabilities for the first (1) category, e.g. below-normal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p2</code></td>
<td>
<p>A vector containing the forecasted probabilities for the second (2) category, e.g. near-normal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p3</code></td>
<td>
<p>A vector containing the forecasted probabilities for the third (3) category, e.g. above-normal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs</code></td>
<td>
<p>A vector containing the observed outcomes (Categories are encoded as 1 (e.g. below-normal), 2 (e.g. near-normal) and 3 (e.g. above-normal)).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_stat</code></td>
<td>
<p>A string indicating which test statistic is to be used for the multinomial test in each bin. 
Options are "LLR" (log-likelihood ratio; default), "Chisq" (Pearson's chi-square) and "Prob" (probability mass statistic). See details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>percentagewise</code></td>
<td>
<p>Logical, specifying whether probabilities are percentagewise (summing to 100) or not (summing to 1).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Only two of the three forecast probability vectors (<code>p1</code>, <code>p2</code> and <code>p3</code>) need to be specified.
</p>
<p>The p-values are based on multinomial tests comparing the observed frequencies within a bin 
with the average forecast probabilities within the bin as outlined in Resin (2020, Section 4.2).
The p-values are exact and do not rely on asymptotics, however, it is assumed that the true 
distribution (under the hypothesis of forecast calibration) within each bin 
is approximated well by the multinomial distribution. If <code>n</code> is small the 
approximation may be poor, resulting in unreliable p-values. p-Values less than 0.0001 are not
exact but merely indicate a value less than 0.0001.
</p>


<h3>Value</h3>

<p>A list with class "calibration_simplex" containing
</p>
<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>As input by user or default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_bins</code></td>
<td>
<p>Computed from <code>n</code>. Number of hexagons.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_obs</code></td>
<td>
<p>Total number of observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>Vector of length <code>n_bins</code> containing the number of observations within each bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond_rel_freq</code></td>
<td>
<p>Matrix containing the observed outcome frequencies within each bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond_ave_prob</code></td>
<td>
<p>Matrix containing the average forecast probabilities within each bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pvals</code></td>
<td>
<p>Exact multinomial p-values within each bin. See details.</p>
</td>
</tr>
</table>
<p>Object of class <code>calibration_simplex</code>.
</p>


<h3>Note</h3>

<p>In contrast to the calibration simplex proposed by Daniel S. Wilks, 2013, the simplex has been
mirrored at the diagonal through the left bottom hexagon. The miscalibration error is by default calculated
precisely (in each bin as the difference of the relative frequencies of each class and the
average forecast probabilities) instead of approximately (using Wilks original formula).
Approximate errors can be used by setting <code>true_error = FALSE</code> when using <code>plot.calibration_simplex</code>.
</p>


<h3>References</h3>

<p>Daniel S. Wilks, 2013, The Calibration Simplex: A Generalization of the Reliability Diagram for Three-Category Probability Forecasts, <em>Weather and Forecasting</em>, <strong>28</strong>, 1210-1218
</p>
<p>Resin, J. (2020), A Simple Algorithm for Exact Multinomial Tests, <em>Preprint</em> <a href="https://arxiv.org/abs/2008.12682">https://arxiv.org/abs/2008.12682</a>
</p>


<h3>See Also</h3>

<p><code>plot.calibration_simplex</code>
</p>
<p><code>ternary_forecast_example</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">attach(ternary_forecast_example)   #see also documentation of sample data
#?ternary_forecast_example

# Calibrated forecast sample
calsim0 = calibration_simplex(p1 = p1, p3 = p3, obs = obs0)
plot(calsim0,use_pvals = TRUE) # with multinomial p-values

# Overconfident forecast sample
calsim1 = calibration_simplex(p1 = p1, p3 = p3, obs = obs1)
plot(calsim1)

# Underconfident forecast sample
calsim2 = calibration_simplex(p1 = p1, p3 = p3, obs = obs2)
plot(calsim2,use_pvals = TRUE) # with multinomial p-values

# Unconditionally biased forecast sample
calsim3 = calibration_simplex(p1 = p1, p3 = p3, obs = obs3)
plot(calsim3)

# Using a different number of bins
calsim = calibration_simplex(n=4, p1 = p1, p3 = p3, obs = obs3)
plot(calsim)

calsim = calibration_simplex(n=13, p1 = p1, p3 = p3, obs = obs3)
plot(calsim,               # using some additional plotting parameters:
     error_scale = 0.5,    # errors are less pronounced (smaller shifts)
     min_bin_freq = 100,   # dots are plotted only for bins,
                           # which contain at least 100 forecast-outcome pairs
     category_labels = c("below-normal","near-normal","above-normal"),
     main = "Sample calibration simplex")

detach(ternary_forecast_example)
</code></pre>


</div>