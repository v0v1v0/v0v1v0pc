<div class="container">

<table style="width: 100%;"><tr>
<td>clusWilcox.test</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Wilcoxon Rank Sum and Signed Rank Test for Clustered Data</h2>

<h3>Description</h3>

<p>Performs one-sample and two-sample Wilcoxon test for clustered data
on vectors of data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">clusWilcox.test(x, ...)

## S3 method for class 'formula'
clusWilcox.test(
  formula,
  data = parent.frame(),
  subset = NULL,
  na.action = na.omit,
  alternative = c("two.sided", "less", "greater"),
  mu = 0,
  paired = FALSE,
  exact = FALSE,
  B = 2000,
  method = c("rgl", "ds", "dd"),
  ...
)

## Default S3 method:
clusWilcox.test(
  x,
  y = NULL,
  cluster = NULL,
  group = NULL,
  stratum = NULL,
  data = NULL,
  alternative = c("two.sided", "less", "greater"),
  mu = 0,
  paired = FALSE,
  exact = FALSE,
  B = 2000,
  method = c("rgl", "ds", "dd"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A numeric vector of data values or a formula. Non-finite (e.g.,
infinite or missing) values will be omitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed to or from methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A formula of the form <code>lhs ~ rhs</code> where the
<code>lhs</code> is the measurements and
the <code>rhs</code> is of the form group + <code>cluster</code>(x1) +
<code>stratum</code>(x2) for clustered rank sum test, where
<code>x1</code> and <code>x2</code> are cluster id and stratum id in the
data frame <code>data</code>. For clustered signed rank test, the
<code>rhs</code> should only contain <code>cluster</code>(x1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>An optional data frame containing the variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>An optional vector specifying a subset of
observations to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>A function which indicates what should happen
when the data contain NAs. Defaults to <code>getOption("na.action")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>A character string specifying the alternative
hypothesis, must be one of <code>"two sided"</code> (default),
<code>"greater"</code> or <code>"less"</code>. You can specify just the
initial letter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>A number specifying an optional parameter used to form
the null hypothesis. Default is 0. See 'Details'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>paired</code></td>
<td>
<p>A logical indicating whether you want a paired test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exact</code></td>
<td>
<p>A logical indicating if a permutation test is to be
used. If it is set as <code>FALSE</code>, then test based on
large-sample theory is carried out. If it is set as
<code>TRUE</code>, then a permutation test is carried out. There are
two available permutation tests: exact permutation test is available for
<code>rgl</code> signed rank test and <code>rgl</code> rank sum test when
treatment is assigned at cluster level, random permutation
test is available for all tests. For more details look at the
description of the argument <code>B</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>An integer specifying the number of permutations if exact = TRUE.
If B = 0, then the test is the exact permutation test.
If B &gt; 0, then an approximation to the exact test with B random permutation.
Default is set as 2000 to ran a random permutation test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string specifying the method of
clustered Wilcoxon rank test to be use, should be one of
<code>"rgl"</code> or <code>"ds"</code>. For rank-sum test, the <code>"dd"</code>
method is also available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>An optional numeric vector of data values, non-finite
values will be omitted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>An optional numeric vector of cluster id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>An optional numeric vector of treatment id.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stratum</code></td>
<td>
<p>An optional numeric vector of stratum id. Only
available for <code>rgl</code> rank sum test when treatment is assigned at
cluster level.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The formula interface is to both clustered signed rank
test and clustered rank sum test.
</p>
<p>The default of <code>cluster</code> id is that there is one member in
each cluster. Both balanced data (identical cluster size) and
unbalanced data (different cluster sizes) are
supported in all tests provided in this package. For clustered
rank sum test, the data can either have treatment assigned at
cluster level or individual level.
</p>
<p>If both <code>x</code> and <code>y</code> are given or only <code>x</code> is given
and <code>paired</code> is <code>TRUE</code>, a clustered Wilcoxon signed
rank test of the null that the distribution of <code>x - y</code>
(paired sample) or of <code>x</code> (one sample) is symmetric about
<code>mu</code> is performed.
</p>
<p>Otherwise, if only <code>x</code> is given and <code>paired</code> is
<code>FALSE</code>, a Wilcoxon rank sum test is performed. In this case,
measurements from different treatment groups should be combined in
<code>x</code> and the <code>group</code> variable is required.  When there
are two treatment groups, the null is that the distributions of
values from the two groups differ by a location shift of <code>mu</code>
and the alternative is that they differ by some other location
shift.  When there are <code>m</code> (&gt;= 2) treatment groups, <code>ds</code>
method can test if the location of the <code>m</code> groups are
identical or not.
</p>
<p>For RGL rank sum test when treatment is assigned at cluster level,
an extra stratification variable is allowed through <code>stratum</code>.
</p>
<p>The exact test is only available for RGL signed rank test and  RGL
rank sum test when treatment is assigned at cluster level.
</p>


<h3>Value</h3>

<p>A list with class <code>"htest"</code> containing the following components,
for different test the components may vary:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Rstat</code></td>
<td>
<p>the value of the rank statistic with a name describing it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ERstat</code></td>
<td>
<p>the expectation of the rank statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>VRstat</code></td>
<td>
<p>the variance of the rank statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>the value of the test statistic with a name describing it.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.value</code></td>
<td>
<p>the p-value for the test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alternative</code></td>
<td>
<p>a character string describing the alternative hypothesis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null.value</code></td>
<td>
<p>the location parameter 'mu'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>the type of test applied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data.name</code></td>
<td>
<p>a character string giving the names of the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>balance</code></td>
<td>
<p>a logical indicating whether the data set is balanced.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ngroup</code></td>
<td>
<p>number of treatment, will be returned if there are more than 2 treatment groups and <code>ds</code> method is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>degrees of freedom of chi-square distribution, will be returned when there are more than 2 treatment groups and <code>ds</code> method is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nobs</code></td>
<td>
<p>number of observations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nclus</code></td>
<td>
<p>number of clusters</p>
</td>
</tr>
</table>
<h3>Methods (by class)</h3>


<ul>
<li> <p><code>clusWilcox.test(formula)</code>: <code>S3</code> method for class 'formula'
</p>
</li>
<li> <p><code>clusWilcox.test(default)</code>: Default <code>S3</code> method.
</p>
</li>
</ul>
<h3>Warning</h3>

<p>This function can use large amounts of memory and stack if 'exact =
TRUE' and one sample is large (and even crash R if the stack
limit is exceeded). Not recommended for data set
with number of clusters more than 50.
</p>


<h3>Author(s)</h3>

<p>Yujing Jiang
</p>


<h3>References</h3>

<p>Bernard Rosner, Robert J. Glynn, Mei-Ling T. Lee (2006)
<em>The Wilcoxon Signed Rank Test for Paired Comparisons of
Clustered Data</em>. Biometrics, <b>62</b>, 185-192.
</p>
<p>Bernard Rosner, Robert J. Glynn, Mei-Ling T. Lee (2003)
<em>Incorporation of Clustering Effects for the Wilcoxon Rank
Sum Test: A Large-Sample Approach</em>. Biometrics, <b>59</b>, 1089-1098.
</p>
<p>Bernard Rosner, Robert J. Glynn, Mei-Ling T. Lee (2006)
<em>Extension of the Rank Sum Test for Clustered Data:
Two-Group Comparisons with Group</em>. Biometrics, <b>62</b>, 1251-1259.
</p>
<p>Somnath Datta, Glen A. Satten (2005) <em>Rank-Sum Tests for Clustered Data</em>.
Journal of the American Statistical Association, <b>100</b>, 908-915.
</p>
<p>Somath Datta, Glen A. Satten (2008) <em>A Signed-Rank Test for Clustered Data</em>.
Biometrics, <b>64</b>, 501-507.
</p>
<p>Sandipan Dutta, Somnath Datta (2015) <em>A Rank-Sum Test for Clustered
Data When the Number of Subjects in a Group within a Cluster is
Informative</em>.
Biometrics, <b>72</b>, 432-440.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(clusrank)

## Clustered signed rank test using RGL method.
data(crsd)
clusWilcox.test(z, cluster = id, data = crsd, paired = TRUE, method = "rgl")
## or
clusWilcox.test(z ~ cluster(id), data = crsd, paired = TRUE, method = "rgl")

## Clustered rank sum test using RGL method.
data(crd)
clusWilcox.test(z ~ group + cluster(id), data = crd, method = "rgl")
## or
clusWilcox.test(z, cluster = id, group = group, data = crd, method = "rgl")
</code></pre>


</div>