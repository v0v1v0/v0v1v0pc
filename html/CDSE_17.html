<div class="container">

<table style="width: 100%;"><tr>
<td>GetStatisticsBy...</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Get statistical values (vectorization ready)</h2>

<h3>Description</h3>

<p>These functions retrieve simple statistics for the area of interest calculated
based on satellite imagery without having to download images.
They are simple wrappers around the <code>GetStatistics</code> function with arguments organized in a way
that facilitates calling the function in a vectorized manner (using <code>lapply</code> or similar function)
and thus potentially also the parallelization.
</p>


<h3>Usage</h3>

<pre><code class="language-R">GetStatisticsByTimerange(
  time_range,
  aoi,
  bbox,
  collection,
  script,
  mosaicking_order = c("mostRecent", "leastRecent", "leastCC")[1],
  pixels,
  resolution,
  buffer = 0,
  percentiles = NULL,
  aggregation_period = 1L,
  aggregation_unit = c("day", "week", "month", "year")[1],
  lastIntervalBehavior = c("SKIP", "SHORTEN", "EXTEND")[1],
  as_data_frame = TRUE,
  client,
  token,
  url = getOption("CDSE.statistical_url")
)

GetStatisticsByAOI(
  aoi,
  time_range,
  collection,
  script,
  mosaicking_order = c("mostRecent", "leastRecent", "leastCC")[1],
  pixels,
  resolution,
  buffer = 0,
  percentiles = NULL,
  aggregation_period = 1L,
  aggregation_unit = c("day", "week", "month", "year")[1],
  lastIntervalBehavior = c("SKIP", "SHORTEN", "EXTEND")[1],
  as_data_frame = TRUE,
  client,
  token,
  url = getOption("CDSE.statistical_url")
)

GetStatisticsByBbox(
  bbox,
  time_range,
  collection,
  script,
  mosaicking_order = c("mostRecent", "leastRecent", "leastCC")[1],
  pixels,
  resolution,
  buffer = 0,
  percentiles = NULL,
  aggregation_period = 1L,
  aggregation_unit = c("day", "week", "month", "year")[1],
  lastIntervalBehavior = c("SKIP", "SHORTEN", "EXTEND")[1],
  as_data_frame = TRUE,
  client,
  token,
  url = getOption("CDSE.statistical_url")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>time_range</code></td>
<td>
<p>scalar or vector (Date or character that can be converted to date) defining the time interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aoi</code></td>
<td>
<p>sf or sfc object, typically a (multi)polygon, describing the Area of Interest.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bbox</code></td>
<td>
<p>numeric vector of four elements describing the bounding box of interest.
Specify with a coordinate pair on two (opposite) vertices of the bounding box rectangle.
Coordinates need to be in longitude, latitude.
</p>
<p>Only one of either <code>aoi</code> or <code>bbox</code> may be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>collection</code></td>
<td>
<p>character indicating which collection to search.
Must be one of the collections returned by <code>GetCollections</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>script</code></td>
<td>
<p>a length one character string containing the evaluation script or the name of the file containing the script.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mosaicking_order</code></td>
<td>
<p>character indicating the order in which tiles are overlapped from
which the output result is mosaicked.
Must be one of "mostRecent", "leastRecent", or "leastCC".
Partial matching is used, that is,
only enough initial letters of each string element are needed to guarantee unique
recognition. Default: "mostRecent"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pixels</code></td>
<td>
<p>integer scalar or length-two vector indicating the request image width and height.
Values must be integers between 1 and 2500.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resolution</code></td>
<td>
<p>numeric scalar or length-two vector indicating the spatial resolution of the request image
in horizontal and vertical direction (in meters).
</p>
<p>Only one of the arguments "pixels" or "resolution" must be set at the same time.
If the argument "pixels" or "resolution" is scalar, the same value is used for horizontal and vertical direction (width and height).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffer</code></td>
<td>
<p>numeric, width of the buffer to retrieve the image of enlarged area. Default: 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>percentiles</code></td>
<td>
<p>numeric vector indicating which percentile values should be computed.
Default: NULL, don't compute any percentiles.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregation_period</code></td>
<td>
<p>the length of the aggregation period in <code>aggregation_unit</code>
(days by default). Default: 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aggregation_unit</code></td>
<td>
<p>character indicating the the unit of the aggregation period,
must be one of "day", "week", "month", or "year". Partial matching is used, that is,
only enough initial letters of each string element are needed to guarantee unique
recognition (here just the first letter is enough). Default: "day"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lastIntervalBehavior</code></td>
<td>
<p>character indicating the behavior of the last interval if the
given <code>time_range</code> isn't divisible by the provided <code>aggregation_period.</code>
Must be one of:
</p>

<dl>
<dt><code>SKIP</code></dt>
<dd>
<p>- skip the last interval (default behavior)</p>
</dd>
<dt><code>SHORTEN</code></dt>
<dd>
<p>- shortens the last interval so that it ends at the end of provided <code>time_range</code></p>
</dd>
<dt><code>EXTEND</code></dt>
<dd>
<p>- extends the last interval over the end of the provided time range so that all intervals are of equal duration</p>
</dd>
</dl>
<p>Partial matching is used, that is,
only enough initial letters of each string element are needed to guarantee unique
recognition. Default: "SKIP"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as_data_frame</code></td>
<td>
<p>logical indicating if the result should be returned as data frame. Default: TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>client</code></td>
<td>
<p>OAuth client object to use for authentication.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>token</code></td>
<td>
<p>OAuth token character string to use for authentication.
</p>
<p>Exactly one of either <code>client</code> or <code>token</code> must be specified. It is recommended to use <code>client</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>url</code></td>
<td>
<p>character indicating the process endpoint. Default: Copernicus Data Space Ecosystem process endpoint</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The values are aggregated over the period (number of <code>aggregation_units</code>)
given by the <code>aggregation_period</code> argument.
The default values provide daily statistics. The statistics are returned only for the
<code>aggregation_units</code> (days, weeks, months, years) when the data is
available. This can be determined by the days of the satellite overpasses, but also
by the calculations done in the evaluation script.
</p>
<p>The scripts used for the Statistical API have some additional requirements: the <code>evaluatePixel()</code>
function must, in addition to other output, always also return dataMask output.
This output defines which pixels are excluded from calculations.
For more information please visit the online documentation
<a href="https://documentation.dataspace.copernicus.eu/APIs/SentinelHub/Statistical.html">https://documentation.dataspace.copernicus.eu/APIs/SentinelHub/Statistical.html</a>.
</p>
<p>If a <code>time_range</code> is not divisible by an <code>aggregation_period</code>, the last ("not full") time
interval will be dismissed by default (SKIP option). The user can instead set the
<code>lastIntervalBehavior</code> to SHORTEN (shortens the last interval so that it ends at the end
of the provided time range) or EXTEND (extends the last interval over the end of the
provided time range so that all the intervals are of equal duration).
</p>
<p>If percentiles requested are 25, 50, and 75, the columns are renamed 'q1', 'median', and 'q3'.
</p>
<p><code>GetStatisticsByTimerange</code> is arranged for vectorization on time_range (time_range is the first argument).
</p>
<p><code>GetStatisticsByAOI</code> is arranged for vectorization on aoi (aoi is the first argument).
</p>
<p><code>GetStatisticsByBbox</code> is arranged for vectorization on bbox (bbox is the first argument).
</p>


<h3>Value</h3>

<p><code>data.frame</code> or <code>list</code> with statistical values.
</p>


<h3>Source</h3>

<p><a href="https://documentation.dataspace.copernicus.eu/APIs/SentinelHub/Statistical.html">https://documentation.dataspace.copernicus.eu/APIs/SentinelHub/Statistical.html</a>
</p>


<h3>See Also</h3>

<p><code>GetStatistics</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
dsn &lt;- system.file("extdata", "centralpark.geojson", package = "CDSE")
aoi &lt;- sf::read_sf(dsn, as_tibble = FALSE)
script_file &lt;- "inst/scripts/NDVI_dataMask_float32.js"
seasons &lt;- SeasonalTimerange(from = "2020-06-01", to = "2023-08-31")
lst_stats &lt;- lapply(seasons, GetStatisticsByTimerange, aoi = aoi, collection = "sentinel-2-l2a",
   script = script_file, mosaicking_order = "leastCC", resolution = 100,
   aggregation_period = 7L, client = OAuthClient)
weekly_stats &lt;- do.call(rbind, lst_stats)
weekly_stats &lt;- weekly_stats[rev(order(weekly_stats$from)), ]
row.names(weekly_stats) &lt;- NULL
head(weekly_stats)

## End(Not run)
</code></pre>


</div>