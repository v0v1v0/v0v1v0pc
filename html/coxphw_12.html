<div class="container">

<table style="width: 100%;"><tr>
<td>predict.coxphw</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Predictions for a weighted Cox model</h2>

<h3>Description</h3>

<p> This function obtains the effect estimates (e.g. of a nonlinear or a
time-dependent effect) at specified values of a continuous
covariable for a model fitted by <code>coxphw</code>. It prints the
relative or log relative hazard. Additionally, the linear predictor lp
or the risk score exp(lp) can be obtained. </p>


<h3>Usage</h3>

<pre><code class="language-R"> ## S3 method for class 'coxphw'
predict(object, type = c("shape", "slice.time", "slice.z", "slice.x", "lp", "risk"),
        x = NULL, newx = NA, refx = NA, z = NULL, at = NULL, exp = FALSE,
        se.fit = FALSE, pval = FALSE, digits = 4, verbose = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p> an output object of <code>coxphw</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>the type of predicted value. Choices are:
<code>"lp"</code> for the linear predictors, <br><code>"risk"</code> for the risk scores <code>exp(lp)</code> <br><code>"shape"</code> for visualizing a nonlinear effect of <code>x</code>, <br><code>"slice.x"</code>  for slicing an interaction of type <code>fun(x)*z</code> at values of <code>x</code>,
<code>"slice.z"</code> for slicing an interaction of type <code>fun(x)*z</code> at a value of <code>z</code>, <br><code>"slice.time"</code> for slicing a time-by-covariate interaction of type <code>z + fun(time):z</code> at values of <code>time</code> <br>
See details. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p> name of the continuous or time variable (use "") for <code>type = "shape"</code>,
<code>"slice.time"</code>, <code>"slice.x"</code>, or <code>"slice.z"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newx</code></td>
<td>
<p> the data values for <code>x</code> for which the effect estimates should be
obtained (e.g., <code>30:70</code>) for <code>type = "shape"</code>,
<code>"slice.time"</code>, <code>"slice.x"</code>, or <code>"slice.z"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refx</code></td>
<td>
<p> the reference value for variable <code>x</code> for <code>type = "shape"</code> or <code>"slice.z"</code>.
The log relative hazard at this value will be 0. (e.g., <code>refx= 50</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p> variable which is in interaction with <code>x</code> (use "") for <code>"slice.time"</code>,
<code>"slice.x"</code>, or <code>"slice.z"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>at</code></td>
<td>
<p> if <code>type = "slice.z"</code> at which level ("slice") of <code>z</code> should the effect estimates of the
<code>x</code> be obtained. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp</code></td>
<td>
<p> if set to TRUE (default), the log relative hazard is given, otherwise the relative hazard
is requested for <code>type = "shape"</code>, <code>"slice.time"</code>, <code>"slice.x"</code>,
or <code>"slice.z"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.fit</code></td>
<td>
<p>if set to TRUE, pointwise standard errors are produced for the predictions for
<code>type = "shape"</code>, <code>"slice.time"</code>, <code>"slice.x"</code>, or <code>"slice.z"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pval</code></td>
<td>
<p> if set to TRUE add Wald-test p-values to effect estimates at values of
<code>newx</code> for <code>type = "shape"</code>, <code>"slice.time"</code>, <code>"slice.x"</code>,
or <code>"slice.z"</code>. Default is set to FALSE. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p> number of printed digits. Default is 4. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p> if set to TRUE (default), results are printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p> further parameters. </p>
</td>
</tr>
</table>
<h3>Details</h3>

<p> This function can be used to depict the estimated nonlinear or time-dependent
effect of an object of class <code>coxphw</code>. It supports simple nonlinear
effects as well as interaction effects of a continuous variable with a binary
covariate or with time (see examples section).
</p>
<p>If the effect estimates of a simple nonlinear effect of <code>x</code> without
interaction is requested with <code>type = "shape"</code>, then <code>x</code> (the usually
continuous covariate), <code>refx</code> (the reference value of <code>x</code>) and <code>newx</code>
(for these values of <code>x</code> the effect estimates are obtained) must be given.
</p>
<p>If the effect estimates of an interaction of <code>z</code> with <code>x</code> are requested
with <code>type = "slice.x"</code>, then <code>x</code> (the usually continuous variable),
<code>z</code> (the categorical variable) and <code>newx</code> (for these values of <code>x</code>
the effect estimates are obtained) must be given.
</p>
<p>If the effect estimates of an interaction of <code>z</code> with <code>x</code> for one level of <code>z</code>
are requested with <code>type = "slice.z"</code>), then <code>x</code> (the usually continuous variable),
<code>z</code> (the categorical variable), <code>at</code> (at which level of <code>z</code>),
<code>refx</code> (the reference value of <code>x</code>), and <code>newx</code> (for these values of <code>x</code>
the effect estimates are obtained) must be given.
</p>
<p>If the effect estimates of an interaction of <code>z</code> with <code>time</code> are requested
with <code>type = "slice.time"</code>, then <code>x</code> (the <code>time</code>), <code>z</code> (the
categorical variable) and <code>newx</code> (for these values of <code>x</code> the effect
estimates are obtained) must be given.
</p>
<p>Note that if the model formula contains time-by-covariate interactions, then the linear predictor
and the risk score are obtained for the failure or censoring time of each subject.
</p>


<h3>Value</h3>

<p> If <code>type = "shape"</code>, <code>"slice.time"</code>, <code>"slice.x"</code>, or <code>"slice.z"</code>
a list with the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>estimates</code></td>
<td>
<p> a matrix with estimates of (log) relative hazard and corresponding confidence limits. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p> pointwise standard errors, only if <code>se.fit = TRUE</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p> p-value, only if <code>pval = TRUE</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p> the significance level = 1 - confidence level. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exp</code></td>
<td>
<p> an indicator if log relative hazard or relative hazard was obtained. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p> name of <code>x</code>. </p>
</td>
</tr>
</table>
<p>If  <code>type = "lp"</code> or <code>"risk"</code>, a vector.
</p>


<h3>Note</h3>

<p> In <span class="pkg">coxphw</span> version 4.0.0 the old <code>plotshape</code> function is replaced with
<code>predict.coxphw</code> and <code>plot.coxphw.predict</code>. </p>


<h3>Author(s)</h3>

<p>Georg Heinze, Meinhard Ploner, Daniela Dunkler</p>


<h3>References</h3>

<p> Royston P and Altman D (1994). Regression Using Fractional Polynomials of Continuous
Covariates: Parsimonious Parametric Modelling. <em>Applied Statistics</em> <b>43</b>, 429-467.
</p>
<p>Royston P and Sauerbrei W (2008). <em>Multivariable Model-building. A pragmatic approach to regression
analysis based on fractional polynomials for modelling continuous variables.</em> Wiley, Chichester, UK. </p>


<h3>See Also</h3>

<p><code>coxphw</code>, <code>plot.coxphw.predict</code> </p>


<h3>Examples</h3>

<pre><code class="language-R">### Example for type = "slice.time"
data("gastric")
gastric$yrs &lt;- gastric$time / 365.25

# check proportional hazards
fitcox &lt;- coxph(Surv(yrs, status) ~ radiation + cluster(id), data = gastric, x = TRUE,
                method = "breslow")
fitcox.ph &lt;- cox.zph(fit = fitcox, transform = "identity")


## compare and visualize linear and log-linear time-dependent effects of radiation
fit1 &lt;- coxphw(Surv(yrs, status) ~ yrs * radiation, data = gastric, template = "PH")
summary(fit1)

predict(fit1, type = "slice.time", x = "yrs", z = "radiation", newx = c(0.5, 1, 2),
        verbose = TRUE, exp = TRUE, pval = TRUE)


fit2 &lt;- coxphw(Surv(yrs, status) ~ log(yrs) * radiation, data = gastric, template = "PH")
summary(fit2)

predict(fit2, type = "slice.time", x = "yrs", z = "radiation", newx = c(0.5, 1, 2),
        verbose = TRUE, exp = TRUE, pval = TRUE)


plotx &lt;- seq(from = quantile(gastric$yrs, probs = 0.05),
             to = quantile(gastric$yrs, probs = 0.95), length = 100)
y1 &lt;- predict(fit1, type = "slice.time", x = "yrs", z = "radiation", newx = plotx)
y2 &lt;- predict(fit2, type = "slice.time", x = "yrs", z = "radiation", newx = plotx)

plot(x = fitcox.ph, se = FALSE, xlim = c(0, 3), las = 1, lty = 3)
abline(a = 0, b = 0, lty = 3)
lines(x = plotx, y = y1$estimates[, "coef"], col = "red", lty = 1, lwd = 2)
lines(x = plotx, y = y2$estimates[, "coef"], col = "blue", lty = 2, lwd = 2)
legend(x = 1.7, y = 1.6, title = "time-dependent effect", title.col = "black",
       legend = c("LOWESS", "linear", "log-linear"), col = c("black", "red", "blue"),
       lty = c(3, 1:2), bty = "n", lwd = 2, text.col = c("black", "red", "blue"))



### Example for type = "shape"
set.seed(512364)
n &lt;- 200
x &lt;- 1:n
true.func &lt;- function(x) 2.5 * log(x) - 2
x &lt;- round(runif(x) * 60 + 10, digits = 0)
time &lt;- round(100000 * rexp(n= n, rate = 1) / exp(true.func(x)), digits = 1)
event &lt;- rep(x = 1, times = n)
my.data &lt;- data.frame(x,time,event)

fit &lt;- coxphw(Surv(time, event) ~ log(x) + x, data = my.data, template = "AHR")

predict(fit, type = "shape", newx = c(30, 50), refx = 40, x = "x", verbose = TRUE)

plotx &lt;- seq(from = quantile(x, probs = 0.05),
             to = quantile(x, probs = 0.95), length = 100)
plot(predict(fit, type = "shape", newx = plotx, refx = 40, x = "x"))


### Example for type = "slice.x" and "slice.z"
set.seed(75315)
n &lt;- 200
trt &lt;- rbinom(n = n, size = 1, prob = 0.5)
x &lt;- 1:n
true.func &lt;- function(x) 2.5 * log(x) - 2
x &lt;- round(runif(n = x) * 60 + 10, digits = 0)
time &lt;- 100 * rexp(n = n, rate = 1) / exp(true.func(x) /
                                      4 * trt - (true.func(x) / 4)^2 * (trt==0))
event &lt;- rep(x = 1, times = n)
my.data &lt;- data.frame(x, trt, time, event)

fun&lt;-function(x) x^(-2)
fit &lt;- coxphw(Surv(time, event) ~ x * trt + fun(x) * trt , data = my.data,
              template = "AHR", verbose = FALSE)

# plots the interaction of trt with x (the effect of trt dependent on the values of x)
plotx &lt;- quantile(x, probs = 0.05):quantile(x, probs = 0.95)
plot(predict(fit, type = "slice.x", x = "x", z = "trt",
             newx = plotx, verbose = FALSE), main = "interaction of trt with x")

# plot the effect of x in subjects with trt = 0
y0 &lt;- predict(fit, type = "slice.z", x = "x", z = "trt", at = 0, newx = plotx,
              refx = median(x), verbose = FALSE)
plot(y0, main = "effect of x in subjects with trt = 0")


# plot the effect of x in subjects with trt = 1
y1 &lt;- predict(fit, type = "slice.z", x = "x", z = "trt", at = 1, newx = plotx,
              refx = median(x), verbose = FALSE)
plot(y1, main = "effect of x in subjects with trt = 1")


# Example for type = "slice.time"
set.seed(23917)
time &lt;- 100 * rexp(n = n, rate = 1) / exp((true.func(x) / 10)^2 / 2000 * trt + trt)
event &lt;- rep(x = 1, times = n)
my.data &lt;- data.frame(x, trt, time, event)
plot.x &lt;- seq(from = 1, to = 100, by = 1)

fun  &lt;- function(t) { PT(t)^-2 * log(PT(t)) }
fun2 &lt;- function(t) { PT(t)^-2 }
fitahr &lt;- coxphw(Surv(time, event) ~ fun(time) * trt + fun2(time) * trt + x,
                 data = my.data, template = "AHR")
yahr &lt;- predict(fitahr, type = "slice.time", x = "time", z = "trt", newx = plot.x)

fitph &lt;- coxphw(Surv(time, event) ~ fun(time) * trt + fun2(time) * trt + x,
                data = my.data, template = "PH")
yph &lt;- predict(fitph, type = "slice.time", x = "time", z = "trt", newx = plot.x)

plot(yahr, addci = FALSE)
lines(yph$estimates$time, yph$estimates$coef, lty = 2)
legend("bottomright", legend = c("AHR", "PH"), bty = "n", lty = 1:2,
       inset = 0.05)
</code></pre>


</div>