<div class="container">

<table style="width: 100%;"><tr>
<td>plot_probabilities_ecdf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot ECDF for the predicted probabilities</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
</p>
<p>Plots the empirical cumulative distribution function (ECDF) for the
probabilities of either the target classes or the predicted classes.
</p>
<p>Creates a <code>ggplot2</code> with the <code>stat_ecdf()</code> geom.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_probabilities_ecdf(
  data,
  target_col,
  probability_cols,
  predicted_class_col = NULL,
  obs_id_col = NULL,
  group_col = NULL,
  probability_of = "target",
  positive = 2,
  theme_fn = ggplot2::theme_minimal,
  color_scale = ggplot2::scale_colour_brewer(palette = "Dark2"),
  apply_facet = length(probability_cols) &gt; 1,
  add_caption = TRUE,
  ecdf_settings = list(),
  facet_settings = list(),
  xlim = c(0, 1)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p><code>data.frame</code> with probabilities, target classes and (optional) predicted classes.
Can also include observation identifiers and a grouping variable.
</p>
<p>Example for binary classification:
</p>

<table>
<tr>
<td style="text-align: right;">
  <strong>Classifier</strong> </td>
<td style="text-align: right;"> <strong>Observation</strong> </td>
<td style="text-align: right;"> <strong>Probability</strong> </td>
<td style="text-align: right;"> <strong>Target</strong> </td>
<td style="text-align: right;"> <strong>Prediction</strong>  </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.3 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_1 </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.7 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.2 </td>
<td style="text-align: right;"> cl_2 </td>
<td style="text-align: right;"> cl_1 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.8 </td>
<td style="text-align: right;"> cl_2 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>Example for multiclass classification:
</p>

<table>
<tr>
<td style="text-align: right;">
  <strong>Classifier</strong> </td>
<td style="text-align: right;"> <strong>Observation</strong> </td>
<td style="text-align: right;"> <strong>cl_1</strong> </td>
<td style="text-align: right;"> <strong>cl_2</strong> </td>
<td style="text-align: right;"> <strong>cl_3</strong> </td>
<td style="text-align: right;"> <strong>Target</strong> </td>
<td style="text-align: right;"> <strong>Prediction</strong>  </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.2 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> 0.7 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_3 </td>
</tr>
<tr>
<td style="text-align: right;">
  SVM </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.3 </td>
<td style="text-align: right;"> 0.5 </td>
<td style="text-align: right;"> 0.2 </td>
<td style="text-align: right;"> cl_1 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 1 </td>
<td style="text-align: right;"> 0.8 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> cl_2 </td>
<td style="text-align: right;"> cl_1 </td>
</tr>
<tr>
<td style="text-align: right;">
  NB </td>
<td style="text-align: right;"> 2 </td>
<td style="text-align: right;"> 0.1 </td>
<td style="text-align: right;"> 0.6 </td>
<td style="text-align: right;"> 0.3 </td>
<td style="text-align: right;"> cl_3 </td>
<td style="text-align: right;"> cl_2 </td>
</tr>
<tr>
<td style="text-align: right;">
  ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
<td style="text-align: right;"> ... </td>
</tr>
<tr>
<td style="text-align: right;">
 </td>
</tr>
</table>
<p>As created with the various validation functions in <code>cvms</code>, like
<code>cross_validate_fn()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>target_col</code></td>
<td>
<p>Name of column with target levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probability_cols</code></td>
<td>
<p>Name of columns with predicted probabilities.
</p>
<p>For <strong>binary</strong> classification, this should be <strong>one column</strong> with the probability of the
<strong>second class</strong> (alphabetically).
</p>
<p>For <strong>multiclass</strong> classification, this should be <strong>one column per class</strong>.
These probabilities must sum to <code>1</code> row-wise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>predicted_class_col</code></td>
<td>
<p>Name of column with predicted classes.
</p>
<p>This is required when <code>probability_of = "prediction"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obs_id_col</code></td>
<td>
<p>Name of column with observation identifiers for averaging the
predicted probabilities per observation before computing the ECDF (<em>when deemed meaningful</em>).
When <code>NULL</code>, each row is an observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group_col</code></td>
<td>
<p>Name of column with groups. The plot elements
are split by these groups and can be identified by their color.
</p>
<p>E.g. the <em>classifier</em> responsible for the prediction.
</p>
<p><strong>N.B.</strong> With more than <strong><code>8</code></strong> groups,
the default <code>`color_scale`</code> might run out of colors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probability_of</code></td>
<td>
<p>Whether to plot the ECDF for the probabilities of the
target classes (<code>"target"</code>) or the predicted classes (<code>"prediction"</code>).
</p>
<p>For each row, we extract the probability of either the
<em>target class</em> or the <em>predicted class</em>. Both are useful
to plot, as they show the behavior of the classifier in a way a confusion matrix doesn't.
One classifier might be very certain in its predictions (whether wrong or right), whereas
another might be less certain.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>positive</code></td>
<td>
<p>TODO</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theme_fn</code></td>
<td>
<p>The <code>ggplot2</code> theme function to apply.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_scale</code></td>
<td>
<p><code>ggplot2</code> color scale object for adding discrete colors to the plot.
</p>
<p>E.g. the output of
<code>ggplot2::scale_colour_brewer()</code> or
<code>ggplot2::scale_colour_viridis_d()</code>.
</p>
<p><strong>N.B.</strong> The number of colors in the object's palette should be at least the same as
the number of groups in the <code>`group_col`</code> column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apply_facet</code></td>
<td>
<p>Whether to use
<code>ggplot2::facet_wrap()</code>. (Logical)
</p>
<p>By default, faceting is applied when there are more than one probability column (multiclass).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add_caption</code></td>
<td>
<p>Whether to add a caption explaining the plot. This is dynamically generated
and intended as a starting point. (Logical)
</p>
<p>You can overwrite the text with <code>ggplot2::labs(caption = "...")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ecdf_settings</code></td>
<td>
<p>Named list of arguments for <code>ggplot2::stat_ecdf()</code>.
</p>
<p>The <code>mapping</code> argument is set separately.
</p>
<p>Any argument not in the list will use the default value set by <code>cvms</code>.
</p>
<p>Defaults: <code>list(geom = "smooth", pad = FALSE)</code>.
</p>
<p>Common changes are to set <code>`geom = "step"`</code> and/or <code>`pad = TRUE`</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet_settings</code></td>
<td>
<p>Named list of arguments for <code>ggplot2::facet_wrap()</code>.
</p>
<p>The <code>facets</code> argument is set separately.
</p>
<p>Any argument not in the list will use its default value.
</p>
<p>Commonly set arguments are <code>nrow</code> and <code>ncol</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>Limits for the x-scale.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>TODO
</p>


<h3>Value</h3>

<p>A <code>ggplot2</code> object with a faceted line plot. TODO
</p>


<h3>Author(s)</h3>

<p>Ludvig Renbo Olsen, <a href="mailto:r-pkgs@ludvigolsen.dk">r-pkgs@ludvigolsen.dk</a>
</p>


<h3>See Also</h3>

<p>Other plotting functions: 
<code>font()</code>,
<code>plot_confusion_matrix()</code>,
<code>plot_metric_density()</code>,
<code>plot_probabilities()</code>,
<code>sum_tile_settings()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Attach cvms
library(cvms)
library(ggplot2)
library(dplyr)

#
# Multiclass
#

# TODO: Go through and rewrite comments and code!

# Plot probabilities of target classes
# From repeated cross-validation of three classifiers

# plot_probabilities_ecdf(
#   data = predicted.musicians,
#   target_col = "Target",
#   probability_cols = c("A", "B", "C", "D"),
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   probability_of = "target"
# )

# Plot probabilities of predicted classes
# From repeated cross-validation of three classifiers

# plot_probabilities_ecdf(
#   data = predicted.musicians,
#   target_col = "Target",
#   probability_cols = c("A", "B", "C", "D"),
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   probability_of = "prediction"
# )

#
# Binary
#

# Filter the predicted.musicians dataset
# binom_data &lt;- predicted.musicians %&gt;%
#   dplyr::filter(
#     Target %in% c("A", "B")
#   ) %&gt;%
#   # "B" is the second class alphabetically
#   dplyr::rename(Probability = B) %&gt;%
#   dplyr::mutate(`Predicted Class` = ifelse(
#     Probability &gt; 0.5, "B", "A")) %&gt;%
#   dplyr::select(-dplyr::all_of(c("A","C","D")))

# Plot probabilities of predicted classes
# From repeated cross-validation of three classifiers

# plot_probabilities_ecdf(
#   data = binom_data,
#   target_col = "Target",
#   probability_cols = "Probability",
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   probability_of = "target"
# )

# plot_probabilities_ecdf(
#   data = binom_data,
#   target_col = "Target",
#   probability_cols = "Probability",
#   predicted_class_col = "Predicted Class",
#   group_col = "Classifier",
#   probability_of = "prediction",
#   xlim = c(0.5, 1)
# )


</code></pre>


</div>