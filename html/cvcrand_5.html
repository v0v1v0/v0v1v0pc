<div class="container">

<table style="width: 100%;"><tr>
<td>cvrcov</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Covariate-by-covariate constrained randomization for cluster randomized trials</h2>

<h3>Description</h3>

<p><code>cvrcov</code> performs covariate-by-covariate constrained randomization for cluster randomized
trials (CRTs), especially suited for CRTs with a small number of clusters. In constrained randomization,
a randomization scheme is randomly sampled from a subset of all possible randomization schemes
based on the constraints on each covariate. 
</p>
<p>The <code>cvrcov</code> function enumerates all randomization schemes or simulates a fixed size of unique randomization schemes as specified by the user.
A subset of the randomization schemes is chosen based on user-specified covariate-by-covariate constraints.  <code>cvrcov</code> treats the subset as the constrained space 
of randomization schemes and samples one scheme from the constrained space as the final chosen scheme.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cvrcov(
  clustername = NULL,
  x,
  categorical = NULL,
  constraints,
  ntotal_cluster,
  ntrt_cluster,
  size = 50000,
  seed = NULL,
  nosim = FALSE,
  savedata = NULL,
  check_validity = FALSE,
  samearmhi = 0.75,
  samearmlo = 0.25
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>clustername</code></td>
<td>
<p>a vector specifying the identification variable of the cluster. If no cluster identification variable is specified, the default is to label the clusters based on the order in which they appear.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a data frame specifying the values of cluster-level covariates to balance. With K covariates and n clusters, it will be dimension of <code>n</code> by <code>K</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>categorical</code></td>
<td>
<p>a vector specifying categorical (including binary) variables. This can be names of the columns or number indexes of columns, but cannot be both. Suppose there are <code>p</code> categories for a categorical variable, <code>cvcrand</code> function creates <code>p-1</code> dummy variables and drops the reference level if the variable is specified as a factor. Otherwise, the first level in the alphanumerical order will be dropped. The results are sensitive to which level is excluded. If the user wants to specify a different level to drop for a <code>p</code>-level categorical variable, the user can create <code>p-1</code> dummy variables and these can instead be supplied as covariates to the <code>cvcrand</code> function. Then, the user needs to specify the dummy variables created to be <code>categorical</code> when running <code>cvcrand</code>. In addition, the user could also set the variable as a factor with the specific reference level. If the <code>weights</code> option is used, the weights for a categorical variable will be replicated on all the dummy variables created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constraints</code></td>
<td>
<p>a vector of user-specified constraints for all covariates. <code>"any"</code> means no constraints. If not <code>"any"</code>, the first character letter of <code>"m"</code> denotes absolute mean difference, and <code>"s"</code> means absolute sum difference. If the second character is <code>"f"</code>, the previous metric is constrained to be smaller or equal to the fraction with the number followed of the overall mean for <code>"m"</code> or mean arm total for <code>"s"</code>. If not <code>"f"</code> at the second character, the metric is just constrained to be smaller or equal to the value following letter(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntotal_cluster</code></td>
<td>
<p>the total number of clusters to be randomized. It must be a positive integer and equal to the number of rows of the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntrt_cluster</code></td>
<td>
<p>the number of clusters that the researcher wants to assign to the treatment arm. It must be a positive integer less than the total number of clusters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size</code></td>
<td>
<p>number of randomization schemes to simulate if the number of all possible randomization schemes is over <code>size</code>. Its default is <code>50,000</code>, and must be a positive integer. It can be overriden by the <code>nosim</code> option.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>seed for simulation and random sampling. It is needed so that the randomization can be replicated. Its default is <code>12345</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nosim</code></td>
<td>
<p>if TRUE, it overrides the default procedure of simulating when the number of all possible randomization schemes is over <code>size</code>, and the program enumerates all randomization schemes. Note: this may consume a lot of memory and cause R to crash</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savedata</code></td>
<td>
<p>saves the data set of the constrained randomization space in a csv file if specified by <code>savedata</code>. The first column of the csv file is an indicator variable of the final randomization scheme in the constrained space. The constrained randomization space will be needed for analysis after the cluster randomized trial is completed if the clustered permutation test is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check_validity</code></td>
<td>
<p>boolean argument to check the randomization validity or not</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samearmhi</code></td>
<td>
<p>clusters assigned to the same arm as least this often are displayed. The default is <code>0.75</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samearmlo</code></td>
<td>
<p>clusters assigned to the same arm at most this often are displayed. The default is <code>0.25</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>allocation</code> the allocation scheme from constrained randomization
</p>
<p><code>assignment_message</code> the statement about how many clusters to be randomized to the intervention and the control arms respectively
</p>
<p><code>scheme_message</code> the statement about how to get the whole randomization space to use in constrained randomization
</p>
<p><code>data_CR</code> the data frame containing the allocation scheme, the <code>clustername</code>, and the original data frame of covariates
</p>
<p><code>baseline_table</code> the descriptive statistics for all the variables by the two arms from the selected scheme
</p>
<p><code>cluster_coincidence</code> cluster coincidence matrix
</p>
<p><code>cluster_coin_des</code> cluster coincidence descriptive
</p>
<p><code>clusters_always_pair</code> pairs of clusters always allocated to the same arm.
</p>
<p><code>clusters_always_not_pair</code> pairs of clusters always allocated to different arms.
</p>
<p><code>clusters_high_pair</code>  pairs of clusters randomized to the same arm at least <code>samearmhi</code> of the time.
</p>
<p><code>clusters_low_pair</code> pairs of clusters randomized to the same arm at most <code>samearmlo</code> of the time.
</p>
<p><code>overall_allocations</code> frequency of acceptable overall allocations.
</p>
<p><code>overall_summary</code> summary of covariates with constraints in the constrained space
</p>


<h3>Author(s)</h3>

<p>Hengshi Yu &lt;hengshi@umich.edu&gt;, Fan Li &lt;fan.f.li@yale.edu&gt;, John A. Gallis &lt;john.gallis@duke.edu&gt;, Elizabeth L. Turner &lt;liz.turner@duke.edu&gt;
</p>


<h3>References</h3>

<p>Raab, G.M. and Butcher, I., 2001. Balance in cluster randomized trials. Statistics in medicine, 20(3), pp.351-365.
</p>
<p>Li, F., Lokhnygina, Y., Murray, D.M., Heagerty, P.J. and DeLong, E.R., 2016. An evaluation of constrained randomization for the design and analysis of group randomized trials. Statistics in medicine, 35(10), pp.1565-1579.
</p>
<p>Li, F., Turner, E. L., Heagerty, P. J., Murray, D. M., Vollmer, W. M., &amp; DeLong, E. R. (2017). An evaluation of constrained randomization for the design and analysis of group randomized trials with binary outcomes. Statistics in medicine, 36(24), 3791-3806.
</p>
<p>Gallis, J.A., Li, F., Yu, H. and Turner, E.L., 2018. cvcrand and cptest: Commands for efficient design and analysis of cluster randomized trials using constrained randomization and permutation tests. The Stata Journal, 18(2), pp.357-378.
</p>
<p>Dickinson, L. M., Beaty, B., Fox, C., Pace, W., Dickinson, W. P., Emsermann, C., &amp; Kempe, A. (2015). Pragmatic cluster randomized trials using covariate constrained randomization: A method for practice-based research networks (PBRNs). The Journal of the American Board of Family Medicine, 28(5), 663-672.
</p>
<p>Bailey, R.A. and Rowley, C.A., 1987. Valid randomization. Proceedings of the Royal Society of London. A. Mathematical and Physical Sciences, 410(1838), pp.105-124.
</p>
<p>Greene, E.J., 2017. A SAS macro for covariate-constrained randomization of general cluster-randomized and unstratified designs. Journal of statistical software, 77(CS1).
</p>


<h3>Examples</h3>

<pre><code class="language-R">

# cvrcov example

Dickinson_design_numeric &lt;- Dickinson_design
Dickinson_design_numeric$location = (Dickinson_design$location == "Rural") * 1
Design_cov_result &lt;- cvrcov(clustername = Dickinson_design_numeric$county,
                            x = data.frame(Dickinson_design_numeric[ , c("location", "inciis",
                                "uptodateonimmunizations", "hispanic", "income")]),
                            ntotal_cluster = 16,
                            ntrt_cluster = 8,
                            constraints = c("s5", "mf.5", "any", "mf0.2", "mf0.2"), 
                            categorical = c("location"),
                            ###### Option to save the constrained space ######
                            # savedata = "dickinson_cov_constrained.csv",
                            seed = 12345, 
                            check_validity = TRUE)


</code></pre>


</div>