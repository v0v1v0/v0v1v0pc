<div class="container">

<table style="width: 100%;"><tr>
<td>tabBook</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute a Tab Book</h2>

<h3>Description</h3>

<p>This function allows you to generate a tab book from a multitable and data.
As with other functions, you can select the rows and columns you want to
work with by subsetting the <code>dataset</code> you pass into the function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">tabBook(
  multitable,
  dataset,
  weight = crunch::weight(dataset),
  output_format = c("json", "xlsx", "csv"),
  file,
  filter = NULL,
  use_legacy_endpoint = envOrOption("use.legacy.tabbook.endpoint", FALSE, expect_lgl =
    TRUE),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>multitable</code></td>
<td>
<p>a <code>Multitable</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>CrunchDataset, which may be subset with a filter expression
on the rows, and a selection of variables to use on the columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>
<p>a CrunchVariable that has been designated as a potential
weight variable for <code>dataset</code>, or <code>NULL</code> for unweighted results.
Default is the currently applied <code>weight</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_format</code></td>
<td>
<p>character export format: currently supported values are "json"
(default), "xlsx" and "csv".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file</code></td>
<td>
<p>character local filename to write to. A default filename will be
generated from the <code>multitable</code>'s name if one is not supplied and the
"xlsx" format is requested. Not required for "json" format export.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter</code></td>
<td>
<p>a Crunch <code>filter</code> object or a vector of names
of <code>filters</code> defined in the dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_legacy_endpoint</code></td>
<td>
<p>Logical, indicating whether to use a 'legacy'
endpoint for compatibility (this endpoint will be removed in the future).
Defaults to <code>FALSE</code>, but can be set in the function, or with the environment
variable <code>R_USE_LEGACY_TABBOOK_ENDPOINT</code> or R option
<code>use.legacy.tabbook.endpoint</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional "options" passed to the tab book POST request.
More details can be found
<a href="https://crunch.io/api/reference/#post-/datasets/-dataset_id-/multitables/">in the crunch API documentation</a></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>By specifying a "json" <code>format</code>, instead of generating an Excel
workbook, you'll get a TabBookResult object, containing nested CrunchCube
results. You can then further format these and construct custom tab reports.
</p>


<h3>Value</h3>

<p>If "json" format is requested, the function returns an object of
class <code>TabBookResult</code>, containing a list of <code>MultitableResult</code>
objects, which themselves contain <code>CrunchCube</code>s. If "xlsx" or "csv", is requested,
the function invisibly returns the filename (<code>file</code>, if specified, or the
the autogenerated file name). If you request "json" and wish to access the
JSON data underlying the <code>TabBookResult</code>, pass in a path for <code>file</code>
and you will get a JSON file written there as well.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Excel export
m &lt;- newMultitable(~ gender + age4 + marstat, data = ds)
tabBook(m, ds, format = "xlsx", file = "wealthy-tab-book.xlsx", filter = "wealthy")

# csv export
tabBook(
    m,
    ds[c("q5a", "q8", "q2a_1", "q2a_2")],
    output_format = "csv",
    file = "tabbook.csv",
    format = list(
        pval_colors = FALSE,
        decimal_places = list(percentages = 0L, other = 2L),
        show_empty = FALSE
    ),
    sig_threshold = 0.05,
    doc_layout = list(toc = FALSE, variable_sheets = "one_sheet"),
    fields = c(
        "col_percent", "row_percent", "count_unweighted", "mean",
        "valid_count_weighted", "valid_count_unweighted"
    ),
    page_layout = list(
        rows = list(
            top = c("base_weighted", "base_unweighted"),
            bottom = c("scale_mean", "scale_median")
        ),
        measure_layout = "long"
    )
)

# JSON export (loads into R)
book &lt;- tabBook(m, ds)
tables &lt;- prop.table(book, 2)


## End(Not run)
</code></pre>


</div>