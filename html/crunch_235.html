<div class="container">

<table style="width: 100%;"><tr>
<td>expressions</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Construct Crunch Expressions from Crunch Database Functions</h2>

<h3>Description</h3>

<p>Crunch Expressions, i.e. <code>CrunchExpr</code> and <code>CrunchLogicalExpr</code>,
encapsulate derivations of Crunch variables, possibly composed of other functions
which are only evaluated when sent to the server when creating a variable using <code>VarDef()</code>
or using <code>as.vector()</code> to get data. The crunch database functions can be found in the
<a href="https://help.crunch.io/hc/en-us/articles/360042411792-Expressions">Help Center</a>,
and can be called directly via <code>crunchdbFunc()</code>m but many have also been wrapped
in native R functions, and are described in the details section below.
</p>


<h3>Usage</h3>

<pre><code class="language-R">crunchdbFunc(fun, x, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>The name of the crunch database function to call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An input, a crunch variable, expression or R object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed to the database function</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Logical expressions
</p>

<ul>
<li>
<p> These logical operators <code>==</code>, <code>!=</code>, <code>&amp;</code>, <code>|</code>, <code>!</code>,<code>%in%</code>  work the same way as their
base R counterparts
</p>
</li>
<li> <p><code>is.selected(x)</code> return <code>CrunchLogicalExpr</code> whether a value is in a selected category
</p>
</li>
<li> <p><code>rowAny(x)</code> and <code>rowAll(x)</code> work row-wise on <code>MultipleResponse</code> Variables (and expressions),
though <code>na.rm</code> is not implemented for <code>all(x)</code>.
<code style="white-space: pre;">⁠%ornm%⁠</code> is similar to <code>|</code>, but where "not selected" beats "missing" (so <code>FALSE %ornm% NA</code>
is <code>FALSE</code> instead of <code>NA</code> as it would be with <code>FALSE | NA</code>)
</p>
</li>
</ul>
<p>Comparisons
</p>

<ul>
<li>
<p> Comparison operators <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code> work the same way as their base R counterparts.
</p>
</li>
<li> <p><code>crunchBetween(x, lower, upper, inclusive)</code> to provide lower and upper bounds in a single
expression.
</p>
</li>
</ul>
<p>Missing data expressions
</p>

<ul>
<li> <p><code>is.na(x)</code>, <code>is.valid(x)</code> return <code>CrunchLogicalExpr</code> whether a single variable (or expression
that creates one) is missing (or not missing).
</p>
</li>
<li> <p><code>rowAnyNA(x)</code>, <code>rowAllNA(x)</code> return <code>CrunchLogicalExpr</code> whether any/all values in an
array variable (or expression that creates one) are missing.
</p>
</li>
<li> <p><code>complete.cases(x)</code> returns an expression that is "selected" if all cases are non-missing,
"missing" if they are all missing, and "other" otherwise.
</p>
</li>
</ul>
<p>Selection expressions
</p>

<ul>
<li> <p><code>selectCategories(x, selections, collapse = TRUE)</code> takes a categorical variable (or array)
and marks categories as selected. <code>selections</code> should be a list of category names or
values. If <code>collapse</code> is <code>TRUE</code>, (the default), it collapses the categories to "selected",
"other" and "missing", but it is <code>FALSE</code>, then the old categories are preserved.
</p>
</li>
<li> <p><code>asSelected(x)</code> returns an expression that condenses a categorical into 3 categories
("selected", "other" or "missing")
</p>
</li>
<li> <p><code>selectedDepth(x)</code> returns an expression that creates a numeric variable that counts the
number of selections across rows of an array variable (or expression that creates one)
</p>
</li>
<li> <p><code>arraySelections(x)</code> returns an expression that takes an array and creates an array with
each variable condensed to "selected", "other" or "missing" and an extra subvariable
"<strong>any</strong>" that indicates whether any is selected.
</p>
</li>
<li> <p><code>alterCategoriesExpr(x, categories = NULL, category_order = NULL, subvariables = NULL)</code>
Change the category names, order, or subvariable names of categorical or Array variables
(can only modify existing ones, not add or remove categories or subvariables).
<code>categories</code> is a <code>Categories</code> object or a list of lists, each with a <code>name</code> indicating
the new name, as well as an <code>id</code> or <code>old_name</code> to identify which category to modify.
<code>category_order</code> is either a numeric vector indicating category ids or a character vector
indicating the names of the categories in the order they should be displayed
(note that all categories must be specified). <code>subvariables</code> is  a list of lists, each with
a <code>name</code> to rename the subvariable and an <code>alias</code>, <code>old_nam</code> or <code>id</code> to identify the
subvariable. When <code>x</code> is an expression, all categories and subvariables must be identified
by <code>id</code>.
</p>
</li>
</ul>
<p>Array expressions
</p>

<ul>
<li> <p><code>makeFrame(x, numeric = NULL)</code> an expression that creates an array from existing
variables or expressions, see <code>deriveArray()</code> for more details
</p>
</li>
<li> <p><code>arraySubsetExpr(x, subvars, subvar_id = c("alias", "name", "id"))</code> Take a subset of an
existing array variable, identifying the subvariables by alias, name, or id (if <code>x</code> is
an expression, you must use id).
</p>
</li>
<li> 
<div class="sourceCode"><pre> alterArrayExpr(
   x,
   add = NULL,
   order = NULL,
   order_id = c("alias", "name", "id"),
   remove = NULL,
   remove_id = c("alias", "name", "id"),
   subreferences = NULL,
   subreferences_id = c("alias", "name", "id")
)
</pre></div>
<p>Add, reorder, remove or rename subvariables on an an array variable <code>x</code>. The <code>add</code> argument is
a list of variables or expressions, optionally named with the id they should have. <code>order</code>
and <code>remove</code> are vectors of aliases, names or ids (specify which with <code>order_id</code>/<code>remove_id</code>).
The <code>subreferences</code> object is a list of lists that are named the alias, name, or id (again
specify which with <code>subreferences_id</code>) with metadata information like name and alias in the
list.
</p>
</li>
</ul>
<p>Miscellaneous expressions
</p>

<ul>
<li> <p><code>caseExpr(..., cases)</code> Create a categorical variable from
a set of logical expressions that when met are assigned to a category. See
<code>makeCaseVariable()</code> for more details.
</p>
</li>
<li> <p><code>bin(x)</code> returns a column's values binned into equidistant bins.
</p>
</li>
<li> <p><code>nchar(x)</code> returns a numeric value indicating the length of a string (or missing reason)
in a <code>TextVariable</code> (or expression that creates one)
</p>
</li>
<li> <p><code>unmissing(x)</code> for a <code>NumericVariable</code> (or expression that creates one) return the values of
the data, ignoring the ones set to missing.
</p>
</li>
<li> <p><code>trim(x, min, max)</code> for a <code>NumericVariable</code> (or expression that creates one) return values
that where all values less than <code>min</code> have been replaced with <code>min</code> and all values greater
than <code>max</code> have been
</p>
</li>
<li> <p><code>crunchDifftime(e1, e2, resolution)</code> Gets the difference between two datetimes as a number
with specified resolution units (one of <code>c("Y", "Q", "M", "W", "D", "h", "m", "s", "ms")</code>).
</p>
</li>
<li> <p><code>datetimeFromCols(year, month, day, hours, minutes, seconds)</code> create a <code>Datetime</code> variable
from numeric variables or expressions (<code>year</code>, <code>month</code>, and <code>day</code> are required, but <code>hours</code>,
<code>minutes</code>, and <code>seconds</code> are optional)
</p>
</li>
<li> <p><code>rollup(x, resolution)</code> sets the resolution of a datetime variable or expression, see
<code>resolution()</code>
</p>
</li>
</ul>
</div>